<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Elysia 1.3 和科学巫术 - Elysia 中文文档</title>
    <meta name="description" content="近乎 0 的开销规范化，配合精确镜像、Bun 系统路由器、独立验证器、减少一半的类型实例化，以及显著降低内存使用和快速启动大型应用的时间">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style.DxhFWJeQ.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BFhO6Lf6.js"></script>
    <link rel="modulepreload" href="/assets/chunks/plugin-vue_export-helper.CKgBKD3c.js">
    <link rel="modulepreload" href="/assets/chunks/preload-helper.CPrT4D5T.js">
    <link rel="modulepreload" href="/assets/chunks/client.Bm-rI_R6.js">
    <link rel="modulepreload" href="/assets/chunks/use-dark.D_Ezswh_.js">
    <link rel="modulepreload" href="/assets/chunks/ray.DH5EacAR.js">
    <link rel="modulepreload" href="/assets/chunks/sponsor.data.9Il3pjW5.js">
    <link rel="modulepreload" href="/assets/chunks/floating-ui.core.DWOiM_yY.js">
    <link rel="modulepreload" href="/assets/chunks/vue.runtime.esm-bundler.BB7fvrom.js">
    <link rel="modulepreload" href="/assets/chunks/dist.CXSQmjX6.js">
    <link rel="modulepreload" href="/assets/chunks/createLucideIcon.nO6fZ36v.js">
    <link rel="modulepreload" href="/assets/chunks/file.B0qe36Kb.js">
    <link rel="modulepreload" href="/assets/chunks/search.KaGBbfxL.js">
    <link rel="modulepreload" href="/assets/chunks/sparkles.DZ7QL8Kt.js">
    <link rel="modulepreload" href="/assets/chunks/pinia.BlUWc_69.js">
    <link rel="modulepreload" href="/assets/chunks/exact-mirror-large.BYqAEsxB.js">
    <link rel="modulepreload" href="/assets/chunks/schema-standalone.D-uUaaEf.js">
    <link rel="modulepreload" href="/assets/chunks/Layout.BZ0rZhD9.js">
    <link rel="modulepreload" href="/assets/chunks/banner.DpkE44SY.js">
    <link rel="modulepreload" href="/assets/blog_elysia-13.md.CaZy0WoQ.lean.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="icon" href="/assets/elysia.png">
    <meta property="og:image" content="https://elysiajs.com/blog/elysia-13/elysia-13.webp">
    <meta property="og:image:width" content="2560">
    <meta property="og:image:height" content="1440">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="https://elysiajs.com/blog/elysia-13/elysia-13.webp">
    <meta property="og:title" content="Elysia 1.3 和科学巫术">
    <meta property="og:description" content="近乎 0 的开销规范化，配合精确镜像、Bun 系统路由器、独立验证器、减少一半的类型实例化，以及显著降低内存使用和快速启动大型应用的时间">
    <script async src="https://www.zhcndoc.com/js/common.js"></script>
    <link rel="preload" as="image" href="/assets/elysia_v.webp" fetchpriority="high">
    <link rel="preload" as="image" href="/assets/elysia.svg" fetchpriority="high">
    <link rel="preload" as="image" href="/assets/shigure-ui-smol.gif" fetchpriority="low">
    <script id="check-dark-mode">(()=>{let e=localStorage.getItem(`vitepress-theme-appearance`)||`auto`,t=window.matchMedia(`(prefers-color-scheme: dark)`).matches;(!e||e===`auto`?t:e===`dark`)&&document.documentElement.classList.add(`dark`)})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle(`mac`,/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body><!--teleport start anchor--><div role="button" aria-expanded="true" aria-haspopup="listbox" aria-labelledby="localsearch-label" class="pointer-events-none VPLocalSearchBox" data-v-0fd83197><!--[--><!--]--><!--[--><!--]--><button data-v-0fd83197></button></div><!--teleport anchor-->
    <div id="app"><div class="Layout" data-v-1df9f90f><!--[--><!--]--><!--[--><span tabindex="-1" data-v-331ec75c></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-331ec75c>Skip to content</a><!--]--><!----><header class="VPNav" data-v-1df9f90f data-v-da52a441><div class="VPNavBar" data-v-da52a441 data-v-70946a35><div class="wrapper" data-v-70946a35><div class="container" data-v-70946a35><div class="title" data-v-70946a35><div class="VPNavBarTitle" data-v-70946a35 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!--[--><img class="VPImage logo" src="/assets/elysia.svg" alt data-v-8426fc1a><!--]--><span data-v-1e38c6bc>Elysia 中文文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-70946a35><div class="content-body" data-v-70946a35><!--[--><!--[--><!--[--><button class="clicky lg:hidden size-10 ml-4 grid place-items-center text-cyan-400 dark:text-cyan-300 font-medium bg-cyan-300/10 dark:bg-cyan-300/5 !rounded-lg backdrop-blur-md"><svg xmlns="http://www.w3.org/2000/svg" width="21" height="21" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles-icon lucide-sparkles"><path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"></path><path d="M20 2v4"></path><path d="M22 4h-4"></path><circle cx="4" cy="20" r="2"></circle></svg></button><!----><!--]--><!--]--><!--]--><section class="VPNavBarSearch search" data-v-70946a35><!--teleport start--><!--teleport end--><div id="local-search"><button type="button" aria-label="搜索文档" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.375" stroke-linecap="round" stroke-linejoin="round" class="lucide inline -translate-y-0.25 scale-125 sm:scale-100 lucide-search-icon lucide-search inline -translate-y-0.25 scale-125 sm:scale-100"><path d="m21 21-4.34-4.34"></path><circle cx="11" cy="11" r="8"></circle></svg><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div></section><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-70946a35 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/table-of-content.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>文档</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>博客</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/illust.html" tabindex="0" data-v-39714824 data-v-52a1d768><!--[--><span data-v-52a1d768>Illust</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-70946a35 data-v-4c1766e2 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="多语言" data-v-42cb505d><span class="text" data-v-42cb505d><span class="vpi-languages option-icon" data-v-42cb505d></span><!----><span class="vpi-chevron-down text-icon" data-v-42cb505d></span></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><div class="items" data-v-4c1766e2><p class="title" data-v-4c1766e2>简体中文</p><!--[--><div class="VPMenuLink" data-v-4c1766e2 data-v-faf5b206><a class="VPLink link vp-external-link-icon" href="https://elysiajs.com/blog/elysia-13.html" target="_blank" rel="noreferrer" lang="en" data-v-faf5b206><!--[--><span data-v-faf5b206>English</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-70946a35 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-70946a35 data-v-0394ad82 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/elysiajs/elysia" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://twitter.com/elysiajs" aria-label="twitter" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/eaFJ2KDJck" aria-label="discord" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-discord"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-70946a35 data-v-bf2fac68 data-v-42cb505d><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-42cb505d><span class="vpi-more-horizontal icon" data-v-42cb505d></span></button><div class="menu" data-v-42cb505d><div class="VPMenu" data-v-42cb505d data-v-25a6cce8><!----><!--[--><!--[--><div class="group translations" data-v-bf2fac68><p class="trans-title" data-v-bf2fac68>简体中文</p><!--[--><div class="VPMenuLink" data-v-bf2fac68 data-v-faf5b206><a class="VPLink link vp-external-link-icon" href="https://elysiajs.com/blog/elysia-13.html" target="_blank" rel="noreferrer" lang="en" data-v-faf5b206><!--[--><span data-v-faf5b206>English</span><!--]--></a></div><!--]--></div><div class="group" data-v-bf2fac68><div class="item appearance" data-v-bf2fac68><p class="label" data-v-bf2fac68>主题</p><div class="appearance-action" data-v-bf2fac68><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bf2fac68 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bf2fac68><div class="item social-links" data-v-bf2fac68><div class="VPSocialLinks social-links-list" data-v-bf2fac68 data-v-d07f11e6><!--[--><a class="VPSocialLink no-icon" href="https://github.com/elysiajs/elysia" aria-label="github" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://twitter.com/elysiajs" aria-label="twitter" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/eaFJ2KDJck" aria-label="discord" target="_blank" rel="me noopener" data-v-d07f11e6 data-v-591a6b30><span class="vpi-social-discord"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-70946a35 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-70946a35><div class="divider-line" data-v-70946a35></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-1df9f90f data-v-db738f89><div class="container" data-v-db738f89><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-db738f89 data-v-0bf0e06f><button data-v-0bf0e06f>回到顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-1df9f90f data-v-c87f25bf><div class="VPDoc has-aside" data-v-c87f25bf data-v-7011f0d8><!--[--><!--[--><!--[--><div class="absolute flex flex-col z-[40] w-full !max-w-full items-center justify-center bg-transparent transition-bg overflow-hidden h-[220px] top-0 left-0 opacity-25 dark:opacity-[.55] pointer-events-none" data-v-bf23a8df><div class="-static ray absolute opacity-60" data-v-bf23a8df></div></div><!--]--><!--]--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--[--><!--[--><!--[--><div className="relative mb-4 w-full rounded-md border border-gray-950/5 p-2 dark:border-white/10"><a href="https://www.rainyun.com/mm_?s=zhcndoc" target="_blank" className="absolute inset-0 z-10" data-umami-event="ads-rainyun"></a><div className="flex w-full justify-center"><img src="/ads/rainyun_1.png" className="w-full rounded-sm"></div></div><!--]--><!--]--><!--]--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>目录</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-1ce71065><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--[--><!--[--><div id="open-elysia-in" class="flex gap-2.5 justify-between items-center pt-0.5 pr-2 text-gray-400 dark:text-gray-500 text-xs mb-1"><button class="flex items-center gap-1 clicky pl-2 pr-1 py-1 -translate-x-2 rounded-full interact:text-sky-500 interact:bg-sky-300/15 transition duration-500 ease-out-expo"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sparkles-icon lucide-sparkles"><path d="M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z"></path><path d="M20 2v4"></path><path d="M22 4h-4"></path><circle cx="4" cy="20" r="2"></circle></svg> 询问此页面 </button><div class="relative z-10 flex justify-center items-center gap-2.5 *:z-20 [&amp;&gt;a&gt;svg]:size-4.5 sm:[&amp;&gt;a&gt;svg]:size-5 [&amp;&gt;a&gt;svg]:opacity-50 [&amp;&gt;a&gt;svg]:interact:opacity-100 [&amp;&gt;a&gt;svg]:transition-opacity"> 在 AI 工具中打开 <a href="https://chatgpt.com/?prompt=%E6%88%91%E6%AD%A3%E5%9C%A8%E6%9F%A5%E7%9C%8B%20https://elysia.zhcndoc.com/blog/elysia-13.html%E3%80%82%0A%0A%E8%AF%B7%E6%82%A8%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AA%E6%A6%82%E5%BF%B5%EF%BC%8C%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%B9%B6%E5%9B%9E%E7%AD%94%E6%88%91%E5%85%B3%E4%BA%8E%E5%AE%83%E7%9A%84%E4%BB%BB%E4%BD%95%E9%97%AE%E9%A2%98%E5%A5%BD%E5%90%97%EF%BC%9F" class="clicky" target="_blank" rel="noopener noreferrer" title="Open in ChatGPT"><svg preserveAspectRatio="xMidYMid" viewBox="0 0 256 260" fill="currentColor"><path d="M239.184 106.203a64.716 64.716 0 0 0-5.576-53.103C219.452 28.459 191 15.784 163.213 21.74A65.586 65.586 0 0 0 52.096 45.22a64.716 64.716 0 0 0-43.23 31.36c-14.31 24.602-11.061 55.634 8.033 76.74a64.665 64.665 0 0 0 5.525 53.102c14.174 24.65 42.644 37.324 70.446 31.36a64.72 64.72 0 0 0 48.754 21.744c28.481.025 53.714-18.361 62.414-45.481a64.767 64.767 0 0 0 43.229-31.36c14.137-24.558 10.875-55.423-8.083-76.483Zm-97.56 136.338a48.397 48.397 0 0 1-31.105-11.255l1.535-.87 51.67-29.825a8.595 8.595 0 0 0 4.247-7.367v-72.85l21.845 12.636c.218.111.37.32.409.563v60.367c-.056 26.818-21.783 48.545-48.601 48.601Zm-104.466-44.61a48.345 48.345 0 0 1-5.781-32.589l1.534.921 51.722 29.826a8.339 8.339 0 0 0 8.441 0l63.181-36.425v25.221a.87.87 0 0 1-.358.665l-52.335 30.184c-23.257 13.398-52.97 5.431-66.404-17.803ZM23.549 85.38a48.499 48.499 0 0 1 25.58-21.333v61.39a8.288 8.288 0 0 0 4.195 7.316l62.874 36.272-21.845 12.636a.819.819 0 0 1-.767 0L41.353 151.53c-23.211-13.454-31.171-43.144-17.804-66.405v.256Zm179.466 41.695-63.08-36.63L161.73 77.86a.819.819 0 0 1 .768 0l52.233 30.184a48.6 48.6 0 0 1-7.316 87.635v-61.391a8.544 8.544 0 0 0-4.4-7.213Zm21.742-32.69-1.535-.922-51.619-30.081a8.39 8.39 0 0 0-8.492 0L99.98 99.808V74.587a.716.716 0 0 1 .307-.665l52.233-30.133a48.652 48.652 0 0 1 72.236 50.391v.205ZM88.061 139.097l-21.845-12.585a.87.87 0 0 1-.41-.614V65.685a48.652 48.652 0 0 1 79.757-37.346l-1.535.87-51.67 29.825a8.595 8.595 0 0 0-4.246 7.367l-.051 72.697Zm11.868-25.58 28.138-16.217 28.188 16.218v32.434l-28.086 16.218-28.188-16.218-.052-32.434Z"></path></svg></a><a href="https://claude.ai/new?q=%E6%88%91%E6%AD%A3%E5%9C%A8%E6%9F%A5%E7%9C%8B%20https://elysia.zhcndoc.com/blog/elysia-13.html%E3%80%82%0A%0A%E8%AF%B7%E6%82%A8%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E8%BF%99%E4%B8%AA%E6%A6%82%E5%BF%B5%EF%BC%8C%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B%EF%BC%8C%E5%B9%B6%E5%9B%9E%E7%AD%94%E6%88%91%E5%85%B3%E4%BA%8E%E5%AE%83%E7%9A%84%E4%BB%BB%E4%BD%95%E9%97%AE%E9%A2%98%E5%A5%BD%E5%90%97%EF%BC%9F" class="clicky" target="_blank" rel="noopener noreferrer" title="Open in Claude"><svg fill-rule="evenodd" viewBox="0 0 24 24" fill="currentColor"><title>Anthropic</title><path d="M13.827 3.52h3.603L24 20h-3.603l-6.57-16.48zm-7.258 0h3.767L16.906 20h-3.674l-1.343-3.461H5.017l-1.344 3.46H0L6.57 3.522zm4.132 9.959L8.453 7.687 6.205 13.48H10.7z"></path></svg></a><a href="https://elysia.zhcndoc.com/blog/elysia-13.md" class="clicky" target="_blank" rel="noopener noreferrer" title="Open in Markdown"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-icon lucide-file"><path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"></path><path d="M14 2v5a1 1 0 0 0 1 1h5"></path></svg></a></div></div><!--]--><!--]--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _blog_elysia-13" data-v-7011f0d8><div><!--[--><article id="blog" class="flex flex-col max-w-3xl w-full mx-auto mt-8"><a href="/blog" class="inline-flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 my-2 mr-auto"><span>←</span> Blog </a><h1 class="!text-3xl !md:text-4xl font-medium">Elysia 1.3 和科学巫术</h1><aside class="flex gap-2 items-center mt-3"><img class="w-9 h-9 rounded-full" src="/blog/authors/lilith-happy.webp" alt="saltyaom"><div class="flex flex-col justify-start"><h3 class="!text-sm !m-0 opacity-75">saltyaom</h3><p class="flex flex-row items-center gap-2 !text-xs !m-0 opacity-75"><time datetime="2025 年 5 月 5 日">2025 年 5 月 5 日</time><span>ー</span><a href="https://twitter.com/saltyaom" target="_blank">@saltyaom</a></p></div></aside><img src="/blog/elysia-13/elysia-13.webp" alt="粉紫色网格渐变背景，上面是 Elysia 1.3 字样，下面是 Scientific Witchery 字样" class="shadow-xl shadow-black/7.5 w-full mt-5 mb-2"><main id="blog-content"><!--[--><p>以 Mili 的歌曲 <a href="https://youtu.be/d-nxW9qBtxQ" target="_blank" rel="noreferrer">Ga1ahad 和科学巫术</a> 命名。</p><p>此版本没有炫目的新功能。</p><p>它是对事物进行改进，以至于我们认为这就是 <strong>“魔法”</strong>。</p><p>Elysia 1.3 的功能几乎零开销，经过 refinements、修复技术债务和重构内部代码，具有：</p><ul><li><a href="#exact-mirror">精确镜像</a></li><li><a href="#bun-system-router">Bun 系统路由器</a></li><li><a href="#standalone-validator">独立验证器</a></li><li><a href="#reduced-type-instantiation">减少一半的类型实例化</a></li><li><a href="#performance-improvement">性能改进</a></li><li><a href="#validation-dx-improvement">验证 DX 改进</a></li><li><a href="#rename-error-to-status">将错误重命名为状态</a></li></ul><h2 id="精确镜像" tabindex="-1">精确镜像 <a class="header-anchor" href="#精确镜像" aria-label="Permalink to “精确镜像”">​</a></h2><p>我们在 Elysia 1.1 中引入了 <a href="/patterns/configuration.html#normalize">normalize</a>，确保数据符合我们所需的形状，并且运行良好。</p><p>它有助于减少潜在的数据泄露，避免意外的属性，用户非常喜欢它。然而，这也带来了性能成本。</p><p>在后台，它使用 <code>TypeBox 的 Value.Clean</code> 动态地将数据强制转换为指定的模式。</p><p>效果很好，但速度不够快。</p><p>由于 TypeBox 不提供与 <code>TypeCompiler.Check</code> 类似的 <strong>编译</strong> 版本，后者利用了提前知道形状的优势。</p><p>这就是我们引入 <a href="https://github.com/elysiajs/exact-mirror" target="_blank" rel="noreferrer">精确镜像</a> 作为替代方案的原因。</p><p><strong>精确镜像</strong> 是 TypeBox 的 <strong>Value.Clean</strong> 的即插即用替代，显著提高了性能，利用了提前编译的优势。</p><h3 id="性能" tabindex="-1">性能 <a class="header-anchor" href="#性能" aria-label="Permalink to “性能”">​</a></h3><p>对于没有数组的小对象，我们测量的速度 <strong>最快可达 ~500倍</strong>。 <img src="/blog/elysia-13/exact-mirror-small.webp" alt="在小数据上运行的精确镜像，其速度比 TypeBox Value.Clean 快 582.52 倍" data-zoomable="true"></p><blockquote><p>在小数据上运行的精确镜像</p></blockquote><p>对于中等和大型对象，我们测量的速度 <strong>最快可达 ~30倍</strong>。 <img src="/blog/elysia-13/exact-mirror-large.webp" alt="在中大型数据上运行的精确镜像，结果依次为 29.46 倍和 31.6 倍" data-zoomable="true"></p><blockquote><p>在中大型数据上运行的精确镜像</p></blockquote><h3 id="对-elysia-的意义" tabindex="-1">对 Elysia 的意义 <a class="header-anchor" href="#对-elysia-的意义" aria-label="Permalink to “对 Elysia 的意义”">​</a></h3><p>从 Elysia 1.3 开始，精确镜像是默认的规范化策略，取代了 TypeBox。</p><p>通过升级到 Elysia 1.3，您可以期待显著的性能提升 <strong>没有任何代码更改</strong>。</p><p>以下是 Elysia 1.2 的吞吐量。 <img src="/blog/elysia-13/normalize-1.2.webp" alt="未开启规范化的 Elysia，吞吐量为 49k req/sec" data-zoomable="true"></p><blockquote><p>未开启规范化的 Elysia</p></blockquote><p>而以下是同一段代码在 Elysia 1.3 中的结果 <img src="/blog/elysia-13/normalize-1.3.webp" alt="开启规范化的 Elysia，吞吐量为 77k req/sec" data-zoomable="true"></p><blockquote><p>开启规范化的 Elysia</p></blockquote><p>我们在使用 <strong>单个</strong> 模式的情况下测得吞吐量最高可达 ~1.5倍。</p><p>这意味着如果您使用多个模式，您将在性能上看到更明显的提升。</p><p>与没有模式的相同代码相比，性能差异小于 2%。</p><p><img src="/blog/elysia-13/no-validation.webp" alt="未验证的 Elysia 的运行结果为 79k req/sec" data-zoomable="true"></p><blockquote><p>未验证的 Elysia 的运行结果</p></blockquote><p>这非常重要。</p><p>之前，您必须在安全性和性能之间做出选择，但随着我们缩小了使用验证和不使用验证之间的性能差距，现在您不必担心这个问题。</p><p>现在，我们将验证开销从大量下降到几乎接近零，而无需您进行任何更改。</p><p>它就像魔法一样运行。</p><p>但是，如果您希望使用 TypeBox 或完全禁用规范化，您可以像配置其他设置一样，通过构造函数进行设定：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Elysia } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;elysia&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Elysia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    normalize: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;typebox&#39;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // 使用 TypeBox</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>您可以访问 <a href="https://github.com/elysiajs/exact-mirror" target="_blank" rel="noreferrer">GitHub上的精确镜像</a> 自行尝试基准测试。</p><h2 id="系统路由器" tabindex="-1">系统路由器 <a class="header-anchor" href="#系统路由器" aria-label="Permalink to “系统路由器”">​</a></h2><p>我们在 Elysia 中从未遇到过路由器性能问题。</p><p>它性能优异，我们尽可能进行了超优化。</p><p>我们将其推至 JavaScript 在实际情况下能够提供的近乎极限。</p><h3 id="bun-路由器" tabindex="-1">Bun 路由器 <a class="header-anchor" href="#bun-路由器" aria-label="Permalink to “Bun 路由器”">​</a></h3><p>然而，Bun 1.2.3 提供了一个内置的路由解决方案（可能是在本地代码中）。</p><p>尽管对于静态路由，我们没有看到太多性能提升，但我们发现 <strong>动态路由性能提高了 2-5%</strong> ，而没有进行任何代码更改。</p><p>从 Elysia 1.3 开始，我们提供了一种双路由策略，将 Bun 的本地路由器和 Elysia 的路由器结合使用。</p><p>Elysia 将尽可能使用 Bun 路由器，若不成功则回退到 Elysia 的路由器。</p><h3 id="适配器" tabindex="-1">适配器 <a class="header-anchor" href="#适配器" aria-label="Permalink to “适配器”">​</a></h3><p>为了实现这一点，我们必须重写我们的内部编译代码，以支持来自 <strong>适配器</strong> 的自定义路由器。</p><p>这意味着现在可以将自定义路由器与 Elysia 自有路由器一起使用。</p><p>这在某些环境中为性能提升开辟了机会，例如：使用内置的 <code>uWebSocket.js 路由器</code>，该路由器具有原生实现的路由功能。</p><h2 id="独立验证器" tabindex="-1">独立验证器 <a class="header-anchor" href="#独立验证器" aria-label="Permalink to “独立验证器”">​</a></h2><p>在 Elysia 中，我们可以定义一个模式并通过 <code>guard</code> 将其应用于多个路由。</p><p>然后，我们可以通过在路由处理程序中提供一个模式来覆盖公共模式，有时看起来像这样：</p><p><img src="/blog/elysia-13/schema-override.webp" alt="Elysia 运行具有默认覆盖保护的模式，显示模式被覆盖" data-zoomable="true"></p><blockquote><p>Elysia 运行具有默认覆盖保护</p></blockquote><p>但有时我们 <strong>不想覆盖</strong> 一个模式。</p><p>相反，我们希望它两者兼具，允许我们组合模式而不是覆盖它们。</p><p>从 Elysia 1.3 开始，我们可以做到这一点。</p><p>我们现在可以告诉 Elysia 不要覆盖它，而是将其视为其自身，通过提供一个模式作为 <strong>独立</strong>。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { Elysia } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;elysia&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Elysia</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">guard</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        schema: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;standalone&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [!代码 ++]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        response: t.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            title: t.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    })</span></span></code></pre></div><p>结果，我们得到了类似于将本地和全局模式合并的结果。</p><p><img src="/blog/elysia-13/schema-standalone.webp" alt="Elysia 运行独立模式，合并多个保护" data-zoomable="true"></p><blockquote><p>Elysia 运行独立模式，合并多个保护</p></blockquote><h2 id="减少类型实例化" tabindex="-1">减少类型实例化 <a class="header-anchor" href="#减少类型实例化" aria-label="Permalink to “减少类型实例化”">​</a></h2><p>Elysia 的类型推断已经非常快。</p><p>我们对类型推断的优化非常有信心，它的速度比大多数使用类 Express 语法的框架还要快。</p><p>然而，我们的用户在规模很大、具有多个路由和复杂的类型推断的情况下，面临着挑战。</p><p>我们设法在大多数情况下 <strong>将类型实例化减少了一半</strong>，测量了推断速度提高了高达 60%。</p><p><img src="/blog/elysia-13/type-instantiation.webp" alt="类型实例化从 109k 减少到 52k" data-zoomable="true"></p><blockquote><p>类型实例化从 109k 减少到 52k</p></blockquote><p>我们还改变了 <code>decorate</code> 的默认行为，而不是递归遍历每个对象和属性进行交集。</p><p>这应该解决使用重型对象/类的用户的问题，例如 <code>PrismaClient</code>。</p><p>因此，结果应该会带来更快速的 IDE 自动补全、建议、类型检查和 Eden Treaty。</p><h2 id="性能改进" tabindex="-1">性能改进 <a class="header-anchor" href="#性能改进" aria-label="Permalink to “性能改进”">​</a></h2><p>我们重构和优化了许多内部代码，从而实现了显著的改进。</p><h3 id="路由注册" tabindex="-1">路由注册 <a class="header-anchor" href="#路由注册" aria-label="Permalink to “路由注册”">​</a></h3><p>我们重构了存储路由信息的方式，并重用对象引用，而不是克隆/创建新的引用。</p><p>我们观察到以下改进：</p><ul><li>内存使用减少到 ~5.6倍</li><li>路由注册时间提高到 ~2.7倍</li></ul><p><img src="/blog/elysia-13/routes.webp" alt="Elysia 1.2（左）与 1.3（右）之间的路由注册比较" data-zoomable="true"></p><blockquote><p>Elysia 1.2（左）与 1.3（右）之间的路由注册比较</p></blockquote><p>这些优化应该能在中大型应用中显现出真正的成果，因为它随服务器的路由数量而扩展。</p><h3 id="sucrose" tabindex="-1">Sucrose <a class="header-anchor" href="#sucrose" aria-label="Permalink to “Sucrose”">​</a></h3><p>我们实现了 Sucrose 缓存，以减少不必要的重新计算，并在为非内联事件编译每个路由时重用已编译的路由。</p><p><img src="/blog/elysia-13/sucrose.webp" alt="Elysia 1.2（左）和 1.3（右）之间的 Sucrose 性能比较" data-zoomable="true"></p><blockquote><p>Elysia 1.2（左）和 1.3（右）之间的 Sucrose 性能比较</p></blockquote><p>Sucrose 将每个事件转换为校验和号码并将其存储为缓存。它使用很少的内存，并将在服务器启动后清理。</p><p>这一改进应该有助于重用全局/作用域事件的每路由的启动时间。</p><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-label="Permalink to “实例”">​</a></h3><p>在创建多个实例并将其作为插件应用时，我们看到显著的改进。</p><ul><li>内存使用减少了 ~10倍</li><li>插件创建速度提高了 ~3倍</li></ul><p><img src="/blog/elysia-13/instance.webp" alt="Elysia 1.2（左）与 1.3（右）之间的实例比较" data-zoomable="true"></p><blockquote><p>Elysia 1.2（左）与 1.3（右）之间的实例比较</p></blockquote><p>这些优化将在升级到 Elysia 1.3 时自动应用。然而，这些性能优化对于小型应用可能不会特别显著。</p><p>因为 Serving 一个简单的 Bun 服务器的固定成本约为 10-15MB。这些优化更像是减少现有开销，并有助于改善启动时间。</p><h3 id="通用更快性能" tabindex="-1">通用更快性能 <a class="header-anchor" href="#通用更快性能" aria-label="Permalink to “通用更快性能”">​</a></h3><p>通过各种微优化、修复技术债务和消除未使用的编译指令。</p><p>我们看到 Elysia 请求处理速度有所改善。在某些情况下提高了高达 40%。</p><p><img src="/blog/elysia-13/handle.webp" alt="Elysia.handle 在 Elysia 1.2 和 1.3 之间的比较" data-zoomable="true"></p><blockquote><p>Elysia.handle 在 Elysia 1.2 和 1.3 之间的比较</p></blockquote><h2 id="验证-dx-改进" tabindex="-1">验证 DX 改进 <a class="header-anchor" href="#验证-dx-改进" aria-label="Permalink to “验证 DX 改进”">​</a></h2><p>我们希望 Elysia 的验证能够 <strong>即刻生效</strong>。</p><p>只需告诉它您想要什么，它就能满足。这是 Elysia 最有价值的方面之一。</p><p>在这次更新中，我们改善了一些我们一直欠缺的领域。</p><h3 id="编码模式" tabindex="-1">编码模式 <a class="header-anchor" href="#编码模式" aria-label="Permalink to “编码模式”">​</a></h3><p>我们已将 <a href="/patterns/configuration.html#encodeschema">encodeSchema</a> 从 <code>实验性</code> 移出，并默认启用。</p><p>这使我们能够使用 <a href="https://github.com/sinclairzx81/typebox?tab=readme-ov-file#types-transform" target="_blank" rel="noreferrer">t.Transform</a> 应用自定义响应映射，以返回给最终用户。</p><p><img src="/blog/elysia-13/encode-schema.webp" alt="使用 t.Transform 进行值拦截" data-zoomable="true"></p><blockquote><p>使用 t.Transform 进行值拦截</p></blockquote><p>这段示例代码将拦截响应，将“hi”替换为“intercepted”。</p><h3 id="清理" tabindex="-1">清理 <a class="header-anchor" href="#清理" aria-label="Permalink to “清理”">​</a></h3><p>为了防止 SQL 注入和 XSS，并确保字符串输入/输出安全，我们引入了 <a href="/patterns/configuration.html#sanitize">sanitize</a> 选项。</p><p>它接受一个函数或一组函数，拦截每个 <code>t.String</code>，并将其转换为新值。</p><p><img src="/blog/elysia-13/sanitize.webp" alt="使用 sanitize 和 Bun.escapeHTML" data-zoomable="true"></p><blockquote><p>使用 sanitize 和 Bun.escapeHTML</p></blockquote><p>在这个例子中，我们使用 <strong>Bun.escapeHTML</strong> 并将每个“dorothy”替换为“doro”。</p><p>由于 <code>sanitize</code> 将全局应用于每个模式，它必须在根实例上应用。</p><p>这大大减少了手动安全验证和转换每个字符串字段的样板代码。</p><h3 id="表单" tabindex="-1">表单 <a class="header-anchor" href="#表单" aria-label="Permalink to “表单”">​</a></h3><p>在 Elysia 的早期版本中，无法使用 <a href="/essential/handler.html#formdata">form</a> 和 <code>t.Object</code> 在编译时进行类型检查 FormData 响应。</p><p>我们现在引入了一个新的 <a href="/patterns/type.html#form">t.Form</a> 类型来解决这个问题。</p><p><img src="/blog/elysia-13/form.webp" alt="使用 t.Form 验证 FormData" data-zoomable="true"></p><blockquote><p>使用 t.Form 验证 FormData</p></blockquote><p>要迁移到表单类型检查，只需在响应模式中将 <code>t.Object</code> 替换为 <code>t.Form</code>。</p><h3 id="文件类型" tabindex="-1">文件类型 <a class="header-anchor" href="#文件类型" aria-label="Permalink to “文件类型”">​</a></h3><p>Elysia 现在使用 <a href="https://github.com/sindresorhus/file-type" target="_blank" rel="noreferrer">file-type</a> 验证文件类型。</p><p><img src="/blog/elysia-13/file-type.webp" alt="使用 t.File 定义文件类型" data-zoomable="true"></p><blockquote><p>使用 t.File 定义文件类型</p></blockquote><p>一旦指定了 <code>type</code>，Elysia 将通过检查魔术数字自动检测文件类型。</p><p>然而，它也被列为 <strong>peerDependencies</strong>，并且不会随 Elysia 默认安装，以减少不需要此功能的用户的包大小。</p><p>如果您依赖文件类型验证以提高安全性，建议您更新到 Elysia 1.3。</p><h3 id="elysia-ref" tabindex="-1">Elysia.Ref <a class="header-anchor" href="#elysia-ref" aria-label="Permalink to “Elysia.Ref”">​</a></h3><p>我们可以通过使用 <code>Elysia.model</code> 创建引用模型，并通过名称引用它。</p><p>然而，有时我们需要在模式内部引用它。</p><p>我们现在可以通过使用 <code>Elysia.Ref</code> 来实现这一点，并自动完成引用模型。</p><p><img src="/blog/elysia-13/elysia-ref.webp" alt="使用 Elysia.Ref 引用模型" data-zoomable="true"></p><blockquote><p>使用 Elysia.Ref 引用模型</p></blockquote><p>您也可以使用 <code>t.Ref</code> 来引用模型，但它不会提供自动完成。</p><h3 id="不验证" tabindex="-1">不验证 <a class="header-anchor" href="#不验证" aria-label="Permalink to “不验证”">​</a></h3><p>我们收到了许多反馈，一些用户希望快速原型化他们的 API，或者有时在强制执行验证时遇到问题。</p><p>在 Elysia 1.3 中，我们引入了 <code>t.NoValidate</code> 以跳过验证。</p><p><img src="/blog/elysia-13/no-validate.webp" alt="使用 t.NoValidate 告诉 Elysia 跳过验证" data-zoomable="true"></p><blockquote><p>使用 t.NoValidate 告诉 Elysia 跳过验证</p></blockquote><p>这将告知 Elysia 跳过运行时验证，但仍然提供 TypeScript 类型检查和 OpenAPI 架构以用于 API 文档。</p><h2 id="状态" tabindex="-1">状态 <a class="header-anchor" href="#状态" aria-label="Permalink to “状态”">​</a></h2><p>我们收到了关于 <code>error</code> 命名的大量反馈。</p><p>从 Elysia 1.3 开始，我们决定弃用 <code>error</code>，并建议使用 <code>status</code> 代替。</p><p><img src="/blog/elysia-13/status.webp" alt="IDE 显示 error 被弃用并重命名为 status" data-zoomable="true"></p><blockquote><p>IDE 显示 error 被弃用并重命名为 status</p></blockquote><p><code>error</code> 函数将按前一个版本的方式运作，无需立即更改。</p><p>但是，我们建议重构为 <code>status</code>，因为我们将在接下来的 6 个月内支持 <code>error</code> 函数，直到大约 Elysia 1.4 或 1.5。</p><p>要迁移，只需将 <code>error</code> 重命名为 <code>status</code>。</p><h2 id="index-从-treaty-中移除" tabindex="-1">&quot;.index&quot; 从 Treaty 中移除 <a class="header-anchor" href="#index-从-treaty-中移除" aria-label="Permalink to “&quot;.index&quot; 从 Treaty 中移除”">​</a></h2><p>之前，您必须添加 <code>(treaty).index</code> 来处理以 <strong>/</strong> 结尾的路径。</p><p>从 Elysia 1.3 开始，我们决定放弃使用 <code>.index</code>，可以简单地绕过它，直接调用方法。</p><p><img src="/blog/elysia-13/treaty-index.webp" alt="Eden Treaty 显示没有使用 .index" data-zoomable="true"></p><blockquote><p>Eden Treaty 显示没有使用 .index</p></blockquote><p>这是一个 <strong>破坏性更改</strong>，但迁移只需最低努力。</p><p>要迁移，只需从您的代码库中删除 <code>.index</code>。使用 IDE 搜索进行批量更改，将 <code>.index</code> 匹配并删除，这应该是一个简单的更改。</p><h2 id="突出变化" tabindex="-1">突出变化 <a class="header-anchor" href="#突出变化" aria-label="Permalink to “突出变化”">​</a></h2><p>以下是一些来自变更日志的显著变化。</p><h3 id="改进" tabindex="-1">改进 <a class="header-anchor" href="#改进" aria-label="Permalink to “改进”">​</a></h3><ul><li><code>encodeSchema</code> 现在稳定，并默认启用</li><li>优化类型</li><li>在使用 Encode 时减少冗余类型检查</li><li>优化 isAsync</li><li>默认解包 Definition[&#39;typebox&#39;] 以防止不必要的 UnwrapTypeModule 调用</li><li>Elysia.form 现在可以进行类型检查</li><li>重构类型系统</li><li>将 <code>_types</code> 重构为 <code>~Types</code></li><li>使用 aot 编译检查自定义 Elysia 类型，例如 Numeric</li><li>重构 <code>app.router.static</code>，并将静态路由器代码生成移至编译阶段</li><li>优化 <code>add</code>、<code>_use</code> 及一些实用函数的内存使用</li><li>改善多个路由的启动时间</li><li>动态创建 cookie 验证器，以便在编译过程中按需使用</li><li>减少对象克隆</li><li>优化用于查找内容类型头分隔符的起始索引</li><li>Promise 现在可以是静态响应</li><li><code>ParseError</code> 现在保留堆栈跟踪</li><li>重构 <code>parseQuery</code> 和 <code>parseQueryFromURL</code></li><li>向 <code>mount</code> 添加 <code>config</code> 选项</li><li>在挂载异步模块后自动重新编译</li><li>支持宏，当钩子具有函数时</li><li>支持在 ws 上解析宏</li><li><a href="https://github.com/elysiajs/elysia/pull/1146" target="_blank" rel="noreferrer">#1146</a> 添加支持从处理程序返回 Web API 的文件</li><li><a href="https://github.com/elysiajs/elysia/pull/1165" target="_blank" rel="noreferrer">#1165</a> 在响应架构验证中跳过非数字状态码</li><li><a href="https://github.com/elysiajs/elysia/issues/1177" target="_blank" rel="noreferrer">#1177</a> 当抛出错误时 cookie 不会签名</li></ul><h3 id="修复错误" tabindex="-1">修复错误 <a class="header-anchor" href="#修复错误" aria-label="Permalink to “修复错误”">​</a></h3><ul><li>从 <code>onError</code> 返回的 <code>Response</code> 使用八位字节流</li><li>使用 <code>mergeObjectArray</code> 时意外的内存分配</li><li>处理日期查询的空格</li></ul><h3 id="更改" tabindex="-1">更改 <a class="header-anchor" href="#更改" aria-label="Permalink to “更改”">​</a></h3><ul><li>当 <code>maybeStream</code> 为 true 时，仅向 mapResponse 提供 <code>c.request</code></li><li>使用普通对象作为 <code>routeTree</code>，而不是 <code>Map</code></li><li>移除 <code>compressHistoryHook</code> 和 <code>decompressHistoryHook</code></li><li>webstandard 处理程序现在在未在 Bun 上时返回 <code>text/plain</code></li><li>除非明确指定，否则为 <code>decorate</code> 使用非常量值</li><li><code>Elysia.mount</code> 现在默认设置 <code>detail.hide = true</code></li></ul><h3 id="破坏性更改" tabindex="-1">破坏性更改 <a class="header-anchor" href="#破坏性更改" aria-label="Permalink to “破坏性更改”">​</a></h3><ul><li>移除 <code>as(&#39;plugin&#39;)</code>，改用 <code>as(&#39;scoped&#39;)</code></li><li>移除 Eden Treaty 的根 <code>index</code></li><li>从 <code>ElysiaAdapter</code> 中移除 <code>websocket</code></li><li>移除 <code>inference.request</code></li></ul><h2 id="后记" tabindex="-1">后记 <a class="header-anchor" href="#后记" aria-label="Permalink to “后记”">​</a></h2><p>嗨？好久不见。</p><p>生活有时会让人感到困惑，是不是？</p><p>有一天，你在追逐梦想，努力工作。</p><p>转眼间，你回头发现自己已经远超目标。</p><p>有人仰望你，你成了他们的灵感，成为某人的榜样。</p><p>听起来很棒，对吧？</p><p>但我认为我并不是一个好的榜样。</p><h3 id="我想过诚实的生活" tabindex="-1">我想过诚实的生活 <a class="header-anchor" href="#我想过诚实的生活" aria-label="Permalink to “我想过诚实的生活”">​</a></h3><p>有时，事情只是被夸大了。</p><p>我可能看起来像个能创造任何东西的天才，但我不是。我只是尽我所能。</p><p>我和朋友们一起玩电子游戏，听奇怪的歌曲，看电影，甚至在动漫展上与他们见面。</p><p>就像一个普通人。</p><p>这段时间，我只是紧紧地抱住了 <em>你的</em> 手臂。</p><p><strong>我和你一样，没有特别之处。</strong></p><p>我尽我所能，但我偶尔也会表现得像个傻瓜。</p><p>即使我觉得自己没有任何可以成为榜样的特质，我仍想告诉你，我心怀感激。</p><p>我的无聊和略显孤独的生活，请不要美化它太多。</p><p><small><em>~ 我很高兴你也坏坏的。</em></small></p><!--]--></main><a href="/" class="inline-flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 mt-2 mr-auto"><span>←</span> Elysia: Ergonomic Framework for Humans </a></article><!----><!--]--></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-3c637f39>最后更新于: <time datetime="2026-01-11T07:34:37.000Z" data-v-3c637f39></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/at-glance.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>下一页</span><span class="title" data-v-e257564d>概览</span><!--]--></a></div></nav></footer><!--[--><!--[--><!--[--><div className="relative mt-4 w-full rounded-md border border-gray-950/5 p-2 dark:border-white/10"><a href="https://www.rainyun.com/mm_?s=zhcndoc" target="_blank" className="absolute inset-0 z-10" data-umami-event="ads-rainyun"></a><div className="flex w-full justify-center"><img src="/ads/rainyun_2.png" className="w-full rounded-sm"></div></div><!--]--><!--]--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"at-glance.md\":\"cWzR3aEv\",\"blog.md\":\"BUWTAt4q\",\"blog_elysia-02.md\":\"HcaF_VLR\",\"blog_elysia-03.md\":\"CoYxt_iD\",\"blog_elysia-04.md\":\"CgZIxbT3\",\"blog_elysia-05.md\":\"cB-sDRd7\",\"blog_elysia-06.md\":\"DSUtJZcP\",\"blog_elysia-07.md\":\"DKoM3KRH\",\"blog_elysia-08.md\":\"CJusyZv2\",\"blog_elysia-10.md\":\"DxpwI3_c\",\"blog_elysia-11.md\":\"CNM7X7Mf\",\"blog_elysia-12.md\":\"CZj_W4OZ\",\"blog_elysia-13.md\":\"CaZy0WoQ\",\"blog_elysia-14.md\":\"D39ggO1l\",\"blog_elysia-supabase.md\":\"CrNOi5Gh\",\"blog_elysia-v-encore.md\":\"5FFmj1m_\",\"blog_openapi-type-gen.md\":\"BOaQGPpN\",\"blog_with-prisma.md\":\"CgRVvmDH\",\"eden_fetch.md\":\"84mMicXY\",\"eden_installation.md\":\"BI5bjmX_\",\"eden_overview.md\":\"CCwYNV7P\",\"eden_test.md\":\"DQ-_pchS\",\"eden_treaty_config.md\":\"CkFgVn8n\",\"eden_treaty_legacy.md\":\"BvCBfsGv\",\"eden_treaty_overview.md\":\"B1EaKzPx\",\"eden_treaty_parameters.md\":\"BYBDGS9x\",\"eden_treaty_response.md\":\"CuOYLCmT\",\"eden_treaty_unit-test.md\":\"N57AzLyj\",\"eden_treaty_websocket.md\":\"DigpWSGk\",\"essential_best-practice.md\":\"Cd1qIPWA\",\"essential_handler.md\":\"BU2sz3EC\",\"essential_life-cycle.md\":\"DG7LrGyP\",\"essential_plugin.md\":\"Crq4sAKe\",\"essential_route.md\":\"BoZUieSG\",\"essential_validation.md\":\"D59EbSJ3\",\"illust.md\":\"C3vSwf7R\",\"index.md\":\"N_HVpFuD\",\"integrations_ai-sdk.md\":\"HIS5SNa7\",\"integrations_astro.md\":\"qAkBEk-c\",\"integrations_better-auth.md\":\"NRsnJcap\",\"integrations_cheat-sheet.md\":\"CP9eMGXo\",\"integrations_cloudflare-worker.md\":\"BEbWzrlo\",\"integrations_deno.md\":\"BfeIoiNI\",\"integrations_drizzle.md\":\"q6r6Pvsx\",\"integrations_expo.md\":\"BRTea-_v\",\"integrations_netlify.md\":\"BJ7oZ1K6\",\"integrations_nextjs.md\":\"Dgau1vaw\",\"integrations_node.md\":\"C2hPMDDz\",\"integrations_nuxt.md\":\"BpwVB95s\",\"integrations_prisma.md\":\"qQZwfF6G\",\"integrations_react-email.md\":\"DViI09yT\",\"integrations_sveltekit.md\":\"DQ9DHS--\",\"integrations_tanstack-start.md\":\"DkmTVvZ4\",\"integrations_vercel.md\":\"Co_zjnV5\",\"key-concept.md\":\"Dv_U434E\",\"migrate_from-express.md\":\"QBVXowWA\",\"migrate_from-fastify.md\":\"DjxSchX_\",\"migrate_from-hono.md\":\"Dw0HGOww\",\"migrate_from-trpc.md\":\"D_fU-iI3\",\"migrate_index.md\":\"CN05lqci\",\"patterns_configuration.md\":\"ByogGe3j\",\"patterns_cookie.md\":\"Bm-71ePa\",\"patterns_deploy.md\":\"B8v-XMGl\",\"patterns_error-handling.md\":\"Bn3i_ZLU\",\"patterns_extends-context.md\":\"BkhM9bQC\",\"patterns_fullstack-dev-server.md\":\"CHLwDeVL\",\"patterns_macro.md\":\"C6ZFQXmU\",\"patterns_mount.md\":\"TDg2Ad2w\",\"patterns_openapi.md\":\"BDdUn0Hv\",\"patterns_opentelemetry.md\":\"DISHe3Rz\",\"patterns_trace.md\":\"C2kODuLQ\",\"patterns_typebox.md\":\"BPf8PaCO\",\"patterns_typescript.md\":\"DmbikXBb\",\"patterns_unit-test.md\":\"BhCCQad4\",\"patterns_websocket.md\":\"CpSQJgR8\",\"playground_index.md\":\"DZT0B_6C\",\"playground_preview.md\":\"C3X4aVtx\",\"plugins_bearer.md\":\"Cm0j5JHp\",\"plugins_cors.md\":\"CiKZYicw\",\"plugins_cron.md\":\"Dwl7_TU7\",\"plugins_graphql-apollo.md\":\"Dcf4SZjK\",\"plugins_graphql-yoga.md\":\"BC6JAVMx\",\"plugins_html.md\":\"Cf7SVbP9\",\"plugins_jwt.md\":\"BN9QkQRo\",\"plugins_openapi.md\":\"DHGoujnC\",\"plugins_opentelemetry.md\":\"Dv7ODqSK\",\"plugins_overview.md\":\"5d1C94KL\",\"plugins_server-timing.md\":\"t-wITrcD\",\"plugins_static.md\":\"CM8Oif_y\",\"plugins_swagger.md\":\"CSbs4ssw\",\"quick-start.md\":\"CDc3RZ5I\",\"table-of-content.md\":\"CWDosMkg\",\"tutorial_features_end-to-end-type-safety_index.md\":\"2JLeosg4\",\"tutorial_features_mount_index.md\":\"BlJeCcuy\",\"tutorial_features_openapi_index.md\":\"DNxBUEkD\",\"tutorial_features_unit-test_index.md\":\"UKieC_cs\",\"tutorial_getting-started_encapsulation_index.md\":\"ClmXlQAS\",\"tutorial_getting-started_guard_index.md\":\"B9z-gFFD\",\"tutorial_getting-started_handler-and-context_index.md\":\"CFzIix7V\",\"tutorial_getting-started_life-cycle_index.md\":\"BrAYcjL4\",\"tutorial_getting-started_plugin_index.md\":\"B_PH2v9n\",\"tutorial_getting-started_status-and-headers_index.md\":\"XnQJkKG-\",\"tutorial_getting-started_validation_index.md\":\"D-WWHqe6\",\"tutorial_getting-started_your-first-route_index.md\":\"BAkY6O0n\",\"tutorial_index.md\":\"Crxrxkdp\",\"tutorial_patterns_cookie_index.md\":\"BfZemszS\",\"tutorial_patterns_error-handling_index.md\":\"CJ3G1BeR\",\"tutorial_patterns_extends-context_index.md\":\"8CzvweM3\",\"tutorial_patterns_macro_index.md\":\"DqbvAcGH\",\"tutorial_patterns_standalone-schema_index.md\":\"DdVHiMv1\",\"tutorial_patterns_validation-error_index.md\":\"D4H-Pa3e\",\"tutorial_whats-next.md\":\"3FRzFYsT\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Elysia 中文文档\",\"titleTemplate\":\":title - Elysia 中文文档\",\"description\":\"适合人体工程学的框架，由 Bun 强化的 TypeScript 框架，具有端到端的类型安全、统一的类型系统和卓越的开发者体验。\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true,\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"logo\":\"/assets/elysia.svg\",\"nav\":[{\"text\":\"文档\",\"link\":\"/table-of-content\"},{\"text\":\"博客\",\"link\":\"/blog\"},{\"text\":\"Illust\",\"link\":\"/illust\"}],\"sidebar\":[{\"text\":\"入门\",\"collapsed\":true,\"items\":[{\"text\":\"概览\",\"link\":\"/at-glance\"},{\"text\":\"快速开始\",\"link\":\"/quick-start\"},{\"text\":\"目录\",\"link\":\"/table-of-content\"},{\"text\":\"关键概念\",\"link\":\"/key-concept\"}]},{\"text\":\"基础\",\"collapsed\":true,\"items\":[{\"text\":\"路由\",\"link\":\"/essential/route\"},{\"text\":\"处理程序\",\"link\":\"/essential/handler\"},{\"text\":\"插件\",\"link\":\"/essential/plugin\"},{\"text\":\"生命周期\",\"link\":\"/essential/life-cycle\"},{\"text\":\"验证\",\"link\":\"/essential/validation\"},{\"text\":\"最佳实践\",\"link\":\"/essential/best-practice\"}]},{\"text\":\"模式\",\"collapsed\":true,\"items\":[{\"text\":\"配置\",\"link\":\"/patterns/configuration\"},{\"text\":\"Cookie\",\"link\":\"/patterns/cookie\"},{\"text\":\"生产环境部署\",\"link\":\"/patterns/deploy\"},{\"text\":\"错误处理\",\"link\":\"/patterns/error-handling\"},{\"text\":\"扩展上下文\",\"link\":\"/patterns/extends-context\"},{\"text\":\"Fullstack Dev Server\",\"link\":\"/patterns/fullstack-dev-server\"},{\"text\":\"Macro\",\"link\":\"/patterns/macro\"},{\"text\":\"挂载\",\"link\":\"/patterns/mount\"},{\"text\":\"OpenAPI\",\"link\":\"/patterns/openapi\"},{\"text\":\"OpenTelemetry\",\"link\":\"/patterns/opentelemetry\"},{\"text\":\"Trace\",\"link\":\"/patterns/trace\"},{\"text\":\"TypeBox (Elysia.t)\",\"link\":\"/patterns/typebox\"},{\"text\":\"TypeScript\",\"link\":\"/patterns/typescript\"},{\"text\":\"单元测试\",\"link\":\"/patterns/unit-test\"},{\"text\":\"WebSocket\",\"link\":\"/patterns/websocket\"}]},{\"text\":\"Eden\",\"collapsed\":true,\"items\":[{\"text\":\"概述\",\"link\":\"/eden/overview.md\"},{\"text\":\"安装\",\"link\":\"/eden/installation.md\"},{\"text\":\"Eden 协议\",\"collapsed\":false,\"items\":[{\"text\":\"概述\",\"link\":\"/eden/treaty/overview\"},{\"text\":\"参数\",\"link\":\"/eden/treaty/parameters\"},{\"text\":\"响应\",\"link\":\"/eden/treaty/response\"},{\"text\":\"WebSocket\",\"link\":\"/eden/treaty/websocket\"},{\"text\":\"配置\",\"link\":\"/eden/treaty/config\"},{\"text\":\"单元测试\",\"link\":\"/eden/treaty/unit-test\"},{\"text\":\"旧版（协议 1）\",\"link\":\"/eden/treaty/legacy.md\"}]},{\"text\":\"Eden Fetch\",\"link\":\"/eden/fetch.md\"}]},{\"text\":\"插件\",\"collapsed\":true,\"items\":[{\"text\":\"概述\",\"link\":\"/plugins/overview\"},{\"text\":\"Bearer\",\"link\":\"/plugins/bearer\"},{\"text\":\"CORS\",\"link\":\"/plugins/cors\"},{\"text\":\"Cron\",\"link\":\"/plugins/cron\"},{\"text\":\"GraphQL Apollo\",\"link\":\"/plugins/graphql-apollo\"},{\"text\":\"GraphQL Yoga\",\"link\":\"/plugins/graphql-yoga\"},{\"text\":\"HTML\",\"link\":\"/plugins/html\"},{\"text\":\"JWT\",\"link\":\"/plugins/jwt\"},{\"text\":\"OpenAPI\",\"link\":\"/plugins/openapi\"},{\"text\":\"OpenTelemetry\",\"link\":\"/plugins/opentelemetry\"},{\"text\":\"服务器计时\",\"link\":\"/plugins/server-timing\"},{\"text\":\"静态\",\"link\":\"/plugins/static\"}]},{\"text\":\"比较\",\"collapsed\":true,\"items\":[{\"text\":\"Express\",\"link\":\"/migrate/from-express\"},{\"text\":\"Fastify\",\"link\":\"/migrate/from-fastify\"},{\"text\":\"Hono\",\"link\":\"/migrate/from-hono\"},{\"text\":\"tRPC\",\"link\":\"/migrate/from-trpc\"}]},{\"text\":\"集成\",\"collapsed\":true,\"items\":[{\"text\":\"AI SDK\",\"link\":\"/integrations/ai-sdk\"},{\"text\":\"Astro\",\"link\":\"/integrations/astro\"},{\"text\":\"Better Auth\",\"link\":\"/integrations/better-auth\"},{\"text\":\"Cloudflare Worker\",\"link\":\"/integrations/cloudflare-worker\"},{\"text\":\"Deno\",\"link\":\"/integrations/deno\"},{\"text\":\"Drizzle\",\"link\":\"/integrations/drizzle\"},{\"text\":\"Expo\",\"link\":\"/integrations/expo\"},{\"text\":\"Netlify\",\"link\":\"/integrations/netlify\"},{\"text\":\"Nextjs\",\"link\":\"/integrations/nextjs\"},{\"text\":\"Node.js\",\"link\":\"/integrations/node\"},{\"text\":\"Nuxt\",\"link\":\"/integrations/nuxt\"},{\"text\":\"Prisma\",\"link\":\"/integrations/prisma\"},{\"text\":\"React Email\",\"link\":\"/integrations/react-email\"},{\"text\":\"SvelteKit\",\"link\":\"/integrations/sveltekit\"},{\"text\":\"Tanstack Start\",\"link\":\"/integrations/tanstack-start\"},{\"text\":\"Vercel\",\"link\":\"/integrations/vercel\"}]}],\"outline\":{\"level\":[2,3],\"label\":\"目录\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/elysiajs/elysia\"},{\"icon\":\"twitter\",\"link\":\"https://twitter.com/elysiajs\"},{\"icon\":\"discord\",\"link\":\"https://discord.gg/eaFJ2KDJck\"}],\"editLink\":{\"text\":\"在 GitHub 上编辑此页面\",\"pattern\":\"https://github.com/zhcndoc/elysia/tree/main/docs/:path\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"medium\"}},\"langMenuLabel\":\"多语言\",\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"主题\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\"},\"locales\":{\"root\":{\"label\":\"简体中文\",\"lang\":\"zh\"},\"en\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"https://elysiajs.com/\"}},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>