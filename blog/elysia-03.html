<!DOCTYPE html>
<html lang="zh" dir="ltr">
  <head>
    <meta charset="utf-8">
    
    <title>Elysia 0.3 - 大地の閾を探して [Looking for Edge of Ground] - Elysia 中文文档</title>
    <meta name="description" content="介绍 Elysia Fn，针对高可扩展性的 TypeScript 性能进行的类型重构，支持文件上传及验证，重构的 Eden 合同。">
    <meta name="generator" content="VitePress v2.0.0-alpha.9">
    <link rel="preload stylesheet" href="/assets/style.DDBX-zZ7.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Dvs0PFFU.js"></script>
    <link rel="modulepreload" href="/assets/chunks/plugin-vue_export-helper.By5GbASF.js">
    <link rel="modulepreload" href="/assets/chunks/preload-helper.DNtGMa4k.js">
    <link rel="modulepreload" href="/assets/chunks/ray.COVkJs8g.js">
    <link rel="modulepreload" href="/assets/chunks/sponsor.constant.4aCYgjBK.js">
    <link rel="modulepreload" href="/assets/chunks/runtime-core.esm-bundler.D02XvB7A.js">
    <link rel="modulepreload" href="/assets/chunks/runtime-dom.esm-bundler._PUIWB9-.js">
    <link rel="modulepreload" href="/assets/chunks/core.CFT5RJS0.js">
    <link rel="modulepreload" href="/assets/chunks/Layout.CgtC_9GJ.js">
    <link rel="modulepreload" href="/assets/blog_elysia-03.md.DQa1ZSNj.lean.js">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <link rel="icon" href="/assets/elysia.png">
    <meta property="og:image" content="https://elysiajs.com/blog/elysia-03/edge-of-ground.webp">
    <meta property="og:image:width" content="2560">
    <meta property="og:image:height" content="1440">
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:image" content="https://elysiajs.com/blog/elysia-03/edge-of-ground.webp">
    <meta property="og:title" content="介绍 Elysia 0.3 - 大地の閾を探して [Looking for Edge of Ground]">
    <meta property="og:description" content="介绍 Elysia Fn，针对高可扩展性的 TypeScript 性能进行的类型重构，支持文件上传及验证，重构的 Eden 合同。">
    <script async src="https://www.zhcndoc.com/js/common.js"></script>
    <script id="check-dark-mode">(()=>{let e=localStorage.getItem(`vitepress-theme-appearance`)||`auto`,t=window.matchMedia(`(prefers-color-scheme: dark)`).matches;(!e||e===`auto`?t:e===`dark`)&&document.documentElement.classList.add(`dark`)})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle(`mac`,/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><!--[--><link rel="preload" as="image" href="/assets/elysia_v.webp" fetchpriority="high"><link rel="preload" as="image" href="/assets/elysia.svg" fetchpriority="high"><link rel="preload" as="image" href="/assets/shigure-ui-smol.gif" fetchpriority="low"><link rel="preload" as="image" href="/assets/elysia-chan-card.webp" fetchpriority="low"><meta name="theme-color" content="#ffffff"><!--[--><!--]--><!--[--><!--]--><div class="Layout" data-v-5e06b97a><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0b0ada53></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0b0ada53>Skip to content</a><!--]--><!----><header class="VPNav" data-v-5e06b97a data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-0ae64501><div class="wrapper" data-v-0ae64501><div class="container" data-v-0ae64501><div class="title" data-v-0ae64501><div class="VPNavBarTitle" data-v-0ae64501 data-v-1e38c6bc><a class="title" href="/" data-v-1e38c6bc><!--[--><!--]--><!--[--><img class="VPImage logo" src="/assets/elysia.svg" alt data-v-8426fc1a><!--]--><span data-v-1e38c6bc>Elysia 中文文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-0ae64501><div class="content-body" data-v-0ae64501><!--[--><!--]--><div class="VPNavBarSearch search" data-v-0ae64501><!--[--><!----><div id="local-search"><button type="button" aria-label="搜索文档" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-0ae64501 data-v-39714824><span id="main-nav-aria-label" class="visually-hidden" data-v-39714824> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-39714824 data-v-3ab3deac><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3ab3deac><span class="text" data-v-3ab3deac><!----><span data-v-3ab3deac>插件</span><span class="vpi-chevron-down text-icon" data-v-3ab3deac></span></span></button><div class="menu" data-v-3ab3deac><div class="VPMenu" data-v-3ab3deac data-v-c9afd7f1><div class="items" data-v-c9afd7f1><!--[--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/overview.html" data-v-35975db6><!--[--><span data-v-35975db6>概述</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/bearer.html" data-v-35975db6><!--[--><span data-v-35975db6>Bearer</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/cors.html" data-v-35975db6><!--[--><span data-v-35975db6>CORS</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/cron.html" data-v-35975db6><!--[--><span data-v-35975db6>Cron</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/graphql-apollo.html" data-v-35975db6><!--[--><span data-v-35975db6>GraphQL Apollo</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/graphql-yoga.html" data-v-35975db6><!--[--><span data-v-35975db6>GraphQL Yoga</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/html.html" data-v-35975db6><!--[--><span data-v-35975db6>HTML</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/jwt.html" data-v-35975db6><!--[--><span data-v-35975db6>JWT</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/openapi.html" data-v-35975db6><!--[--><span data-v-35975db6>OpenAPI</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/opentelemetry.html" data-v-35975db6><!--[--><span data-v-35975db6>OpenTelemetry</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/server-timing.html" data-v-35975db6><!--[--><span data-v-35975db6>Server Timing</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/static.html" data-v-35975db6><!--[--><span data-v-35975db6>Static</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-c9afd7f1 data-v-35975db6><a class="VPLink link" href="/plugins/stream.html" data-v-35975db6><!--[--><span data-v-35975db6>Stream</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/blog.html" tabindex="0" data-v-39714824 data-v-e56f3d57><!--[--><span data-v-e56f3d57>博客</span><!--]--></a><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-0ae64501 data-v-88af2de4 data-v-3ab3deac><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="多语言" data-v-3ab3deac><span class="text" data-v-3ab3deac><span class="vpi-languages option-icon" data-v-3ab3deac></span><!----><span class="vpi-chevron-down text-icon" data-v-3ab3deac></span></span></button><div class="menu" data-v-3ab3deac><div class="VPMenu" data-v-3ab3deac data-v-c9afd7f1><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>简体中文</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-35975db6><a class="VPLink link vp-external-link-icon" href="https://elysiajs.com/blog/elysia-03.html" target="_blank" rel="noreferrer" data-v-35975db6><!--[--><span data-v-35975db6>English</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-0ae64501 data-v-6c893767><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-6c893767 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-0ae64501 data-v-0394ad82 data-v-d474d15f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/elysiajs/elysia" aria-label="github" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://twitter.com/elysiajs" aria-label="twitter" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/eaFJ2KDJck" aria-label="discord" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-discord"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-0ae64501 data-v-bb2aa2f0 data-v-3ab3deac><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3ab3deac><span class="vpi-more-horizontal icon" data-v-3ab3deac></span></button><div class="menu" data-v-3ab3deac><div class="VPMenu" data-v-3ab3deac data-v-c9afd7f1><!----><!--[--><!--[--><div class="group translations" data-v-bb2aa2f0><p class="trans-title" data-v-bb2aa2f0>简体中文</p><!--[--><div class="VPMenuLink" data-v-bb2aa2f0 data-v-35975db6><a class="VPLink link vp-external-link-icon" href="https://elysiajs.com/blog/elysia-03.html" target="_blank" rel="noreferrer" data-v-35975db6><!--[--><span data-v-35975db6>English</span><!--]--></a></div><!--]--></div><div class="group" data-v-bb2aa2f0><div class="item appearance" data-v-bb2aa2f0><p class="label" data-v-bb2aa2f0>主题</p><div class="appearance-action" data-v-bb2aa2f0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-bb2aa2f0 data-v-5337faa4 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-5337faa4></span><span class="vpi-moon moon" data-v-5337faa4></span><!--]--></span></span></button></div></div></div><div class="group" data-v-bb2aa2f0><div class="item social-links" data-v-bb2aa2f0><div class="VPSocialLinks social-links-list" data-v-bb2aa2f0 data-v-d474d15f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/elysiajs/elysia" aria-label="github" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-github"></span></a><a class="VPSocialLink no-icon" href="https://twitter.com/elysiajs" aria-label="twitter" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-twitter"></span></a><a class="VPSocialLink no-icon" href="https://discord.gg/eaFJ2KDJck" aria-label="discord" target="_blank" rel="noopener" data-v-d474d15f data-v-bd121fe5><span class="vpi-social-discord"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-0ae64501 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-0ae64501><div class="divider-line" data-v-0ae64501></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-5e06b97a data-v-e30e5487><div class="container" data-v-e30e5487><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-e30e5487 data-v-5fabb9ca><button data-v-5fabb9ca>回到顶部</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-5e06b97a data-v-aff0b8d7><div class="VPDoc has-aside" data-v-aff0b8d7 data-v-7011f0d8><!--[--><!--[--><!--[--><div class="absolute flex flex-col z-[40] w-full !max-w-full items-center justify-center bg-transparent transition-bg overflow-hidden h-[220px] top-0 left-0 opacity-25 dark:opacity-[.55] pointer-events-none" data-v-bf23a8df><div class="-static ray absolute opacity-60" data-v-bf23a8df></div></div><!--]--><!--]--><!--]--><div class="container" data-v-7011f0d8><div class="aside" data-v-7011f0d8><div class="aside-curtain" data-v-7011f0d8></div><div class="aside-container" data-v-7011f0d8><div class="aside-content" data-v-7011f0d8><div class="VPDocAside" data-v-7011f0d8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-60d5052e><div class="content" data-v-60d5052e><div class="outline-marker" data-v-60d5052e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-60d5052e>页面导航</div><ul class="VPDocOutlineItem root" data-v-60d5052e data-v-2d0bdf9b><!--[--><!--]--></ul></div></nav><!--[--><!--[--><!--[--><!--[--><h6 class="text-sm font-medium text-gray-500 mt-6 px-2"> 我们的赞助商 </h6><aside class="grid grid-cols-2 w-48"><!--[--><!--]--></aside><!--]--><!--]--><!--]--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--[--><!--[--><!--[--><div class="mt-auto mx-auto"><img src="/assets/elysia-chan-card.webp" class="aspect-video max-h-24 rounded-lg border object-cover opacity-40 interact:opacity-100 interact:scale-110 interact:-translate-y-2 interact:shadow-xl shadow-slate-800/7.5 transition-all ease-out duration-200 cursor-pointer" style="object-position:0 10%;"></div><!--]--><!--]--><!--]--><!--]--></div></div></div></div><div class="content" data-v-7011f0d8><div class="content-container" data-v-7011f0d8><!--[--><!--]--><main class="main" data-v-7011f0d8><div style="position:relative;" class="vp-doc _blog_elysia-03" data-v-7011f0d8><div><article id="blog" class="flex flex-col max-w-3xl w-full mx-auto mt-8"><a href="/blog" class="flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 mb-2"><span>←</span> Blog </a><h1 class="!text-3xl !md:text-4xl font-medium">Elysia 0.3 - 大地の閾を探して [Looking for Edge of Ground]</h1><aside class="flex gap-2 items-center mt-3"><img class="w-9 h-9 rounded-full" src="/blog/authors/lilith-happy.webp" alt="saltyaom"><div class="flex flex-col justify-start"><h3 class="!text-sm !m-0 opacity-75">saltyaom</h3><p class="flex flex-row items-center gap-2 !text-xs !m-0 opacity-75"><time datetime="2023 年 3 月 17 日">2023 年 3 月 17 日</time><span>ー</span><a href="https://twitter.com/saltyaom" target="_blank">@saltyaom</a></p></div></aside><img src="/blog/elysia-03/edge-of-ground.webp" alt="碎玻璃片漂浮在深渊中" class="border w-full mt-5 mb-2"><main id="blog-content"><!--[--><p>以 Camellia 的歌曲<a href="https://youtu.be/oyJf72je2U0" target="_blank" rel="noreferrer">「大地の閾を探して [Looking for Edge of Ground]」</a> ft. 初音未来 命名，是我最喜欢的 Camellia 专辑「U.U.F.O」的最后一曲。这首歌对我个人影响深远，因此我不会轻视这个名字。</p><p>这是最具挑战性的更新，带来了迄今为止最大的 Elysia 发布，重新思考和重新设计了 Elysia 架构，以实现高可扩展性，同时尽量减少破坏性更改。</p><p>我很高兴地宣布 Elysia 0.3 的发布候选版本，令人兴奋的新功能即将到来。</p><h2 id="elysia-fn" tabindex="-1">Elysia Fn <a class="header-anchor" href="#elysia-fn" aria-label="Permalink to “Elysia Fn”">​</a></h2><p>介绍 Elysia Fn，可以在前端运行任何后端函数，具备完整的自动补全和类型支持。</p><video controls autoplay muted><source src="/blog/elysia-03/elysia-fn.mp4" type="video/mp4"></video><p>为了快速开发，Elysia Fn 允许你“暴露”后端代码，以便从前端调用，具备完整的类型安全、自动补全、原始代码注释和“点击定义”功能，帮助你加速开发进程。</p><p>你可以通过 Eden Fn 将 Elysia Fn 与 Eden 结合使用，以实现完全的类型安全。</p><h3 id="权限" tabindex="-1">权限 <a class="header-anchor" href="#权限" aria-label="Permalink to “权限”">​</a></h3><p>你可以限制函数的允许或拒绝范围，检查授权头和其他头字段，验证参数，或以编程方式限制密钥访问。</p><p>密钥检查支持类型安全和自动补全所有可能的函数，因此你不会错过某些功能或意外输入错误的名称。 <img src="/blog/elysia-03/narrowed-key.webp" alt="Narrowed Key" data-zoomable="true"></p><p>以编程方式缩小属性范围也会缩小参数的类型，换句话说，实现了完全的类型安全。 <img src="/blog/elysia-03/narrowed-param.webp" alt="Narrowed Params" data-zoomable="true"></p><h3 id="技术细节" tabindex="-1">技术细节 <a class="header-anchor" href="#技术细节" aria-label="Permalink to “技术细节”">​</a></h3><p>在技术细节上，Elysia Fn 使用 JavaScript 的 Proxy 来捕获对象属性和参数，以创建批量请求发送到服务器进行处理，并在网络上返回值。 Elysia Fn 扩展了 superjson，允许在 JSON 数据中解析 JavaScript 的原生类型，如 Error、Map、Set 和 undefined。</p><p>Elysia Fn 支持多种用例，例如在客户端 Nextjs 应用中访问 Prisma。 理论上，可以使用 Redis、Sequelize、RabbitMQ 等等。 由于 Elysia 运行在 Bun 上，Elysia Fn 可以并发运行超过 120 万次操作/秒（在 M1 Max 上测试）。</p><p>了解更多关于 Elysia Fn 的信息，请访问 <a href="/plugins/eden/fn.html">Eden Fn</a>。</p><h2 id="类型重构" tabindex="-1">类型重构 <a class="header-anchor" href="#类型重构" aria-label="Permalink to “类型重构”">​</a></h2><p>类型检查速度提高了 6.5-9 倍，类型行数减少无法计数。</p><p>Elysia 0.3 中，超过 80% 的 Elysia 和 Eden 类型已经重写，专注于性能、类型推断和快速自动补全。</p><p>对超过 350 条复杂路由进行测试，Elysia 仅需 0.22 秒即可生成用于 Eden 的类型声明。</p><p>由于 Elysia 路由现在直接编译为字面对象而不是 Typebox 引用，Elysia 的类型声明比 0.2 版本小得多，Eden 更易于使用。这里的小得多的意思是 50%-99% 更小。</p><p>不仅 Elysia 与 TypeScript 的集成显著提升，Elysia 对 TypeScript 和你的代码的理解也更好。</p><p>例如，在 0.3 版本中，Elysia 在插件注册时不再那么严格，允许你在没有完全类型补全的情况下注册插件。 内联的 <code>use</code> 函数现在推断父类型，而嵌套守卫可以更准确地引用父类的模型类型。</p><p>类型声明现在也可以构建和导出。</p><p>经过类型重构，Elysia 对 TypeScript 的理解远超以前，类型补全的速度将显著加快，我们鼓励你尝试一下，看看有多快。 有关更多细节，请参见这条 <a href="https://twitter.com/saltyAom/status/1629876280517869568?s=20" target="_blank" rel="noreferrer">Twitter 线程</a>。</p><h2 id="文件上传" tabindex="-1">文件上传 <a class="header-anchor" href="#文件上传" aria-label="Permalink to “文件上传”">​</a></h2><p>感谢 Bun 0.5.7，Elysia 0.3 中默认实现并启用了表单数据 <code>multipart/formdata</code>。</p><p>为上传文件定义类型补全和验证后，<code>Elysia.t</code> 现在通过 <code>File</code> 和 <code>Files</code> 扩展 TypeBox 以进行文件验证。</p><p>验证包括检查文件类型，并自动补全标准文件大小，文件的最小和最大大小，以及每个字段的文件总数。</p><p>Elysia 0.3 还引入了 <code>schema.contentType</code>，以明确验证传入请求类型，在验证数据之前严格检查头信息。</p><h2 id="openapi-schema-3-0-x" tabindex="-1">OpenAPI Schema 3.0.x <a class="header-anchor" href="#openapi-schema-3-0-x" aria-label="Permalink to “OpenAPI Schema 3.0.x”">​</a></h2><p>在 Elysia 0.3 中，Elysia 现在默认使用 OpenAPI schema 3.0.x，以更好地声明 API 定义，并根据内容类型更好地支持多种类型。</p><p><code>schema.details</code> 现已更新为 OpenAPI 3.0.x，Elysia 还更新了 Swagger 插件，以匹配 OpenAPI 3.0.x，利用 OpenAPI 3 和 Swagger 中的新功能，尤其是文件上传方面。</p><h2 id="eden-重构" tabindex="-1">Eden 重构 <a class="header-anchor" href="#eden-重构" aria-label="Permalink to “Eden 重构”">​</a></h2><p>为了支持更高的 Elysia 需求，支持 Elysia Fn、Rest 等，Eden 被重新设计以与新架构扩展。</p><p>Eden 现在导出 3 类型的函数。</p><ul><li><a href="/plugins/eden/treaty.html">Eden Treaty</a> <code>eden/treaty</code>: 原始的 Eden 语法</li><li><a href="/plugins/eden/fn.html">Eden Fn</a> <code>eden/fn</code>: 访问 Elysia Fn</li><li><a href="/plugins/eden/fetch.html">Eden Fetch</a> <code>eden/fetch</code>: 类似 fetch 的语法，适用于复杂的 Elysia 类型 (&gt; 1,000 路由 / Elysia 实例)</li></ul><p>通过重构类型定义和支持 Elysia Eden，Eden 现在在推断服务器类型时显著更快和更好。</p><p>自动补全速度更快，使用的资源比以往更少，实际上，Eden 的类型声明几乎重构了 100%，以减少大小和推断时间，使其在眨眼之间支持超过 350 条路由的自动补全（约 0.26 秒）。</p><p>为了使 Elysia Eden 完全类型安全，利用 Elysia 对 TypeScript 更好的理解，Eden 现在可以根据响应状态缩小类型，使你能够在任何条件下准确捕获类型。 <img src="/blog/elysia-03/narrowed-error.webp" alt="Narrowed error.webp" data-zoomable="true"></p><h3 id="显著改进" tabindex="-1">显著改进： <a class="header-anchor" href="#显著改进" aria-label="Permalink to “显著改进：”">​</a></h3><ul><li>添加字符串格式：&#39;email&#39;、&#39;uuid&#39;、&#39;date&#39;、&#39;date-time&#39;</li><li>更新 @sinclair/typebox 至 0.25.24</li><li>更新 Raikiri 至 0.2.0-beta.0 (ei)</li><li>感谢 #21 添加文件上传测试 (@amirrezamahyari)</li><li>为 Eden 预编译小写方法</li><li>为大多数 Elysia 类型减少复杂指令</li><li>将 <code>ElysiaRoute</code> 类型编译为字面量</li><li>优化类型编译、类型推断和自动补全</li><li>提高类型编译速度</li><li>改进插件注册中的 TypeScript 推断</li><li>优化 TypeScript 推断大小</li><li>上下文创建优化</li><li>默认使用 Raikiri 路由</li><li>移除未使用的函数</li><li>重构 <code>registerSchemaPath</code> 以支持 OpenAPI 3.0.3</li><li>为 Eden 添加 <code>error</code> 推断</li><li>将 <code>@sinclair/typebox</code> 标记为可选的 <code>peerDenpendencies</code></li></ul><p>修复：</p><ul><li>Raikiri 0.2 在未找到时抛出错误</li><li>与 <code>t.File</code> 的联合响应无法工作</li><li>Swagger 中未定义定义</li><li>在分组插件中缺少详细信息</li><li>分组插件无法编译架构</li><li>因为 EXPOSED 是私有属性，分组不能导出</li><li>多个 cookies 不将 <code>content-type</code> 设置为 <code>application/json</code></li><li>使用 <code>fn.permission</code> 时 <code>EXPOSED</code> 未导出</li><li><code>.ws</code> 合并返回类型缺失</li><li>缺少 nanoid</li><li>上下文副作用</li><li>Swagger 中的 <code>t.Files</code> 引用单个文件</li><li>Eden 响应类型未知</li><li>通过 Eden 无法类型化 <code>setModel</code> 推断定义</li><li>在不允许权限的函数中处理抛出的错误</li><li>导出的变量使用了外部模块的名称 &#39;SCHEMA&#39;</li><li>导出的变量使用了外部模块的名称 &#39;DEFS&#39;</li><li>在 <code>tsconfig.json</code> 中使用 <code>declaration: true</code> 建立 Elysia 应用时可能出现错误</li></ul><p>重大变更：</p><ul><li>将 <code>inject</code> 重命名为 <code>derive</code></li><li>弃用 <code>ElysiaRoute</code>，更改为内联</li><li>移除 <code>derive</code></li><li>从 OpenAPI 2.x 更新到 OpenAPI 3.0.3</li><li>将 context.store[SYMBOL] 移动到 meta[SYMBOL]</li></ul><h2 id="之后" tabindex="-1">之后 <a class="header-anchor" href="#之后" aria-label="Permalink to “之后”">​</a></h2><p>随着 Elysia Fn 的引入，我个人很期待它在前端开发中的应用，打破前端与后端的界限。而 Elysia 的类型重构，使类型检查和自动补全变得更快。</p><p>我期待着看到你们使用 Elysia 创建你们要构建的精彩事物。</p><p>我们有专门的 <a href="https://discord.gg/eaFJ2KDJck" target="_blank" rel="noreferrer">Discord 服务器</a> 支持 Elysia。欢迎随时打招呼或畅所欲言。</p><p>感谢您对 Elysia 的支持。</p><blockquote><p>在永无止境的天幕下</p><p>在没有名字的悬崖上</p><p>我只是嚎叫</p><p>希望那无尽的回响能传达到你</p><p>我相信某天，我会站在大地的边缘</p><p>（直到那天我能回到你身边告诉你）</p></blockquote><!--]--></main><a href="/" class="flex items-center gap-2 text-base !text-gray-500 dark:!text-gray-400 !no-underline hover:!text-pink-500 focus:!text-pink-500 mt-2"><span>←</span> Elysia: Ergonomic Framework for Humans </a></article></div></div></main><footer class="VPDocFooter" data-v-7011f0d8 data-v-e257564d><!--[--><!--]--><div class="edit-info" data-v-e257564d><!----><div class="last-updated" data-v-e257564d><p class="VPLastUpdated" data-v-e257564d data-v-e98dd255>最后更新于: <time datetime="2025-09-18T15:08:24.000Z" data-v-e98dd255></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-e257564d><span class="visually-hidden" id="doc-footer-aria-label" data-v-e257564d>Pager</span><div class="pager" data-v-e257564d><!----></div><div class="pager" data-v-e257564d><a class="VPLink link pager-link next" href="/at-glance.html" data-v-e257564d><!--[--><span class="desc" data-v-e257564d>下一页</span><span class="title" data-v-e257564d>概览</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div><!--]--></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"at-glance.md\":\"CIcXr_aw\",\"blog.md\":\"H0czChfS\",\"blog_elysia-02.md\":\"CMKaV4Id\",\"blog_elysia-03.md\":\"DQa1ZSNj\",\"blog_elysia-04.md\":\"DHXt2GbB\",\"blog_elysia-05.md\":\"CIgI-jLM\",\"blog_elysia-06.md\":\"B33YZKfX\",\"blog_elysia-07.md\":\"-Hfbans0\",\"blog_elysia-08.md\":\"CADMy4eN\",\"blog_elysia-10.md\":\"Dr088yZG\",\"blog_elysia-11.md\":\"Df9szbKe\",\"blog_elysia-12.md\":\"DzSocM9r\",\"blog_elysia-13.md\":\"5MRQiuoD\",\"blog_elysia-14.md\":\"CQKylEGA\",\"blog_elysia-supabase.md\":\"vaH1xxnN\",\"blog_openapi-type-gen.md\":\"nIIqxpGf\",\"blog_with-prisma.md\":\"BYy2Cd9j\",\"eden_fetch.md\":\"RjvMqaoB\",\"eden_installation.md\":\"BODTWWso\",\"eden_overview.md\":\"BrQy8Z5Y\",\"eden_test.md\":\"CIJVYIgq\",\"eden_treaty_config.md\":\"CjZ77XQi\",\"eden_treaty_legacy.md\":\"Bw4hW9lX\",\"eden_treaty_overview.md\":\"Dqx9Q3wg\",\"eden_treaty_parameters.md\":\"DP4TV-w8\",\"eden_treaty_response.md\":\"2YkJXxzE\",\"eden_treaty_unit-test.md\":\"94ANRF5Z\",\"eden_treaty_websocket.md\":\"UJi4oEtb\",\"essential_best-practice.md\":\"DqUj4gnM\",\"essential_handler.md\":\"Cer1LRLX\",\"essential_life-cycle.md\":\"BAFj7o9s\",\"essential_plugin.md\":\"fcuogcCI\",\"essential_route.md\":\"LzEhD-mK\",\"essential_structure.md\":\"CVyWKKLs\",\"essential_validation.md\":\"JCQjZFcG\",\"index.md\":\"D7F-5qbj\",\"integrations_ai-sdk.md\":\"Cf4peAZ0\",\"integrations_astro.md\":\"DZnZk3D8\",\"integrations_better-auth.md\":\"DLHUOsFD\",\"integrations_cheat-sheet.md\":\"BTDMFsYJ\",\"integrations_drizzle.md\":\"DD689xW_\",\"integrations_expo.md\":\"5rqy5x0k\",\"integrations_nextjs.md\":\"BlE4HwTT\",\"integrations_nuxt.md\":\"Bgl5XPkc\",\"integrations_opentelemetry.md\":\"BoB_ReV5\",\"integrations_prisma.md\":\"CAREQfTf\",\"integrations_react-email.md\":\"D_SHIEQd\",\"integrations_sveltekit.md\":\"DZO2Qm41\",\"integrations_vercel.md\":\"Ca0JOyy3\",\"key-concept.md\":\"Dfb9USWm\",\"migrate_from-express.md\":\"4beM9Hrp\",\"migrate_from-fastify.md\":\"D0VpzGQb\",\"migrate_from-hono.md\":\"axHMZ8uI\",\"patterns_configuration.md\":\"DeiEwWJp\",\"patterns_cookie.md\":\"BGXYU9yq\",\"patterns_deploy.md\":\"CgMGdvMP\",\"patterns_error-handling.md\":\"DYdRRcP0\",\"patterns_macro.md\":\"BFB9ADyy\",\"patterns_mount.md\":\"CZ5MNPTu\",\"patterns_openapi.md\":\"C-e4LrmE\",\"patterns_trace.md\":\"DjNwVdwh\",\"patterns_type.md\":\"-te2ba8m\",\"patterns_unit-test.md\":\"o7v7VTrx\",\"patterns_websocket.md\":\"DDYa26QV\",\"plugins_bearer.md\":\"Gd5fUbu2\",\"plugins_cors.md\":\"Cuu89bjM\",\"plugins_cron.md\":\"GA2j8u8-\",\"plugins_graphql-apollo.md\":\"BcsNqVd7\",\"plugins_graphql-yoga.md\":\"Dn4ufK46\",\"plugins_html.md\":\"C9oA6FyB\",\"plugins_jwt.md\":\"D44kN1j3\",\"plugins_openapi.md\":\"wOIGQmTc\",\"plugins_opentelemetry.md\":\"CEUjMCMa\",\"plugins_overview.md\":\"DkZkGzgG\",\"plugins_server-timing.md\":\"DtlGrys7\",\"plugins_static.md\":\"vzT0KUb3\",\"plugins_stream.md\":\"frNy5Jjp\",\"plugins_swagger.md\":\"D9Q9bAa9\",\"quick-start.md\":\"CDxHYmEQ\",\"table-of-content.md\":\"COirGFX1\",\"tutorial.md\":\"D6Nia-BP\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Elysia 中文文档\",\"titleTemplate\":\":title - Elysia 中文文档\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"search\":{\"provider\":\"local\",\"options\":{\"detailedView\":true,\"locales\":{\"root\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"logo\":\"/assets/elysia.svg\",\"nav\":[{\"text\":\"插件\",\"items\":[{\"text\":\"概述\",\"link\":\"/plugins/overview\"},{\"text\":\"Bearer\",\"link\":\"/plugins/bearer\"},{\"text\":\"CORS\",\"link\":\"/plugins/cors\"},{\"text\":\"Cron\",\"link\":\"/plugins/cron\"},{\"text\":\"GraphQL Apollo\",\"link\":\"/plugins/graphql-apollo\"},{\"text\":\"GraphQL Yoga\",\"link\":\"/plugins/graphql-yoga\"},{\"text\":\"HTML\",\"link\":\"/plugins/html\"},{\"text\":\"JWT\",\"link\":\"/plugins/jwt\"},{\"text\":\"OpenAPI\",\"link\":\"/plugins/openapi\"},{\"text\":\"OpenTelemetry\",\"link\":\"/plugins/opentelemetry\"},{\"text\":\"Server Timing\",\"link\":\"/plugins/server-timing\"},{\"text\":\"Static\",\"link\":\"/plugins/static\"},{\"text\":\"Stream\",\"link\":\"/plugins/stream\"}]},{\"text\":\"博客\",\"link\":\"/blog\"}],\"sidebar\":[{\"text\":\"入门\",\"collapsed\":true,\"items\":[{\"text\":\"概览\",\"link\":\"/at-glance\"},{\"text\":\"快速开始\",\"link\":\"/quick-start\"},{\"text\":\"教程\",\"link\":\"/tutorial\",\"collapsed\":true,\"items\":[{\"text\":\"从 Express 迁移\",\"link\":\"/migrate/from-express\"},{\"text\":\"从 Fastify 迁移\",\"link\":\"/migrate/from-fastify\"},{\"text\":\"从 Hono 迁移\",\"link\":\"/migrate/from-hono\"}]},{\"text\":\"关键概念\",\"link\":\"/key-concept\"},{\"text\":\"目录\",\"link\":\"/table-of-content\"}]},{\"text\":\"基础\",\"collapsed\":true,\"items\":[{\"text\":\"路由\",\"link\":\"/essential/route\"},{\"text\":\"处理程序\",\"link\":\"/essential/handler\"},{\"text\":\"生命周期\",\"link\":\"/essential/life-cycle\"},{\"text\":\"验证\",\"link\":\"/essential/validation\"},{\"text\":\"插件\",\"link\":\"/essential/plugin\"},{\"text\":\"最佳实践\",\"link\":\"/essential/best-practice\"}]},{\"text\":\"模式\",\"collapsed\":true,\"items\":[{\"text\":\"配置\",\"link\":\"/patterns/configuration\"},{\"text\":\"Cookie\",\"link\":\"/patterns/cookie\"},{\"text\":\"生产环境部署\",\"link\":\"/patterns/deploy\"},{\"text\":\"错误处理\",\"link\":\"/patterns/error-handling\"},{\"text\":\"Macro\",\"link\":\"/patterns/macro\"},{\"text\":\"挂载\",\"link\":\"/patterns/mount\"},{\"text\":\"OpenAPI\",\"link\":\"/patterns/openapi\"},{\"text\":\"Trace\",\"link\":\"/patterns/trace\"},{\"text\":\"类型\",\"link\":\"/patterns/type\"},{\"text\":\"单元测试\",\"link\":\"/patterns/unit-test\"},{\"text\":\"WebSocket\",\"link\":\"/patterns/websocket\"}]},{\"text\":\"Eden\",\"collapsed\":true,\"items\":[{\"text\":\"概述\",\"link\":\"/eden/overview.md\"},{\"text\":\"安装\",\"link\":\"/eden/installation.md\"},{\"text\":\"Eden 协议\",\"collapsed\":false,\"items\":[{\"text\":\"概述\",\"link\":\"/eden/treaty/overview\"},{\"text\":\"参数\",\"link\":\"/eden/treaty/parameters\"},{\"text\":\"响应\",\"link\":\"/eden/treaty/response\"},{\"text\":\"WebSocket\",\"link\":\"/eden/treaty/websocket\"},{\"text\":\"配置\",\"link\":\"/eden/treaty/config\"},{\"text\":\"单元测试\",\"link\":\"/eden/treaty/unit-test\"},{\"text\":\"旧版（协议 1）\",\"link\":\"/eden/treaty/legacy.md\"}]},{\"text\":\"Eden Fetch\",\"link\":\"/eden/fetch.md\"}]},{\"text\":\"插件\",\"collapsed\":true,\"items\":[{\"text\":\"概述\",\"link\":\"/plugins/overview\"},{\"text\":\"Bearer\",\"link\":\"/plugins/bearer\"},{\"text\":\"CORS\",\"link\":\"/plugins/cors\"},{\"text\":\"Cron\",\"link\":\"/plugins/cron\"},{\"text\":\"GraphQL Apollo\",\"link\":\"/plugins/graphql-apollo\"},{\"text\":\"GraphQL Yoga\",\"link\":\"/plugins/graphql-yoga\"},{\"text\":\"HTML\",\"link\":\"/plugins/html\"},{\"text\":\"JWT\",\"link\":\"/plugins/jwt\"},{\"text\":\"OpenAPI\",\"link\":\"/plugins/openapi\"},{\"text\":\"OpenTelemetry\",\"link\":\"/plugins/opentelemetry\"},{\"text\":\"服务器计时\",\"link\":\"/plugins/server-timing\"},{\"text\":\"静态\",\"link\":\"/plugins/static\"},{\"text\":\"Stream\",\"link\":\"/plugins/stream\"}]},{\"text\":\"集成\",\"collapsed\":true,\"items\":[{\"text\":\"AI SDK\",\"link\":\"/integrations/ai-sdk\"},{\"text\":\"Astro\",\"link\":\"/integrations/astro\"},{\"text\":\"Better Auth\",\"link\":\"/integrations/better-auth\"},{\"text\":\"Drizzle\",\"link\":\"/integrations/drizzle\"},{\"text\":\"Expo\",\"link\":\"/integrations/expo\"},{\"text\":\"Nextjs\",\"link\":\"/integrations/nextjs\"},{\"text\":\"Nuxt\",\"link\":\"/integrations/nuxt\"},{\"text\":\"OpenTelemetry\",\"link\":\"/integrations/opentelemetry\"},{\"text\":\"Prisma\",\"link\":\"/integrations/prisma\"},{\"text\":\"React Email\",\"link\":\"/integrations/react-email\"},{\"text\":\"SvelteKit\",\"link\":\"/integrations/sveltekit\"},{\"text\":\"Vercel\",\"link\":\"/integrations/vercel\"}]}],\"outline\":{\"level\":2,\"label\":\"页面导航\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/elysiajs/elysia\"},{\"icon\":\"twitter\",\"link\":\"https://twitter.com/elysiajs\"},{\"icon\":\"discord\",\"link\":\"https://discord.gg/eaFJ2KDJck\"}],\"editLink\":{\"text\":\"在 GitHub 上编辑此页面\",\"pattern\":\"https://github.com/zhcndoc/elysia/tree/main/docs/:path\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"lastUpdated\":{\"text\":\"最后更新于\",\"formatOptions\":{\"dateStyle\":\"short\",\"timeStyle\":\"medium\"}},\"langMenuLabel\":\"多语言\",\"returnToTopLabel\":\"回到顶部\",\"sidebarMenuLabel\":\"菜单\",\"darkModeSwitchLabel\":\"主题\",\"lightModeSwitchTitle\":\"切换到浅色模式\",\"darkModeSwitchTitle\":\"切换到深色模式\"},\"locales\":{\"root\":{\"label\":\"简体中文\",\"lang\":\"zh\"},\"en\":{\"label\":\"English\",\"lang\":\"en\",\"link\":\"https://elysiajs.com/\"}},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>