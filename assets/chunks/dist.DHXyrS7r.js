const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/core.BmyAj8QY.js","assets/chunks/chunk.BqXodU4U.js"])))=>i.map(i=>d[i]);
import{o as e,r as t,t as n}from"./chunk.BqXodU4U.js";import{Ct as r,G as i,Ot as a,T as o,Tt as s,V as c,_ as l,at as u,b as d,c as f,gt as p,p as m,tt as h}from"./vue.runtime.esm-bundler.BB7fvrom.js";import{n as g,t as _}from"./preload-helper.CPrT4D5T.js";import{t as ee}from"./dist.CgqBDwnI.js";var te={class:`mockup-browser dark:bg-slate-800 border dark:border-slate-700 playground`},ne={class:`mockup-browser-toolbar`},re={class:`input`},v=[`value`],ie={class:`flex justify-start items-stretch w-full h-full px-4 whitespace-pre-wrap pb-3`,style:{"min-height":`20rem`}},ae=o({__name:`playground`,props:{elysia:{},mock:{default:()=>({})},alias:{default:()=>({})}},setup(e){let t=e.elysia?.router.history,n=p({method:t?.[0]?.method??`get`,path:t?.[0]?.path??`/`}),o=p(``),g=async()=>{let{method:t,path:r}=n.value;if(e.mock&&r in e.mock&&t in e.mock[r]){o.value=e.mock[r][t];return}o.value=await e.elysia.handle(new Request(`http://elysiajs.com`+r,{method:t})).then(e=>e.text())};return g(),h([n],g),(p,h)=>(c(),d(`article`,te,[l(`div`,ne,[l(`div`,re,[h[1]||=l(`span`,null,`localhost`,-1),u(l(`select`,{name:`route`,class:`select`,"onUpdate:modelValue":h[0]||=e=>n.value=e},[(c(!0),d(m,null,i(r(t),({method:t,path:n})=>(c(),d(`option`,{key:t+`_`+n,value:{method:t,path:n}},a(e.alias&&n in e.alias?e.alias[n]:n),9,v))),128))],512),[[f,n.value]])]),l(`p`,{class:s([`!my-0 font-semibold pl-2 min-w-[5.5ch] text-right whitespace-nowrap`,n.value.method===`GET`?`text-green-600`:`text-blue-500`])},a(n.value.method),3)]),l(`section`,ie,a(o.value),1)]))}}),oe=(e,t)=>{let n=t?.length?{}:null;if(n)for(let e of t)n[e.part.charCodeAt(0)]=e;return{part:e,store:null,inert:n,params:null,wildcardStore:null}},se=(e,t)=>({...e,part:t}),ce=e=>({name:e,store:null,inert:null}),y=class e{constructor(e={}){this.config=e,e.lazy&&(this.find=this.lazyFind),e.onParam&&!Array.isArray(e.onParam)&&(this.config.onParam=[this.config.onParam])}root={};history=[];deferred=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/(\/:\w+\?)/g};lazyFind=(e,t)=>this.config.lazy?(this.build(),this.find(e,t)):this.find;build(){if(this.config.lazy){for(let[e,t,n]of this.deferred)this.add(e,t,n,{lazy:!1,ignoreHistory:!0});this.deferred=[],this.find=(e,t)=>{let n=this.root[e];return n?le(t,t.length,n,0,this.config.onParam):null}}}add(t,n,r,{ignoreError:i=!1,ignoreHistory:a=!1,lazy:o=this.config.lazy}={}){if(o)return this.find=this.lazyFind,this.deferred.push([t,n,r]),r;if(typeof n!=`string`)throw TypeError(`Route path must be a string`);n===``?n=`/`:n[0]!==`/`&&(n=`/${n}`);let s=n[n.length-1]===`*`,c=n.match(e.regex.optionalParams);if(c){let e=n.replaceAll(`?`,``);this.add(t,e,r,{ignoreError:i,ignoreHistory:a,lazy:o});for(let e=0;e<c.length;e++){let i=n.replace(c[e],``);this.add(t,i,r,{ignoreError:!0,ignoreHistory:a,lazy:o})}return r}if(c&&(n=n.replaceAll(`?`,``)),this.history.find(([e,r,i])=>e===t&&r===n))return r;(s||c&&n.charCodeAt(n.length-1)===63)&&(n=n.slice(0,-1)),a||this.history.push([t,n,r]);let l=n.split(e.regex.static),u=n.match(e.regex.params)||[];l[l.length-1]===``&&l.pop();let d;d=this.root[t]?this.root[t]:this.root[t]=oe(`/`);let f=0;for(let e=0;e<l.length;++e){let t=l[e];if(e>0){let e=u[f++].slice(1);if(d.params===null)d.params=ce(e);else if(d.params.name!==e){if(i)return r;throw Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}let a=d.params;if(a.inert===null){d=a.inert=oe(t);continue}d=a.inert}for(let e=0;;){if(e===t.length){if(e<d.part.length){let n=se(d,d.part.slice(e));Object.assign(d,oe(t,[n]))}break}if(e===d.part.length){d.inert===null&&(d.inert={});let n=d.inert[t.charCodeAt(e)];if(n){d=n,t=t.slice(e),e=0;continue}let r=oe(t.slice(e));d.inert[t.charCodeAt(e)]=r,d=r;break}if(t[e]!==d.part[e]){let n=se(d,d.part.slice(e)),r=oe(t.slice(e));Object.assign(d,oe(d.part.slice(0,e),[n,r])),d=r;break}++e}}if(f<u.length){let e=u[f].slice(1);if(d.params===null)d.params=ce(e);else if(d.params.name!==e){if(i)return r;throw Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}return d.params.store===null&&(d.params.store=r),d.params.store}return s?(d.wildcardStore===null&&(d.wildcardStore=r),d.wildcardStore):(d.store===null&&(d.store=r),d.store)}find(e,t){let n=this.root[e];return n?le(t,t.length,n,0,this.config.onParam):null}},le=(e,t,n,r,i)=>{let a=n.part,o=a.length,s=r+o;if(o>1){if(s>t)return null;if(o<15){for(let t=1,n=r+1;t<o;++t,++n)if(a.charCodeAt(t)!==e.charCodeAt(n))return null}else if(e.slice(r,s)!==a)return null}if(s===t)return n.store===null?n.wildcardStore===null?null:{store:n.wildcardStore,params:{"*":``}}:{store:n.store,params:{}};if(n.inert!==null){let r=n.inert[e.charCodeAt(s)];if(r!==void 0){let n=le(e,t,r,s,i);if(n!==null)return n}}if(n.params!==null){let{store:r,name:a,inert:o}=n.params,c=e.indexOf(`/`,s);if(c!==s){if(c===-1||c>=t){if(r!==null){let n={};if(n[a]=e.substring(s,t),i)for(let e=0;e<i.length;e++){let t=i[e](n[a],a);t!==void 0&&(n[a]=t)}return{store:r,params:n}}}else if(o!==null){let n=le(e,t,o,c,i);if(n!==null){if(n.params[a]=e.substring(s,c),i)for(let e=0;e<i.length;e++){let t=i[e](n.params[a],a);t!==void 0&&(n.params[a]=t)}return n}}}}return n.wildcardStore===null?null:{store:n.wildcardStore,params:{"*":e.substring(s,t)}}};function ue(e){return S(e)&&!de(e)&&!_e(e)&&Symbol.asyncIterator in e}function de(e){return Array.isArray(e)}function fe(e){return typeof e==`bigint`}function pe(e){return typeof e==`boolean`}function me(e){return e instanceof globalThis.Date}function he(e){return typeof e==`function`}function b(e){return S(e)&&!de(e)&&!_e(e)&&Symbol.iterator in e}function ge(e){return e===null}function x(e){return typeof e==`number`}function S(e){return typeof e==`object`&&!!e}function C(e){return e instanceof globalThis.RegExp}function w(e){return typeof e==`string`}function T(e){return typeof e==`symbol`}function _e(e){return e instanceof globalThis.Uint8Array}function E(e){return e===void 0}function ve(e){return e.map(e=>Ce(e))}function ye(e){return new Date(e.getTime())}function be(e){return new Uint8Array(e)}function xe(e){return new RegExp(e.source,e.flags)}function Se(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=Ce(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=Ce(e[n]);return t}function Ce(e){return de(e)?ve(e):me(e)?ye(e):_e(e)?be(e):C(e)?xe(e):S(e)?Se(e):e}function we(e){return Ce(e)}function Te(e,t){return we(t===void 0?e:{...t,...e})}function Ee(e){return O(e)&&globalThis.Symbol.asyncIterator in e}function De(e){return O(e)&&globalThis.Symbol.iterator in e}function Oe(e){return e instanceof globalThis.Promise}function ke(e){return e instanceof Date&&globalThis.Number.isFinite(e.getTime())}function Ae(e){return e instanceof globalThis.Map}function je(e){return e instanceof globalThis.Set}function Me(e){return globalThis.ArrayBuffer.isView(e)}function Ne(e){return e instanceof globalThis.Uint8Array}function D(e,t){return t in e}function O(e){return typeof e==`object`&&!!e}function Pe(e){return globalThis.Array.isArray(e)&&!globalThis.ArrayBuffer.isView(e)}function Fe(e){return e===void 0}function Ie(e){return e===null}function Le(e){return typeof e==`boolean`}function k(e){return typeof e==`number`}function Re(e){return globalThis.Number.isInteger(e)}function ze(e){return typeof e==`bigint`}function Be(e){return typeof e==`string`}function Ve(e){return typeof e==`function`}function He(e){return typeof e==`symbol`}function Ue(e){return ze(e)||Le(e)||Ie(e)||k(e)||Be(e)||He(e)||Fe(e)}var We;(function(e){e.InstanceMode=`default`,e.ExactOptionalPropertyTypes=!1,e.AllowArrayObject=!1,e.AllowNaN=!1,e.AllowNullVoid=!1;function t(t,n){return e.ExactOptionalPropertyTypes?n in t:t[n]!==void 0}e.IsExactOptionalProperty=t;function n(t){let n=O(t);return e.AllowArrayObject?n:n&&!Pe(t)}e.IsObjectLike=n;function r(e){return n(e)&&!(e instanceof Date)&&!(e instanceof Uint8Array)}e.IsRecordLike=r;function i(t){return e.AllowNaN?k(t):Number.isFinite(t)}e.IsNumberLike=i;function a(t){let n=Fe(t);return e.AllowNullVoid?n||t===null:n}e.IsVoidLike=a})(We||={});function Ge(e){return globalThis.Object.freeze(e).map(e=>Xe(e))}function Ke(e){return e}function qe(e){return e}function Je(e){return e}function Ye(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=Xe(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=Xe(e[n]);return globalThis.Object.freeze(t)}function Xe(e){return de(e)?Ge(e):me(e)?Ke(e):_e(e)?qe(e):C(e)?Je(e):S(e)?Ye(e):e}function A(e,t){let n=t===void 0?e:{...t,...e};switch(We.InstanceMode){case`freeze`:return Xe(n);case`clone`:return we(n);default:return n}}var Ze=class extends Error{constructor(e){super(e)}};const Qe=Symbol.for(`TypeBox.Transform`),$e=Symbol.for(`TypeBox.Readonly`),et=Symbol.for(`TypeBox.Optional`),tt=Symbol.for(`TypeBox.Hint`),j=Symbol.for(`TypeBox.Kind`);function nt(e){return S(e)&&e[$e]===`Readonly`}function rt(e){return S(e)&&e[et]===`Optional`}function it(e){return M(e,`Any`)}function at(e){return M(e,`Argument`)}function ot(e){return M(e,`Array`)}function st(e){return M(e,`AsyncIterator`)}function ct(e){return M(e,`BigInt`)}function lt(e){return M(e,`Boolean`)}function ut(e){return M(e,`Computed`)}function dt(e){return M(e,`Constructor`)}function ft(e){return M(e,`Date`)}function pt(e){return M(e,`Function`)}function mt(e){return M(e,`Integer`)}function ht(e){return M(e,`Intersect`)}function gt(e){return M(e,`Iterator`)}function M(e,t){return S(e)&&j in e&&e[j]===t}function _t(e){return pe(e)||x(e)||w(e)}function vt(e){return M(e,`Literal`)}function yt(e){return M(e,`MappedKey`)}function bt(e){return M(e,`MappedResult`)}function xt(e){return M(e,`Never`)}function St(e){return M(e,`Not`)}function Ct(e){return M(e,`Null`)}function wt(e){return M(e,`Number`)}function Tt(e){return M(e,`Object`)}function Et(e){return M(e,`Promise`)}function Dt(e){return M(e,`Record`)}function Ot(e){return M(e,`Ref`)}function kt(e){return M(e,`RegExp`)}function At(e){return M(e,`String`)}function jt(e){return M(e,`Symbol`)}function Mt(e){return M(e,`TemplateLiteral`)}function Nt(e){return M(e,`This`)}function N(e){return S(e)&&Qe in e}function Pt(e){return M(e,`Tuple`)}function Ft(e){return M(e,`Undefined`)}function It(e){return M(e,`Union`)}function Lt(e){return M(e,`Uint8Array`)}function Rt(e){return M(e,`Unknown`)}function zt(e){return M(e,`Unsafe`)}function Bt(e){return M(e,`Void`)}function Vt(e){return S(e)&&j in e&&w(e[j])}function Ht(e){return it(e)||at(e)||ot(e)||lt(e)||ct(e)||st(e)||ut(e)||dt(e)||ft(e)||pt(e)||mt(e)||ht(e)||gt(e)||vt(e)||yt(e)||bt(e)||xt(e)||St(e)||Ct(e)||wt(e)||Tt(e)||Et(e)||Dt(e)||Ot(e)||kt(e)||At(e)||jt(e)||Mt(e)||Nt(e)||Pt(e)||Ft(e)||It(e)||Lt(e)||Rt(e)||zt(e)||Bt(e)||Vt(e)}var Ut=`Argument.Any.Array.AsyncIterator.BigInt.Boolean.Computed.Constructor.Date.Enum.Function.Integer.Intersect.Iterator.Literal.MappedKey.MappedResult.Not.Null.Number.Object.Promise.Record.Ref.RegExp.String.Symbol.TemplateLiteral.This.Tuple.Undefined.Union.Uint8Array.Unknown.Void`.split(`.`);function Wt(e){try{return new RegExp(e),!0}catch{return!1}}function Gt(e){if(!w(e))return!1;for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(n>=7&&n<=13||n===27||n===127)return!1}return!0}function Kt(e){return Jt(e)||R(e)}function qt(e){return E(e)||fe(e)}function P(e){return E(e)||x(e)}function Jt(e){return E(e)||pe(e)}function F(e){return E(e)||w(e)}function Yt(e){return E(e)||w(e)&&Gt(e)&&Wt(e)}function Xt(e){return E(e)||w(e)&&Gt(e)}function Zt(e){return E(e)||R(e)}function Qt(e){return S(e)&&e[et]===`Optional`}function $t(e){return I(e,`Any`)&&F(e.$id)}function en(e){return I(e,`Argument`)&&x(e.index)}function tn(e){return I(e,`Array`)&&e.type===`array`&&F(e.$id)&&R(e.items)&&P(e.minItems)&&P(e.maxItems)&&Jt(e.uniqueItems)&&Zt(e.contains)&&P(e.minContains)&&P(e.maxContains)}function nn(e){return I(e,`AsyncIterator`)&&e.type===`AsyncIterator`&&F(e.$id)&&R(e.items)}function rn(e){return I(e,`BigInt`)&&e.type===`bigint`&&F(e.$id)&&qt(e.exclusiveMaximum)&&qt(e.exclusiveMinimum)&&qt(e.maximum)&&qt(e.minimum)&&qt(e.multipleOf)}function an(e){return I(e,`Boolean`)&&e.type===`boolean`&&F(e.$id)}function on(e){return I(e,`Computed`)&&w(e.target)&&de(e.parameters)&&e.parameters.every(e=>R(e))}function sn(e){return I(e,`Constructor`)&&e.type===`Constructor`&&F(e.$id)&&de(e.parameters)&&e.parameters.every(e=>R(e))&&R(e.returns)}function cn(e){return I(e,`Date`)&&e.type===`Date`&&F(e.$id)&&P(e.exclusiveMaximumTimestamp)&&P(e.exclusiveMinimumTimestamp)&&P(e.maximumTimestamp)&&P(e.minimumTimestamp)&&P(e.multipleOfTimestamp)}function ln(e){return I(e,`Function`)&&e.type===`Function`&&F(e.$id)&&de(e.parameters)&&e.parameters.every(e=>R(e))&&R(e.returns)}function un(e){return I(e,`Integer`)&&e.type===`integer`&&F(e.$id)&&P(e.exclusiveMaximum)&&P(e.exclusiveMinimum)&&P(e.maximum)&&P(e.minimum)&&P(e.multipleOf)}function dn(e){return S(e)&&Object.entries(e).every(([e,t])=>Gt(e)&&R(t))}function fn(e){return I(e,`Intersect`)&&!(w(e.type)&&e.type!==`object`)&&de(e.allOf)&&e.allOf.every(e=>R(e)&&!Nn(e))&&F(e.type)&&(Jt(e.unevaluatedProperties)||Zt(e.unevaluatedProperties))&&F(e.$id)}function pn(e){return I(e,`Iterator`)&&e.type===`Iterator`&&F(e.$id)&&R(e.items)}function I(e,t){return S(e)&&j in e&&e[j]===t}function mn(e){return _n(e)&&w(e.const)}function hn(e){return _n(e)&&x(e.const)}function gn(e){return _n(e)&&pe(e.const)}function _n(e){return I(e,`Literal`)&&F(e.$id)&&vn(e.const)}function vn(e){return pe(e)||x(e)||w(e)}function yn(e){return I(e,`MappedKey`)&&de(e.keys)&&e.keys.every(e=>x(e)||w(e))}function bn(e){return I(e,`MappedResult`)&&dn(e.properties)}function xn(e){return I(e,`Never`)&&S(e.not)&&Object.getOwnPropertyNames(e.not).length===0}function Sn(e){return I(e,`Not`)&&R(e.not)}function Cn(e){return I(e,`Null`)&&e.type===`null`&&F(e.$id)}function wn(e){return I(e,`Number`)&&e.type===`number`&&F(e.$id)&&P(e.exclusiveMaximum)&&P(e.exclusiveMinimum)&&P(e.maximum)&&P(e.minimum)&&P(e.multipleOf)}function L(e){return I(e,`Object`)&&e.type===`object`&&F(e.$id)&&dn(e.properties)&&Kt(e.additionalProperties)&&P(e.minProperties)&&P(e.maxProperties)}function Tn(e){return I(e,`Promise`)&&e.type===`Promise`&&F(e.$id)&&R(e.item)}function En(e){return I(e,`Record`)&&e.type===`object`&&F(e.$id)&&Kt(e.additionalProperties)&&S(e.patternProperties)&&(e=>{let t=Object.getOwnPropertyNames(e.patternProperties);return t.length===1&&Wt(t[0])&&S(e.patternProperties)&&R(e.patternProperties[t[0]])})(e)}function Dn(e){return I(e,`Ref`)&&F(e.$id)&&w(e.$ref)}function On(e){return I(e,`RegExp`)&&F(e.$id)&&w(e.source)&&w(e.flags)&&P(e.maxLength)&&P(e.minLength)}function kn(e){return I(e,`String`)&&e.type===`string`&&F(e.$id)&&P(e.minLength)&&P(e.maxLength)&&Yt(e.pattern)&&Xt(e.format)}function An(e){return I(e,`Symbol`)&&e.type===`symbol`&&F(e.$id)}function jn(e){return I(e,`TemplateLiteral`)&&e.type===`string`&&w(e.pattern)&&e.pattern[0]===`^`&&e.pattern[e.pattern.length-1]===`$`}function Mn(e){return I(e,`This`)&&F(e.$id)&&w(e.$ref)}function Nn(e){return S(e)&&Qe in e}function Pn(e){return I(e,`Tuple`)&&e.type===`array`&&F(e.$id)&&x(e.minItems)&&x(e.maxItems)&&e.minItems===e.maxItems&&(E(e.items)&&E(e.additionalItems)&&e.minItems===0||de(e.items)&&e.items.every(e=>R(e)))}function Fn(e){return I(e,`Undefined`)&&e.type===`undefined`&&F(e.$id)}function In(e){return I(e,`Union`)&&F(e.$id)&&S(e)&&de(e.anyOf)&&e.anyOf.every(e=>R(e))}function Ln(e){return I(e,`Uint8Array`)&&e.type===`Uint8Array`&&F(e.$id)&&P(e.minByteLength)&&P(e.maxByteLength)}function Rn(e){return I(e,`Unknown`)&&F(e.$id)}function zn(e){return I(e,`Unsafe`)}function Bn(e){return I(e,`Void`)&&e.type===`void`&&F(e.$id)}function Vn(e){return S(e)&&j in e&&w(e[j])&&!Ut.includes(e[j])}function R(e){return S(e)&&($t(e)||en(e)||tn(e)||an(e)||rn(e)||nn(e)||on(e)||sn(e)||cn(e)||ln(e)||un(e)||fn(e)||pn(e)||_n(e)||yn(e)||bn(e)||xn(e)||Sn(e)||Cn(e)||wn(e)||L(e)||Tn(e)||En(e)||Dn(e)||On(e)||kn(e)||An(e)||jn(e)||Mn(e)||Pn(e)||Fn(e)||In(e)||Ln(e)||Rn(e)||zn(e)||Bn(e)||Vn(e))}const Hn=`(true|false)`,Un=`(0|[1-9][0-9]*)`,Wn=`(.*)`;`${Hn}`;const Gn=`^${Un}$`,Kn=`^${Wn}$`;var qn=new Map;function Jn(e){return qn.has(e)}function Yn(e,t){qn.set(e,t)}function Xn(e){return qn.get(e)}var Zn=new Map;function Qn(e){return Zn.has(e)}function $n(e,t){Zn.set(e,t)}function er(e){return Zn.get(e)}function tr(e,t){return e.includes(t)}function nr(e){return[...new Set(e)]}function rr(e,t){return e.filter(e=>t.includes(e))}function ir(e,t){return e.reduce((e,t)=>rr(e,t),t)}function ar(e){return e.length===1?e[0]:e.length>1?ir(e.slice(1),e[0]):[]}function or(e){let t=[];for(let n of e)t.push(...n);return t}function sr(e){return A({[j]:`Any`},e)}function cr(e,t){return A({[j]:`Array`,type:`array`,items:e},t)}function lr(e){return A({[j]:`Argument`,index:e})}function ur(e,t){return A({[j]:`AsyncIterator`,type:`AsyncIterator`,items:e},t)}function dr(e,t,n){return A({[j]:`Computed`,target:e,parameters:t},n)}function fr(e,t){let{[t]:n,...r}=e;return r}function pr(e,t){return t.reduce((e,t)=>fr(e,t),e)}function z(e){return A({[j]:`Never`,not:{}},e)}function mr(e){return A({[j]:`MappedResult`,properties:e})}function hr(e,t,n){return A({[j]:`Constructor`,type:`Constructor`,parameters:e,returns:t},n)}function gr(e,t,n){return A({[j]:`Function`,type:`Function`,parameters:e,returns:t},n)}function _r(e,t){return A({[j]:`Union`,anyOf:e},t)}function vr(e){return e.some(e=>rt(e))}function yr(e){return e.map(e=>rt(e)?br(e):e)}function br(e){return pr(e,[et])}function xr(e,t){return vr(e)?sa(_r(yr(e),t)):_r(yr(e),t)}function Sr(e,t){return e.length===1?A(e[0],t):e.length===0?z(t):xr(e,t)}function Cr(e,t){return e.length===0?z(t):e.length===1?A(e[0],t):_r(e,t)}var wr=class extends Ze{};function Tr(e){return e.replace(/\\\$/g,`$`).replace(/\\\*/g,`*`).replace(/\\\^/g,`^`).replace(/\\\|/g,`|`).replace(/\\\(/g,`(`).replace(/\\\)/g,`)`)}function Er(e,t,n){return e[t]===n&&e.charCodeAt(t-1)!==92}function Dr(e,t){return Er(e,t,`(`)}function Or(e,t){return Er(e,t,`)`)}function kr(e,t){return Er(e,t,`|`)}function Ar(e){if(!(Dr(e,0)&&Or(e,e.length-1)))return!1;let t=0;for(let n=0;n<e.length;n++)if(Dr(e,n)&&(t+=1),Or(e,n)&&--t,t===0&&n!==e.length-1)return!1;return!0}function jr(e){return e.slice(1,e.length-1)}function Mr(e){let t=0;for(let n=0;n<e.length;n++)if(Dr(e,n)&&(t+=1),Or(e,n)&&--t,kr(e,n)&&t===0)return!0;return!1}function Nr(e){for(let t=0;t<e.length;t++)if(Dr(e,t))return!0;return!1}function Pr(e){let[t,n]=[0,0],r=[];for(let i=0;i<e.length;i++)if(Dr(e,i)&&(t+=1),Or(e,i)&&--t,kr(e,i)&&t===0){let t=e.slice(n,i);t.length>0&&r.push(Ir(t)),n=i+1}let i=e.slice(n);return i.length>0&&r.push(Ir(i)),r.length===0?{type:`const`,const:``}:r.length===1?r[0]:{type:`or`,expr:r}}function Fr(e){function t(e,t){if(!Dr(e,t))throw new wr(`TemplateLiteralParser: Index must point to open parens`);let n=0;for(let r=t;r<e.length;r++)if(Dr(e,r)&&(n+=1),Or(e,r)&&--n,n===0)return[t,r];throw new wr(`TemplateLiteralParser: Unclosed group parens in expression`)}function n(e,t){for(let n=t;n<e.length;n++)if(Dr(e,n))return[t,n];return[t,e.length]}let r=[];for(let i=0;i<e.length;i++)if(Dr(e,i)){let[n,a]=t(e,i),o=e.slice(n,a+1);r.push(Ir(o)),i=a}else{let[t,a]=n(e,i),o=e.slice(t,a);o.length>0&&r.push(Ir(o)),i=a-1}return r.length===0?{type:`const`,const:``}:r.length===1?r[0]:{type:`and`,expr:r}}function Ir(e){return Ar(e)?Ir(jr(e)):Mr(e)?Pr(e):Nr(e)?Fr(e):{type:`const`,const:Tr(e)}}function Lr(e){return Ir(e.slice(1,e.length-1))}var Rr=class extends Ze{};function zr(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`0`&&e.expr[1].type===`const`&&e.expr[1].const===`[1-9][0-9]*`}function Br(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`true`&&e.expr[1].type===`const`&&e.expr[1].const===`false`}function Vr(e){return e.type===`const`&&e.const===`.*`}function Hr(e){return zr(e)||Vr(e)?!1:Br(e)?!0:e.type===`and`||e.type===`or`?e.expr.every(e=>Hr(e)):e.type===`const`?!0:(()=>{throw new Rr(`Unknown expression type`)})()}function Ur(e){return Hr(Lr(e.pattern))}var Wr=class extends Ze{};function*Gr(e){if(e.length===1)return yield*e[0];for(let t of e[0])for(let n of Gr(e.slice(1)))yield`${t}${n}`}function*Kr(e){return yield*Gr(e.expr.map(e=>[...Yr(e)]))}function*qr(e){for(let t of e.expr)yield*Yr(t)}function*Jr(e){return yield e.const}function*Yr(e){return e.type===`and`?yield*Kr(e):e.type===`or`?yield*qr(e):e.type===`const`?yield*Jr(e):(()=>{throw new Wr(`Unknown expression`)})()}function Xr(e){let t=Lr(e.pattern);return Hr(t)?[...Yr(t)]:[]}function Zr(e,t){return A({[j]:`Literal`,const:e,type:typeof e},t)}function Qr(e){return A({[j]:`Boolean`,type:`boolean`},e)}function $r(e){return A({[j]:`BigInt`,type:`bigint`},e)}function ei(e){return A({[j]:`Number`,type:`number`},e)}function ti(e){return A({[j]:`String`,type:`string`},e)}function*ni(e){let t=e.trim().replace(/"|'/g,``);return t===`boolean`?yield Qr():t===`number`?yield ei():t===`bigint`?yield $r():t===`string`?yield ti():yield(()=>{let e=t.split(`|`).map(e=>Zr(e.trim()));return e.length===0?z():e.length===1?e[0]:Sr(e)})()}function*ri(e){if(e[1]!==`{`)return yield*[Zr(`$`),...ii(e.slice(1))];for(let t=2;t<e.length;t++)if(e[t]===`}`){let n=ni(e.slice(2,t)),r=ii(e.slice(t+1));return yield*[...n,...r]}yield Zr(e)}function*ii(e){for(let t=0;t<e.length;t++)if(e[t]===`$`)return yield*[Zr(e.slice(0,t)),...ri(e.slice(t))];yield Zr(e)}function ai(e){return[...ii(e)]}var oi=class extends Ze{};function si(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function ci(e,t){return Mt(e)?e.pattern.slice(1,e.pattern.length-1):It(e)?`(${e.anyOf.map(e=>ci(e,t)).join(`|`)})`:wt(e)||mt(e)||ct(e)?`${t}${Un}`:At(e)?`${t}${Wn}`:vt(e)?`${t}${si(e.const.toString())}`:lt(e)?`${t}${Hn}`:(()=>{throw new oi(`Unexpected Kind '${e[j]}'`)})()}function li(e){return`^${e.map(e=>ci(e,``)).join(``)}\$`}function ui(e){return Sr(Xr(e).map(e=>Zr(e)))}function di(e,t){let n=w(e)?li(ai(e)):li(e);return A({[j]:`TemplateLiteral`,type:`string`,pattern:n},t)}function fi(e){return Xr(e).map(e=>e.toString())}function pi(e){let t=[];for(let n of e)t.push(...hi(n));return t}function mi(e){return[e.toString()]}function hi(e){return[...new Set(Mt(e)?fi(e):It(e)?pi(e.anyOf):vt(e)?mi(e.const):wt(e)||mt(e)?[`[number]`]:[])]}function gi(e,t,n){let r={};for(let i of Object.getOwnPropertyNames(t))r[i]=Ai(e,hi(t[i]),n);return r}function _i(e,t,n){return gi(e,t.properties,n)}function vi(e,t,n){return mr(_i(e,t,n))}function yi(e,t){return e.map(e=>Di(e,t))}function bi(e){return e.filter(e=>!xt(e))}function xi(e,t){return ga(bi(yi(e,t)))}function Si(e){return e.some(e=>xt(e))?[]:e}function Ci(e,t){return Sr(Si(yi(e,t)))}function wi(e,t){return t in e?e[t]:t===`[number]`?Sr(e):z()}function Ti(e,t){return t===`[number]`?e:z()}function Ei(e,t){return t in e?e[t]:z()}function Di(e,t){return ht(e)?xi(e.allOf,t):It(e)?Ci(e.anyOf,t):Pt(e)?wi(e.items??[],t):ot(e)?Ti(e.items,t):Tt(e)?Ei(e.properties,t):z()}function Oi(e,t){return t.map(t=>Di(e,t))}function ki(e,t){return Sr(Oi(e,t))}function Ai(e,t,n){if(Ot(e)||Ot(t)){if(!Ht(e)||!Ht(t))throw new Ze(`Index types using Ref parameters require both Type and Key to be of TSchema`);return dr(`Index`,[e,t])}return bt(t)?vi(e,t,n):yt(t)?Pi(e,t,n):A(Ht(t)?ki(e,hi(t)):ki(e,t),n)}function ji(e,t,n){return{[t]:Ai(e,[t],we(n))}}function Mi(e,t,n){return t.reduce((t,r)=>({...t,...ji(e,r,n)}),{})}function Ni(e,t,n){return Mi(e,t.keys,n)}function Pi(e,t,n){return mr(Ni(e,t,n))}function Fi(e,t){return A({[j]:`Iterator`,type:`Iterator`,items:e},t)}function Ii(e){return globalThis.Object.keys(e).filter(t=>!rt(e[t]))}function Li(e,t){let n=Ii(e);return A(n.length>0?{[j]:`Object`,type:`object`,required:n,properties:e}:{[j]:`Object`,type:`object`,properties:e},t)}var Ri=Li;function zi(e,t){return A({[j]:`Promise`,type:`Promise`,item:e},t)}function Bi(e){return A(pr(e,[$e]))}function Vi(e){return A({...e,[$e]:`Readonly`})}function Hi(e,t){return t===!1?Bi(e):Vi(e)}function Ui(e,t){let n=t??!0;return bt(e)?Ki(e,n):Hi(e,n)}function Wi(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ui(e[r],t);return n}function Gi(e,t){return Wi(e.properties,t)}function Ki(e,t){return mr(Gi(e,t))}function qi(e,t){return A(e.length>0?{[j]:`Tuple`,type:`array`,items:e,additionalItems:!1,minItems:e.length,maxItems:e.length}:{[j]:`Tuple`,type:`array`,minItems:e.length,maxItems:e.length},t)}function Ji(e,t){return e in t?ta(e,t[e]):mr(t)}function Yi(e){return{[e]:Zr(e)}}function Xi(e){let t={};for(let n of e)t[n]=Zr(n);return t}function Zi(e,t){return tr(t,e)?Yi(e):Xi(t)}function Qi(e,t){return Ji(e,Zi(e,t))}function $i(e,t){return t.map(t=>ta(e,t))}function ea(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(t))n[r]=ta(e,t[r]);return n}function ta(e,t){let n={...t};return rt(t)?sa(ta(e,pr(t,[et]))):nt(t)?Ui(ta(e,pr(t,[$e]))):bt(t)?Ji(e,t.properties):yt(t)?Qi(e,t.keys):dt(t)?hr($i(e,t.parameters),ta(e,t.returns),n):pt(t)?gr($i(e,t.parameters),ta(e,t.returns),n):st(t)?ur(ta(e,t.items),n):gt(t)?Fi(ta(e,t.items),n):ht(t)?_a($i(e,t.allOf),n):It(t)?Cr($i(e,t.anyOf),n):Pt(t)?qi($i(e,t.items??[]),n):Tt(t)?Ri(ea(e,t.properties),n):ot(t)?cr(ta(e,t.items),n):Et(t)?zi(ta(e,t.item),n):t}function na(e,t){let n={};for(let r of e)n[r]=ta(r,t);return n}function ra(e,t,n){let r=Ht(e)?hi(e):e;return Ri(na(r,t({[j]:`MappedKey`,keys:r})),n)}function ia(e){return A(pr(e,[et]))}function aa(e){return A({...e,[et]:`Optional`})}function oa(e,t){return t===!1?ia(e):aa(e)}function sa(e,t){let n=t??!0;return bt(e)?ua(e,n):oa(e,n)}function ca(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=sa(e[r],t);return n}function la(e,t){return ca(e.properties,t)}function ua(e,t){return mr(la(e,t))}function da(e,t={}){let n=e.every(e=>Tt(e)),r=Ht(t.unevaluatedProperties)?{unevaluatedProperties:t.unevaluatedProperties}:{};return A(t.unevaluatedProperties===!1||Ht(t.unevaluatedProperties)||n?{...r,[j]:`Intersect`,type:`object`,allOf:e}:{...r,[j]:`Intersect`,allOf:e},t)}function fa(e){return e.every(e=>rt(e))}function pa(e){return pr(e,[et])}function ma(e){return e.map(e=>rt(e)?pa(e):e)}function ha(e,t){return fa(e)?sa(da(ma(e),t)):da(ma(e),t)}function ga(e,t={}){if(e.length===1)return A(e[0],t);if(e.length===0)return z(t);if(e.some(e=>N(e)))throw Error(`Cannot intersect transform types`);return ha(e,t)}function _a(e,t){if(e.length===1)return A(e[0],t);if(e.length===0)return z(t);if(e.some(e=>N(e)))throw Error(`Cannot intersect transform types`);return da(e,t)}function va(...e){let[t,n]=typeof e[0]==`string`?[e[0],e[1]]:[e[0].$id,e[1]];if(typeof t!=`string`)throw new Ze(`Ref: $ref must be a string`);return A({[j]:`Ref`,$ref:t},n)}function ya(e,t){return dr(`Awaited`,[dr(e,t)])}function ba(e){return dr(`Awaited`,[va(e)])}function xa(e){return _a(wa(e))}function Sa(e){return Cr(wa(e))}function Ca(e){return Ta(e)}function wa(e){return e.map(e=>Ta(e))}function Ta(e,t){return A(ut(e)?ya(e.target,e.parameters):ht(e)?xa(e.allOf):It(e)?Sa(e.anyOf):Et(e)?Ca(e.item):Ot(e)?ba(e.$ref):e,t)}function Ea(e){let t=[];for(let n of e)t.push(Na(n));return t}function Da(e){return or(Ea(e))}function Oa(e){return ar(Ea(e))}function ka(e){return e.map((e,t)=>t.toString())}function Aa(e){return[`[number]`]}function ja(e){return globalThis.Object.getOwnPropertyNames(e)}function Ma(e){return Pa?globalThis.Object.getOwnPropertyNames(e).map(e=>e[0]===`^`&&e[e.length-1]===`$`?e.slice(1,e.length-1):e):[]}function Na(e){return ht(e)?Da(e.allOf):It(e)?Oa(e.anyOf):Pt(e)?ka(e.items??[]):ot(e)?Aa(e.items):Tt(e)?ja(e.properties):Dt(e)?Ma(e.patternProperties):[]}var Pa=!1;function Fa(e){Pa=!0;let t=Na(e);return Pa=!1,`^(${t.map(e=>`(${e})`).join(`|`)})$`}function Ia(e,t){return dr(`KeyOf`,[dr(e,t)])}function La(e){return dr(`KeyOf`,[va(e)])}function Ra(e,t){return A(Sr(za(Na(e))),t)}function za(e){return e.map(e=>e===`[number]`?ei():Zr(e))}function Ba(e,t){return ut(e)?Ia(e.target,e.parameters):Ot(e)?La(e.$ref):bt(e)?Ua(e,t):Ra(e,t)}function Va(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ba(e[r],we(t));return n}function Ha(e,t){return Va(e.properties,t)}function Ua(e,t){return mr(Ha(e,t))}function Wa(e){let t=Na(e),n=Oi(e,t);return t.map((e,r)=>[t[r],n[r]])}function Ga(e){let t=[];for(let n of e)t.push(...Na(n));return nr(t)}function Ka(e){return e.filter(e=>!xt(e))}function qa(e,t){let n=[];for(let r of e)n.push(...Oi(r,[t]));return Ka(n)}function Ja(e,t){let n={};for(let r of t)n[r]=ga(qa(e,r));return n}function Ya(e,t){return Ri(Ja(e,Ga(e)),t)}function Xa(e){return A({[j]:`Date`,type:`Date`},e)}function Za(e){return A({[j]:`Null`,type:`null`},e)}function Qa(e){return A({[j]:`Symbol`,type:`symbol`},e)}function $a(e){return A({[j]:`Undefined`,type:`undefined`},e)}function eo(e){return A({[j]:`Uint8Array`,type:`Uint8Array`},e)}function to(e){return A({[j]:`Unknown`},e)}function no(e){return e.map(e=>ao(e,!1))}function ro(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=Ui(ao(e[n],!1));return t}function io(e,t){return t===!0?e:Ui(e)}function ao(e,t){return ue(e)||b(e)?io(sr(),t):de(e)?Ui(qi(no(e))):_e(e)?eo():me(e)?Xa():S(e)?io(Ri(ro(e)),t):he(e)?io(gr([],to()),t):E(e)?$a():ge(e)?Za():T(e)?Qa():fe(e)?$r():x(e)||pe(e)||w(e)?Zr(e):Ri({})}function oo(e,t){return A(ao(e,!0),t)}function so(e,t){return dt(e)?qi(e.parameters,t):z(t)}function co(e,t){if(E(e))throw Error(`Enum undefined or empty`);let n=globalThis.Object.getOwnPropertyNames(e).filter(e=>isNaN(e)).map(t=>e[t]);return Cr([...new Set(n)].map(e=>Zr(e)),{...t,[tt]:`Enum`})}var lo=class extends Ze{},B;(function(e){e[e.Union=0]=`Union`,e[e.True=1]=`True`,e[e.False=2]=`False`})(B||={});function uo(e){return e===B.False?e:B.True}function fo(e){throw new lo(e)}function po(e){return xn(e)||fn(e)||In(e)||Rn(e)||$t(e)}function mo(e,t){return xn(t)?Mo(e,t):fn(t)?Oo(e,t):In(t)?hs(e,t):Rn(t)?_s(e,t):$t(t)?ho(e,t):fo(`StructuralRight`)}function ho(e,t){return B.True}function go(e,t){return fn(t)?Oo(e,t):In(t)&&t.anyOf.some(e=>$t(e)||Rn(e))?B.True:In(t)?B.Union:Rn(t)||$t(t)?B.True:B.Union}function _o(e,t){return Rn(e)?B.False:$t(e)?B.Union:xn(e)?B.True:B.False}function vo(e,t){return L(t)&&Yo(t)?B.True:po(t)?mo(e,t):tn(t)?uo(V(e.items,t.items)):B.False}function yo(e,t){return po(t)?mo(e,t):nn(t)?uo(V(e.items,t.items)):B.False}function bo(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):rn(t)?B.True:B.False}function xo(e,t){return gn(e)||an(e)?B.True:B.False}function So(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):an(t)?B.True:B.False}function Co(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):sn(t)?e.parameters.length>t.parameters.length?B.False:e.parameters.every((e,n)=>uo(V(t.parameters[n],e))===B.True)?uo(V(e.returns,t.returns)):B.False:B.False}function wo(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):cn(t)?B.True:B.False}function To(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):ln(t)?e.parameters.length>t.parameters.length?B.False:e.parameters.every((e,n)=>uo(V(t.parameters[n],e))===B.True)?uo(V(e.returns,t.returns)):B.False:B.False}function Eo(e,t){return _n(e)&&x(e.const)||wn(e)||un(e)?B.True:B.False}function Do(e,t){return un(t)||wn(t)?B.True:po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):B.False}function Oo(e,t){return t.allOf.every(t=>V(e,t)===B.True)?B.True:B.False}function ko(e,t){return e.allOf.some(e=>V(e,t)===B.True)?B.True:B.False}function Ao(e,t){return po(t)?mo(e,t):pn(t)?uo(V(e.items,t.items)):B.False}function jo(e,t){return _n(t)&&t.const===e.const?B.True:po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):kn(t)?os(e,t):wn(t)?Lo(e,t):un(t)?Eo(e,t):an(t)?xo(e,t):B.False}function Mo(e,t){return B.False}function No(e,t){return B.True}function Po(e){let[t,n]=[e,0];for(;Sn(t);)t=t.not,n+=1;return n%2==0?t:to()}function Fo(e,t){return Sn(e)?V(Po(e),t):Sn(t)?V(e,Po(t)):fo(`Invalid fallthrough for Not`)}function Io(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):Cn(t)?B.True:B.False}function Lo(e,t){return hn(e)||wn(e)||un(e)?B.True:B.False}function Ro(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):un(t)||wn(t)?B.True:B.False}function zo(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function Bo(e){return Yo(e)}function Vo(e){return zo(e,0)||zo(e,1)&&`description`in e.properties&&In(e.properties.description)&&e.properties.description.anyOf.length===2&&(kn(e.properties.description.anyOf[0])&&Fn(e.properties.description.anyOf[1])||kn(e.properties.description.anyOf[1])&&Fn(e.properties.description.anyOf[0]))}function Ho(e){return zo(e,0)}function Uo(e){return zo(e,0)}function Wo(e){return zo(e,0)}function Go(e){return zo(e,0)}function Ko(e){return Yo(e)}function qo(e){let t=ei();return zo(e,0)||zo(e,1)&&`length`in e.properties&&uo(V(e.properties.length,t))===B.True}function Jo(e){return zo(e,0)}function Yo(e){let t=ei();return zo(e,0)||zo(e,1)&&`length`in e.properties&&uo(V(e.properties.length,t))===B.True}function Xo(e){let t=gr([sr()],sr());return zo(e,0)||zo(e,1)&&`then`in e.properties&&uo(V(e.properties.then,t))===B.True}function Zo(e,t){return V(e,t)===B.False||Qt(e)&&!Qt(t)?B.False:B.True}function Qo(e,t){return Rn(e)?B.False:$t(e)?B.Union:xn(e)||mn(e)&&Bo(t)||hn(e)&&Ho(t)||gn(e)&&Uo(t)||An(e)&&Vo(t)||rn(e)&&Wo(t)||kn(e)&&Bo(t)||An(e)&&Vo(t)||wn(e)&&Ho(t)||un(e)&&Ho(t)||an(e)&&Uo(t)||Ln(e)&&Ko(t)||cn(e)&&Go(t)||sn(e)&&Jo(t)||ln(e)&&qo(t)?B.True:En(e)&&kn(ts(e))?(()=>t[tt]===`Record`?B.True:B.False)():En(e)&&wn(ts(e))?(()=>zo(t,0)?B.True:B.False)():B.False}function $o(e,t){return po(t)?mo(e,t):En(t)?rs(e,t):L(t)?(()=>{for(let n of Object.getOwnPropertyNames(t.properties)){if(!(n in e.properties)&&!Qt(t.properties[n]))return B.False;if(Qt(t.properties[n]))return B.True;if(Zo(e.properties[n],t.properties[n])===B.False)return B.False}return B.True})():B.False}function es(e,t){return po(t)?mo(e,t):L(t)&&Xo(t)?B.True:Tn(t)?uo(V(e.item,t.item)):B.False}function ts(e){return Gn in e.patternProperties?ei():Kn in e.patternProperties?ti():fo(`Unknown record key pattern`)}function ns(e){return Gn in e.patternProperties?e.patternProperties[Gn]:Kn in e.patternProperties?e.patternProperties[Kn]:fo(`Unable to get record value schema`)}function rs(e,t){let[n,r]=[ts(t),ns(t)];return mn(e)&&wn(n)&&uo(V(e,r))===B.True?B.True:Ln(e)&&wn(n)||kn(e)&&wn(n)||tn(e)&&wn(n)?V(e,r):L(e)?(()=>{for(let t of Object.getOwnPropertyNames(e.properties))if(Zo(r,e.properties[t])===B.False)return B.False;return B.True})():B.False}function is(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?V(ns(e),ns(t)):B.False}function as(e,t){return V(On(e)?ti():e,On(t)?ti():t)}function os(e,t){return _n(e)&&w(e.const)||kn(e)?B.True:B.False}function ss(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):kn(t)?B.True:B.False}function cs(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):An(t)?B.True:B.False}function ls(e,t){return jn(e)?V(ui(e),t):jn(t)?V(e,ui(t)):fo(`Invalid fallthrough for TemplateLiteral`)}function us(e,t){return tn(t)&&e.items!==void 0&&e.items.every(e=>V(e,t.items)===B.True)}function ds(e,t){return xn(e)?B.True:Rn(e)?B.False:$t(e)?B.Union:B.False}function fs(e,t){return po(t)?mo(e,t):L(t)&&Yo(t)||tn(t)&&us(e,t)?B.True:Pn(t)?E(e.items)&&!E(t.items)||!E(e.items)&&E(t.items)?B.False:E(e.items)&&!E(t.items)||e.items.every((e,n)=>V(e,t.items[n])===B.True)?B.True:B.False:B.False}function ps(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):Ln(t)?B.True:B.False}function ms(e,t){return po(t)?mo(e,t):L(t)?Qo(e,t):En(t)?rs(e,t):Bn(t)?ys(e,t):Fn(t)?B.True:B.False}function hs(e,t){return t.anyOf.some(t=>V(e,t)===B.True)?B.True:B.False}function gs(e,t){return e.anyOf.every(e=>V(e,t)===B.True)?B.True:B.False}function _s(e,t){return B.True}function vs(e,t){return xn(t)?Mo(e,t):fn(t)?Oo(e,t):In(t)?hs(e,t):$t(t)?ho(e,t):kn(t)?os(e,t):wn(t)?Lo(e,t):un(t)?Eo(e,t):an(t)?xo(e,t):tn(t)?_o(e,t):Pn(t)?ds(e,t):L(t)?Qo(e,t):Rn(t)?B.True:B.False}function ys(e,t){return Fn(e)||Fn(e)?B.True:B.False}function bs(e,t){return fn(t)?Oo(e,t):In(t)?hs(e,t):Rn(t)?_s(e,t):$t(t)?ho(e,t):L(t)?Qo(e,t):Bn(t)?B.True:B.False}function V(e,t){return jn(e)||jn(t)?ls(e,t):On(e)||On(t)?as(e,t):Sn(e)||Sn(t)?Fo(e,t):$t(e)?go(e,t):tn(e)?vo(e,t):rn(e)?bo(e,t):an(e)?So(e,t):nn(e)?yo(e,t):sn(e)?Co(e,t):cn(e)?wo(e,t):ln(e)?To(e,t):un(e)?Do(e,t):fn(e)?ko(e,t):pn(e)?Ao(e,t):_n(e)?jo(e,t):xn(e)?No(e,t):Cn(e)?Io(e,t):wn(e)?Ro(e,t):L(e)?$o(e,t):En(e)?is(e,t):kn(e)?ss(e,t):An(e)?cs(e,t):Pn(e)?fs(e,t):Tn(e)?es(e,t):Ln(e)?ps(e,t):Fn(e)?ms(e,t):In(e)?gs(e,t):Rn(e)?vs(e,t):Bn(e)?bs(e,t):fo(`Unknown left type operand '${e[j]}'`)}function xs(e,t){return V(e,t)}function Ss(e,t,n,r,i){let a={};for(let o of globalThis.Object.getOwnPropertyNames(e))a[o]=Es(e[o],t,n,r,we(i));return a}function Cs(e,t,n,r,i){return Ss(e.properties,t,n,r,i)}function ws(e,t,n,r,i){return mr(Cs(e,t,n,r,i))}function Ts(e,t,n,r){let i=xs(e,t);return i===B.Union?Cr([n,r]):i===B.True?n:r}function Es(e,t,n,r,i){return bt(e)?ws(e,t,n,r,i):yt(e)?A(As(e,t,n,r,i)):A(Ts(e,t,n,r),i)}function Ds(e,t,n,r,i){return{[e]:Es(Zr(e),t,n,r,we(i))}}function Os(e,t,n,r,i){return e.reduce((e,a)=>({...e,...Ds(a,t,n,r,i)}),{})}function ks(e,t,n,r,i){return Os(e.keys,t,n,r,i)}function As(e,t,n,r,i){return mr(ks(e,t,n,r,i))}function js(e){return e.allOf.every(e=>Ps(e))}function Ms(e){return e.anyOf.some(e=>Ps(e))}function Ns(e){return!Ps(e.not)}function Ps(e){return e[j]===`Intersect`?js(e):e[j]===`Union`?Ms(e):e[j]===`Not`?Ns(e):e[j]===`Undefined`}function Fs(e,t){return Ls(ui(e),t)}function Is(e,t){let n=e.filter(e=>xs(e,t)===B.False);return n.length===1?n[0]:Cr(n)}function Ls(e,t,n={}){return Mt(e)?A(Fs(e,t),n):bt(e)?A(Bs(e,t),n):A(It(e)?Is(e.anyOf,t):xs(e,t)===B.False?e:z(),n)}function Rs(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ls(e[r],t);return n}function zs(e,t){return Rs(e.properties,t)}function Bs(e,t){return mr(zs(e,t))}function Vs(e,t){return Us(ui(e),t)}function Hs(e,t){let n=e.filter(e=>xs(e,t)!==B.False);return n.length===1?n[0]:Cr(n)}function Us(e,t,n){return Mt(e)?A(Vs(e,t),n):bt(e)?A(Ks(e,t),n):A(It(e)?Hs(e.anyOf,t):xs(e,t)===B.False?z():e,n)}function Ws(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Us(e[r],t);return n}function Gs(e,t){return Ws(e.properties,t)}function Ks(e,t){return mr(Gs(e,t))}function qs(e,t){return dt(e)?A(e.returns,t):z(t)}function Js(e){return Ui(sa(e))}function Ys(e,t,n){return A({[j]:`Record`,type:`object`,patternProperties:{[e]:t}},n)}function Xs(e,t,n){let r={};for(let n of e)r[n]=t;return Ri(r,{...n,[tt]:`Record`})}function Zs(e,t,n){return Ur(e)?Xs(hi(e),t,n):Ys(e.pattern,t,n)}function Qs(e,t,n){return Xs(hi(Cr(e)),t,n)}function $s(e,t,n){return Xs([e.toString()],t,n)}function ec(e,t,n){return Ys(e.source,t,n)}function tc(e,t,n){return Ys(E(e.pattern)?Kn:e.pattern,t,n)}function nc(e,t,n){return Ys(Kn,t,n)}function rc(e,t,n){return Ys(`^(?!.*)$`,t,n)}function ic(e,t,n){return Ri({true:t,false:t},n)}function ac(e,t,n){return Ys(Gn,t,n)}function oc(e,t,n){return Ys(Gn,t,n)}function sc(e,t,n={}){return It(e)?Qs(e.anyOf,t,n):Mt(e)?Zs(e,t,n):vt(e)?$s(e.const,t,n):lt(e)?ic(e,t,n):mt(e)?ac(e,t,n):wt(e)?oc(e,t,n):kt(e)?ec(e,t,n):At(e)?tc(e,t,n):it(e)?nc(e,t,n):xt(e)?rc(e,t,n):z(n)}function cc(e){return globalThis.Object.getOwnPropertyNames(e.patternProperties)[0]}function lc(e){let t=cc(e);return t===Kn?ti():t===Gn?ei():ti({pattern:t})}function uc(e){return e.patternProperties[cc(e)]}function dc(e,t){return t.parameters=Tc(e,t.parameters),t.returns=Ec(e,t.returns),t}function fc(e,t){return t.parameters=Tc(e,t.parameters),t.returns=Ec(e,t.returns),t}function pc(e,t){return t.allOf=Tc(e,t.allOf),t}function mc(e,t){return t.anyOf=Tc(e,t.anyOf),t}function hc(e,t){return E(t.items)||(t.items=Tc(e,t.items)),t}function gc(e,t){return t.items=Ec(e,t.items),t}function _c(e,t){return t.items=Ec(e,t.items),t}function vc(e,t){return t.items=Ec(e,t.items),t}function yc(e,t){return t.item=Ec(e,t.item),t}function bc(e,t){let n=wc(e,t.properties);return{...t,...Ri(n)}}function xc(e,t){let n=sc(Ec(e,lc(t)),Ec(e,uc(t)));return{...t,...n}}function Sc(e,t){return t.index in e?e[t.index]:to()}function Cc(e,t){let n=nt(t),r=rt(t),i=Ec(e,t);return n&&r?Js(i):n&&!r?Ui(i):!n&&r?sa(i):i}function wc(e,t){return globalThis.Object.getOwnPropertyNames(t).reduce((n,r)=>({...n,[r]:Cc(e,t[r])}),{})}function Tc(e,t){return t.map(t=>Ec(e,t))}function Ec(e,t){return dt(t)?dc(e,t):pt(t)?fc(e,t):ht(t)?pc(e,t):It(t)?mc(e,t):Pt(t)?hc(e,t):ot(t)?gc(e,t):st(t)?_c(e,t):gt(t)?vc(e,t):Et(t)?yc(e,t):Tt(t)?bc(e,t):Dt(t)?xc(e,t):at(t)?Sc(e,t):t}function Dc(e,t){return Ec(t,Te(e))}function Oc(e){return A({[j]:`Integer`,type:`integer`},e)}function kc(e,t,n){return{[e]:Bc(Zr(e),t,we(n))}}function Ac(e,t,n){return e.reduce((e,r)=>({...e,...kc(r,t,n)}),{})}function jc(e,t,n){return Ac(e.keys,t,n)}function Mc(e,t,n){return mr(jc(e,t,n))}function Nc(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),n].join(``)}function Pc(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),n].join(``)}function Fc(e){return e.toUpperCase()}function Ic(e){return e.toLowerCase()}function Lc(e,t,n){let r=Lr(e.pattern);return Hr(r)?di([Cr(zc([...Yr(r)].map(e=>Zr(e)),t))],n):{...e,pattern:Rc(e.pattern,t)}}function Rc(e,t){return typeof e==`string`?t===`Uncapitalize`?Nc(e):t===`Capitalize`?Pc(e):t===`Uppercase`?Fc(e):t===`Lowercase`?Ic(e):e:e.toString()}function zc(e,t){return e.map(e=>Bc(e,t))}function Bc(e,t,n={}){return yt(e)?Mc(e,t,n):Mt(e)?Lc(e,t,n):It(e)?Cr(zc(e.anyOf,t),n):vt(e)?Zr(Rc(e.const,t),n):A(e,n)}function Vc(e,t={}){return Bc(e,`Capitalize`,t)}function Hc(e,t={}){return Bc(e,`Lowercase`,t)}function Uc(e,t={}){return Bc(e,`Uncapitalize`,t)}function Wc(e,t={}){return Bc(e,`Uppercase`,t)}function Gc(e,t,n){let r={};for(let i of globalThis.Object.getOwnPropertyNames(e))r[i]=tl(e[i],t,we(n));return r}function Kc(e,t,n){return Gc(e.properties,t,n)}function qc(e,t,n){return mr(Kc(e,t,n))}function Jc(e,t){return e.map(e=>el(e,t))}function Yc(e,t){return e.map(e=>el(e,t))}function Xc(e,t){let{[t]:n,...r}=e;return r}function Zc(e,t){return t.reduce((e,t)=>Xc(e,t),e)}function Qc(e,t,n){let r=pr(e,[Qe,`$id`,`required`,`properties`]);return Ri(Zc(n,t),r)}function $c(e){return Cr(e.reduce((e,t)=>_t(t)?[...e,Zr(t)]:e,[]))}function el(e,t){return ht(e)?_a(Jc(e.allOf,t)):It(e)?Cr(Yc(e.anyOf,t)):Tt(e)?Qc(e,t,e.properties):Ri({})}function tl(e,t,n){let r=de(t)?$c(t):t,i=Ht(t)?hi(t):t,a=Ot(e),o=Ot(t);return bt(e)?qc(e,i,n):yt(t)?al(e,t,n):a&&o||!a&&o||a&&!o?dr(`Omit`,[e,r],n):A({...el(e,i),...n})}function nl(e,t,n){return{[t]:tl(e,[t],we(n))}}function rl(e,t,n){return t.reduce((t,r)=>({...t,...nl(e,r,n)}),{})}function il(e,t,n){return rl(e,t.keys,n)}function al(e,t,n){return mr(il(e,t,n))}function ol(e,t,n){let r={};for(let i of globalThis.Object.getOwnPropertyNames(e))r[i]=hl(e[i],t,we(n));return r}function sl(e,t,n){return ol(e.properties,t,n)}function cl(e,t,n){return mr(sl(e,t,n))}function ll(e,t){return e.map(e=>ml(e,t))}function ul(e,t){return e.map(e=>ml(e,t))}function dl(e,t){let n={};for(let r of t)r in e&&(n[r]=e[r]);return n}function fl(e,t,n){let r=pr(e,[Qe,`$id`,`required`,`properties`]);return Ri(dl(n,t),r)}function pl(e){return Cr(e.reduce((e,t)=>_t(t)?[...e,Zr(t)]:e,[]))}function ml(e,t){return ht(e)?_a(ll(e.allOf,t)):It(e)?Cr(ul(e.anyOf,t)):Tt(e)?fl(e,t,e.properties):Ri({})}function hl(e,t,n){let r=de(t)?pl(t):t,i=Ht(t)?hi(t):t,a=Ot(e),o=Ot(t);return bt(e)?cl(e,i,n):yt(t)?yl(e,t,n):a&&o||!a&&o||a&&!o?dr(`Pick`,[e,r],n):A({...ml(e,i),...n})}function gl(e,t,n){return{[t]:hl(e,[t],we(n))}}function _l(e,t,n){return t.reduce((t,r)=>({...t,...gl(e,r,n)}),{})}function vl(e,t,n){return _l(e,t.keys,n)}function yl(e,t,n){return mr(vl(e,t,n))}function bl(e,t){return dr(`Partial`,[dr(e,t)])}function xl(e){return dr(`Partial`,[va(e)])}function Sl(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=sa(e[n]);return t}function Cl(e,t){let n=pr(e,[Qe,`$id`,`required`,`properties`]);return Ri(Sl(t),n)}function wl(e){return e.map(e=>Tl(e))}function Tl(e){return ut(e)?bl(e.target,e.parameters):Ot(e)?xl(e.$ref):ht(e)?_a(wl(e.allOf)):It(e)?Cr(wl(e.anyOf)):Tt(e)?Cl(e,e.properties):ct(e)||lt(e)||mt(e)||vt(e)||Ct(e)||wt(e)||At(e)||jt(e)||Ft(e)?e:Ri({})}function El(e,t){return bt(e)?kl(e,t):A({...Tl(e),...t})}function Dl(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=El(e[r],we(t));return n}function Ol(e,t){return Dl(e.properties,t)}function kl(e,t){return mr(Ol(e,t))}function Al(e,t){return dr(`Required`,[dr(e,t)])}function jl(e){return dr(`Required`,[va(e)])}function Ml(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=pr(e[n],[et]);return t}function Nl(e,t){let n=pr(e,[Qe,`$id`,`required`,`properties`]);return Ri(Ml(t),n)}function Pl(e){return e.map(e=>Fl(e))}function Fl(e){return ut(e)?Al(e.target,e.parameters):Ot(e)?jl(e.$ref):ht(e)?_a(Pl(e.allOf)):It(e)?Cr(Pl(e.anyOf)):Tt(e)?Nl(e,e.properties):ct(e)||lt(e)||mt(e)||vt(e)||Ct(e)||wt(e)||At(e)||jt(e)||Ft(e)?e:Ri({})}function Il(e,t){return bt(e)?zl(e,t):A({...Fl(e),...t})}function Ll(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Il(e[r],t);return n}function Rl(e,t){return Ll(e.properties,t)}function zl(e,t){return mr(Rl(e,t))}function Bl(e,t){return t.map(t=>Ot(t)?Vl(e,t.$ref):cu(e,t))}function Vl(e,t){return t in e?Ot(e[t])?Vl(e,e[t].$ref):cu(e,e[t]):z()}function Hl(e){return Ta(e[0])}function Ul(e){return Ai(e[0],e[1])}function Wl(e){return Ba(e[0])}function Gl(e){return El(e[0])}function Kl(e){return tl(e[0],e[1])}function ql(e){return hl(e[0],e[1])}function Jl(e){return Il(e[0])}function Yl(e,t,n){let r=Bl(e,n);return t===`Awaited`?Hl(r):t===`Index`?Ul(r):t===`KeyOf`?Wl(r):t===`Partial`?Gl(r):t===`Omit`?Kl(r):t===`Pick`?ql(r):t===`Required`?Jl(r):z()}function Xl(e,t){return cr(cu(e,t))}function Zl(e,t){return ur(cu(e,t))}function Ql(e,t,n){return hr(su(e,t),cu(e,n))}function $l(e,t,n){return gr(su(e,t),cu(e,n))}function eu(e,t){return _a(su(e,t))}function tu(e,t){return Fi(cu(e,t))}function nu(e,t){return Ri(globalThis.Object.keys(t).reduce((n,r)=>({...n,[r]:cu(e,t[r])}),{}))}function ru(e,t){let[n,r]=[cu(e,uc(t)),cc(t)],i=Te(t);return i.patternProperties[r]=n,i}function iu(e,t){return Ot(t)?{...Vl(e,t.$ref),[Qe]:t[Qe]}:t}function au(e,t){return qi(su(e,t))}function ou(e,t){return Cr(su(e,t))}function su(e,t){return t.map(t=>cu(e,t))}function cu(e,t){return rt(t)?A(cu(e,pr(t,[et])),t):nt(t)?A(cu(e,pr(t,[$e])),t):N(t)?A(iu(e,t),t):ot(t)?A(Xl(e,t.items),t):st(t)?A(Zl(e,t.items),t):ut(t)?A(Yl(e,t.target,t.parameters)):dt(t)?A(Ql(e,t.parameters,t.returns),t):pt(t)?A($l(e,t.parameters,t.returns),t):ht(t)?A(eu(e,t.allOf),t):gt(t)?A(tu(e,t.items),t):Tt(t)?A(nu(e,t.properties),t):Dt(t)?A(ru(e,t)):Pt(t)?A(au(e,t.items||[]),t):It(t)?A(ou(e,t.anyOf),t):t}function lu(e,t){return t in e?cu(e,e[t]):z()}function uu(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>({...t,[n]:lu(e,n)}),{})}var du=class{constructor(e){let t=uu(e);this.$defs=this.WithIdentifiers(t)}Import(e,t){let n={...this.$defs,[e]:A(this.$defs[e],t)};return A({[j]:`Import`,$defs:n,$ref:e})}WithIdentifiers(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>({...t,[n]:{...e[n],$id:n}}),{})}};function fu(e){return new du(e)}function pu(e,t){return A({[j]:`Not`,not:e},t)}function mu(e,t){return pt(e)?qi(e.parameters,t):z()}var hu=0;function gu(e,t={}){E(t.$id)&&(t.$id=`T${hu++}`);let n=Te(e({[j]:`This`,$ref:`${t.$id}`}));return n.$id=t.$id,A({[tt]:`Recursive`,...n},t)}function _u(e,t){let n=w(e)?new globalThis.RegExp(e):e;return A({[j]:`RegExp`,type:`RegExp`,source:n.source,flags:n.flags},t)}function vu(e){return ht(e)?e.allOf:It(e)?e.anyOf:Pt(e)?e.items??[]:[]}function yu(e){return vu(e)}function bu(e,t){return pt(e)?A(e.returns,t):z(t)}var xu=class{constructor(e){this.schema=e}Decode(e){return new Su(this.schema,e)}},Su=class{constructor(e,t){this.schema=e,this.decode=t}EncodeTransform(e,t){let n={Encode:n=>t[Qe].Encode(e(n)),Decode:e=>this.decode(t[Qe].Decode(e))};return{...t,[Qe]:n}}EncodeSchema(e,t){let n={Decode:this.decode,Encode:e};return{...t,[Qe]:n}}Encode(e){return N(this.schema)?this.EncodeTransform(e,this.schema):this.EncodeSchema(e,this.schema)}};function Cu(e){return new xu(e)}function wu(e={}){return A({[j]:e[j]??`Unsafe`},e)}function Tu(e){return A({[j]:`Void`,type:`void`},e)}var Eu=t({Any:()=>sr,Argument:()=>lr,Array:()=>cr,AsyncIterator:()=>ur,Awaited:()=>Ta,BigInt:()=>$r,Boolean:()=>Qr,Capitalize:()=>Vc,Composite:()=>Ya,Const:()=>oo,Constructor:()=>hr,ConstructorParameters:()=>so,Date:()=>Xa,Enum:()=>co,Exclude:()=>Ls,Extends:()=>Es,Extract:()=>Us,Function:()=>gr,Index:()=>Ai,InstanceType:()=>qs,Instantiate:()=>Dc,Integer:()=>Oc,Intersect:()=>_a,Iterator:()=>Fi,KeyOf:()=>Ba,Literal:()=>Zr,Lowercase:()=>Hc,Mapped:()=>ra,Module:()=>fu,Never:()=>z,Not:()=>pu,Null:()=>Za,Number:()=>ei,Object:()=>Ri,Omit:()=>tl,Optional:()=>sa,Parameters:()=>mu,Partial:()=>El,Pick:()=>hl,Promise:()=>zi,Readonly:()=>Ui,ReadonlyOptional:()=>Js,Record:()=>sc,Recursive:()=>gu,Ref:()=>va,RegExp:()=>_u,Required:()=>Il,Rest:()=>yu,ReturnType:()=>bu,String:()=>ti,Symbol:()=>Qa,TemplateLiteral:()=>di,Transform:()=>Cu,Tuple:()=>qi,Uint8Array:()=>eo,Uncapitalize:()=>Uc,Undefined:()=>$a,Union:()=>Cr,Unknown:()=>to,Unsafe:()=>wu,Uppercase:()=>Wc,Void:()=>Tu},1),Du=n(((e,t)=>{var n=12,r=0,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7];function a(e){var t=e.indexOf(`%`);if(t===-1)return e;for(var a=e.length,o=``,c=0,l=0,u=t,d=n;t>-1&&t<a;){var f=s(e[t+1],4)|s(e[t+2],0),p=i[f];if(d=i[256+d+p],l=l<<6|f&i[364+p],d===n)o+=e.slice(c,u),o+=l<=65535?String.fromCharCode(l):String.fromCharCode(55232+(l>>10),56320+(l&1023)),l=0,c=t+3,t=u=e.indexOf(`%`,c);else if(d===r)return null;else{if(t+=3,t<a&&e.charCodeAt(t)===37)continue;return null}}return o+e.slice(c)}var o={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};function s(e,t){var n=o[e];return n===void 0?255:n<<t}t.exports=a}));function Ou(e){switch(e.errorType){case U.ArrayContains:return`Expected array to contain at least one matching value`;case U.ArrayMaxContains:return`Expected array to contain no more than ${e.schema.maxContains} matching values`;case U.ArrayMinContains:return`Expected array to contain at least ${e.schema.minContains} matching values`;case U.ArrayMaxItems:return`Expected array length to be less or equal to ${e.schema.maxItems}`;case U.ArrayMinItems:return`Expected array length to be greater or equal to ${e.schema.minItems}`;case U.ArrayUniqueItems:return`Expected array elements to be unique`;case U.Array:return`Expected array`;case U.AsyncIterator:return`Expected AsyncIterator`;case U.BigIntExclusiveMaximum:return`Expected bigint to be less than ${e.schema.exclusiveMaximum}`;case U.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${e.schema.exclusiveMinimum}`;case U.BigIntMaximum:return`Expected bigint to be less or equal to ${e.schema.maximum}`;case U.BigIntMinimum:return`Expected bigint to be greater or equal to ${e.schema.minimum}`;case U.BigIntMultipleOf:return`Expected bigint to be a multiple of ${e.schema.multipleOf}`;case U.BigInt:return`Expected bigint`;case U.Boolean:return`Expected boolean`;case U.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${e.schema.exclusiveMinimumTimestamp}`;case U.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${e.schema.exclusiveMaximumTimestamp}`;case U.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${e.schema.minimumTimestamp}`;case U.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${e.schema.maximumTimestamp}`;case U.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${e.schema.multipleOfTimestamp}`;case U.Date:return`Expected Date`;case U.Function:return`Expected function`;case U.IntegerExclusiveMaximum:return`Expected integer to be less than ${e.schema.exclusiveMaximum}`;case U.IntegerExclusiveMinimum:return`Expected integer to be greater than ${e.schema.exclusiveMinimum}`;case U.IntegerMaximum:return`Expected integer to be less or equal to ${e.schema.maximum}`;case U.IntegerMinimum:return`Expected integer to be greater or equal to ${e.schema.minimum}`;case U.IntegerMultipleOf:return`Expected integer to be a multiple of ${e.schema.multipleOf}`;case U.Integer:return`Expected integer`;case U.IntersectUnevaluatedProperties:return`Unexpected property`;case U.Intersect:return`Expected all values to match`;case U.Iterator:return`Expected Iterator`;case U.Literal:return`Expected ${typeof e.schema.const==`string`?`'${e.schema.const}'`:e.schema.const}`;case U.Never:return`Never`;case U.Not:return`Value should not match`;case U.Null:return`Expected null`;case U.NumberExclusiveMaximum:return`Expected number to be less than ${e.schema.exclusiveMaximum}`;case U.NumberExclusiveMinimum:return`Expected number to be greater than ${e.schema.exclusiveMinimum}`;case U.NumberMaximum:return`Expected number to be less or equal to ${e.schema.maximum}`;case U.NumberMinimum:return`Expected number to be greater or equal to ${e.schema.minimum}`;case U.NumberMultipleOf:return`Expected number to be a multiple of ${e.schema.multipleOf}`;case U.Number:return`Expected number`;case U.Object:return`Expected object`;case U.ObjectAdditionalProperties:return`Unexpected property`;case U.ObjectMaxProperties:return`Expected object to have no more than ${e.schema.maxProperties} properties`;case U.ObjectMinProperties:return`Expected object to have at least ${e.schema.minProperties} properties`;case U.ObjectRequiredProperty:return`Expected required property`;case U.Promise:return`Expected Promise`;case U.RegExp:return`Expected string to match regular expression`;case U.StringFormatUnknown:return`Unknown format '${e.schema.format}'`;case U.StringFormat:return`Expected string to match '${e.schema.format}' format`;case U.StringMaxLength:return`Expected string length less or equal to ${e.schema.maxLength}`;case U.StringMinLength:return`Expected string length greater or equal to ${e.schema.minLength}`;case U.StringPattern:return`Expected string to match '${e.schema.pattern}'`;case U.String:return`Expected string`;case U.Symbol:return`Expected symbol`;case U.TupleLength:return`Expected tuple to have ${e.schema.maxItems||0} elements`;case U.Tuple:return`Expected tuple`;case U.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${e.schema.maxByteLength}`;case U.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${e.schema.minByteLength}`;case U.Uint8Array:return`Expected Uint8Array`;case U.Undefined:return`Expected undefined`;case U.Union:return`Expected union value`;case U.Void:return`Expected void`;case U.Kind:return`Expected kind '${e.schema[j]}'`;default:return`Unknown error type`}}var ku=Ou;function Au(){return ku}var ju=class extends Ze{constructor(e){super(`Unable to dereference schema with $id '${e.$ref}'`),this.schema=e}};function Mu(e,t){let n=t.find(t=>t.$id===e.$ref);if(n===void 0)throw new ju(e);return Pu(n,t)}function Nu(e,t){return!Be(e.$id)||t.some(t=>t.$id===e.$id)||t.push(e),t}function Pu(e,t){return e[j]===`This`||e[j]===`Ref`?Mu(e,t):e}var Fu=class extends Ze{constructor(e){super(`Unable to hash value`),this.value=e}},Iu;(function(e){e[e.Undefined=0]=`Undefined`,e[e.Null=1]=`Null`,e[e.Boolean=2]=`Boolean`,e[e.Number=3]=`Number`,e[e.String=4]=`String`,e[e.Object=5]=`Object`,e[e.Array=6]=`Array`,e[e.Date=7]=`Date`,e[e.Uint8Array=8]=`Uint8Array`,e[e.Symbol=9]=`Symbol`,e[e.BigInt=10]=`BigInt`})(Iu||={});var Lu=BigInt(`14695981039346656037`),[Ru,zu]=[BigInt(`1099511628211`),BigInt(`18446744073709551616`)],Bu=Array.from({length:256}).map((e,t)=>BigInt(t)),Vu=new Float64Array(1),Hu=new DataView(Vu.buffer),Uu=new Uint8Array(Vu.buffer);function*Wu(e){let t=e===0?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let n=0;n<t;n++)yield e>>8*(t-1-n)&255}function Gu(e){rd(Iu.Array);for(let t of e)nd(t)}function Ku(e){rd(Iu.Boolean),rd(e?1:0)}function qu(e){rd(Iu.BigInt),Hu.setBigInt64(0,e);for(let e of Uu)rd(e)}function Ju(e){rd(Iu.Date),nd(e.getTime())}function Yu(e){rd(Iu.Null)}function Xu(e){rd(Iu.Number),Hu.setFloat64(0,e);for(let e of Uu)rd(e)}function Zu(e){rd(Iu.Object);for(let t of globalThis.Object.getOwnPropertyNames(e).sort())nd(t),nd(e[t])}function Qu(e){rd(Iu.String);for(let t=0;t<e.length;t++)for(let n of Wu(e.charCodeAt(t)))rd(n)}function $u(e){rd(Iu.Symbol),nd(e.description)}function ed(e){rd(Iu.Uint8Array);for(let t=0;t<e.length;t++)rd(e[t])}function td(e){return rd(Iu.Undefined)}function nd(e){if(Pe(e))return Gu(e);if(Le(e))return Ku(e);if(ze(e))return qu(e);if(ke(e))return Ju(e);if(Ie(e))return Yu(e);if(k(e))return Xu(e);if(O(e))return Zu(e);if(Be(e))return Qu(e);if(He(e))return $u(e);if(Ne(e))return ed(e);if(Fe(e))return td(e);throw new Fu(e)}function rd(e){Lu^=Bu[e],Lu=Lu*Ru%zu}function id(e){return Lu=BigInt(`14695981039346656037`),nd(e),Lu}var ad=class extends Ze{constructor(e){super(`Unknown type`),this.schema=e}};function od(e){return e[j]===`Any`||e[j]===`Unknown`}function H(e){return e!==void 0}function sd(e,t,n){return!0}function cd(e,t,n){return!0}function ld(e,t,n){if(!Pe(n)||H(e.minItems)&&!(n.length>=e.minItems)||H(e.maxItems)&&!(n.length<=e.maxItems)||!n.every(n=>Vd(e.items,t,n))||e.uniqueItems===!0&&!(function(){let e=new Set;for(let t of n){let n=id(t);if(e.has(n))return!1;e.add(n)}return!0})())return!1;if(!(H(e.contains)||k(e.minContains)||k(e.maxContains)))return!0;let r=H(e.contains)?e.contains:z(),i=n.reduce((e,n)=>Vd(r,t,n)?e+1:e,0);return!(i===0||k(e.minContains)&&i<e.minContains||k(e.maxContains)&&i>e.maxContains)}function ud(e,t,n){return Ee(n)}function dd(e,t,n){return!(!ze(n)||H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||H(e.maximum)&&!(n<=e.maximum)||H(e.minimum)&&!(n>=e.minimum)||H(e.multipleOf)&&n%e.multipleOf!==BigInt(0))}function fd(e,t,n){return Le(n)}function pd(e,t,n){return Vd(e.returns,t,n.prototype)}function md(e,t,n){return!(!ke(n)||H(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp)||H(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp)||H(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp)||H(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp)||H(e.multipleOfTimestamp)&&n.getTime()%e.multipleOfTimestamp!==0)}function hd(e,t,n){return Ve(n)}function gd(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Vd(i,[...t,...r],n)}function _d(e,t,n){return!(!Re(n)||H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||H(e.maximum)&&!(n<=e.maximum)||H(e.minimum)&&!(n>=e.minimum)||H(e.multipleOf)&&n%e.multipleOf!==0)}function vd(e,t,n){let r=e.allOf.every(e=>Vd(e,t,n));if(e.unevaluatedProperties===!1){let t=new RegExp(Fa(e)),i=Object.getOwnPropertyNames(n).every(e=>t.test(e));return r&&i}else if(Ht(e.unevaluatedProperties)){let i=new RegExp(Fa(e)),a=Object.getOwnPropertyNames(n).every(r=>i.test(r)||Vd(e.unevaluatedProperties,t,n[r]));return r&&a}else return r}function yd(e,t,n){return De(n)}function bd(e,t,n){return n===e.const}function xd(e,t,n){return!1}function Sd(e,t,n){return!Vd(e.not,t,n)}function Cd(e,t,n){return Ie(n)}function wd(e,t,n){return!(!We.IsNumberLike(n)||H(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||H(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||H(e.minimum)&&!(n>=e.minimum)||H(e.maximum)&&!(n<=e.maximum)||H(e.multipleOf)&&n%e.multipleOf!==0)}function Td(e,t,n){if(!We.IsObjectLike(n)||H(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||H(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let r=Object.getOwnPropertyNames(e.properties);for(let i of r){let r=e.properties[i];if(e.required&&e.required.includes(i)){if(!Vd(r,t,n[i])||(Ps(r)||od(r))&&!(i in n))return!1}else if(We.IsExactOptionalProperty(n,i)&&!Vd(r,t,n[i]))return!1}if(e.additionalProperties===!1){let t=Object.getOwnPropertyNames(n);return e.required&&e.required.length===r.length&&t.length===r.length?!0:t.every(e=>r.includes(e))}else if(typeof e.additionalProperties==`object`)return Object.getOwnPropertyNames(n).every(i=>r.includes(i)||Vd(e.additionalProperties,t,n[i]));else return!0}function Ed(e,t,n){return Oe(n)}function Dd(e,t,n){if(!We.IsRecordLike(n)||H(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||H(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let[r,i]=Object.entries(e.patternProperties)[0],a=new RegExp(r),o=Object.entries(n).every(([e,n])=>a.test(e)?Vd(i,t,n):!0),s=typeof e.additionalProperties==`object`?Object.entries(n).every(([n,r])=>a.test(n)?!0:Vd(e.additionalProperties,t,r)):!0,c=e.additionalProperties===!1?Object.getOwnPropertyNames(n).every(e=>a.test(e)):!0;return o&&s&&c}function Od(e,t,n){return Vd(Pu(e,t),t,n)}function kd(e,t,n){let r=new RegExp(e.source,e.flags);return H(e.minLength)&&!(n.length>=e.minLength)||H(e.maxLength)&&!(n.length<=e.maxLength)?!1:r.test(n)}function Ad(e,t,n){return!Be(n)||H(e.minLength)&&!(n.length>=e.minLength)||H(e.maxLength)&&!(n.length<=e.maxLength)||H(e.pattern)&&!new RegExp(e.pattern).test(n)?!1:H(e.format)?Jn(e.format)?Xn(e.format)(n):!1:!0}function jd(e,t,n){return He(n)}function Md(e,t,n){return Be(n)&&new RegExp(e.pattern).test(n)}function Nd(e,t,n){return Vd(Pu(e,t),t,n)}function Pd(e,t,n){if(!Pe(n)||e.items===void 0&&n.length!==0||n.length!==e.maxItems)return!1;if(!e.items)return!0;for(let r=0;r<e.items.length;r++)if(!Vd(e.items[r],t,n[r]))return!1;return!0}function Fd(e,t,n){return Fe(n)}function Id(e,t,n){return e.anyOf.some(e=>Vd(e,t,n))}function Ld(e,t,n){return!(!Ne(n)||H(e.maxByteLength)&&!(n.length<=e.maxByteLength)||H(e.minByteLength)&&!(n.length>=e.minByteLength))}function Rd(e,t,n){return!0}function zd(e,t,n){return We.IsVoidLike(n)}function Bd(e,t,n){return Qn(e[j])?er(e[j])(e,n):!1}function Vd(e,t,n){let r=H(e.$id)?Nu(e,t):t,i=e;switch(i[j]){case`Any`:return sd(i,r,n);case`Argument`:return cd(i,r,n);case`Array`:return ld(i,r,n);case`AsyncIterator`:return ud(i,r,n);case`BigInt`:return dd(i,r,n);case`Boolean`:return fd(i,r,n);case`Constructor`:return pd(i,r,n);case`Date`:return md(i,r,n);case`Function`:return hd(i,r,n);case`Import`:return gd(i,r,n);case`Integer`:return _d(i,r,n);case`Intersect`:return vd(i,r,n);case`Iterator`:return yd(i,r,n);case`Literal`:return bd(i,r,n);case`Never`:return xd(i,r,n);case`Not`:return Sd(i,r,n);case`Null`:return Cd(i,r,n);case`Number`:return wd(i,r,n);case`Object`:return Td(i,r,n);case`Promise`:return Ed(i,r,n);case`Record`:return Dd(i,r,n);case`Ref`:return Od(i,r,n);case`RegExp`:return kd(i,r,n);case`String`:return Ad(i,r,n);case`Symbol`:return jd(i,r,n);case`TemplateLiteral`:return Md(i,r,n);case`This`:return Nd(i,r,n);case`Tuple`:return Pd(i,r,n);case`Undefined`:return Fd(i,r,n);case`Union`:return Id(i,r,n);case`Uint8Array`:return Ld(i,r,n);case`Unknown`:return Rd(i,r,n);case`Void`:return zd(i,r,n);default:if(!Qn(i[j]))throw new ad(i);return Bd(i,r,n)}}function Hd(...e){return e.length===3?Vd(e[0],e[1],e[2]):Vd(e[0],[],e[1])}var U;(function(e){e[e.ArrayContains=0]=`ArrayContains`,e[e.ArrayMaxContains=1]=`ArrayMaxContains`,e[e.ArrayMaxItems=2]=`ArrayMaxItems`,e[e.ArrayMinContains=3]=`ArrayMinContains`,e[e.ArrayMinItems=4]=`ArrayMinItems`,e[e.ArrayUniqueItems=5]=`ArrayUniqueItems`,e[e.Array=6]=`Array`,e[e.AsyncIterator=7]=`AsyncIterator`,e[e.BigIntExclusiveMaximum=8]=`BigIntExclusiveMaximum`,e[e.BigIntExclusiveMinimum=9]=`BigIntExclusiveMinimum`,e[e.BigIntMaximum=10]=`BigIntMaximum`,e[e.BigIntMinimum=11]=`BigIntMinimum`,e[e.BigIntMultipleOf=12]=`BigIntMultipleOf`,e[e.BigInt=13]=`BigInt`,e[e.Boolean=14]=`Boolean`,e[e.DateExclusiveMaximumTimestamp=15]=`DateExclusiveMaximumTimestamp`,e[e.DateExclusiveMinimumTimestamp=16]=`DateExclusiveMinimumTimestamp`,e[e.DateMaximumTimestamp=17]=`DateMaximumTimestamp`,e[e.DateMinimumTimestamp=18]=`DateMinimumTimestamp`,e[e.DateMultipleOfTimestamp=19]=`DateMultipleOfTimestamp`,e[e.Date=20]=`Date`,e[e.Function=21]=`Function`,e[e.IntegerExclusiveMaximum=22]=`IntegerExclusiveMaximum`,e[e.IntegerExclusiveMinimum=23]=`IntegerExclusiveMinimum`,e[e.IntegerMaximum=24]=`IntegerMaximum`,e[e.IntegerMinimum=25]=`IntegerMinimum`,e[e.IntegerMultipleOf=26]=`IntegerMultipleOf`,e[e.Integer=27]=`Integer`,e[e.IntersectUnevaluatedProperties=28]=`IntersectUnevaluatedProperties`,e[e.Intersect=29]=`Intersect`,e[e.Iterator=30]=`Iterator`,e[e.Kind=31]=`Kind`,e[e.Literal=32]=`Literal`,e[e.Never=33]=`Never`,e[e.Not=34]=`Not`,e[e.Null=35]=`Null`,e[e.NumberExclusiveMaximum=36]=`NumberExclusiveMaximum`,e[e.NumberExclusiveMinimum=37]=`NumberExclusiveMinimum`,e[e.NumberMaximum=38]=`NumberMaximum`,e[e.NumberMinimum=39]=`NumberMinimum`,e[e.NumberMultipleOf=40]=`NumberMultipleOf`,e[e.Number=41]=`Number`,e[e.ObjectAdditionalProperties=42]=`ObjectAdditionalProperties`,e[e.ObjectMaxProperties=43]=`ObjectMaxProperties`,e[e.ObjectMinProperties=44]=`ObjectMinProperties`,e[e.ObjectRequiredProperty=45]=`ObjectRequiredProperty`,e[e.Object=46]=`Object`,e[e.Promise=47]=`Promise`,e[e.RegExp=48]=`RegExp`,e[e.StringFormatUnknown=49]=`StringFormatUnknown`,e[e.StringFormat=50]=`StringFormat`,e[e.StringMaxLength=51]=`StringMaxLength`,e[e.StringMinLength=52]=`StringMinLength`,e[e.StringPattern=53]=`StringPattern`,e[e.String=54]=`String`,e[e.Symbol=55]=`Symbol`,e[e.TupleLength=56]=`TupleLength`,e[e.Tuple=57]=`Tuple`,e[e.Uint8ArrayMaxByteLength=58]=`Uint8ArrayMaxByteLength`,e[e.Uint8ArrayMinByteLength=59]=`Uint8ArrayMinByteLength`,e[e.Uint8Array=60]=`Uint8Array`,e[e.Undefined=61]=`Undefined`,e[e.Union=62]=`Union`,e[e.Void=63]=`Void`})(U||={});var Ud=class extends Ze{constructor(e){super(`Unknown type`),this.schema=e}};function Wd(e){return e.replace(/~/g,`~0`).replace(/\//g,`~1`)}function W(e){return e!==void 0}var Gd=class{constructor(e){this.iterator=e}[Symbol.iterator](){return this.iterator}First(){let e=this.iterator.next();return e.done?void 0:e.value}};function G(e,t,n,r,i=[]){return{type:e,schema:t,path:n,value:r,message:Au()({errorType:e,path:n,schema:t,value:r,errors:i}),errors:i}}function*Kd(e,t,n,r){}function*qd(e,t,n,r){}function*Jd(e,t,n,r){if(!Pe(r))return yield G(U.Array,e,n,r);W(e.minItems)&&!(r.length>=e.minItems)&&(yield G(U.ArrayMinItems,e,n,r)),W(e.maxItems)&&!(r.length<=e.maxItems)&&(yield G(U.ArrayMaxItems,e,n,r));for(let i=0;i<r.length;i++)yield*Df(e.items,t,`${n}/${i}`,r[i]);if(e.uniqueItems===!0&&!(function(){let e=new Set;for(let t of r){let n=id(t);if(e.has(n))return!1;e.add(n)}return!0})()&&(yield G(U.ArrayUniqueItems,e,n,r)),!(W(e.contains)||W(e.minContains)||W(e.maxContains)))return;let i=W(e.contains)?e.contains:z(),a=r.reduce((e,r,a)=>Df(i,t,`${n}${a}`,r).next().done===!0?e+1:e,0);a===0&&(yield G(U.ArrayContains,e,n,r)),k(e.minContains)&&a<e.minContains&&(yield G(U.ArrayMinContains,e,n,r)),k(e.maxContains)&&a>e.maxContains&&(yield G(U.ArrayMaxContains,e,n,r))}function*Yd(e,t,n,r){Ee(r)||(yield G(U.AsyncIterator,e,n,r))}function*Xd(e,t,n,r){if(!ze(r))return yield G(U.BigInt,e,n,r);W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield G(U.BigIntExclusiveMaximum,e,n,r)),W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield G(U.BigIntExclusiveMinimum,e,n,r)),W(e.maximum)&&!(r<=e.maximum)&&(yield G(U.BigIntMaximum,e,n,r)),W(e.minimum)&&!(r>=e.minimum)&&(yield G(U.BigIntMinimum,e,n,r)),W(e.multipleOf)&&r%e.multipleOf!==BigInt(0)&&(yield G(U.BigIntMultipleOf,e,n,r))}function*Zd(e,t,n,r){Le(r)||(yield G(U.Boolean,e,n,r))}function*Qd(e,t,n,r){yield*Df(e.returns,t,n,r.prototype)}function*$d(e,t,n,r){if(!ke(r))return yield G(U.Date,e,n,r);W(e.exclusiveMaximumTimestamp)&&!(r.getTime()<e.exclusiveMaximumTimestamp)&&(yield G(U.DateExclusiveMaximumTimestamp,e,n,r)),W(e.exclusiveMinimumTimestamp)&&!(r.getTime()>e.exclusiveMinimumTimestamp)&&(yield G(U.DateExclusiveMinimumTimestamp,e,n,r)),W(e.maximumTimestamp)&&!(r.getTime()<=e.maximumTimestamp)&&(yield G(U.DateMaximumTimestamp,e,n,r)),W(e.minimumTimestamp)&&!(r.getTime()>=e.minimumTimestamp)&&(yield G(U.DateMinimumTimestamp,e,n,r)),W(e.multipleOfTimestamp)&&r.getTime()%e.multipleOfTimestamp!==0&&(yield G(U.DateMultipleOfTimestamp,e,n,r))}function*ef(e,t,n,r){Ve(r)||(yield G(U.Function,e,n,r))}function*tf(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref];yield*Df(a,[...t,...i],n,r)}function*nf(e,t,n,r){if(!Re(r))return yield G(U.Integer,e,n,r);W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield G(U.IntegerExclusiveMaximum,e,n,r)),W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield G(U.IntegerExclusiveMinimum,e,n,r)),W(e.maximum)&&!(r<=e.maximum)&&(yield G(U.IntegerMaximum,e,n,r)),W(e.minimum)&&!(r>=e.minimum)&&(yield G(U.IntegerMinimum,e,n,r)),W(e.multipleOf)&&r%e.multipleOf!==0&&(yield G(U.IntegerMultipleOf,e,n,r))}function*rf(e,t,n,r){let i=!1;for(let a of e.allOf)for(let e of Df(a,t,n,r))i=!0,yield e;if(i)return yield G(U.Intersect,e,n,r);if(e.unevaluatedProperties===!1){let t=new RegExp(Fa(e));for(let i of Object.getOwnPropertyNames(r))t.test(i)||(yield G(U.IntersectUnevaluatedProperties,e,`${n}/${i}`,r))}if(typeof e.unevaluatedProperties==`object`){let i=new RegExp(Fa(e));for(let a of Object.getOwnPropertyNames(r))if(!i.test(a)){let i=Df(e.unevaluatedProperties,t,`${n}/${a}`,r[a]).next();i.done||(yield i.value)}}}function*af(e,t,n,r){De(r)||(yield G(U.Iterator,e,n,r))}function*of(e,t,n,r){r!==e.const&&(yield G(U.Literal,e,n,r))}function*sf(e,t,n,r){yield G(U.Never,e,n,r)}function*cf(e,t,n,r){Df(e.not,t,n,r).next().done===!0&&(yield G(U.Not,e,n,r))}function*lf(e,t,n,r){Ie(r)||(yield G(U.Null,e,n,r))}function*uf(e,t,n,r){if(!We.IsNumberLike(r))return yield G(U.Number,e,n,r);W(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield G(U.NumberExclusiveMaximum,e,n,r)),W(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield G(U.NumberExclusiveMinimum,e,n,r)),W(e.maximum)&&!(r<=e.maximum)&&(yield G(U.NumberMaximum,e,n,r)),W(e.minimum)&&!(r>=e.minimum)&&(yield G(U.NumberMinimum,e,n,r)),W(e.multipleOf)&&r%e.multipleOf!==0&&(yield G(U.NumberMultipleOf,e,n,r))}function*df(e,t,n,r){if(!We.IsObjectLike(r))return yield G(U.Object,e,n,r);W(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)&&(yield G(U.ObjectMinProperties,e,n,r)),W(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties)&&(yield G(U.ObjectMaxProperties,e,n,r));let i=Array.isArray(e.required)?e.required:[],a=Object.getOwnPropertyNames(e.properties),o=Object.getOwnPropertyNames(r);for(let t of i)o.includes(t)||(yield G(U.ObjectRequiredProperty,e.properties[t],`${n}/${Wd(t)}`,void 0));if(e.additionalProperties===!1)for(let t of o)a.includes(t)||(yield G(U.ObjectAdditionalProperties,e,`${n}/${Wd(t)}`,r[t]));if(typeof e.additionalProperties==`object`)for(let i of o)a.includes(i)||(yield*Df(e.additionalProperties,t,`${n}/${Wd(i)}`,r[i]));for(let i of a){let a=e.properties[i];e.required&&e.required.includes(i)?(yield*Df(a,t,`${n}/${Wd(i)}`,r[i]),Ps(e)&&!(i in r)&&(yield G(U.ObjectRequiredProperty,a,`${n}/${Wd(i)}`,void 0))):We.IsExactOptionalProperty(r,i)&&(yield*Df(a,t,`${n}/${Wd(i)}`,r[i]))}}function*ff(e,t,n,r){Oe(r)||(yield G(U.Promise,e,n,r))}function*pf(e,t,n,r){if(!We.IsRecordLike(r))return yield G(U.Object,e,n,r);W(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)&&(yield G(U.ObjectMinProperties,e,n,r)),W(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties)&&(yield G(U.ObjectMaxProperties,e,n,r));let[i,a]=Object.entries(e.patternProperties)[0],o=new RegExp(i);for(let[e,i]of Object.entries(r))o.test(e)&&(yield*Df(a,t,`${n}/${Wd(e)}`,i));if(typeof e.additionalProperties==`object`)for(let[i,a]of Object.entries(r))o.test(i)||(yield*Df(e.additionalProperties,t,`${n}/${Wd(i)}`,a));if(e.additionalProperties===!1){for(let[t,i]of Object.entries(r))if(!o.test(t))return yield G(U.ObjectAdditionalProperties,e,`${n}/${Wd(t)}`,i)}}function*mf(e,t,n,r){yield*Df(Pu(e,t),t,n,r)}function*hf(e,t,n,r){if(!Be(r))return yield G(U.String,e,n,r);if(W(e.minLength)&&!(r.length>=e.minLength)&&(yield G(U.StringMinLength,e,n,r)),W(e.maxLength)&&!(r.length<=e.maxLength)&&(yield G(U.StringMaxLength,e,n,r)),!new RegExp(e.source,e.flags).test(r))return yield G(U.RegExp,e,n,r)}function*gf(e,t,n,r){if(!Be(r))return yield G(U.String,e,n,r);W(e.minLength)&&!(r.length>=e.minLength)&&(yield G(U.StringMinLength,e,n,r)),W(e.maxLength)&&!(r.length<=e.maxLength)&&(yield G(U.StringMaxLength,e,n,r)),Be(e.pattern)&&(new RegExp(e.pattern).test(r)||(yield G(U.StringPattern,e,n,r))),Be(e.format)&&(Jn(e.format)?Xn(e.format)(r)||(yield G(U.StringFormat,e,n,r)):yield G(U.StringFormatUnknown,e,n,r))}function*_f(e,t,n,r){He(r)||(yield G(U.Symbol,e,n,r))}function*vf(e,t,n,r){if(!Be(r))return yield G(U.String,e,n,r);new RegExp(e.pattern).test(r)||(yield G(U.StringPattern,e,n,r))}function*yf(e,t,n,r){yield*Df(Pu(e,t),t,n,r)}function*bf(e,t,n,r){if(!Pe(r))return yield G(U.Tuple,e,n,r);if(e.items===void 0&&r.length!==0||r.length!==e.maxItems)return yield G(U.TupleLength,e,n,r);if(e.items)for(let i=0;i<e.items.length;i++)yield*Df(e.items[i],t,`${n}/${i}`,r[i])}function*xf(e,t,n,r){Fe(r)||(yield G(U.Undefined,e,n,r))}function*Sf(e,t,n,r){if(Hd(e,t,r))return;let i=e.anyOf.map(e=>new Gd(Df(e,t,n,r)));yield G(U.Union,e,n,r,i)}function*Cf(e,t,n,r){if(!Ne(r))return yield G(U.Uint8Array,e,n,r);W(e.maxByteLength)&&!(r.length<=e.maxByteLength)&&(yield G(U.Uint8ArrayMaxByteLength,e,n,r)),W(e.minByteLength)&&!(r.length>=e.minByteLength)&&(yield G(U.Uint8ArrayMinByteLength,e,n,r))}function*wf(e,t,n,r){}function*Tf(e,t,n,r){We.IsVoidLike(r)||(yield G(U.Void,e,n,r))}function*Ef(e,t,n,r){er(e[j])(e,r)||(yield G(U.Kind,e,n,r))}function*Df(e,t,n,r){let i=W(e.$id)?[...t,e]:t,a=e;switch(a[j]){case`Any`:return yield*Kd(a,i,n,r);case`Argument`:return yield*qd(a,i,n,r);case`Array`:return yield*Jd(a,i,n,r);case`AsyncIterator`:return yield*Yd(a,i,n,r);case`BigInt`:return yield*Xd(a,i,n,r);case`Boolean`:return yield*Zd(a,i,n,r);case`Constructor`:return yield*Qd(a,i,n,r);case`Date`:return yield*$d(a,i,n,r);case`Function`:return yield*ef(a,i,n,r);case`Import`:return yield*tf(a,i,n,r);case`Integer`:return yield*nf(a,i,n,r);case`Intersect`:return yield*rf(a,i,n,r);case`Iterator`:return yield*af(a,i,n,r);case`Literal`:return yield*of(a,i,n,r);case`Never`:return yield*sf(a,i,n,r);case`Not`:return yield*cf(a,i,n,r);case`Null`:return yield*lf(a,i,n,r);case`Number`:return yield*uf(a,i,n,r);case`Object`:return yield*df(a,i,n,r);case`Promise`:return yield*ff(a,i,n,r);case`Record`:return yield*pf(a,i,n,r);case`Ref`:return yield*mf(a,i,n,r);case`RegExp`:return yield*hf(a,i,n,r);case`String`:return yield*gf(a,i,n,r);case`Symbol`:return yield*_f(a,i,n,r);case`TemplateLiteral`:return yield*vf(a,i,n,r);case`This`:return yield*yf(a,i,n,r);case`Tuple`:return yield*bf(a,i,n,r);case`Undefined`:return yield*xf(a,i,n,r);case`Union`:return yield*Sf(a,i,n,r);case`Uint8Array`:return yield*Cf(a,i,n,r);case`Unknown`:return yield*wf(a,i,n,r);case`Void`:return yield*Tf(a,i,n,r);default:if(!Qn(a[j]))throw new Ud(e);return yield*Ef(a,i,n,r)}}function Of(...e){return new Gd(e.length===3?Df(e[0],e[1],``,e[2]):Df(e[0],[],``,e[1]))}function kf(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=If(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=If(e[n]);return t}function Af(e){return e.map(e=>If(e))}function jf(e){return e.slice()}function Mf(e){return new Map(If([...e.entries()]))}function Nf(e){return new Set(If([...e.entries()]))}function Pf(e){return new Date(e.toISOString())}function Ff(e){return e}function If(e){if(Pe(e))return Af(e);if(ke(e))return Pf(e);if(Me(e))return jf(e);if(Ae(e))return Mf(e);if(je(e))return Nf(e);if(O(e))return kf(e);if(Ue(e))return Ff(e);throw Error(`ValueClone: Unable to clone value`)}var Lf=class extends Ze{constructor(e,t){super(t),this.schema=e}};function K(e){return Ve(e)?e():If(e)}function Rf(e,t){return D(e,`default`)?K(e.default):{}}function zf(e,t){return{}}function Bf(e,t){if(e.uniqueItems===!0&&!D(e,`default`))throw new Lf(e,`Array with the uniqueItems constraint requires a default value`);if(`contains`in e&&!D(e,`default`))throw new Lf(e,`Array with the contains constraint requires a default value`);return`default`in e?K(e.default):e.minItems===void 0?[]:Array.from({length:e.minItems}).map(n=>vp(e.items,t))}function Vf(e,t){return D(e,`default`)?K(e.default):(async function*(){})()}function Hf(e,t){return D(e,`default`)?K(e.default):BigInt(0)}function Uf(e,t){return D(e,`default`)?K(e.default):!1}function Wf(e,t){if(D(e,`default`))return K(e.default);{let n=vp(e.returns,t);return typeof n==`object`&&!Array.isArray(n)?class{constructor(){for(let[e,t]of Object.entries(n)){let n=this;n[e]=t}}}:class{}}}function Gf(e,t){return D(e,`default`)?K(e.default):e.minimumTimestamp===void 0?new Date:new Date(e.minimumTimestamp)}function Kf(e,t){return D(e,`default`)?K(e.default):()=>vp(e.returns,t)}function qf(e,t){let n=globalThis.Object.values(e.$defs),r=e.$defs[e.$ref];return vp(r,[...t,...n])}function Jf(e,t){return D(e,`default`)?K(e.default):e.minimum===void 0?0:e.minimum}function Yf(e,t){if(D(e,`default`))return K(e.default);{let n=e.allOf.reduce((e,n)=>{let r=vp(n,t);return typeof r==`object`?{...e,...r}:r},{});if(!Hd(e,t,n))throw new Lf(e,`Intersect produced invalid value. Consider using a default value.`);return n}}function Xf(e,t){return D(e,`default`)?K(e.default):(function*(){})()}function Zf(e,t){return D(e,`default`)?K(e.default):e.const}function Qf(e,t){if(D(e,`default`))return K(e.default);throw new Lf(e,`Never types cannot be created. Consider using a default value.`)}function $f(e,t){if(D(e,`default`))return K(e.default);throw new Lf(e,`Not types must have a default value`)}function ep(e,t){return D(e,`default`)?K(e.default):null}function tp(e,t){return D(e,`default`)?K(e.default):e.minimum===void 0?0:e.minimum}function np(e,t){if(D(e,`default`))return K(e.default);{let n=new Set(e.required),r={};for(let[i,a]of Object.entries(e.properties))n.has(i)&&(r[i]=vp(a,t));return r}}function rp(e,t){return D(e,`default`)?K(e.default):Promise.resolve(vp(e.item,t))}function ip(e,t){return D(e,`default`)?K(e.default):{}}function ap(e,t){return D(e,`default`)?K(e.default):vp(Pu(e,t),t)}function op(e,t){if(D(e,`default`))return K(e.default);throw new Lf(e,`RegExp types cannot be created. Consider using a default value.`)}function sp(e,t){if(e.pattern!==void 0){if(D(e,`default`))return K(e.default);throw new Lf(e,`String types with patterns must specify a default value`)}else if(e.format!==void 0){if(D(e,`default`))return K(e.default);throw new Lf(e,`String types with formats must specify a default value`)}else if(D(e,`default`))return K(e.default);else if(e.minLength!==void 0)return Array.from({length:e.minLength}).map(()=>` `).join(``);else return``}function cp(e,t){return D(e,`default`)?K(e.default):`value`in e?Symbol.for(e.value):Symbol()}function lp(e,t){if(D(e,`default`))return K(e.default);if(!Ur(e))throw new Lf(e,`Can only create template literals that produce a finite variants. Consider using a default value.`);return Xr(e)[0]}function up(e,t){if(bp++>yp)throw new Lf(e,`Cannot create recursive type as it appears possibly infinite. Consider using a default.`);return D(e,`default`)?K(e.default):vp(Pu(e,t),t)}function dp(e,t){return D(e,`default`)?K(e.default):e.items===void 0?[]:Array.from({length:e.minItems}).map((n,r)=>vp(e.items[r],t))}function fp(e,t){if(D(e,`default`))return K(e.default)}function pp(e,t){if(D(e,`default`))return K(e.default);if(e.anyOf.length===0)throw Error(`ValueCreate.Union: Cannot create Union with zero variants`);return vp(e.anyOf[0],t)}function mp(e,t){return D(e,`default`)?K(e.default):e.minByteLength===void 0?new Uint8Array:new Uint8Array(e.minByteLength)}function hp(e,t){return D(e,`default`)?K(e.default):{}}function gp(e,t){if(D(e,`default`))return K(e.default)}function _p(e,t){if(D(e,`default`))return K(e.default);throw Error(`User defined types must specify a default value`)}function vp(e,t){let n=Nu(e,t),r=e;switch(r[j]){case`Any`:return Rf(r,n);case`Argument`:return zf(r,n);case`Array`:return Bf(r,n);case`AsyncIterator`:return Vf(r,n);case`BigInt`:return Hf(r,n);case`Boolean`:return Uf(r,n);case`Constructor`:return Wf(r,n);case`Date`:return Gf(r,n);case`Function`:return Kf(r,n);case`Import`:return qf(r,n);case`Integer`:return Jf(r,n);case`Intersect`:return Yf(r,n);case`Iterator`:return Xf(r,n);case`Literal`:return Zf(r,n);case`Never`:return Qf(r,n);case`Not`:return $f(r,n);case`Null`:return ep(r,n);case`Number`:return tp(r,n);case`Object`:return np(r,n);case`Promise`:return rp(r,n);case`Record`:return ip(r,n);case`Ref`:return ap(r,n);case`RegExp`:return op(r,n);case`String`:return sp(r,n);case`Symbol`:return cp(r,n);case`TemplateLiteral`:return lp(r,n);case`This`:return up(r,n);case`Tuple`:return dp(r,n);case`Undefined`:return fp(r,n);case`Union`:return pp(r,n);case`Uint8Array`:return mp(r,n);case`Unknown`:return hp(r,n);case`Void`:return gp(r,n);default:if(!Qn(r[j]))throw new Lf(r,`Unknown type`);return _p(r,n)}}var yp=512,bp=0;function xp(...e){return bp=0,e.length===2?vp(e[0],e[1]):vp(e[0],[])}function Sp(e){return Vt(e)&&e[j]!==`Unsafe`}function Cp(e,t,n){return Pe(n)?n.map(n=>Mp(e.items,t,n)):n}function wp(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Mp(i,[...t,...r],n)}function Tp(e,t,n){let r=e.unevaluatedProperties,i=e.allOf.map(e=>Mp(e,t,If(n))).reduce((e,t)=>O(t)?{...e,...t}:t,{});if(!O(n)||!O(i)||!Vt(r))return i;let a=Na(e);for(let e of Object.getOwnPropertyNames(n))a.includes(e)||Hd(r,t,n[e])&&(i[e]=Mp(r,t,n[e]));return i}function Ep(e,t,n){if(!O(n)||Pe(n))return n;let r=e.additionalProperties;for(let i of Object.getOwnPropertyNames(n)){if(D(e.properties,i)){n[i]=Mp(e.properties[i],t,n[i]);continue}if(Vt(r)&&Hd(r,t,n[i])){n[i]=Mp(r,t,n[i]);continue}delete n[i]}return n}function Dp(e,t,n){if(!O(n))return n;let r=e.additionalProperties,i=Object.getOwnPropertyNames(n),[a,o]=Object.entries(e.patternProperties)[0],s=new RegExp(a);for(let e of i){if(s.test(e)){n[e]=Mp(o,t,n[e]);continue}if(Vt(r)&&Hd(r,t,n[e])){n[e]=Mp(r,t,n[e]);continue}delete n[e]}return n}function Op(e,t,n){return Mp(Pu(e,t),t,n)}function kp(e,t,n){return Mp(Pu(e,t),t,n)}function Ap(e,t,n){if(!Pe(n))return n;if(Fe(e.items))return[];let r=Math.min(n.length,e.items.length);for(let i=0;i<r;i++)n[i]=Mp(e.items[i],t,n[i]);return n.length>r?n.slice(0,r):n}function jp(e,t,n){for(let r of e.anyOf)if(Sp(r)&&Hd(r,t,n))return Mp(r,t,n);return n}function Mp(e,t,n){let r=Be(e.$id)?Nu(e,t):t,i=e;switch(i[j]){case`Array`:return Cp(i,r,n);case`Import`:return wp(i,r,n);case`Intersect`:return Tp(i,r,n);case`Object`:return Ep(i,r,n);case`Record`:return Dp(i,r,n);case`Ref`:return Op(i,r,n);case`This`:return kp(i,r,n);case`Tuple`:return Ap(i,r,n);case`Union`:return jp(i,r,n);default:return n}}function Np(...e){return e.length===3?Mp(e[0],e[1],e[2]):Mp(e[0],[],e[1])}var Pp=class extends Ze{constructor(e,t,n){super(`Unable to decode value as it does not match the expected schema`),this.schema=e,this.value=t,this.error=n}},Fp=class extends Ze{constructor(e,t,n,r){super(r instanceof Error?r.message:`Unknown error`),this.schema=e,this.path=t,this.value=n,this.error=r}};function q(e,t,n){try{return N(e)?e[Qe].Decode(n):n}catch(r){throw new Fp(e,t,n,r)}}function Ip(e,t,n,r){return Pe(r)?q(e,n,r.map((r,i)=>Kp(e.items,t,`${n}/${i}`,r))):q(e,n,r)}function Lp(e,t,n,r){if(!O(r)||Ue(r))return q(e,n,r);let i=Wa(e),a=i.map(e=>e[0]),o={...r};for(let[e,r]of i)e in o&&(o[e]=Kp(r,t,`${n}/${e}`,o[e]));if(!N(e.unevaluatedProperties))return q(e,n,o);let s=Object.getOwnPropertyNames(o),c=e.unevaluatedProperties,l={...o};for(let e of s)a.includes(e)||(l[e]=q(c,`${n}/${e}`,l[e]));return q(e,n,l)}function Rp(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref];return q(e,n,Kp(a,[...t,...i],n,r))}function zp(e,t,n,r){return q(e,n,Kp(e.not,t,n,r))}function Bp(e,t,n,r){if(!O(r))return q(e,n,r);let i=Na(e),a={...r};for(let r of i)D(a,r)&&(Fe(a[r])&&(!Ft(e.properties[r])||We.IsExactOptionalProperty(a,r))||(a[r]=Kp(e.properties[r],t,`${n}/${r}`,a[r])));if(!Ht(e.additionalProperties))return q(e,n,a);let o=Object.getOwnPropertyNames(a),s=e.additionalProperties,c={...a};for(let e of o)i.includes(e)||(c[e]=q(s,`${n}/${e}`,c[e]));return q(e,n,c)}function Vp(e,t,n,r){if(!O(r))return q(e,n,r);let i=Object.getOwnPropertyNames(e.patternProperties)[0],a=new RegExp(i),o={...r};for(let s of Object.getOwnPropertyNames(r))a.test(s)&&(o[s]=Kp(e.patternProperties[i],t,`${n}/${s}`,o[s]));if(!Ht(e.additionalProperties))return q(e,n,o);let s=Object.getOwnPropertyNames(o),c=e.additionalProperties,l={...o};for(let e of s)a.test(e)||(l[e]=q(c,`${n}/${e}`,l[e]));return q(e,n,l)}function Hp(e,t,n,r){return q(e,n,Kp(Pu(e,t),t,n,r))}function Up(e,t,n,r){return q(e,n,Kp(Pu(e,t),t,n,r))}function Wp(e,t,n,r){return Pe(r)&&Pe(e.items)?q(e,n,e.items.map((e,i)=>Kp(e,t,`${n}/${i}`,r[i]))):q(e,n,r)}function Gp(e,t,n,r){for(let i of e.anyOf)if(Hd(i,t,r))return q(e,n,Kp(i,t,n,r));return q(e,n,r)}function Kp(e,t,n,r){let i=Nu(e,t),a=e;switch(e[j]){case`Array`:return Ip(a,i,n,r);case`Import`:return Rp(a,i,n,r);case`Intersect`:return Lp(a,i,n,r);case`Not`:return zp(a,i,n,r);case`Object`:return Bp(a,i,n,r);case`Record`:return Vp(a,i,n,r);case`Ref`:return Hp(a,i,n,r);case`Symbol`:return q(a,n,r);case`This`:return Up(a,i,n,r);case`Tuple`:return Wp(a,i,n,r);case`Union`:return Gp(a,i,n,r);default:return q(a,n,r)}}function qp(e,t,n){return Kp(e,t,``,n)}var Jp=class extends Ze{constructor(e,t,n){super(`The encoded value does not match the expected schema`),this.schema=e,this.value=t,this.error=n}},Yp=class extends Ze{constructor(e,t,n,r){super(`${r instanceof Error?r.message:`Unknown error`}`),this.schema=e,this.path=t,this.value=n,this.error=r}};function Xp(e,t,n){try{return N(e)?e[Qe].Encode(n):n}catch(r){throw new Yp(e,t,n,r)}}function Zp(e,t,n,r){let i=Xp(e,n,r);return Pe(i)?i.map((r,i)=>sm(e.items,t,`${n}/${i}`,r)):i}function Qp(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref],o=Xp(e,n,r);return sm(a,[...t,...i],n,o)}function $p(e,t,n,r){let i=Xp(e,n,r);if(!O(r)||Ue(r))return i;let a=Wa(e),o=a.map(e=>e[0]),s={...i};for(let[e,r]of a)e in s&&(s[e]=sm(r,t,`${n}/${e}`,s[e]));if(!N(e.unevaluatedProperties))return s;let c=Object.getOwnPropertyNames(s),l=e.unevaluatedProperties,u={...s};for(let e of c)o.includes(e)||(u[e]=Xp(l,`${n}/${e}`,u[e]));return u}function em(e,t,n,r){return Xp(e.not,n,Xp(e,n,r))}function tm(e,t,n,r){let i=Xp(e,n,r);if(!O(i))return i;let a=Na(e),o={...i};for(let r of a)D(o,r)&&(Fe(o[r])&&(!Ft(e.properties[r])||We.IsExactOptionalProperty(o,r))||(o[r]=sm(e.properties[r],t,`${n}/${r}`,o[r])));if(!Ht(e.additionalProperties))return o;let s=Object.getOwnPropertyNames(o),c=e.additionalProperties,l={...o};for(let e of s)a.includes(e)||(l[e]=Xp(c,`${n}/${e}`,l[e]));return l}function nm(e,t,n,r){let i=Xp(e,n,r);if(!O(r))return i;let a=Object.getOwnPropertyNames(e.patternProperties)[0],o=new RegExp(a),s={...i};for(let i of Object.getOwnPropertyNames(r))o.test(i)&&(s[i]=sm(e.patternProperties[a],t,`${n}/${i}`,s[i]));if(!Ht(e.additionalProperties))return s;let c=Object.getOwnPropertyNames(s),l=e.additionalProperties,u={...s};for(let e of c)o.test(e)||(u[e]=Xp(l,`${n}/${e}`,u[e]));return u}function rm(e,t,n,r){return Xp(e,n,sm(Pu(e,t),t,n,r))}function im(e,t,n,r){return Xp(e,n,sm(Pu(e,t),t,n,r))}function am(e,t,n,r){let i=Xp(e,n,r);return Pe(e.items)?e.items.map((e,r)=>sm(e,t,`${n}/${r}`,i[r])):[]}function om(e,t,n,r){for(let i of e.anyOf)if(Hd(i,t,r))return Xp(e,n,sm(i,t,n,r));for(let i of e.anyOf){let a=sm(i,t,n,r);if(Hd(e,t,a))return Xp(e,n,a)}return Xp(e,n,r)}function sm(e,t,n,r){let i=Nu(e,t),a=e;switch(e[j]){case`Array`:return Zp(a,i,n,r);case`Import`:return Qp(a,i,n,r);case`Intersect`:return $p(a,i,n,r);case`Not`:return em(a,i,n,r);case`Object`:return tm(a,i,n,r);case`Record`:return nm(a,i,n,r);case`Ref`:return rm(a,i,n,r);case`This`:return im(a,i,n,r);case`Tuple`:return am(a,i,n,r);case`Union`:return om(a,i,n,r);default:return Xp(a,n,r)}}function cm(e,t,n){return sm(e,t,``,n)}function lm(e,t){return N(e)||wm(e.items,t)}function um(e,t){return N(e)||wm(e.items,t)}function dm(e,t){return N(e)||wm(e.returns,t)||e.parameters.some(e=>wm(e,t))}function fm(e,t){return N(e)||wm(e.returns,t)||e.parameters.some(e=>wm(e,t))}function pm(e,t){return N(e)||N(e.unevaluatedProperties)||e.allOf.some(e=>wm(e,t))}function mm(e,t){let n=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>[...t,e.$defs[n]],[]),r=e.$defs[e.$ref];return N(e)||wm(r,[...n,...t])}function hm(e,t){return N(e)||wm(e.items,t)}function gm(e,t){return N(e)||wm(e.not,t)}function _m(e,t){return N(e)||Object.values(e.properties).some(e=>wm(e,t))||Ht(e.additionalProperties)&&wm(e.additionalProperties,t)}function vm(e,t){return N(e)||wm(e.item,t)}function ym(e,t){let n=Object.getOwnPropertyNames(e.patternProperties)[0],r=e.patternProperties[n];return N(e)||wm(r,t)||Ht(e.additionalProperties)&&N(e.additionalProperties)}function bm(e,t){return N(e)?!0:wm(Pu(e,t),t)}function xm(e,t){return N(e)?!0:wm(Pu(e,t),t)}function Sm(e,t){return N(e)||!Fe(e.items)&&e.items.some(e=>wm(e,t))}function Cm(e,t){return N(e)||e.anyOf.some(e=>wm(e,t))}function wm(e,t){let n=Nu(e,t),r=e;if(e.$id&&Tm.has(e.$id))return!1;switch(e.$id&&Tm.add(e.$id),e[j]){case`Array`:return lm(r,n);case`AsyncIterator`:return um(r,n);case`Constructor`:return dm(r,n);case`Function`:return fm(r,n);case`Import`:return mm(r,n);case`Intersect`:return pm(r,n);case`Iterator`:return hm(r,n);case`Not`:return gm(r,n);case`Object`:return _m(r,n);case`Promise`:return vm(r,n);case`Record`:return ym(r,n);case`Ref`:return bm(r,n);case`This`:return xm(r,n);case`Tuple`:return Sm(r,n);case`Union`:return Cm(r,n);default:return N(e)}}var Tm=new Set;function Em(e,t){return Tm.clear(),wm(e,t)}function Dm(...e){let[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!Hd(t,n,r))throw new Pp(t,r,Of(t,n,r).First());return Em(t,n)?qp(t,n,r):r}function Om(e,t){let n=D(e,`default`)?e.default:void 0,r=Ve(n)?n():If(n);return Fe(t)?r:O(t)&&O(r)?Object.assign(r,t):t}function km(e){return Vt(e)&&`default`in e}function Am(e,t,n){if(Pe(n)){for(let r=0;r<n.length;r++)n[r]=Bm(e.items,t,n[r]);return n}let r=Om(e,n);if(!Pe(r))return r;for(let n=0;n<r.length;n++)r[n]=Bm(e.items,t,r[n]);return r}function jm(e,t,n){return ke(n)?n:Om(e,n)}function Mm(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Bm(i,[...t,...r],n)}function Nm(e,t,n){let r=Om(e,n);return e.allOf.reduce((e,n)=>{let i=Bm(n,t,r);return O(i)?{...e,...i}:i},{})}function Pm(e,t,n){let r=Om(e,n);if(!O(r))return r;let i=Object.getOwnPropertyNames(e.properties);for(let n of i)Fe(Bm(e.properties[n],t,r[n]))||(r[n]=Bm(e.properties[n],t,r[n]));if(!km(e.additionalProperties))return r;for(let n of Object.getOwnPropertyNames(r))i.includes(n)||(r[n]=Bm(e.additionalProperties,t,r[n]));return r}function Fm(e,t,n){let r=Om(e,n);if(!O(r))return r;let i=e.additionalProperties,[a,o]=Object.entries(e.patternProperties)[0],s=new RegExp(a);for(let e of Object.getOwnPropertyNames(r))s.test(e)&&km(o)&&(r[e]=Bm(o,t,r[e]));if(!km(i))return r;for(let e of Object.getOwnPropertyNames(r))s.test(e)||(r[e]=Bm(i,t,r[e]));return r}function Im(e,t,n){return Bm(Pu(e,t),t,Om(e,n))}function Lm(e,t,n){return Bm(Pu(e,t),t,n)}function Rm(e,t,n){let r=Om(e,n);if(!Pe(r)||Fe(e.items))return r;let[i,a]=[e.items,Math.max(e.items.length,r.length)];for(let e=0;e<a;e++)e<i.length&&(r[e]=Bm(i[e],t,r[e]));return r}function zm(e,t,n){let r=Om(e,n);for(let n of e.anyOf){let e=Bm(n,t,If(r));if(Hd(n,t,e))return e}return r}function Bm(e,t,n){let r=Nu(e,t),i=e;switch(i[j]){case`Array`:return Am(i,r,n);case`Date`:return jm(i,r,n);case`Import`:return Mm(i,r,n);case`Intersect`:return Nm(i,r,n);case`Object`:return Pm(i,r,n);case`Record`:return Fm(i,r,n);case`Ref`:return Im(i,r,n);case`This`:return Lm(i,r,n);case`Tuple`:return Rm(i,r,n);case`Union`:return zm(i,r,n);default:return Om(i,n)}}function Vm(...e){return e.length===3?Bm(e[0],e[1],e[2]):Bm(e[0],[],e[1])}function Hm(...e){let[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]],i=Em(t,n)?cm(t,n,r):r;if(!Hd(t,n,i))throw new Jp(t,i,Of(t,n,i).First());return i}var Um=class{constructor(e,t,n,r){this.schema=e,this.references=t,this.checkFunc=n,this.code=r,this.hasTransform=Em(e,t)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(e){return Of(this.schema,this.references,e)}Check(e){return this.checkFunc(e)}Decode(e){if(!this.checkFunc(e))throw new Pp(this.schema,e,this.Errors(e).First());return this.hasTransform?qp(this.schema,this.references,e):e}Encode(e){let t=this.hasTransform?cm(this.schema,this.references,e):e;if(!this.checkFunc(t))throw new Jp(this.schema,e,this.Errors(e).First());return t}},Wm;(function(e){function t(e){return e===36}e.DollarSign=t;function n(e){return e===95}e.IsUnderscore=n;function r(e){return e>=65&&e<=90||e>=97&&e<=122}e.IsAlpha=r;function i(e){return e>=48&&e<=57}e.IsNumeric=i})(Wm||={});var Gm;(function(e){function t(e){return e.length===0?!1:Wm.IsNumeric(e.charCodeAt(0))}function n(e){if(t(e))return!1;for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(!(Wm.IsAlpha(n)||Wm.IsNumeric(n)||Wm.DollarSign(n)||Wm.IsUnderscore(n)))return!1}return!0}function r(e){return e.replace(/'/g,`\\'`)}function i(e,t){return n(t)?`${e}.${t}`:`${e}['${r(t)}']`}e.Encode=i})(Gm||={});var Km;(function(e){function t(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);Wm.IsNumeric(r)||Wm.IsAlpha(r)?t.push(e.charAt(n)):t.push(`_${r}_`)}return t.join(``).replace(/__/g,`_`)}e.Encode=t})(Km||={});var qm;(function(e){function t(e){return e.replace(/'/g,`\\'`)}e.Escape=t})(qm||={});var Jm=class extends Ze{constructor(e){super(`Unknown type`),this.schema=e}},Ym=class extends Ze{constructor(e){super(`Preflight validation check failed to guard for the given schema`),this.schema=e}},Xm;(function(e){function t(e,t,n){return We.ExactOptionalPropertyTypes?`('${t}' in ${e} ? ${n} : true)`:`(${Gm.Encode(e,t)} !== undefined ? ${n} : true)`}e.IsExactOptionalProperty=t;function n(e){return We.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null)`:`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}))`}e.IsObjectLike=n;function r(e){return We.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`:`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}) && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`}e.IsRecordLike=r;function i(e){return We.AllowNaN?`typeof ${e} === 'number'`:`Number.isFinite(${e})`}e.IsNumberLike=i;function a(e){return We.AllowNullVoid?`(${e} === undefined || ${e} === null)`:`${e} === undefined`}e.IsVoidLike=a})(Xm||={});var Zm;(function(e){function t(e){return e[j]===`Any`||e[j]===`Unknown`}function*n(e,t,n){yield`true`}function*r(e,t,n){yield`true`}function*i(e,t,n){yield`Array.isArray(${n})`;let[r,i]=[T(`value`,`any`),T(`acc`,`number`)];if(k(e.maxItems)&&(yield`${n}.length <= ${e.maxItems}`),k(e.minItems)&&(yield`${n}.length >= ${e.minItems}`),yield`${n}.every((${r}) => ${x(e.items,t,`value`)})`,R(e.contains)||k(e.minContains)||k(e.maxContains)){let a=x(R(e.contains)?e.contains:z(),t,`value`),o=k(e.minContains)?[`(count >= ${e.minContains})`]:[],s=k(e.maxContains)?[`(count <= ${e.maxContains})`]:[];yield`((${r}) => { ${`const count = value.reduce((${i}, ${r}) => ${a} ? acc + 1 : acc, 0)`}; return ${[`(count > 0)`,...o,...s].join(` && `)}})(${n})`}e.uniqueItems===!0&&(yield`((${r}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${n})`)}function*a(e,t,n){yield`(typeof value === 'object' && Symbol.asyncIterator in ${n})`}function*o(e,t,n){yield`(typeof ${n} === 'bigint')`,ze(e.exclusiveMaximum)&&(yield`${n} < BigInt(${e.exclusiveMaximum})`),ze(e.exclusiveMinimum)&&(yield`${n} > BigInt(${e.exclusiveMinimum})`),ze(e.maximum)&&(yield`${n} <= BigInt(${e.maximum})`),ze(e.minimum)&&(yield`${n} >= BigInt(${e.minimum})`),ze(e.multipleOf)&&(yield`(${n} % BigInt(${e.multipleOf})) === 0`)}function*s(e,t,n){yield`(typeof ${n} === 'boolean')`}function*c(e,t,n){yield*b(e.returns,t,`${n}.prototype`)}function*l(e,t,n){yield`(${n} instanceof Date) && Number.isFinite(${n}.getTime())`,k(e.exclusiveMaximumTimestamp)&&(yield`${n}.getTime() < ${e.exclusiveMaximumTimestamp}`),k(e.exclusiveMinimumTimestamp)&&(yield`${n}.getTime() > ${e.exclusiveMinimumTimestamp}`),k(e.maximumTimestamp)&&(yield`${n}.getTime() <= ${e.maximumTimestamp}`),k(e.minimumTimestamp)&&(yield`${n}.getTime() >= ${e.minimumTimestamp}`),k(e.multipleOfTimestamp)&&(yield`(${n}.getTime() % ${e.multipleOfTimestamp}) === 0`)}function*u(e,t,n){yield`(typeof ${n} === 'function')`}function*d(e,t,n){let r=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>[...t,e.$defs[n]],[]);yield*b(va(e.$ref),[...t,...r],n)}function*f(e,t,n){yield`Number.isInteger(${n})`,k(e.exclusiveMaximum)&&(yield`${n} < ${e.exclusiveMaximum}`),k(e.exclusiveMinimum)&&(yield`${n} > ${e.exclusiveMinimum}`),k(e.maximum)&&(yield`${n} <= ${e.maximum}`),k(e.minimum)&&(yield`${n} >= ${e.minimum}`),k(e.multipleOf)&&(yield`(${n} % ${e.multipleOf}) === 0`)}function*p(e,t,n){let r=e.allOf.map(e=>x(e,t,n)).join(` && `);e.unevaluatedProperties===!1?yield`(${r} && ${`Object.getOwnPropertyNames(${n}).every(key => ${C(`${new RegExp(Fa(e))};`)}.test(key))`})`:R(e.unevaluatedProperties)?yield`(${r} && ${`Object.getOwnPropertyNames(${n}).every(key => ${C(`${new RegExp(Fa(e))};`)}.test(key) || ${x(e.unevaluatedProperties,t,`${n}[key]`)})`})`:yield`(${r})`}function*m(e,t,n){yield`(typeof value === 'object' && Symbol.iterator in ${n})`}function*h(e,t,n){typeof e.const==`number`||typeof e.const==`boolean`?yield`(${n} === ${e.const})`:yield`(${n} === '${qm.Escape(e.const)}')`}function*g(e,t,n){yield`false`}function*_(e,t,n){yield`(!${x(e.not,t,n)})`}function*ee(e,t,n){yield`(${n} === null)`}function*te(e,t,n){yield Xm.IsNumberLike(n),k(e.exclusiveMaximum)&&(yield`${n} < ${e.exclusiveMaximum}`),k(e.exclusiveMinimum)&&(yield`${n} > ${e.exclusiveMinimum}`),k(e.maximum)&&(yield`${n} <= ${e.maximum}`),k(e.minimum)&&(yield`${n} >= ${e.minimum}`),k(e.multipleOf)&&(yield`(${n} % ${e.multipleOf}) === 0`)}function*ne(e,n,r){yield Xm.IsObjectLike(r),k(e.minProperties)&&(yield`Object.getOwnPropertyNames(${r}).length >= ${e.minProperties}`),k(e.maxProperties)&&(yield`Object.getOwnPropertyNames(${r}).length <= ${e.maxProperties}`);let i=Object.getOwnPropertyNames(e.properties);for(let a of i){let i=Gm.Encode(r,a),o=e.properties[a];if(e.required&&e.required.includes(a))yield*b(o,n,i),(Ps(o)||t(o))&&(yield`('${a}' in ${r})`);else{let e=x(o,n,i);yield Xm.IsExactOptionalProperty(r,a,e)}}if(e.additionalProperties===!1&&(e.required&&e.required.length===i.length?yield`Object.getOwnPropertyNames(${r}).length === ${i.length}`:yield`Object.getOwnPropertyNames(${r}).every(key => ${`[${i.map(e=>`'${e}'`).join(`, `)}]`}.includes(key))`),typeof e.additionalProperties==`object`){let t=x(e.additionalProperties,n,`${r}[key]`);yield`(Object.getOwnPropertyNames(${r}).every(key => ${`[${i.map(e=>`'${e}'`).join(`, `)}]`}.includes(key) || ${t}))`}}function*re(e,t,n){yield`${n} instanceof Promise`}function*v(e,t,n){yield Xm.IsRecordLike(n),k(e.minProperties)&&(yield`Object.getOwnPropertyNames(${n}).length >= ${e.minProperties}`),k(e.maxProperties)&&(yield`Object.getOwnPropertyNames(${n}).length <= ${e.maxProperties}`);let[r,i]=Object.entries(e.patternProperties)[0];yield`(Object.entries(${n}).every(([key, value]) => ${`(${C(`${new RegExp(r)}`)}.test(key) ? ${x(i,t,`value`)} : ${R(e.additionalProperties)?x(e.additionalProperties,t,n):e.additionalProperties===!1?`false`:`true`})`}))`}function*ie(e,t,n){let r=Pu(e,t);if(ge.functions.has(e.$ref))return yield`${S(e.$ref)}(${n})`;yield*b(r,t,n)}function*ae(e,t,n){let r=C(`${new RegExp(e.source,e.flags)};`);yield`(typeof ${n} === 'string')`,k(e.maxLength)&&(yield`${n}.length <= ${e.maxLength}`),k(e.minLength)&&(yield`${n}.length >= ${e.minLength}`),yield`${r}.test(${n})`}function*oe(e,t,n){yield`(typeof ${n} === 'string')`,k(e.maxLength)&&(yield`${n}.length <= ${e.maxLength}`),k(e.minLength)&&(yield`${n}.length >= ${e.minLength}`),e.pattern!==void 0&&(yield`${C(`${new RegExp(e.pattern)};`)}.test(${n})`),e.format!==void 0&&(yield`format('${e.format}', ${n})`)}function*se(e,t,n){yield`(typeof ${n} === 'symbol')`}function*ce(e,t,n){yield`(typeof ${n} === 'string')`,yield`${C(`${new RegExp(e.pattern)};`)}.test(${n})`}function*y(e,t,n){yield`${S(e.$ref)}(${n})`}function*le(e,t,n){if(yield`Array.isArray(${n})`,e.items===void 0)return yield`${n}.length === 0`;yield`(${n}.length === ${e.maxItems})`;for(let r=0;r<e.items.length;r++)yield`${x(e.items[r],t,`${n}[${r}]`)}`}function*ue(e,t,n){yield`${n} === undefined`}function*de(e,t,n){yield`(${e.anyOf.map(e=>x(e,t,n)).join(` || `)})`}function*fe(e,t,n){yield`${n} instanceof Uint8Array`,k(e.maxByteLength)&&(yield`(${n}.length <= ${e.maxByteLength})`),k(e.minByteLength)&&(yield`(${n}.length >= ${e.minByteLength})`)}function*pe(e,t,n){yield`true`}function*me(e,t,n){yield Xm.IsVoidLike(n)}function*he(e,t,n){let r=ge.instances.size;ge.instances.set(r,e),yield`kind('${e[j]}', ${r}, ${n})`}function*b(e,t,b,x=!0){let C=Be(e.$id)?[...t,e]:t,T=e;if(x&&Be(e.$id)){let n=S(e.$id);if(ge.functions.has(n))return yield`${n}(${b})`;{ge.functions.set(n,`<deferred>`);let r=w(n,e,t,`value`,!1);return ge.functions.set(n,r),yield`${n}(${b})`}}switch(T[j]){case`Any`:return yield*n(T,C,b);case`Argument`:return yield*r(T,C,b);case`Array`:return yield*i(T,C,b);case`AsyncIterator`:return yield*a(T,C,b);case`BigInt`:return yield*o(T,C,b);case`Boolean`:return yield*s(T,C,b);case`Constructor`:return yield*c(T,C,b);case`Date`:return yield*l(T,C,b);case`Function`:return yield*u(T,C,b);case`Import`:return yield*d(T,C,b);case`Integer`:return yield*f(T,C,b);case`Intersect`:return yield*p(T,C,b);case`Iterator`:return yield*m(T,C,b);case`Literal`:return yield*h(T,C,b);case`Never`:return yield*g(T,C,b);case`Not`:return yield*_(T,C,b);case`Null`:return yield*ee(T,C,b);case`Number`:return yield*te(T,C,b);case`Object`:return yield*ne(T,C,b);case`Promise`:return yield*re(T,C,b);case`Record`:return yield*v(T,C,b);case`Ref`:return yield*ie(T,C,b);case`RegExp`:return yield*ae(T,C,b);case`String`:return yield*oe(T,C,b);case`Symbol`:return yield*se(T,C,b);case`TemplateLiteral`:return yield*ce(T,C,b);case`This`:return yield*y(T,C,b);case`Tuple`:return yield*le(T,C,b);case`Undefined`:return yield*ue(T,C,b);case`Union`:return yield*de(T,C,b);case`Uint8Array`:return yield*fe(T,C,b);case`Unknown`:return yield*pe(T,C,b);case`Void`:return yield*me(T,C,b);default:if(!Qn(T[j]))throw new Jm(e);return yield*he(T,C,b)}}let ge={language:`javascript`,functions:new Map,variables:new Map,instances:new Map};function x(e,t,n,r=!0){return`(${[...b(e,t,n,r)].join(` && `)})`}function S(e){return`check_${Km.Encode(e)}`}function C(e){let t=`local_${ge.variables.size}`;return ge.variables.set(t,`const ${t} = ${e}`),t}function w(e,t,n,r,i=!0){let[a,o]=[`
`,e=>``.padStart(e,` `)],s=T(`value`,`any`),c=_e(`boolean`),l=[...b(t,n,r,i)].map(e=>`${o(4)}${e}`).join(` &&${a}`);return`function ${e}(${s})${c} {${a}${o(2)}return (${a}${l}${a}${o(2)})\n}`}function T(e,t){return`${e}${ge.language===`typescript`?`: ${t}`:``}`}function _e(e){return ge.language===`typescript`?`: ${e}`:``}function E(e,t,n){let r=w(`check`,e,t,`value`),i=T(`value`,`any`),a=_e(`boolean`),o=[...ge.functions.values()],s=[...ge.variables.values()],c=Be(e.$id)?`return function check(${i})${a} {\n  return ${S(e.$id)}(value)\n}`:`return ${r}`;return[...s,...o,c].join(`
`)}function ve(...e){let t={language:`javascript`},[n,r,i]=e.length===2&&Pe(e[1])?[e[0],e[1],t]:e.length===2&&!Pe(e[1])?[e[0],[],e[1]]:e.length===3?[e[0],e[1],e[2]]:e.length===1?[e[0],[],t]:[null,[],t];if(ge.language=i.language,ge.variables.clear(),ge.functions.clear(),ge.instances.clear(),!R(n))throw new Ym(n);for(let e of r)if(!R(e))throw new Ym(e);return E(n,r,i)}e.Code=ve;function ye(e,t=[]){let n=ve(e,t,{language:`javascript`}),r=globalThis.Function(`kind`,`format`,`hash`,n),i=new Map(ge.instances);function a(e,t,n){return!Qn(e)||!i.has(t)?!1:er(e)(i.get(t),n)}function o(e,t){return Jn(e)?Xn(e)(t):!1}function s(e){return id(e)}return new Um(e,t,r(a,o,s),n)}e.Compile=ye})(Zm||={});var Qm=typeof Bun<`u`,$m={aac:`audio/aac`,abw:`application/x-abiword`,ai:`application/postscript`,arc:`application/octet-stream`,avi:`video/x-msvideo`,azw:`application/vnd.amazon.ebook`,bin:`application/octet-stream`,bz:`application/x-bzip`,bz2:`application/x-bzip2`,csh:`application/x-csh`,css:`text/css`,csv:`text/csv`,doc:`application/msword`,dll:`application/octet-stream`,eot:`application/vnd.ms-fontobject`,epub:`application/epub+zip`,gif:`image/gif`,htm:`text/html`,html:`text/html`,ico:`image/x-icon`,ics:`text/calendar`,jar:`application/java-archive`,jpeg:`image/jpeg`,jpg:`image/jpeg`,js:`application/javascript`,json:`application/json`,mid:`audio/midi`,midi:`audio/midi`,mp2:`audio/mpeg`,mp3:`audio/mpeg`,mp4:`video/mp4`,mpa:`video/mpeg`,mpe:`video/mpeg`,mpeg:`video/mpeg`,mpkg:`application/vnd.apple.installer+xml`,odp:`application/vnd.oasis.opendocument.presentation`,ods:`application/vnd.oasis.opendocument.spreadsheet`,odt:`application/vnd.oasis.opendocument.text`,oga:`audio/ogg`,ogv:`video/ogg`,ogx:`application/ogg`,otf:`font/otf`,png:`image/png`,pdf:`application/pdf`,ppt:`application/vnd.ms-powerpoint`,rar:`application/x-rar-compressed`,rtf:`application/rtf`,sh:`application/x-sh`,svg:`image/svg+xml`,swf:`application/x-shockwave-flash`,tar:`application/x-tar`,tif:`image/tiff`,tiff:`image/tiff`,ts:`application/typescript`,ttf:`font/ttf`,txt:`text/plain`,vsd:`application/vnd.visio`,wav:`audio/x-wav`,weba:`audio/webm`,webm:`video/webm`,webp:`image/webp`,woff:`font/woff`,woff2:`font/woff2`,xhtml:`application/xhtml+xml`,xls:`application/vnd.ms-excel`,xlsx:`application/vnd.ms-excel`,xlsx_OLD:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`,xml:`application/xml`,xul:`application/vnd.mozilla.xul+xml`,zip:`application/zip`,"3gp":`video/3gpp`,"3gp_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp`,"3gp2":`video/3gpp2`,"3gp2_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp2`,"7z":`application/x-7z-compressed`},eh=e=>{let t=e.lastIndexOf(`.`);return t===-1?``:e.slice(t+1)},th,nh,rh=class{constructor(e){if(this.path=e,Qm)this.value=Bun.file(e);else{if(!th||!nh){if(typeof window<`u`){console.warn(`Browser environment does not support file`);return}let e=e=>console.warn(Error(`[elysia] \`file\` require \`fs${e?`.`+e:``}\` ${e?.includes(`.`)?`module `:``}which is not available in this environment`));if(typeof process>`u`||typeof process.getBuiltinModule!=`function`){e();return}let t=process.getBuiltinModule(`fs`);if(!t){e();return}if(typeof t.createReadStream!=`function`){e();return}if(typeof t.promises?.stat!=`function`){e();return}th=t.createReadStream,nh=t.promises.stat}this.value=th(e),this.stats=nh(e)}}get type(){return $m[eh(this.path)]||`application/octet-stream`}get length(){return Qm?this.value.size:this.stats?.then(e=>e.size)??0}},ih=`toJSON`in new Headers,ah=(e,t)=>{let n=new URL(e);return n.pathname=t,n.toString()},oh=e=>typeof e==`function`&&/^\s*class\s+/.test(e.toString())||e.toString&&e.toString().startsWith(`[object `)&&e.toString()!==`[object Object]`||Y(Object.getPrototypeOf(e)),sh=e=>e&&typeof e==`object`&&!Array.isArray(e),ch=(e,t,n)=>{let r=n?.skipKeys,i=n?.override??!0,a=n?.mergeArray??!1,o=n?.seen??new WeakSet;if(!sh(e)||!sh(t)||o.has(t))return e;o.add(t);for(let[n,s]of Object.entries(t))if(!(r?.includes(n)||[`__proto__`,`constructor`,`prototype`].includes(n))){if(a&&Array.isArray(s)){e[n]=Array.isArray(e[n])?[...e[n],...s]:e[n]=s;continue}if(!sh(s)||!(n in e)||oh(s)){if((i||!(n in e))&&!Object.isFrozen(e))try{e[n]=s}catch{}continue}if(!Object.isFrozen(e[n]))try{e[n]=ch(e[n],s,{skipKeys:r,override:i,mergeArray:a,seen:o})}catch{}}return o.delete(t),e},lh=(e,t)=>{let n=ch(Object.assign({},e),t,{skipKeys:[`properties`],mergeArray:!1});return n.properties&&delete n.properties,n},J=(e,t)=>{if(!t)return e;let n=[],r=[];if(e){Array.isArray(e)||(e=[e]);for(let t of e)n.push(t),t.checksum&&r.push(t.checksum)}if(t){Array.isArray(t)||(t=[t]);for(let e of t)r.includes(e.checksum)||n.push(e)}return n};[`start`,`request`,`parse`,`transform`,`resolve`,`beforeHandle`,`afterHandle`,`mapResponse`,`afterResponse`,`trace`,`error`,`stop`,`body`,`headers`,`params`,`query`,`response`,`type`,`detail`].reduce((e,t)=>(e[t]=!0,e),{});var uh=e=>typeof e==`object`&&Object.keys(e).every(e=>!isNaN(+e)),dh=(e,t)=>uh(e)&&uh(t)?Object.assign({},e,t):e&&!uh(e)&&uh(t)?Object.assign({200:e},t):t??e,fh=(e,t)=>!e&&!t?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:{body:t?.body??e?.body,headers:t?.headers??e?.headers,params:t?.params??e?.params,query:t?.query??e?.query,cookie:t?.cookie??e?.cookie,response:dh(e?.response,t?.response)},ph=(e,t)=>{if(!t)return e??{};if(!e)return t??{};if(!Object.values(t).find(e=>e!=null))return{...e};let n={...e,...t,body:t.body??e.body,headers:t.headers??e.headers,params:t.params??e.params,query:t.query??e.query,cookie:t.cookie??e.cookie,response:dh(e.response,t.response),type:e.type||t.type,detail:ch(t.detail??{},e.detail??{}),parse:J(e.parse,t.parse),transform:J(e.transform,t.transform),beforeHandle:J(J(Mh(e.resolve,`resolve`),e.beforeHandle),J(Mh(t.resolve,`resolve`),t.beforeHandle)),afterHandle:J(e.afterHandle,t.afterHandle),mapResponse:J(e.mapResponse,t.mapResponse),afterResponse:J(e.afterResponse,t.afterResponse),trace:J(e.trace,t.trace),error:J(e.error,t.error),standaloneSchema:e.standaloneSchema||t.standaloneSchema?e.standaloneSchema&&!t.standaloneSchema?e.standaloneSchema:t.standaloneSchema&&!e.standaloneSchema?t.standaloneSchema:[...e.standaloneSchema??[],...t.standaloneSchema??[]]:void 0};return n.resolve&&delete n.resolve,n},mh=e=>{e.parse&&!Array.isArray(e.parse)&&(e.parse=[e.parse]),e.transform&&!Array.isArray(e.transform)&&(e.transform=[e.transform]),e.afterHandle&&!Array.isArray(e.afterHandle)&&(e.afterHandle=[e.afterHandle]),e.mapResponse&&!Array.isArray(e.mapResponse)&&(e.mapResponse=[e.mapResponse]),e.afterResponse&&!Array.isArray(e.afterResponse)&&(e.afterResponse=[e.afterResponse]),e.trace&&!Array.isArray(e.trace)&&(e.trace=[e.trace]),e.error&&!Array.isArray(e.error)&&(e.error=[e.error]);let t=[];return e.resolve&&(t=Mh(Array.isArray(e.resolve)?e.resolve:[e.resolve],`resolve`),delete e.resolve),e.beforeHandle&&(t=t.length?t.concat(Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]):Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]),t.length&&(e.beforeHandle=t),e};typeof Bun<`u`&&Bun.hash;var hh=typeof setImmediate==`function`,gh=e=>{let t=9;for(let n=0;n<e.length;)t=Math.imul(t^e.charCodeAt(n++),9**9);return t^=t>>>9},_h=(e,t)=>{if(!t)return;if(!Array.isArray(t)){let n=t;return e&&!n.checksum&&(n.checksum=e),n.scope===`scoped`&&(n.scope=`local`),n}let n=[...t];for(let t of n)e&&!t.checksum&&(t.checksum=e),t.scope===`scoped`&&(t.scope=`local`);return n},vh=(e,t,n)=>({start:J(e.start,_h(n,t?.start)),request:J(e.request,_h(n,t?.request)),parse:J(e.parse,_h(n,t?.parse)),transform:J(e.transform,_h(n,t?.transform)),beforeHandle:J(J(Mh(e.resolve,`resolve`),e.beforeHandle),_h(n,J(Mh(t?.resolve,`resolve`),t?.beforeHandle))),afterHandle:J(e.afterHandle,_h(n,t?.afterHandle)),mapResponse:J(e.mapResponse,_h(n,t?.mapResponse)),afterResponse:J(e.afterResponse,_h(n,t?.afterResponse)),trace:J(e.trace,_h(n,t?.trace)),error:J(e.error,_h(n,t?.error)),stop:J(e.stop,_h(n,t?.stop))}),yh=(e,t,{skipIfHasType:n=!1})=>{if(!e)return e;if(!Array.isArray(e))return n?e.scope??=t:e.scope=t,e;for(let r of e)n?r.scope??=t:r.scope=t;return e},bh=e=>{if(!e)return e;if(!Array.isArray(e))switch(e.scope){case`global`:case`scoped`:return{...e};default:return{fn:e}}let t=[];for(let n of e)switch(n.scope){case`global`:case`scoped`:t.push({...n});break}return t},xh=e=>({...e,type:e?.type,detail:e?.detail,parse:bh(e?.parse),transform:bh(e?.transform),beforeHandle:bh(e?.beforeHandle),afterHandle:bh(e?.afterHandle),mapResponse:bh(e?.mapResponse),afterResponse:bh(e?.afterResponse),error:bh(e?.error),trace:bh(e?.trace)}),Sh={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Enhance Your Calm":420,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},Ch=Object.fromEntries(Object.entries(Sh).map(([e,t])=>[t,e]));function wh(e){let t=e;for(;t.endsWith(`=`);)t=t.slice(0,-1);return t}var Th=new TextEncoder,Eh=async(e,t)=>{if(typeof e==`object`?e=JSON.stringify(e):typeof e!=`string`&&(e+=``),t===null)throw TypeError(`Secret key must be provided.`);let n=await crypto.subtle.importKey(`raw`,Th.encode(t),{name:`HMAC`,hash:`SHA-256`},!1,[`sign`]),r=await crypto.subtle.sign(`HMAC`,n,Th.encode(e));return e+`.`+wh(Buffer.from(r).toString(`base64`))},Dh=async(e,t)=>{if(typeof e!=`string`)throw TypeError(`Signed cookie string must be provided.`);if(t===null)throw TypeError(`Secret key must be provided.`);let n=e.slice(0,e.lastIndexOf(`.`));return await Eh(n,t)===e?n:!1},Oh=(e,t,n)=>{if(!e.standaloneValidator?.length||!Array.isArray(e.standaloneValidator)){e.standaloneValidator=[{[t]:n}];return}let r=e.standaloneValidator[e.standaloneValidator.length-1];t in r?e.standaloneValidator.push({[t]:n}):r[t]=n},kh=e=>{if(typeof e==`number`)return e;if(e.length<16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)?null:t}if(e.length===16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)||t.toString()!==e?null:t}return null},Ah=e=>kh(e)!==null,jh=class{constructor(e=console.error,t=()=>{}){this.onError=e,this.onFinally=t,this.root=null,this.promises=[]}get size(){return this.promises.length}add(e){return this.promises.push(e),this.root||=this.drain(),this.promises.length===1&&this.then(this.onFinally),e}async drain(){for(;this.promises.length>0;){try{await this.promises[0]}catch(e){this.onError(e)}this.promises.shift()}this.root=null}then(e,t){return(this.root??Promise.resolve()).then(e,t)}},Mh=(e,t)=>{if(!e)return e;if(!Array.isArray(e)){if(typeof e==`function`||typeof e==`string`)return t?{fn:e,subType:t}:{fn:e};if(`fn`in e)return e}let n=[];for(let r of e)typeof r==`function`||typeof r==`string`?n.push(t?{fn:r,subType:t}:{fn:r}):`fn`in r&&n.push(r);return n},Nh=e=>(e.start&&=Mh(e.start),e.request&&=Mh(e.request),e.parse&&=Mh(e.parse),e.transform&&=Mh(e.transform),e.beforeHandle&&=Mh(e.beforeHandle),e.afterHandle&&=Mh(e.afterHandle),e.mapResponse&&=Mh(e.mapResponse),e.afterResponse&&=Mh(e.afterResponse),e.trace&&=Mh(e.trace),e.error&&=Mh(e.error),e.stop&&=Mh(e.stop),e),Ph=e=>{let t=Object.create(null);return e.start?.map&&(t.start=e.start.map(e=>e.fn)),e.request?.map&&(t.request=e.request.map(e=>e.fn)),e.parse?.map&&(t.parse=e.parse.map(e=>e.fn)),e.transform?.map&&(t.transform=e.transform.map(e=>e.fn)),e.beforeHandle?.map&&(t.beforeHandle=e.beforeHandle.map(e=>e.fn)),e.afterHandle?.map&&(t.afterHandle=e.afterHandle.map(e=>e.fn)),e.mapResponse?.map&&(t.mapResponse=e.mapResponse.map(e=>e.fn)),e.afterResponse?.map&&(t.afterResponse=e.afterResponse.map(e=>e.fn)),e.error?.map&&(t.error=e.error.map(e=>e.fn)),e.stop?.map&&(t.stop=e.stop.map(e=>e.fn)),e.trace?.map?t.trace=e.trace.map(e=>e.fn):t.trace=[],t},Fh=e=>({body:e.body,cookie:e.cookie,headers:e.headers,query:e.query,set:e.set,server:e.server,path:e.path,route:e.route,url:e.url}),Ih=(e,t=302)=>Response.redirect(e,t),Lh=Symbol(`ElysiaFormData`),Rh=Symbol(`ElysiaRequestId`),zh=e=>{let t=new FormData;if(t[Lh]={},e)for(let[n,r]of Object.entries(e)){if(Array.isArray(r)){t[Lh][n]=[];for(let e of r)r instanceof File?t.append(n,r,r.name):r instanceof rh?t.append(n,r.value,r.value?.name):t.append(n,r),t[Lh][n].push(r);continue}r instanceof File?t.append(n,r,r.name):r instanceof rh?t.append(n,r.value,r.value?.name):t.append(n,r),t[Lh][n]=r}return t},Bh=typeof crypto>`u`?()=>{let e=``;for(let t=0;t<16;t++)e+=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789`.charAt(Math.floor(Math.random()*62));return e}:()=>{let e=crypto.randomUUID();return e.slice(0,8)+e.slice(24,32)},Vh=e=>{if(!e.length)return[];let t=[];for(let n=0;n<e.length;n++){let r=e[n];r.checksum&&(t.includes(r.checksum)&&(e.splice(n,1),n--),t.push(r.checksum))}return e},Hh=(e,t=`scoped`)=>{if(e){if(t===`scoped`){for(let t of e)`scope`in t&&t.scope===`local`&&(t.scope=`scoped`);return}for(let t of e)`scope`in t&&(t.scope=`global`)}},Uh=e=>e.charCodeAt(e.length-1)===47?e.slice(0,e.length-1):e+`/`,Y=e=>{if(!e)return!1;for(let t in e)return!0;return!1},Wh=(e,{dynamic:t=!1}={})=>{let n=encodeURIComponent(e).replace(/%2F/g,`/`);return t&&(n=n.replace(/%3A/g,`:`).replace(/%3F/g,`?`)),n},Gh=!!(typeof Bun>`u`||Bun.semver?.satisfies?.(Bun.version,`>=1.2.14`));async function Kh(e){if(e.bodyUsed||!e.body)return 0;let t=0,n=e.body.getReader();for(;;){let{done:e,value:r}=await n.read();if(e)break;t+=r.byteLength}return t}var qh={headers:!0,cookie:!0,query:!0,params:!0,body:!0,response:!0},Jh=typeof Bun<`u`?Bun.env:typeof process<`u`?{}:void 0,Yh=Symbol(`ElysiaErrorCode`),Xh=(Jh?.NODE_ENV??Jh?.ENV)===`production`,Zh={101:void 0,204:void 0,205:void 0,304:void 0,307:void 0,308:void 0},Qh=class{constructor(e,t){let n=t??(e in Ch?Ch[e]:e);this.code=Sh[e]??e,e in Zh?this.response=void 0:this.response=n}},$h=(e,t)=>new Qh(e,t),eg=class extends Error{constructor(e){super(e??`NOT_FOUND`),this.code=`NOT_FOUND`,this.status=404}},tg=class extends Error{constructor(e){super(`Bad Request`,{cause:e}),this.code=`PARSE`,this.status=400}},ng=class extends Error{constructor(e,t){super(t??`"${e}" has invalid cookie signature`),this.key=e,this.code=`INVALID_COOKIE_SIGNATURE`,this.status=400}},rg=e=>{if(!e)return{summary:void 0};let{message:t,path:n,value:r,type:i}=e;Array.isArray(n)&&(n=n[0]);let a=typeof n==`string`?n.slice(1).replaceAll(`/`,`.`):`unknown`,o=n===``;switch(i){case 42:return{...e,summary:o?`Value should not be provided`:`Property '${a}' should not be provided`};case 45:return{...e,summary:o?`Value is missing`:`Property '${a}' is missing`};case 50:let n=t.indexOf(`'`),i=t.slice(n+1,t.indexOf(`'`,n+1));return{...e,summary:o?`Value should be an email`:`Property '${a}' should be ${i}`};case 54:return{...e,summary:`${t.slice(0,9).trim()} property '${a}' to be ${t.slice(8).trim()} but found: ${r}`};case 62:let s=e.schema.anyOf.map(e=>`'${e?.format??e.type}'`).join(`, `);return{...e,summary:o?`Value should be one of ${s}`:`Property '${a}' should be one of: ${s}`};default:return{summary:t,...e}}},ig=class e extends Error{constructor(t,n,r=`"${t}" has invalid file type`){super(r),this.property=t,this.expected=n,this.message=r,this.code=`INVALID_FILE_TYPE`,this.status=422,Object.setPrototypeOf(this,e.prototype)}toResponse(e){return Xh?new Response(JSON.stringify({type:`validation`,on:`body`}),{status:422,headers:{...e,"content-type":`application/json`}}):new Response(JSON.stringify({type:`validation`,on:`body`,summary:`Invalid file type`,message:this.message,property:this.property,expected:this.expected}),{status:422,headers:{...e,"content-type":`application/json`}})}},X=class e extends Error{constructor(t,n,r,i=!1,a){let o=``,s,c,l;if(n?.provider===`standard`||`~standard`in n||n.schema&&`~standard`in n.schema){let e=(`~standard`in n?n:n.schema)[`~standard`];s=(a??e.validate(r).issues)?.[0],o=Xh?JSON.stringify({type:`validation`,on:t,found:r}):JSON.stringify({type:`validation`,on:t,property:s.path?.[0]||`root`,message:s?.message,summary:s?.problem,expected:c,found:r,errors:a},null,2),l=s?.message}else{r&&typeof r==`object`&&r instanceof Qh&&(r=r.response),s=a?.First()??(`Errors`in n?n.Errors(r).First():Of(n,r).First());let e=s?.path||`root`,u=n?.schema??n;if(!Xh&&!i)try{c=xp(u)}catch(e){c={type:`Could not create expected value`,message:e?.message,error:e}}l=s?.schema?.message||s?.schema?.error!==void 0?typeof s.schema.error==`function`?s.schema.error(Xh&&!i?{type:`validation`,on:t,found:r}:{type:`validation`,on:t,value:r,property:e,message:s?.message,summary:rg(s).summary,found:r,expected:c,errors:`Errors`in n?[...n.Errors(r)].map(rg):[...Of(n,r)].map(rg)},n):s.schema.error:void 0,o=l===void 0?Xh&&!i?JSON.stringify({type:`validation`,on:t,found:r}):JSON.stringify({type:`validation`,on:t,property:e,message:s?.message,summary:rg(s).summary,expected:c,found:r,errors:`Errors`in n?[...n.Errors(r)].map(rg):[...Of(n,r)].map(rg)},null,2):typeof l==`object`?JSON.stringify(l):l+``}super(o),this.type=t,this.validator=n,this.value=r,this.allowUnsafeValidationDetails=i,this.code=`VALIDATION`,this.status=422,this.valueError=s,this.expected=c,this.customError=l,Object.setPrototypeOf(this,e.prototype)}get messageValue(){return this.valueError}get all(){return this.validator?.provider===`standard`||`~standard`in this.validator||`schema`in this.validator&&this.validator.schema&&`~standard`in this.validator.schema?(`~standard`in this.validator?this.validator:this.validator.schema)[`~standard`].validate(this.value).issues?.map(e=>({summary:e.message,path:e.path?.join(`.`)||`root`,message:e.message,value:this.value}))||[]:`Errors`in this.validator?[...this.validator.Errors(this.value)].map(rg):[...Of(this.validator,this.value)].map(rg)}static simplifyModel(e){let t=`schema`in e?e.schema:e;try{return xp(t)}catch{return t}}get model(){return`~standard`in this.validator?this.validator:e.simplifyModel(this.validator)}toResponse(e){return new Response(this.message,{status:400,headers:{...e,"content-type":`application/json`}})}detail(e,t=this.allowUnsafeValidationDetails){if(!this.customError)return this.message;let n=this.value,r=this.expected,i=this.all;return Xh&&!t?{type:`validation`,on:this.type,found:n,message:e}:{type:`validation`,on:this.type,property:this.valueError?.path||`root`,message:e,summary:rg(this.valueError).summary,found:n,expected:r,errors:i}}};g();var ag=(e,t)=>{try{return JSON.parse(e)}catch{throw new X(`property`,t,e)}};function og(e,t){return Qn(e)||$n(e,t),(t={})=>wu({...t,[j]:e})}var sg=e=>{try{let t=Zm.Compile(e);return t.Create=()=>xp(e),t.Error=n=>new X(`property`,e,n,t.Errors(n)),t}catch{return{Check:t=>Hd(e,t),CheckThrow:t=>{if(!Hd(e,t))throw new X(`property`,e,t,Of(e,t))},Decode:t=>Dm(e,t),Create:()=>xp(e),Error:t=>new X(`property`,e,t,Of(e,t))}}},cg=e=>{if(typeof e==`string`)switch(e.slice(-1)){case`k`:return e.slice(0,e.length-1)*1024;case`m`:return e.slice(0,e.length-1)*1048576;default:return+e}return e},lg=(e,t)=>e.startsWith(t)?!0:t.charCodeAt(t.length-1)===42&&t.charCodeAt(t.length-2)===47&&e.startsWith(t.slice(0,-1)),ug=!1,dg=()=>{ug||=(console.warn(`[Elysia] Attempt to validate file type without 'file-type'. This may lead to security risks. We recommend installing 'file-type' to properly validate file extension.`),!0)},fg=async()=>_(()=>import(`./core.BmyAj8QY.js`),__vite__mapDeps([0,1])).then(e=>(pg=e.fileTypeFromBlob,pg)).catch(dg),pg,mg=e=>pg?pg(e):fg().then(t=>{if(t)return t(e)}),hg=async(e,t,n=e?.name??``)=>{if(Array.isArray(e))return await Promise.all(e.map(e=>hg(e,t,n))),!0;if(!e)return!1;let r=await mg(e);if(!r||typeof t==`string`&&!lg(r.mime,t))throw new ig(n,t);for(let e=0;e<t.length;e++)if(lg(r.mime,t[e]))return!0;throw new ig(n,t)},gg=(e,t)=>{if(t instanceof rh)return!0;if(!(t instanceof Blob)||e.minSize&&t.size<cg(e.minSize)||e.maxSize&&t.size>cg(e.maxSize))return!1;if(e.extension){if(typeof e.extension==`string`)return lg(t.type,e.extension);for(let n=0;n<e.extension.length;n++)if(lg(t.type,e.extension[n]))return!0;return!1}return!0},_g=e=>t=>({...t,message:e}),vg={date:Sg,time:wg(!0),"date-time":Dg(!0),"iso-time":wg(!1),"iso-date-time":Dg(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:Ag,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:zg,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:Mg,int32:{type:`number`,validate:Fg},int64:{type:`number`,validate:Ig},float:{type:`number`,validate:Lg},double:{type:`number`,validate:Lg},password:!0,binary:!0};function yg(e){return e%4==0&&(e%100!=0||e%400==0)}var bg=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,xg=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Sg(e){let t=bg.exec(e);if(!t)return!1;let n=+t[1],r=+t[2],i=+t[3];return r>=1&&r<=12&&i>=1&&i<=(r===2&&yg(n)?29:xg[r])}var Cg=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function wg(e){return function(t){let n=Cg.exec(t);if(!n)return!1;let r=+n[1],i=+n[2],a=+n[3],o=n[4],s=n[5]===`-`?-1:1,c=+(n[6]||0),l=+(n[7]||0);if(c>23||l>59||e&&!o)return!1;if(r<=23&&i<=59&&a<60)return!0;let u=i-l*s,d=r-c*s-(u<0?1:0);return(d===23||d===-1)&&(u===59||u===-1)&&a<61}}var Tg=e=>e.charCodeAt(e.length-6)===32?e.slice(0,-6)+`+`+e.slice(-5):e,Eg=/t|\s/i;function Dg(e){let t=wg(e);return function(e){let n=e.split(Eg);return n.length===2&&Sg(n[0])&&t(n[1])}}var Og=/\/|:/,kg=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Ag(e){return Og.test(e)&&kg.test(e)}var jg=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function Mg(e){return jg.lastIndex=0,jg.test(e)}var Ng=-(2**31),Pg=2**31-1;function Fg(e){return Number.isInteger(e)&&e<=Pg&&e>=Ng}function Ig(e){return Number.isInteger(e)}function Lg(){return!0}var Rg=/[^\\]\\Z/;function zg(e){if(Rg.test(e))return!1;try{return new RegExp(e),!0}catch{return!1}}var Bg=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,Vg=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,Hg=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,Ug=vg.date,Wg=vg[`date-time`];Jn(`date`)||Yn(`date`,e=>{let t=Tg(e).replace(/"/g,``);if(Bg.test(t)||Vg.test(t)||Hg.test(t)||Ug(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1}),Jn(`date-time`)||Yn(`date-time`,e=>{let t=e.replace(/"/g,``);if(Bg.test(t)||Vg.test(t)||Hg.test(t)||Wg(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1}),Object.entries(vg).forEach(e=>{let[t,n]=e;Jn(t)||(n instanceof RegExp?Yn(t,e=>n.test(e)):typeof n==`function`&&Yn(t,n))}),Jn(`numeric`)||Yn(`numeric`,e=>!!e&&!isNaN(+e)),Jn(`integer`)||Yn(`integer`,e=>!!e&&Number.isInteger(+e)),Jn(`boolean`)||Yn(`boolean`,e=>e===`true`||e===`false`),Jn(`ObjectString`)||Yn(`ObjectString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}}),Jn(`ArrayString`)||Yn(`ArrayString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});var Z=Object.assign({},Eu);og(`UnionEnum`,(e,t)=>(typeof t==`number`||typeof t==`string`||t===null)&&e.enum.includes(t)),og(`ArrayBuffer`,(e,t)=>t instanceof ArrayBuffer);var Gg=og(`Files`,(e,t)=>{if(e.minItems&&e.minItems>1&&!Array.isArray(t))return!1;if(!Array.isArray(t))return gg(e,t);if(e.minItems&&t.length<e.minItems||e.maxItems&&t.length>e.maxItems)return!1;for(let n=0;n<t.length;n++)if(!gg(e,t[n]))return!1;return!0}),Kg=og(`ElysiaForm`,({compiler:e,...t},n)=>{if(!(n instanceof FormData))return!1;if(e){if(!(Lh in n))throw new X(`property`,t,n);if(!e.Check(n[Lh]))throw e.Error(n[Lh])}return!0}),qg={String:e=>Eu.String(e),Numeric:e=>{let t=sg(Eu.Number(e));return Z.Transform(Z.Union([Z.String({format:`numeric`,default:0}),Z.Number(e)],e)).Decode(n=>{let r=+n;if(isNaN(r))return n;if(e&&!t.Check(r))throw t.Error(r);return r}).Encode(e=>e)},NumericEnum(e,t){let n=sg(Eu.Enum(e,t));return Z.Transform(Z.Union([Z.String({format:`numeric`}),Z.Number()],t)).Decode(e=>{let t=+e;if(isNaN(t)||!n.Check(t))throw n.Error(t);return t}).Encode(e=>e)},Integer:e=>{let t=sg(Eu.Integer(e));return Z.Transform(Z.Union([Z.String({format:`integer`,default:0}),Eu.Integer(e)],e)).Decode(e=>{let n=+e;if(!t.Check(n))throw t.Error(n);return n}).Encode(e=>e)},Date:e=>{let t=Eu.Date(e),n=sg(t),r=e?.default?new Date(e.default):void 0;return Z.Transform(Z.Union([Eu.Date(e),Z.String({format:`date-time`,default:r?.toISOString()}),Z.String({format:`date`,default:r?.toISOString()}),Z.Number({default:r?.getTime()})],e)).Decode(e=>{if(typeof e==`number`){let t=new Date(e);if(!n.Check(t))throw n.Error(t);return t}if(e instanceof Date)return e;let r=new Date(Tg(e));if(!r||isNaN(r.getTime()))throw new X(`property`,t,r);if(!n.Check(r))throw n.Error(r);return r}).Encode(e=>{if(e instanceof Date)return e.toISOString();if(typeof e==`string`){if(isNaN(new Date(Tg(e)).getTime()))throw new X(`property`,t,e);return e}if(!n.Check(e))throw n.Error(e);return e})},BooleanString:e=>{let t=sg(Eu.Boolean(e));return Z.Transform(Z.Union([Z.Boolean(e),Z.String({format:`boolean`,default:!1})],e)).Decode(e=>{if(typeof e==`string`)return e===`true`;if(e!==void 0&&!t.Check(e))throw t.Error(e);return e}).Encode(e=>e)},ObjectString:(e,t)=>{let n=Z.Object(e,t),r=sg(n);return Z.Transform(Z.Union([Z.String({format:`ObjectString`,default:t?.default}),n],{elysiaMeta:`ObjectString`})).Decode(e=>{if(typeof e==`string`){if(e.charCodeAt(0)!==123)throw new X(`property`,n,e);if(!r.Check(e=ag(e,n)))throw r.Error(e);return r.Decode(e)}return e}).Encode(e=>{let t;if(typeof e==`string`&&(e=ag(t=e,n)),!r.Check(e))throw r.Error(e);return t??JSON.stringify(e)})},ArrayString:(e=Z.String(),t)=>{let n=Z.Array(e,t),r=sg(n),i=(e,t=!1)=>{if(e.charCodeAt(0)===91){if(!r.Check(e=ag(e,n)))throw r.Error(e);return r.Decode(e)}if(t)return e;throw new X(`property`,n,e)};return Z.Transform(Z.Union([Z.String({format:`ArrayString`,default:t?.default}),n],{elysiaMeta:`ArrayString`})).Decode(e=>{if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r==`string`){let e=i(r,!0);Array.isArray(e)?t=t.concat(e):t.push(e);continue}t.push(r)}return t}return typeof e==`string`?i(e):e}).Encode(e=>{let t;if(typeof e==`string`&&(e=ag(t=e,n)),!r.Check(e))throw new X(`property`,n,e);return t??JSON.stringify(e)})},ArrayQuery:(e=Z.String(),t)=>{let n=Z.Array(e,t),r=sg(n),i=e=>e.indexOf(`,`)===-1?[e]:r.Decode(e.split(`,`));return Z.Transform(Z.Union([Z.String({default:t?.default}),n],{elysiaMeta:`ArrayQuery`})).Decode(e=>{if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r==`string`){let e=i(r);Array.isArray(e)?t=t.concat(e):t.push(e);continue}t.push(r)}return t}return typeof e==`string`?i(e):e}).Encode(e=>{let t;if(typeof e==`string`&&(e=ag(t=e,n)),!r.Check(e))throw new X(`property`,n,e);return t??JSON.stringify(e)})},File:og(`File`,gg),Files:(e={})=>Z.Transform(Gg(e)).Decode(e=>Array.isArray(e)?e:[e]).Encode(e=>e),Nullable:(e,t)=>Z.Union([e,Z.Null()],{...t,nullable:!0}),MaybeEmpty:(e,t)=>Z.Union([e,Z.Null(),Z.Undefined()],t),Cookie:(e,{domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u,...d}={})=>{let f=Z.Object(e,d);return f.config={domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u},f},UnionEnum:(e,t={})=>{let n=e.every(e=>typeof e==`string`)?{type:`string`}:e.every(e=>typeof e==`number`)?{type:`number`}:e.every(e=>e===null)?{type:`null`}:{};if(e.some(e=>typeof e==`object`&&!!e))throw Error(`This type does not support objects or arrays`);return{default:e[0],...t,[j]:`UnionEnum`,...n,enum:e}},NoValidate:(e,t=!0)=>(e.noValidate=t,e),Form:(e,t={})=>{let n=Z.Object(e,{default:zh({}),...t}),r=sg(n);return Z.Union([n,Kg({compiler:r})])},ArrayBuffer(e={}){return{default:[1,2,3],...e,[j]:`ArrayBuffer`}},Uint8Array:e=>{let t=sg(Eu.Uint8Array(e));return Z.Transform(Z.Union([Z.ArrayBuffer(),Eu.Uint8Array(e)])).Decode(e=>{if(e instanceof ArrayBuffer){if(!t.Check(e=new Uint8Array(e)))throw t.Error(e);return e}return e}).Encode(e=>e)}};Z.BooleanString=qg.BooleanString,Z.ObjectString=qg.ObjectString,Z.ArrayString=qg.ArrayString,Z.ArrayQuery=qg.ArrayQuery,Z.Numeric=qg.Numeric,Z.NumericEnum=qg.NumericEnum,Z.Integer=qg.Integer,Z.File=e=>(e?.type&&fg(),qg.File({default:`File`,...e,extension:e?.type,type:`string`,format:`binary`})),Z.Files=e=>(e?.type&&fg(),qg.Files({...e,elysiaMeta:`Files`,default:`Files`,extension:e?.type,type:`array`,items:{...e,default:`Files`,type:`string`,format:`binary`}})),Z.Nullable=qg.Nullable,Z.MaybeEmpty=qg.MaybeEmpty,Z.Cookie=qg.Cookie,Z.Date=qg.Date,Z.UnionEnum=qg.UnionEnum,Z.NoValidate=qg.NoValidate,Z.Form=qg.Form,Z.ArrayBuffer=qg.ArrayBuffer,Z.Uint8Array=qg.Uint8Array;var Jg=ee(),Yg=e(Du(),1),Xg=e=>{let t=2166136261,n=e.length;for(let r=0;r<n;r++)t^=e.charCodeAt(r),t=Math.imul(t,16777619);return t>>>0},Zg=class{constructor(e,t,n={}){this.name=e,this.jar=t,this.initial=n}get cookie(){return this.jar[this.name]??this.initial}set cookie(e){this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]=e,this.valueHash=void 0}get setCookie(){return this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]}set setCookie(e){this.cookie=e}get value(){return this.cookie.value}set value(e){let t=this.cookie.value;if(t!==e){if(typeof t==`object`&&t&&typeof e==`object`&&e)try{let n=JSON.stringify(e),r=Xg(n);if(this.valueHash!==void 0&&this.valueHash!==r)this.valueHash=r;else{if(JSON.stringify(t)===n){this.valueHash=r;return}this.valueHash=r}}catch{}this.name in this.jar||(this.jar[this.name]={...this.initial}),this.jar[this.name].value=e}}get expires(){return this.cookie.expires}set expires(e){this.setCookie.expires=e}get maxAge(){return this.cookie.maxAge}set maxAge(e){this.setCookie.maxAge=e}get domain(){return this.cookie.domain}set domain(e){this.setCookie.domain=e}get path(){return this.cookie.path}set path(e){this.setCookie.path=e}get secure(){return this.cookie.secure}set secure(e){this.setCookie.secure=e}get httpOnly(){return this.cookie.httpOnly}set httpOnly(e){this.setCookie.httpOnly=e}get sameSite(){return this.cookie.sameSite}set sameSite(e){this.setCookie.sameSite=e}get priority(){return this.cookie.priority}set priority(e){this.setCookie.priority=e}get partitioned(){return this.cookie.partitioned}set partitioned(e){this.setCookie.partitioned=e}get secrets(){return this.cookie.secrets}set secrets(e){this.setCookie.secrets=e}update(e){return this.setCookie=Object.assign(this.cookie,typeof e==`function`?e(this.cookie):e),this}set(e){return this.setCookie=Object.assign({...this.initial,value:this.value},typeof e==`function`?e(this.cookie):e),this}remove(){if(this.value!==void 0)return this.set({expires:new Date(0),maxAge:0,value:``}),this}toString(){return typeof this.value==`object`?JSON.stringify(this.value):this.value?.toString()??``}},Qg=(e,t,n)=>(e.cookie||={},new Proxy(t,{get(r,i){return i in t?new Zg(i,e.cookie,Object.assign({},n??{},t[i])):new Zg(i,e.cookie,Object.assign({},n))}})),$g=async(e,t,{secrets:n,sign:r,...i}={})=>{if(!t)return Qg(e,{},i);let a=typeof n==`string`;r&&r!==!0&&!Array.isArray(r)&&(r=[r]);let o={},s=(0,Jg.parse)(t);for(let[e,t]of Object.entries(s)){if(t===void 0)continue;let i=(0,Yg.default)(t);if(i){let e=i.charCodeAt(0),t=i.charCodeAt(i.length-1);if(e===123&&t===125||e===91&&t===93)try{i=JSON.parse(i)}catch{}}if(r===!0||r?.includes(e)){if(!n)throw Error(`No secret is provided to cookie plugin`);if(a){let t=await Dh(i,n);if(t===!1)throw new ng(e);i=t}else{let t=!1;for(let e=0;e<n.length;e++){let r=await Dh(i,n[e]);if(r!==!1){t=!0,i=r;break}}if(!t)throw new ng(e)}}o[e]={value:i}}return Qg(e,o,i)},e_=e=>{if(!e||!Y(e))return;let t=[];for(let[n,r]of Object.entries(e)){if(!n||!r)continue;let e=r.value;e!=null&&t.push((0,Jg.serialize)(n,typeof e==`object`?JSON.stringify(e):e+``,r))}if(t.length!==0)return t.length===1?t[0]:t},t_=Qm?Bun.env:{},Q=(e,t)=>{if(!Qm&&e instanceof Promise)return e.then(e=>Q(e,t));let n=e.size,r=t&&(t.status===206||t.status===304||t.status===412||t.status===416),i=r?{}:{"accept-ranges":`bytes`,"content-range":n?`bytes 0-${n-1}/${n}`:void 0};if(!t&&!n)return new Response(e);if(!t)return new Response(e,{headers:i});if(t.headers instanceof Headers){for(let e of Object.keys(i))e in t.headers&&t.headers.append(e,i[e]);return r&&(t.headers.delete(`content-length`),t.headers.delete(`accept-ranges`)),new Response(e,t)}return Y(t.headers)?new Response(e,{status:t.status,headers:Object.assign(i,t.headers)}):new Response(e,{status:t.status,headers:i})},n_=(e,t)=>{if(!e)return e;e.delete(`set-cookie`);for(let n=0;n<t.length;n++){let r=t[n].indexOf(`=`);e.append(`set-cookie`,`${t[n].slice(0,r)}=${t[n].slice(r+1)||``}`)}return e},r_=(e,t)=>{if(t?.headers){if(e)if(ih)Object.assign(t.headers,e.headers.toJSON());else for(let[n,r]of e.headers.entries())n in t.headers&&(t.headers[n]=r);return t.status===200&&(t.status=e.status),t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t}if(!e)return{headers:{},status:t?.status??200};if(ih)return t={headers:e.headers.toJSON(),status:t?.status??200},t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t;t={headers:{},status:t?.status??200};for(let[n,r]of e.headers.entries())n!==`content-encoding`&&n in t.headers&&(t.headers[n]=r);return t},i_=t_.ELYSIA_RAPID_STREAM===`true`,a_=({mapResponse:e,mapCompactResponse:t})=>async(n,r,i)=>{let a=n.next?.();if(r&&s_(r),a instanceof Promise&&(a=await a),a?.value instanceof ReadableStream)n=a.value;else if(a&&(typeof a?.done>`u`||a?.done))return r?e(a.value,r,i):t(a.value,i);let o=a?.value?.sse??n?.sse??r?.headers[`content-type`]?.startsWith(`text/event-stream`),s=o?e=>`data: ${e}

`:e=>e,c=o?`text/event-stream`:a?.value&&typeof a?.value==`object`?`application/json`:`text/plain`;r?.headers?(r.headers[`transfer-encoding`]||(r.headers[`transfer-encoding`]=`chunked`),r.headers[`content-type`]||(r.headers[`content-type`]=c),r.headers[`cache-control`]||(r.headers[`cache-control`]=`no-cache`)):r={status:200,headers:{"content-type":c,"transfer-encoding":`chunked`,"cache-control":`no-cache`,connection:`keep-alive`}};let l=i?.headers.has(`Origin`);return new Response(new ReadableStream({async start(e){let t=!1;if(i?.signal?.addEventListener(`abort`,()=>{t=!0;try{e.close()}catch{}}),!(!a||a.value instanceof ReadableStream)&&a.value!==void 0&&a.value!==null)if(a.value.toSSE)e.enqueue(a.value.toSSE());else if(typeof a.value==`object`)try{e.enqueue(s(JSON.stringify(a.value)))}catch{e.enqueue(s(a.value.toString()))}else e.enqueue(s(a.value.toString()));try{for await(let r of n){if(t)break;if(r!=null)if(r.toSSE)e.enqueue(r.toSSE());else{if(typeof r==`object`)try{e.enqueue(s(JSON.stringify(r)))}catch{e.enqueue(s(r.toString()))}else e.enqueue(s(r.toString()));!i_&&l&&!o&&await new Promise(e=>setTimeout(()=>e(),0))}}}catch(e){console.warn(e)}try{e.close()}catch{}}}),r)};async function*o_(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:e,value:t}=await n.read();if(e)break;typeof t==`string`?yield t:yield r.decode(t)}}finally{n.releaseLock()}}var s_=e=>{if(typeof e.status==`string`&&(e.status=Sh[e.status]),e.cookie&&Y(e.cookie)){let t=e_(e.cookie);t&&(e.headers[`set-cookie`]=t)}e.headers[`set-cookie`]&&Array.isArray(e.headers[`set-cookie`])&&(e.headers=n_(new Headers(e.headers),e.headers[`set-cookie`]))},c_=e=>{let t=a_(e);return(e,n,r)=>{let i=!1;if(n.headers instanceof Headers)for(let t of n.headers.keys())if(t===`set-cookie`){if(i)continue;i=!0;for(let t of n.headers.getSetCookie())e.headers.append(`set-cookie`,t)}else e.headers.has(t)||e.headers.set(t,n.headers?.get(t)??``);else for(let t in n.headers)t===`set-cookie`?e.headers.append(t,n.headers[t]):e.headers.has(t)||e.headers.set(t,n.headers[t]);let a=n.status??200;if(e.status!==a&&a!==200&&(e.status<=300||e.status>400)){let i=new Response(e.body,{headers:e.headers,status:n.status});return!i.headers.has(`content-length`)&&i.headers.get(`transfer-encoding`)===`chunked`?t(o_(i),r_(i,n),r):i}return!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?t(o_(e),r_(e,n),r):e}};async function l_(e,t=2){let n=[],r=!1,i=[];(async()=>{for await(let t of e)n.push(t),i.forEach(e=>e.resolve()),i=[];r=!0,i.forEach(e=>e.resolve())})();async function*a(){let e=0;for(;;)if(e<n.length)yield n[e++];else{if(r)return;await new Promise(e=>i.push({resolve:e}))}}return Array.from({length:t},a)}var u_=(e,t={headers:{}})=>{let n=e.path,r=$m[n.slice(n.lastIndexOf(`.`)+1)];return r&&(t.headers[`content-type`]=r),e.stats&&t.status!==206&&t.status!==304&&t.status!==412&&t.status!==416?e.stats.then(n=>{let r=n.size;return r!==void 0&&(t.headers[`content-range`]=`bytes 0-${r-1}/${r}`,t.headers[`content-length`]=r),Q(e.value,t)}):Q(e.value,t)},d_=(e,t,n)=>{if(Y(t.headers)||t.status!==200||t.cookie)switch(s_(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return u_(e,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,d_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return g_(e,t,n);case`Error`:return m_(e,t);case`Promise`:return e.then(e=>d_(e,t,n));case`Function`:return d_(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return g_(e,t,n);if(e instanceof Promise)return e.then(e=>d_(e,t));if(e instanceof Error)return m_(e,t);if(e instanceof Qh)return t.status=e.code,d_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return __(e,t,n);if(typeof e?.then==`function`)return e.then(e=>d_(e,t));if(typeof e?.toResponse==`function`)return d_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return typeof e?.next==`function`||e instanceof ReadableStream?__(e,t,n):p_(e,n)},f_=(e,t,n)=>{if(e!=null)if(Y(t.headers)||t.status!==200||t.cookie)switch(s_(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return u_(e,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,f_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return g_(e,t,n);case`Promise`:return e.then(e=>f_(e,t));case`Error`:return m_(e,t);case`Function`:return f_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return g_(e,t,n);if(e instanceof Promise)return e.then(e=>f_(e,t));if(e instanceof Error)return m_(e,t);if(e instanceof Qh)return t.status=e.code,f_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return __(e,t,n);if(typeof e?.then==`function`)return e.then(e=>f_(e,t));if(typeof e?.toResponse==`function`)return f_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return u_(e,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,f_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Promise`:return e.then(e=>{let n=f_(e,t);if(n!==void 0)return n});case`Error`:return m_(e,t);case`Function`:return p_(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>f_(e,t));if(e instanceof Error)return m_(e,t);if(e instanceof Qh)return t.status=e.code,f_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return __(e,t,n);if(typeof e?.then==`function`)return e.then(e=>f_(e,t));if(typeof e?.toResponse==`function`)return f_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},p_=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e,{headers:{"Content-Type":`text/plain`}});case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return u_(e);case`File`:return Q(e);case`Blob`:return Q(e);case`ElysiaCustomStatusResponse`:return d_(e.response,{status:e.code,headers:{}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Error`:return m_(e);case`Promise`:return e.then(e=>p_(e,t));case`Function`:return p_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>p_(e,t));if(e instanceof Error)return m_(e);if(e instanceof Qh)return d_(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`||e instanceof ReadableStream)return __(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>d_(e,set));if(typeof e?.toResponse==`function`)return p_(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},m_=(e,t)=>{if(typeof e?.toResponse==`function`){let n=e.toResponse(),r=t??{headers:{},status:200,redirect:``},i=e=>(e instanceof Response&&(r.status=e.status),d_(e,r));return typeof n?.then==`function`?n.then(i):i(n)}return new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status===200?500:t?.status??500,headers:t?.headers})},h_=(e,t,n={})=>{if(typeof e==`function`)return;let r=d_(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return()=>r.clone()},g_=c_({mapResponse:d_,mapCompactResponse:p_}),__=a_({mapResponse:d_,mapCompactResponse:p_}),v_={name:`web-standard`,isWebStandard:!0,handler:{mapResponse:d_,mapEarlyResponse:f_,mapCompactResponse:p_,createStaticHandler:h_},composeHandler:{mapResponseContext:`c.request`,preferWebstandardHeaders:!0,headers:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`,parser:{json(e){return e?`try{c.body=await c.request.json()}catch{}
`:`c.body=await c.request.json()
`},text(){return`c.body=await c.request.text()
`},urlencoded(){return`c.body=parseQuery(await c.request.text())
`},arrayBuffer(){return`c.body=await c.request.arrayBuffer()
`},formData(e){let t=`
c.body={}
`;return e?t+=`let form;try{form=await c.request.formData()}catch{}`:t+=`const form=await c.request.formData()
`,t+`for(const key of form.keys()){if(c.body[key]) continue
const value=form.getAll(key)
if(value.length===1)c.body[key]=value[0]
else c.body[key]=value}`}}},async stop(e,t){if(!e.server)throw Error("Elysia isn't running. Call `app.listen` to start the server.");if(e.server&&(await e.server.stop(t),e.server=null,e.event.stop?.length))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)},composeGeneralHandler:{parameters:`r`,createContext(e){let t=``,n=``,r=e.setHeaders;for(let n of Object.keys(e.decorator))t+=`,'${n}':decorator['${n}']`;let i=e.config.handler?.standardHostname??!0,a=!!e.event.trace?.length;return n+=`const u=r.url,s=u.indexOf('/',${i?11:7}),qi=u.indexOf('?',s+1),p=u.substring(s,qi===-1?undefined:qi)
`,a&&(n+=`const id=randomId()
`),n+=`const c={request:r,store,qi,path:p,url:u,redirect,status,set:{headers:`,n+=Object.keys(r??{}).length?`Object.assign({},app.setHeaders)`:`Object.create(null)`,n+=`,status:200}`,e.inference.server&&(n+=`,get server(){return app.getServer()}`),a&&(n+=`,[ELYSIA_REQUEST_ID]:id`),n+=t,n+=`}
`,n},error404(e,t,n=``){let r=`if(route===null){`+n+(t?``:`c.set.status=404`)+`
return `;return t?r+=`app.handleError(c,notFound,false,${this.parameters})`:r+=e?`c.response=c.responseValue=new Response(error404Message,{status:c.set.status===200?404:c.set.status,headers:c.set.headers})`:`c.response=c.responseValue=error404.clone()`,r+=`}`,{declare:t?``:`const error404Message=notFound.message.toString()
const error404=new Response(error404Message,{status:404})
`,code:r}}},composeError:{mapResponseContext:``,validationError:`set.headers['content-type']='application/json';return mapResponse(error.message,set)`,unknownError:`set.status=error.status??set.status??500;return mapResponse(error.message,set)`},listen(){return()=>{throw Error(`WebStandard does not support listen, you might want to export default Elysia.fetch instead`)}}},y_=e(Du(),1),b_=1,x_=2,S_=4,C_=8;function w_(e,t=0,n,r){let i=Object.create(null),a=0,o=e.length,s=t-1,c=s;for(let t=0;t<o;t++)switch(e.charCodeAt(t)){case 38:l(e,t),s=t,c=t,a=0;break;case 61:c<=s?c=t:a|=C_;break;case 43:c>s?a|=S_:a|=b_;break;case 37:c>s?a|=C_:a|=x_;break}return s<o&&l(e,o),i;function l(e,t){let o=c>s,l=o?c:t,u=e.slice(s+1,l);if(!o&&u.length===0)return;let d=u;a&b_&&(d=d.replace(/\+/g,` `)),a&x_&&(d=(0,y_.default)(d)||d);let f=``;if(o){let n=e.slice(c+1,t);a&S_&&(n=n.replace(/\+/g,` `)),a&C_&&(n=(0,y_.default)(n)||n),f=n}let p=i[d];n&&n?.[d]?f.charCodeAt(0)===91?(f=r&&r?.[d]?JSON.parse(f):f.slice(1,-1).split(`,`),p===void 0?i[d]=f:Array.isArray(p)?p.push(...f):(i[d]=f,i[d].unshift(p))):p===void 0?i[d]=f:Array.isArray(p)?p.push(f):i[d]=[p,f]:i[d]=f}}function T_(e,t=0){let n=Object.create(null),r=0,i=e.length,a=t-1,o=a;for(let t=0;t<i;t++)switch(e.charCodeAt(t)){case 38:s(e,t),a=t,o=t,r=0;break;case 61:o<=a?o=t:r|=C_;break;case 43:o>a?r|=S_:r|=b_;break;case 37:o>a?r|=C_:r|=x_;break}return a<i&&s(e,i),n;function s(e,t){let i=o>a,s=i?o:t,c=e.slice(a+1,s);if(!i&&c.length===0)return;let l=c;r&b_&&(l=l.replace(/\+/g,` `)),r&x_&&(l=(0,y_.default)(l)||l);let u=``;if(i){let n=e.slice(o+1,t);r&S_&&(n=n.replace(/\+/g,` `)),r&C_&&(n=(0,y_.default)(n)||n),u=n}let d=n[l];if(u.charCodeAt(0)===91&&u.charCodeAt(u.length-1)===93){try{u=JSON.parse(u)}catch{}d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}else if(u.charCodeAt(0)===123&&u.charCodeAt(u.length-1)===125){try{u=JSON.parse(u)}catch{}d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}else u.includes(`,`)&&(u=u.split(`,`)),d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}}function E_(e){let t=Object.create(null),n=0,r=e.length,i=-1,a=-1;for(let t=0;t<r;t++)switch(e.charCodeAt(t)){case 38:o(e,t),i=t,a=t,n=0;break;case 61:a<=i?a=t:n|=C_;break;case 43:a>i?n|=S_:n|=b_;break;case 37:a>i?n|=C_:n|=x_;break}return i<r&&o(e,r),t;function o(e,r){let o=a>i,s=o?a:r,c=e.slice(i+1,s);if(!o&&c.length===0)return;let l=c;n&b_&&(l=l.replace(/\+/g,` `)),n&x_&&(l=(0,y_.default)(l)||l);let u=``;if(o){let t=e.slice(a+1,r);n&S_&&(t=t.replace(/\+/g,` `)),n&C_&&(t=(0,y_.default)(t)||t),u=t}let d=t[l];d===void 0?t[l]=u:Array.isArray(d)?d.push(u):t[l]=[d,u]}}var D_=Symbol(`ElysiaTrace`),O_=()=>{let{promise:e,resolve:t}=Promise.withResolvers(),{promise:n,resolve:r}=Promise.withResolvers(),{promise:i,resolve:a}=Promise.withResolvers(),o=[],s=[];return[t=>(t&&o.push(t),e),e=>{let c=[],l=[],u=null;for(let t=0;t<(e.total??0);t++){let{promise:e,resolve:n}=Promise.withResolvers(),{promise:r,resolve:i}=Promise.withResolvers(),{promise:a,resolve:o}=Promise.withResolvers(),s=[],d=[];c.push(t=>(t&&s.push(t),e)),l.push(e=>{let c={...e,end:r,error:a,index:t,onStop(e){return e&&d.push(e),r}};n(c);for(let e=0;e<s.length;e++)s[e](c);return(t=null)=>{let n=performance.now();t&&(u=t);let r={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<d.length;e++)d[e](r);i(n),o(t)}})}let d={...e,end:n,error:i,onEvent(e){for(let t=0;t<c.length;t++)c[t](e)},onStop(e){return e&&s.push(e),n}};t(d);for(let e=0;e<o.length;e++)o[e](d);return{resolveChild:l,resolve(t=null){let n=performance.now();!t&&u&&(t=u);let i={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<s.length;e++)s[e](i);r(n),a(t)}}}]},k_=e=>t=>{let[n,r]=O_(),[i,a]=O_(),[o,s]=O_(),[c,l]=O_(),[u,d]=O_(),[f,p]=O_(),[m,h]=O_(),[g,_]=O_(),[ee,te]=O_();return e({id:t[Rh],context:t,set:t.set,onRequest:n,onParse:i,onTransform:o,onBeforeHandle:c,onHandle:u,onAfterHandle:f,onMapResponse:g,onAfterResponse:ee,onError:m,time:Date.now(),store:t.store}),{request:r,parse:a,transform:s,beforeHandle:l,handle:d,afterHandle:p,error:h,mapResponse:_,afterResponse:te}},A_=Symbol.for(`TypeBox.Kind`),j_=Symbol.for(`TypeBox.Hint`),M_=e=>/(\ |-|\t|\n|\.|\[|\]|\{|\})/.test(e)||!isNaN(+e[0]),N_=(e,t,n=!1)=>typeof t==`number`?`${e}[${t}]`:M_(t)?`${e}${n?`?.`:``}["${t}"]`:`${e}${n?`?`:``}.${t}`,P_=e=>M_(e)?`"${e}"`:e,F_=(e,t=0,n)=>{if(n.type!==`string`||n.const||n.trusted)return e;let r=``;for(let e=t-1;e>=0;e--)r+=`d.h${e}(`;return r+e+`)`.repeat(t)},I_=e=>{if(!e.allOf||A_ in e&&(e[A_]!==`Intersect`||e.type!==`object`))return e;let{allOf:t,...n}=e;n.properties={},A_ in n&&(n[A_]=`Object`);for(let e of t){if(e.type!==`object`)continue;let{properties:t,required:r,type:i,[A_]:a,...o}=e;for(let t in r&&(n.required=n.required?n.required.concat(r):r),Object.assign(n,o),e.properties)n.properties[t]=I_(e.properties[t])}return n},L_=(e,t,n)=>{let r=e.patternProperties[`^(.*)$`]??e.patternProperties[Object.keys(e.patternProperties)[0]];if(!r)return t;let i=n.array;n.array++;let a=`(()=>{const ar${i}s=Object.keys(${t}),ar${i}v={};for(let i=0;i<ar${i}s.length;i++){const ar${i}p=${t}[ar${i}s[i]];ar${i}v[ar${i}s[i]]=${V_(r,`ar${i}p`,n)}`,o=n.optionalsInArray[i+1];if(o)for(let e=0;e<o.length;e++){let t=`ar${i}v[ar${i}s[i]]${o[e]}`;a+=`;if(${t}===undefined)delete ${t}`}return a+=`}return ar${i}v})()`,a},R_=(e,t,n)=>{let r=n.array;n.array++;let i=t===`v`&&!n.unions.length,a=``;i||(a=`(()=>{`),a+=`const ar${r}v=[`;for(let r=0;r<e.length;r++)r!==0&&(a+=`,`),a+=V_(e[r],N_(t,r,n.parentIsOptional),n);return a+=`];`,i||(a+=`return ar${r}v})()`),a};function z_(e,t=new WeakMap){if(typeof e!=`object`||!e||typeof e==`function`)return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){let n=Array(e.length);t.set(e,n);for(let r=0;r<e.length;r++)n[r]=z_(e[r],t);return n}if(typeof e==`object`){let n=Object.keys(e).concat(Object.getOwnPropertySymbols(e)),r={};for(let i of n)r[i]=z_(e[i],t);return r}return e}var B_=(e,t,n)=>{if(n.TypeCompiler===void 0)return n.typeCompilerWanred||=(console.warn(Error(`[exact-mirror] TypeBox's TypeCompiler is required to use Union`)),!0),t;n.unionKeys[t]=1;let r=n.unions.length,i=n.unions[r]=[],a=`(()=>{
`,o=e=>{if(!(A_ in e)||!e.$ref)return e;if(e[A_]===`This`)return z_(n.definitions[e.$ref]);if(e[A_]===`Ref`)if(!n.modules)console.warn(Error(`[exact-mirror] modules is required when using nested cyclic reference`));else return n.modules.Import(e.$ref);return e},s=``;for(let c=0;c<e.length;c++){let l=o(e[c]);if(Array.isArray(l.anyOf))for(let e=0;e<l.anyOf.length;e++)l.anyOf[e]=o(l.anyOf[e]);else if(l.items)if(Array.isArray(l.items))for(let e=0;e<l.items.length;e++)l.items[e]=o(l.items[e]);else l.items=o(l.items);i.push(Zm.Compile(l)),a+=`if(d.unions[${r}][${c}].Check(${t})){return ${V_(l,t,{...n,recursion:n.recursion+1,parentIsOptional:!0})}}
`,s+=(c?``:`let `)+`tmp=`+V_(l,t,{...n,recursion:n.recursion+1,parentIsOptional:!0})+`
if(d.unions[${r}][${c}].Check(tmp))return tmp
`}return s&&(a+=s),a+=`return ${n.removeUnknownUnionType?`undefined`:t}`,a+`})()`},V_=(e,t,n)=>{if(!e)return``;let r=t===`v`&&!n.unions.length;if(A_ in e&&e[A_]===`Import`&&e.$ref in e.$defs)return V_(e.$defs[e.$ref],t,{...n,definitions:Object.assign(n.definitions,e.$defs)});if(r&&e.type!==`object`&&e.type!==`array`&&!e.anyOf)return`return ${F_(`v`,n.sanitize?.length,e)}`;if(n.recursion>=n.recursionLimit)return t;let i=``;switch(e.$id&&j_ in e&&(n.definitions[e.$id]=e),e.type){case`object`:if(e[A_]===`Record`){i=L_(e,t,n);break}e=I_(e),i+=`{`,e.additionalProperties&&(i+=`...${t},`);let a=Object.keys(e.properties);for(let r=0;r<a.length;r++){let o=a[r],s=!e.required||e.required&&!e.required.includes(o)||Array.isArray(e.properties[o].anyOf),c=N_(t,o,n.parentIsOptional);if(s){let e=n.array;if(t.startsWith(`ar`)){let r=c.indexOf(`.`),i;i=r>=0?c.slice(r):c.slice(t.length),i.startsWith(`?.`)&&(i=i.charAt(2)===`[`?i.slice(2):i.slice(1));let a=n.optionalsInArray;a[e]?a[e].push(i):a[e]=[i]}else n.optionals.push(c)}let l=e.properties[o];r!==0&&(i+=`,`),i+=`${P_(o)}:${s?`${c}===undefined?undefined:`:``}${V_(l,c,{...n,recursion:n.recursion+1,parentIsOptional:s})}`}i+=`}`;break;case`array`:if(e.items.type!==`object`&&e.items.type!==`array`){if(Array.isArray(e.items)){i=R_(e.items,t,n);break}else if(r&&!Array.isArray(e.items.anyOf))return`return v`;else if(A_ in e.items&&e.items.$ref&&(e.items[A_]===`Ref`||e.items[A_]===`This`))i=V_(z_(n.definitions[e.items.$ref]),t,{...n,parentIsOptional:!0,recursion:n.recursion+1});else if(!Array.isArray(e.items.anyOf)){i=t;break}}let o=n.array;n.array++;let s=t;r?i=`const ar${o}v=new Array(${t}.length);`:(s=`ar${o}s`,i=`((${s})=>{const ar${o}v=new Array(${s}.length);`),i+=`for(let i=0;i<${s}.length;i++){const ar${o}p=${s}[i];ar${o}v[i]=${V_(e.items,`ar${o}p`,n)}`;let c=n.optionalsInArray[o+1];if(c)for(let e=0;e<c.length;e++){let t=`ar${o}v[i]${c[e]}`;i+=`;if(${t}===undefined)delete ${t}`}i+=`}`,r||(i+=`return ar${o}v})(${t})`);break;default:if(e.$ref&&e.$ref in n.definitions)return V_(n.definitions[e.$ref],t,n);if(Array.isArray(e.anyOf)){i=B_(e.anyOf,t,n);break}i=F_(t,n.sanitize?.length,e);break}if(!r)return i;i=e.type===`array`?`${i}const x=ar0v;`:`const x=${i}
`;for(let t=0;t<n.optionals.length;t++){let r=n.optionals[t],a=r.slice(1);i+=`if(${r}===undefined`,n.unionKeys[r]&&(i+=`||x${a}===undefined`);let o=a.charCodeAt(0)!==63&&e.type!==`array`;i+=`)delete x${o?a.charCodeAt(0)===91?`?.`:`?`:``}${a}
`}return`${i}return x`},H_=(e,{TypeCompiler:t,modules:n,definitions:r,sanitize:i,recursionLimit:a=8,removeUnknownUnionType:o=!1}={})=>{let s=[];typeof i==`function`&&(i=[i]);let c=V_(e,`v`,{optionals:[],optionalsInArray:[],array:0,parentIsOptional:!1,unions:s,unionKeys:{},TypeCompiler:t,modules:n,definitions:r??n?.$defs??{},sanitize:i,recursion:0,recursionLimit:a,removeUnknownUnionType:o});if(!s.length&&!i?.length)return Function(`v`,c);let l;if(i?.length){l={};for(let e=0;e<i.length;e++)l[`h${e}`]=i[e]}return Function(`d`,`return function mirror(v){${c}}`)({unions:s,...l})},U_=(e,t)=>{if(Array.isArray(t)){let n=e;for(let e of t)n=W_(n,e);return n}return W_(e,t)},W_=(e,t)=>{if(t.rootOnly&&t.excludeRoot)throw Error(`Can't set both rootOnly and excludeRoot`);if(t.rootOnly&&t.onlyFirst)throw Error(`Can't set both rootOnly and onlyFirst`);if(t.rootOnly&&t.untilObjectFound)throw Error(`Can't set both rootOnly and untilObjectFound`);let n=({s:e,isRoot:r,treeLvl:i})=>{if(!e)return e;let a=r&&t.excludeRoot,o=t.from[j];if(e.elysiaMeta)return t.from.elysiaMeta===e.elysiaMeta&&!a?t.to(e):e;let s=o&&e[j]===o;if(!a&&t.onlyFirst&&e.type===t.onlyFirst||r&&t.rootOnly)return s?t.to(e):e;if(!r&&t.untilObjectFound&&e.type===`object`)return e;let c={isRoot:!1,treeLvl:i+1},l={...e};if(e.oneOf&&(l.oneOf=e.oneOf.map(e=>n({...c,s:e}))),e.anyOf&&(l.anyOf=e.anyOf.map(e=>n({...c,s:e}))),e.allOf&&(l.allOf=e.allOf.map(e=>n({...c,s:e}))),e.not&&(l.not=n({...c,s:e.not})),e.properties){l.properties={};for(let[t,r]of Object.entries(e.properties))l.properties[t]=n({...c,s:r})}if(e.items){let t=e.items;l.items=Array.isArray(t)?t.map(e=>n({...c,s:e})):n({...c,s:t})}return!a&&o&&l[j]===o?t.to(l):l};return n({s:e,isRoot:!0,treeLvl:0})},G_,K_=()=>(G_||=[{from:Z.Object({}),to:e=>Z.ObjectString(e.properties||{},e),excludeRoot:!0},{from:Z.Array(Z.Any()),to:e=>Z.ArrayString(e.items||Z.Any(),e)}],G_),q_,J_=()=>(q_||=[{from:Z.Object({}),to:e=>Z.ObjectString(e.properties??{},e),excludeRoot:!0},{from:Z.Array(Z.Any()),to:e=>Z.ArrayQuery(e.items??Z.Any(),e)}],q_),Y_,X_=()=>(Y_||=[{from:Z.Number(),to:e=>Z.Numeric(e),rootOnly:!0},{from:Z.Boolean(),to:e=>Z.BooleanString(e),rootOnly:!0}],Y_),Z_,Q_=()=>(Z_||=[{from:Z.Object({}),to:e=>Z.ObjectString(e.properties??{},e),onlyFirst:`object`,excludeRoot:!0},{from:Z.Array(Z.Any()),to:e=>Z.ArrayString(e.items??Z.Any(),e),onlyFirst:`array`,excludeRoot:!0}],Z_),$_=e=>e?e?.[j]===`Import`&&e.References?e.References().some($_):(e.schema&&(e=e.schema),!!e&&et in e):!1,ev=e=>{if(!e)return!1;let t=e?.schema??e;if(t[j]===`Import`&&e.References)return e.References().some(ev);if(t.anyOf)return t.anyOf.some(ev);if(t.someOf)return t.someOf.some(ev);if(t.allOf)return t.allOf.some(ev);if(t.not)return t.not.some(ev);if(t.type===`object`){let e=t.properties;if(`additionalProperties`in t)return t.additionalProperties;if(`patternProperties`in t)return!1;for(let t of Object.keys(e)){let n=e[t];if(n.type===`object`){if(ev(n))return!0}else if(n.anyOf){for(let e=0;e<n.anyOf.length;e++)if(ev(n.anyOf[e]))return!0}return n.additionalProperties}return!1}return t.type===`array`&&t.items&&!Array.isArray(t.items)?ev(t.items):!1},tv=(e,t,n)=>{if(e)return typeof e==`string`?n&&e in n.$defs?n.Import(e):t?.[e]:e},nv=(e,t)=>{if(!t)return!1;if(j in t&&t[j]===e)return!0;if(j in t&&t[j]===`Import`&&t.$defs&&t.$ref){let n=t.$ref.replace(`#/$defs/`,``);if(t.$defs[n])return nv(e,t.$defs[n])}if(t.anyOf)return t.anyOf.some(t=>nv(e,t));if(t.oneOf)return t.oneOf.some(t=>nv(e,t));if(t.allOf)return t.allOf.some(t=>nv(e,t));if(t.type===`array`&&t.items)return e===`Files`&&j in t.items&&t.items[j]===`File`?!0:nv(e,t.items);if(t.type===`object`){let n=t.properties;if(!n)return!1;for(let t of Object.keys(n))if(nv(e,n[t]))return!0}return!1},rv=(e,t)=>{if(!t)return!1;let n=t?.schema??t;if(n.elysiaMeta===e)return!0;if(n[j]===`Import`&&t.References)return t.References().some(t=>rv(e,t));if(n.anyOf)return n.anyOf.some(t=>rv(e,t));if(n.someOf)return n.someOf.some(t=>rv(e,t));if(n.allOf)return n.allOf.some(t=>rv(e,t));if(n.not)return n.not.some(t=>rv(e,t));if(n.type===`object`){let t=n.properties;for(let r of Object.keys(t)){let i=t[r];if(i.type===`object`){if(rv(e,i))return!0}else if(i.anyOf){for(let t=0;t<i.anyOf.length;t++)if(rv(e,i.anyOf[t]))return!0}return n.elysiaMeta===e}return!1}return n.type===`array`&&n.items&&!Array.isArray(n.items)?rv(e,n.items):!1},iv=(e,t)=>{if(!t)return;let n=t.schema??t;if(n[j]===`Import`&&t.References)return t.References().some(t=>iv(e,t));if(n.type===`object`){let t=n.properties;if(!t)return!1;for(let n of Object.keys(t)){let r=t[n];if(e in r)return!0;if(r.type===`object`){if(iv(e,r))return!0}else if(r.anyOf){for(let t=0;t<r.anyOf.length;t++)if(iv(e,r.anyOf[t]))return!0}}return!1}return e in n},av=e=>{if(!e)return!1;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(av(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(av(e.anyOf[t]))return!0}if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(av(e.oneOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(av(e.allOf[t]))return!0}if(e.not&&av(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(av(n)||n.type===`array`&&n.items&&av(n.items))return!0}}return e.type===`array`&&e.items&&av(e.items)?!0:e[j]===`Ref`&&`$ref`in e},ov=e=>{if(!e)return!1;if(e.$ref&&e.$defs&&e.$ref in e.$defs&&ov(e.$defs[e.$ref]))return!0;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(ov(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(ov(e.anyOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(ov(e.allOf[t]))return!0}if(e.not&&ov(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(ov(n)||n.type===`array`&&n.items&&ov(n.items))return!0}}return e.type===`array`&&e.items&&ov(e.items)?!0:Qe in e},sv=e=>t=>{if(typeof t==`object`)try{return Np(e,t)}catch{}return t},cv=(e,{models:t={},dynamic:n=!1,modules:r,normalize:i=!1,additionalProperties:a=!1,forceAdditionalProperties:o=!1,coerce:s=!1,additionalCoerce:c=[],validators:l,sanitize:u}={})=>{if(l=l?.filter(e=>e),!e){if(!l?.length)return;e=l[0],l=l.slice(1)}let d=e=>s?U_(e,[{from:Z.Number(),to:e=>Z.Numeric(e),untilObjectFound:!0},{from:Z.Boolean(),to:e=>Z.BooleanString(e),untilObjectFound:!0},...Array.isArray(c)?c:[c]]):U_(e,c),f=e=>{if(e&&typeof e!=`string`&&`~standard`in e)return e;if(!e)return;let n;if(typeof e!=`string`)n=e;else if(n=r&&e in r.$defs?r.Import(e):t[e],!n)return;let i=Array.isArray(c)?c.length>0:!!c;if(j in n)if(n[j]===`Import`)av(n.$defs[n.$ref])||(n=n.$defs[n.$ref],(s||i)&&(n=d(n),`$id`in n&&!n.$defs&&(n.$id=`${n.$id}_coerced_${Bh()}`)));else if(av(n)){let e=Bh();n=Z.Module({...r?.$defs,[e]:n}).Import(e)}else (s||i)&&(n=d(n));return n},p=f(e),m=l;if(`~standard`in p||l?.length&&l.some(e=>e&&typeof e!=`string`&&`~standard`in e)){let e=e=>{let a;if(i===!0||i===`exactMirror`)try{a=H_(e,{TypeCompiler:Zm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(e),a=sv(e)}let o=cv(e,{models:t,modules:r,dynamic:n,normalize:i,additionalProperties:!0,forceAdditionalProperties:!0,coerce:s,additionalCoerce:c});return o.Decode=a,e=>o.Check(e)?{value:o.Decode(e)}:{issues:[...o.Errors(e)]}},a=p[`~standard`]?p[`~standard`].validate:e(p),o=[];if(l?.length){for(let t of l)if(t&&typeof t!=`string`){if(t?.[`~standard`]){o.push(t[`~standard`]);continue}if(j in t){o.push(e(t));continue}}}async function d(e){let t=a(e);if(t instanceof Promise&&(t=await t),t.issues)return t;let n=[];t&&typeof t==`object`&&n.push(t.value);for(let r=0;r<o.length;r++){if(t=o[r].validate(e),t instanceof Promise&&(t=await t),t.issues)return t;t&&typeof t==`object`&&n.push(t.value)}if(!n.length)return{value:t};if(n.length===1)return{value:n[0]};if(n.length===2)return{value:ch(n[0],n[1])};let r=ch(n[0],n[1]);for(let e=2;e<n.length;e++)r=ch(r,n[e]);return{value:r}}let f={provider:`standard`,schema:p,references:``,checkFunc:()=>{},code:``,Check:d,Errors:e=>d(e)?.then?.(e=>e?.issues),Code:()=>``,Decode:d,Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return f.parse=e=>{try{return f.Decode(f.Clean?.(e)??e)}catch{throw[...f.Errors(e)].map(rg)}},f.safeParse=e=>{try{return{success:!0,data:f.Decode(f.Clean?.(e)??e),error:null}}catch{let t=[...h.Errors(e)].map(rg);return{success:!1,data:null,error:t[0]?.summary,errors:t}}},f}else if(l?.length){let e=!1,{schema:t,notObjects:n}=uv([p,...m.map(f)]);n&&(p=Z.Intersect([...t?[t]:[],...n.map(t=>{let n=f(t);return n.type===`object`&&`additionalProperties`in n&&(!e&&n.additionalProperties===!1&&(e=!0),delete n.additionalProperties),n})]),p.type===`object`&&e&&(p.additionalProperties=!1))}else p.type===`object`&&(!(`additionalProperties`in p)||o)?p.additionalProperties=a:p=U_(p,{onlyFirst:`object`,from:Z.Object({}),to(e){return!e.properties||`additionalProperties`in e?e:Z.Object(e.properties,{...e,additionalProperties:!1})}});if(n)if(j in p){let e={provider:`typebox`,schema:p,references:``,checkFunc:()=>{},code:``,Check:e=>Hd(p,e),Errors:e=>Of(p,e),Code:()=>``,Clean:sv(p),Decode:e=>Dm(p,e),Encode:e=>Hm(p,e),get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=ev(p)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=iv(`default`,p)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=$_(p)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=ov(p)},"~hasRef":void 0,get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=ov(p)}};if(p.config&&(e.config=p.config,e?.schema?.config&&delete e.schema.config),i&&p.additionalProperties===!1)if(i===!0||i===`exactMirror`)try{e.Clean=H_(p,{TypeCompiler:Zm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(p),e.Clean=sv(p)}else e.Clean=sv(p);return e.parse=t=>{try{return e.Decode(e.Clean?.(t)??t)}catch{throw[...e.Errors(t)].map(rg)}},e.safeParse=t=>{try{return{success:!0,data:e.Decode(e.Clean?.(t)??t),error:null}}catch{let e=[...h.Errors(t)].map(rg);return{success:!1,data:null,error:e[0]?.summary,errors:e}}},e}else{let e={provider:`standard`,schema:p,references:``,checkFunc:()=>{},code:``,Check:e=>p[`~standard`].validate(e),Errors(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t.issues},Code:()=>``,Decode(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return e.parse=t=>{try{return e.Decode(e.Clean?.(t)??t)}catch{throw[...e.Errors(t)].map(rg)}},e.safeParse=t=>{try{return{success:!0,data:e.Decode(e.Clean?.(t)??t),error:null}}catch{let e=[...h.Errors(t)].map(rg);return{success:!1,data:null,error:e[0]?.summary,errors:e}}},e}let h;if(j in p)if(h=Zm.Compile(p,Object.values(t).filter(e=>j in e)),h.provider=`typebox`,p.config&&(h.config=p.config,h?.schema?.config&&delete h.schema.config),i===!0||i===`exactMirror`)try{h.Clean=H_(p,{TypeCompiler:Zm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.dir(p,{depth:null}),h.Clean=sv(p)}else i===`typebox`&&(h.Clean=sv(p));else h={provider:`standard`,schema:p,references:``,checkFunc(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},code:``,Check:e=>p[`~standard`].validate(e),Errors(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t.issues},Code:()=>``,Decode(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return h.parse=e=>{try{return h.Decode(h.Clean?.(e)??e)}catch{throw[...h.Errors(e)].map(rg)}},h.safeParse=e=>{try{return{success:!0,data:h.Decode(h.Clean?.(e)??e),error:null}}catch{let t=[...h.Errors(e)].map(rg);return{success:!1,data:null,error:t[0]?.summary,errors:t}}},j in p&&Object.assign(h,{get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=ev(h)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=iv(`default`,h)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=$_(h)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=ov(p)},get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=av(p)},"~hasRef":void 0}),h},lv=e=>e[j]===`Union`||!e.schema&&!!e.anyOf,uv=e=>{if(e.length===0)return{schema:void 0,notObjects:[]};if(e.length===1)return e[0].type===`object`?{schema:e[0],notObjects:[]}:{schema:void 0,notObjects:e};let t,n=[],r=!1,i=!1;for(let a of e){if(a.type!==`object`){n.push(a);continue}if(`additionalProperties`in a&&(a.additionalProperties===!0?r=!0:a.additionalProperties===!1&&(i=!0)),!t){t=a;continue}t={...t,...a,properties:{...t.properties,...a.properties},required:[...t?.required??[],...a.required??[]]}}return t&&(t.required&&=[...new Set(t.required)],i?t.additionalProperties=!1:r&&(t.additionalProperties=!0)),{schema:t,notObjects:n}},dv=(e,{models:t={},modules:n,dynamic:r=!1,normalize:i=!1,additionalProperties:a=!1,validators:o=[],sanitize:s})=>{if(o=o.filter(e=>e),!e){if(!o?.length)return;e=o[0],o=o.slice(1)}let c;if(typeof e!=`string`)c=e;else if(c=n&&e in n.$defs?n.Import(e):t[e],!c)return;if(!c)return;if(j in c||`~standard`in c)return{200:cv(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(e=>e[200]),sanitize:s})};let l={};return Object.keys(c).forEach(e=>{if(isNaN(+e))return;let u=c[+e];if(typeof u==`string`){if(u in t){let c=t[u];if(!c)return;l[+e]=j in c||`~standard`in c?cv(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):c}return}l[+e]=j in u||`~standard`in u?cv(u,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):u}),l},fv=({validator:e,modules:t,defaultConfig:n={},config:r,dynamic:i,normalize:a=!1,models:o,validators:s,sanitize:c})=>{let l=e?.provider?e:cv(e,{modules:t,dynamic:i,models:o,normalize:a,additionalProperties:!0,coerce:!0,additionalCoerce:K_(),validators:s,sanitize:c});return l?l.config=lh(l.config,r):(l=cv(Z.Cookie(Z.Any()),{modules:t,dynamic:i,models:o,additionalProperties:!0,validators:s,sanitize:c}),l.config=n),l},pv=e=>e&&e[j]===`Import`&&e.$defs[e.$ref][j]===`Object`?e.$defs[e.$ref]:e,mv=e(Du(),1),$=(e,t)=>t?e:``,hv=[`json`,`text`,`urlencoded`,`arrayBuffer`,`formdata`,`application/json`,`text/plain`,`application/x-www-form-urlencoded`,`application/octet-stream`,`multipart/form-data`],gv=({context:e=`c`,trace:t=[],addFn:n})=>{if(!t.length)return()=>({resolveChild(){return()=>{}},resolve(){}});for(let r=0;r<t.length;r++)n(`let report${r},reportChild${r},reportErr${r},reportErrChild${r};let trace${r}=${e}[ELYSIA_TRACE]?.[${r}]??trace[${r}](${e});
`);return(e,{name:r,total:i=0,alias:a}={})=>{r||=`anonymous`;let o=e===`error`?`reportErr`:`report`;for(let s=0;s<t.length;s++)n(`${a?`const `:``}${a??o}${s}=trace${s}.${e}({id,event:'${e}',name:'${r}',begin:performance.now(),total:${i}})
`),a&&n(`${o}${s}=${a}${s}
`);return{resolve(){for(let e=0;e<t.length;e++)n(`${a??o}${e}.resolve()
`)},resolveChild(r){for(let i=0;i<t.length;i++)n(`${o}Child${i}=${o}${i}.resolveChild?.shift()?.({id,event:'${e}',name:'${r}',begin:performance.now()})
`);return e=>{for(let r=0;r<t.length;r++)n(e?`if(${e} instanceof Error){${o}Child${r}?.(${e}) }else{${o}Child${r}?.()}`:`${o}Child${r}?.()
`)}}}}},_v=({schema:e,name:t,type:n,typeAlias:r=n,normalize:i,ignoreTryCatch:a=!1})=>!i||!e.Clean?``:i===!0||i===`exactMirror`?a?`${t}=validator.${r}.Clean(${t})
`:`try{${t}=validator.${r}.Clean(${t})
}catch{}`:i===`typebox`?`${t}=validator.${r}.Clean(${t})
`:``,vv=({injectResponse:e=``,normalize:t=!1,validator:n,encodeSchema:r=!1,isStaticResponse:i=!1,hasSanitize:a=!1,allowUnsafeValidationDetails:o=!1})=>({validate:(e,t=`c.${e}`,n)=>`c.set.status=422;throw new ValidationError('${e}',validator.${e},${t},${o}${n?`,`+n:``})`,response:(s=`r`)=>{if(i||!n.response)return``;let c=e+`
`;c+=`if(${s} instanceof ElysiaCustomStatusResponse){c.set.status=${s}.code
${s}=${s}.response}if(${s} instanceof Response === false && typeof ${s}?.next !== 'function' && !(${s} instanceof ReadableStream))switch(c.set.status){`;for(let[e,i]of Object.entries(n.response)){if(c+=`
case ${e}:
`,i.provider===`standard`){c+=`let vare${e}=validator.response[${e}].Check(${s})
if(vare${e} instanceof Promise)vare${e}=await vare${e}
if(vare${e}.issues)throw new ValidationError('response',validator.response[${e}],${s},${o},vare${e}.issues)
${s}=vare${e}.value
c.set.status=${e}
break
`;continue}let n=i.schema?.noValidate===!0;if(!n&&i.schema?.$ref&&i.schema?.$defs){let e=i.schema.$ref,t=typeof e==`string`&&e.includes(`/`)?e.split(`/`).pop():e;i.schema.$defs[t]?.noValidate===!0&&(n=!0)}let l=n||a,u=({ignoreTryCatch:n=!1}={})=>_v({name:s,schema:i,type:`response`,typeAlias:`response[${e}]`,normalize:t,ignoreTryCatch:n});l&&(c+=u());let d=!l&&t&&!n;r&&i.hasTransform&&!n?(c+=`try{${s}=validator.response[${e}].Encode(${s})
`,l||(c+=u({ignoreTryCatch:!0})),c+=`c.set.status=${e}}catch{`+(d?`try{
`+u({ignoreTryCatch:!0})+`${s}=validator.response[${e}].Encode(${s})
}catch{throw new ValidationError('response',validator.response[${e}],${s},${o})}`:`throw new ValidationError('response',validator.response[${e}],${s}),${o}`)+`}`):(l||(c+=u()),n||(c+=`if(validator.response[${e}].Check(${s})===false)throw new ValidationError('response',validator.response[${e}],${s},${o})
c.set.status=${e}
`)),c+=`break
`}return c+`}`}}),yv=e=>(e?.fn??e).constructor.name===`AsyncFunction`,bv=/=>\s?response\.clone\(/,xv=/(?:return|=>)\s?\S+\(|a(?:sync|wait)/,Sv=e=>{let t=typeof e==`object`;if(t&&e.isAsync!==void 0)return e.isAsync;let n=t?e.fn:e;if(n.constructor.name===`AsyncFunction`)return!0;let r=n.toString();if(bv.test(r))return t&&(e.isAsync=!1),!1;let i=xv.test(r);return t&&(e.isAsync=i),i},Cv=e=>{let t=typeof e==`object`;if(t&&e.hasReturn!==void 0)return e.hasReturn;let n=t?e.fn.toString():typeof e==`string`?e.toString():e,r=n.indexOf(`)`);if(n.charCodeAt(r+2)===61&&n.charCodeAt(r+5)!==123)return t&&(e.hasReturn=!0),!0;let i=n.includes(`return`);return t&&(e.hasReturn=i),i},wv=e=>{let t=e?.fn??e;return t.constructor.name===`AsyncGeneratorFunction`||t.constructor.name===`GeneratorFunction`},Tv=(e,t,n=!1,r=`c.${t}`)=>`try{${e}}catch(error){if(error.constructor.name === 'TransformDecodeError'){c.set.status=422
throw error.error ?? new ValidationError('${t}',validator.${t},${r},${n})}}`,Ev=hh?`setImmediate`:`Promise.resolve().then`,Dv=({app:e,path:t,method:n,hooks:r,validator:i,handler:a,allowMeta:o=!1,inference:s})=>{let c=e[`~adapter`].composeHandler,l=e[`~adapter`].handler,u=typeof a==`function`;if(!u){a=l.mapResponse(a,{headers:e.setHeaders??{}});let t=a instanceof Response||a?.constructor?.name===`Response`&&typeof a?.clone==`function`;if(r.parse?.length&&r.transform?.length&&r.beforeHandle?.length&&r.afterHandle?.length)return t?Function(`a`,`"use strict";
return function(){return a.clone()}`)(a):Function(`a`,`"use strict";
return function(){return a}`)(a);if(t){let e=a;a=()=>e.clone()}}let d=u?`handler(c)`:`handler`,f=!!r.trace?.length,p=``;if(s=Jv(Object.assign({handler:a},r),s,e.config.sucrose),c.declare){let e=c.declare(s);e&&(p+=e)}s.server&&(p+=`Object.defineProperty(c,'server',{get:function(){return getServer()}})
`),i.createBody?.(),i.createQuery?.(),i.createHeaders?.(),i.createParams?.(),i.createCookie?.(),i.createResponse?.();let m=!!i.body||!!i.headers||!!i.params||!!i.query||!!i.cookie||!!i.response,h=s.query||!!i.query,g=r.parse?.length===1&&r.parse[0].fn===`none`,_=n!==``&&n!==`GET`&&n!==`HEAD`&&(s.body||!!i.body||!!r.parse?.length)&&!g,ee=e.setHeaders,te=ee&&!!Object.keys(ee).length,ne=s.headers||!!i.headers||c.preferWebstandardHeaders!==!0&&s.body,re=s.cookie||!!i.cookie,v=i.cookie?.config?lh(i?.cookie?.config,e.config.cookie):e.config.cookie,ie=``,ae=()=>{if(ie)return ie;if(v?.sign){if(!v.secrets)throw Error(`t.Cookie required secret which is not set in (${n}) ${t}.`);let e=v.secrets?typeof v.secrets==`string`?v.secrets:v.secrets[0]:void 0;if(ie+=`const _setCookie = c.set.cookie
if(_setCookie){`,v.sign===!0)ie+=`for(const [key, cookie] of Object.entries(_setCookie)){c.set.cookie[key].value=await signCookie(cookie.value,${e?JSON.stringify(e):`undefined`})}`;else{typeof v.sign==`string`&&(v.sign=[v.sign]);for(let t of v.sign)ie+=`if(_setCookie[${JSON.stringify(t)}]?.value)c.set.cookie[${JSON.stringify(t)}].value=await signCookie(_setCookie[${JSON.stringify(t)}].value,${e?JSON.stringify(e):`undefined`})
`}ie+=`}
`}return ie},oe=e.config.normalize,se=e.config.encodeSchema,ce=e.config.allowUnsafeValidationDetails,y=vv({normalize:oe,validator:i,encodeSchema:se,isStaticResponse:a instanceof Response,hasSanitize:!!e.config.sanitize,allowUnsafeValidationDetails:ce});ne&&(p+=c.headers),f&&(p+=`const id=c[ELYSIA_REQUEST_ID]
`);let le=gv({trace:r.trace,addFn:e=>{p+=e}});if(p+=`try{`,re){let e=(e,t)=>{let n=v?.[e]??t;return n===void 0?``:n?typeof n==`string`?`${e}:${JSON.stringify(n)},`:n instanceof Date?`${e}: new Date(${n.getTime()}),`:`${e}:${n},`:typeof t==`string`?`${e}:"${t}",`:`${e}:${t},`},t=v?`{secrets:${v.secrets===void 0?`undefined`:typeof v.secrets==`string`?JSON.stringify(v.secrets):`[`+v.secrets.map(e=>JSON.stringify(e)).join(`,`)+`]`},sign:${v.sign===!0?!0:v.sign===void 0?`undefined`:typeof v.sign==`string`?JSON.stringify(v.sign):`[`+v.sign.map(e=>JSON.stringify(e)).join(`,`)+`]`},`+e(`domain`)+e(`expires`)+e(`httpOnly`)+e(`maxAge`)+e(`path`,`/`)+e(`priority`)+e(`sameSite`)+e(`secure`)+`}`:`undefined`;ne?p+=`
c.cookie=await parseCookie(c.set,c.headers.cookie,${t})
`:p+=`
c.cookie=await parseCookie(c.set,c.request.headers.get('cookie'),${t})
`}if(h){let e={},t={},n=!1,r=!1;if(i.query?.schema){let a=pv(i.query?.schema);if(j in a&&a.properties)for(let[i,o]of Object.entries(a.properties))rv(`ArrayQuery`,o)&&(e[i]=!0,n=!0),rv(`ObjectString`,o)&&(t[i]=!0,r=!0)}p+=`if(c.qi===-1){c.query=Object.create(null)}else{c.query=parseQueryFromURL(c.url,c.qi+1${n?`,`+JSON.stringify(e):r?`,undefined`:``}${r?`,`+JSON.stringify(t):``})}`}let ue=typeof a==`function`&&Sv(a),de=f||r.afterResponse?.length?`c.response=c.responseValue= `:``,fe=Object.keys(i.response??{}),pe=fe.length>1,me=fe.length===0||fe.length===1&&fe[0]===`200`,he=re||_||ue||!!r.parse?.length||!!r.afterHandle?.some(Sv)||!!r.beforeHandle?.some(Sv)||!!r.transform?.some(Sv)||!!r.mapResponse?.some(Sv)||i.body?.provider===`standard`||i.headers?.provider===`standard`||i.query?.provider===`standard`||i.params?.provider===`standard`||i.cookie?.provider===`standard`||Object.values(i.response??{}).find(e=>e.provider===`standard`),b=(typeof a==`function`?wv(a):!1)||!!r.beforeHandle?.some(wv)||!!r.afterHandle?.some(wv)||!!r.transform?.some(wv),ge=s.cookie||s.set||ne||f||pe||!me||u&&te||b,x,S=(e=!0)=>{if(x!==void 0)return x;if(!r.afterResponse?.length&&!f)return``;let t=``;t+=`
${Ev}(async()=>{if(c.responseValue){if(c.responseValue instanceof ElysiaCustomStatusResponse) c.set.status=c.responseValue.code
`+(e?`if(typeof afterHandlerStreamListener!=='undefined')for await(const v of afterHandlerStreamListener){}
`:``)+`}
`;let n=gv({trace:r.trace,addFn:e=>{t+=e}})(`afterResponse`,{total:r.afterResponse?.length});if(r.afterResponse?.length&&r.afterResponse)for(let e=0;e<r.afterResponse.length;e++){let i=n.resolveChild(r.afterResponse[e].fn.name),a=Sv(r.afterResponse[e])?`await `:``;t+=`
${a}e.afterResponse[${e}](c)
`,i()}return n.resolve(),t+=`})
`,x=t},C=(e=`r`)=>{let t=S(),n=`${ge?`mapResponse`:`mapCompactResponse`}(${de}${e}${ge?`,c.set`:``}${w})
`;return t?`const _res=${n}`+t+`return _res`:`return ${n}`},w=b&&c.mapResponseContext?`,${c.mapResponseContext}`:``;(f||s.route)&&(p+=`c.route=\`${t}\`
`),(f||r.afterResponse?.length)&&(p+=`let afterHandlerStreamListener
`);let T=le(`parse`,{total:r.parse?.length});if(_){let t=!!r.parse?.length||s.body||i.body;c.parser.declare&&(p+=c.parser.declare),p+=`
try{`;let n=typeof r.parse==`string`?r.parse:Array.isArray(r.parse)&&r.parse.length===1?typeof r.parse[0]==`string`?r.parse[0]:typeof r.parse[0].fn==`string`?r.parse[0].fn:void 0:void 0;if(!n&&i.body&&!r.parse?.length){let e=i.body.schema;e&&e.anyOf&&e[j]===`Union`&&e.anyOf?.length===2&&e.anyOf?.find(e=>e[j]===`ElysiaForm`)&&(n=`formdata`)}if(n&&hv.includes(n)){let t=le(`parse`,{total:r.parse?.length}),a=!!i.body?.isOptional;switch(n){case`json`:case`application/json`:p+=c.parser.json(a);break;case`text`:case`text/plain`:p+=c.parser.text(a);break;case`urlencoded`:case`application/x-www-form-urlencoded`:p+=c.parser.urlencoded(a);break;case`arrayBuffer`:case`application/octet-stream`:p+=c.parser.arrayBuffer(a);break;case`formdata`:case`multipart/form-data`:p+=c.parser.formData(a);break;default:n[0]in e[`~parser`]&&(p+=ne?`let contentType = c.headers['content-type']`:`let contentType = c.request.headers.get('content-type')`,p+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0,index)}
else{contentType=''}c.contentType=contentType
let result=parser['${n}'](c, contentType)
if(result instanceof Promise)result=await result
if(result instanceof ElysiaCustomStatusResponse)throw result
if(result!==undefined)c.body=result
delete c.contentType
`);break}t.resolve()}else if(t){p+=`
`,p+=`let contentType
if(c.request.body)`,p+=ne?`contentType=c.headers['content-type']
`:`contentType=c.request.headers.get('content-type')
`;let t=!1;if(r.parse?.length)p+=`if(contentType){
const index=contentType.indexOf(';')

if(index!==-1)contentType=contentType.substring(0,index)}else{contentType=''}let used=false
c.contentType=contentType
`;else{t=!0;let e=!!i.body?.isOptional;p+=`if(contentType)switch(contentType.charCodeAt(12)){
case 106:`+c.parser.json(e)+`break
case 120:`+c.parser.urlencoded(e)+`break
case 111:`+c.parser.arrayBuffer(e)+`break
case 114:`+c.parser.formData(e)+`break
default:if(contentType.charCodeAt(0)===116){`+c.parser.text(e)+`}break
}`}let n=le(`parse`,{total:r.parse?.length});if(r.parse)for(let e=0;e<r.parse.length;e++){let a=`bo${e}`;if(e!==0&&(p+=`
if(!used){`),typeof r.parse[e].fn==`string`){let o=n.resolveChild(r.parse[e].fn),s=!!i.body?.isOptional;switch(r.parse[e].fn){case`json`:case`application/json`:t=!0,p+=c.parser.json(s);break;case`text`:case`text/plain`:t=!0,p+=c.parser.text(s);break;case`urlencoded`:case`application/x-www-form-urlencoded`:t=!0,p+=c.parser.urlencoded(s);break;case`arrayBuffer`:case`application/octet-stream`:t=!0,p+=c.parser.arrayBuffer(s);break;case`formdata`:case`multipart/form-data`:t=!0,p+=c.parser.formData(s);break;default:p+=`let ${a}=parser['${r.parse[e].fn}'](c,contentType)
if(${a} instanceof Promise)${a}=await ${a}
if(${a}!==undefined){c.body=${a};used=true;}
`}o()}else{let t=n.resolveChild(r.parse[e].fn.name);p+=`let ${a}=e.parse[${e}]
${a}=${a}(c,contentType)
if(${a} instanceof Promise)${a}=await ${a}
if(${a}!==undefined){c.body=${a};used=true}`,t()}if(e!==0&&(p+=`}`),t)break}if(n.resolve(),!t){let t=!!i.body?.isOptional;r.parse?.length&&(p+=`
if(!used){
`),p+=`switch(contentType){case 'application/json':
`+c.parser.json(t)+`break
case 'text/plain':`+c.parser.text(t)+`break
case 'application/x-www-form-urlencoded':`+c.parser.urlencoded(t)+`break
case 'application/octet-stream':`+c.parser.arrayBuffer(t)+`break
case 'multipart/form-data':`+c.parser.formData(t)+`break
`;for(let t of Object.keys(e[`~parser`]))p+=`case '${t}':let bo${t}=parser['${t}'](c,contentType)
if(bo${t} instanceof Promise)bo${t}=await bo${t}
if(bo${t} instanceof ElysiaCustomStatusResponse){`+C(`bo${t}`)+`}if(bo${t}!==undefined)c.body=bo${t}
break
`;r.parse?.length&&(p+=`}`),p+=`}`}r.parse?.length&&(p+=`
delete c.contentType`)}p+=`}catch(error){throw new ParseError(error)}`}if(T.resolve(),r?.transform||f){let e=le(`transform`,{total:r.transform?.length});if(r.transform?.length){p+=`let transformed
`;for(let t=0;t<r.transform.length;t++){let n=r.transform[t],i=e.resolveChild(n.fn.name);p+=Sv(n)?`transformed=await e.transform[${t}](c)
`:`transformed=e.transform[${t}](c)
`,n.subType===`mapDerive`?p+=`if(transformed instanceof ElysiaCustomStatusResponse){`+C(`transformed`)+`}else{transformed.request=c.request
transformed.store=c.store
transformed.qi=c.qi
transformed.path=c.path
transformed.url=c.url
transformed.redirect=c.redirect
transformed.set=c.set
transformed.error=c.error
c=transformed}`:p+=`if(transformed instanceof ElysiaCustomStatusResponse){`+C(`transformed`)+`}else Object.assign(c,transformed)
`,i()}}e.resolve()}let _e=[];if(i){if(i.headers){if(i.headers.hasDefault)for(let[e,t]of Object.entries(Vm(i.headers.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`c.headers['${e}']??=${n}
`)}p+=_v({name:`c.headers`,schema:i.headers,type:`headers`,normalize:oe}),i.headers.isOptional&&(p+=`if(isNotEmpty(c.headers)){`),i.headers?.provider===`standard`?p+=`let vah=validator.headers.Check(c.headers)
if(vah instanceof Promise)vah=await vah
if(vah.issues){`+y.validate(`headers`,void 0,`vah.issues`)+`}else{c.headers=vah.value}
`:i.headers?.schema?.noValidate!==!0&&(p+=`if(validator.headers.Check(c.headers) === false){`+y.validate(`headers`)+`}`),i.headers.hasTransform&&(p+=Tv(`c.headers=validator.headers.Decode(c.headers)
`,`headers`,ce)),i.headers.isOptional&&(p+=`}`)}if(i.params){if(i.params.hasDefault)for(let[e,t]of Object.entries(Vm(i.params.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`c.params['${e}']??=${n}
`)}i.params.provider===`standard`?p+=`let vap=validator.params.Check(c.params)
if(vap instanceof Promise)vap=await vap
if(vap.issues){`+y.validate(`params`,void 0,`vap.issues`)+`}else{c.params=vap.value}
`:i.params?.schema?.noValidate!==!0&&(p+=`if(validator.params.Check(c.params)===false){`+y.validate(`params`)+`}`),i.params.hasTransform&&(p+=Tv(`c.params=validator.params.Decode(c.params)
`,`params`,ce))}if(i.query){if(j in i.query?.schema&&i.query.hasDefault)for(let[e,t]of Object.entries(Vm(i.query.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`if(c.query['${e}']===undefined)c.query['${e}']=${n}
`)}p+=_v({name:`c.query`,schema:i.query,type:`query`,normalize:oe}),i.query.isOptional&&(p+=`if(isNotEmpty(c.query)){`),i.query.provider===`standard`?p+=`let vaq=validator.query.Check(c.query)
if(vaq instanceof Promise)vaq=await vaq
if(vaq.issues){`+y.validate(`query`,void 0,`vaq.issues`)+`}else{c.query=vaq.value}
`:i.query?.schema?.noValidate!==!0&&(p+=`if(validator.query.Check(c.query)===false){`+y.validate(`query`)+`}`),i.query.hasTransform&&(p+=Tv(`c.query=validator.query.Decode(c.query)
`,`query`,ce),p+=Tv(`c.query=validator.query.Decode(c.query)
`,`query`,ce)),i.query.isOptional&&(p+=`}`)}if(_&&i.body){(i.body.hasTransform||i.body.isOptional)&&(p+=`const isNotEmptyObject=c.body&&(typeof c.body==="object"&&(isNotEmpty(c.body)||c.body instanceof ArrayBuffer))
`);let t=lv(i.body.schema),n=!1;if(i.body.hasDefault){let e=Vm(i.body.schema,i.body.schema.type===`object`||pv(i.body.schema)[j]===`Object`?{}:void 0),r=pv(i.body.schema);if(!t&&e&&typeof e==`object`&&(nv(`File`,r)||nv(`Files`,r))){n=!0;for(let[t,n]of Object.entries(e))(n===`File`||n===`Files`)&&delete e[t];Y(e)||(e=void 0)}let a=typeof e==`object`?JSON.stringify(e):typeof e==`string`?`'${e}'`:e;e!=null&&(Array.isArray(e)?p+=`if(!c.body)c.body=${a}
`:typeof e==`object`?p+=`c.body=Object.assign(${a},c.body)
`:p+=`c.body=${a}
`),p+=_v({name:`c.body`,schema:i.body,type:`body`,normalize:oe}),i.body.provider===`standard`?p+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+y.validate(`body`,void 0,`vab.issues`)+`}else{c.body=vab.value}
`:i.body?.schema?.noValidate!==!0&&(i.body.isOptional?p+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`:p+=`if(validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`)}else p+=_v({name:`c.body`,schema:i.body,type:`body`,normalize:oe}),i.body.provider===`standard`?p+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+y.validate(`body`,void 0,`vab.issues`)+`}else{c.body=vab.value}
`:i.body?.schema?.noValidate!==!0&&(i.body.isOptional?p+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`:p+=`if(validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`);if(i.body.hasTransform&&(p+=Tv(`if(isNotEmptyObject)c.body=validator.body.Decode(c.body)
`,`body`,ce)),t&&i.body.schema.anyOf?.length){let t=Object.values(i.body.schema.anyOf);for(let n=0;n<t.length;n++){let r=t[n];if(nv(`File`,r)||nv(`Files`,r)){let t=cv(r,{modules:e.definitions.typebox,dynamic:!e.config.aot,models:e.definitions.type,normalize:e.config.normalize,additionalCoerce:X_(),sanitize:()=>e.config.sanitize});if(t){let e=_e.length===0,n=t.schema?.properties??r.properties;if(!n&&t.schema?.anyOf){let e=t.schema.anyOf.find(e=>e.type===`object`||j in e&&e[j]===`Object`);e&&(n=e.properties)}if(!n)continue;let i=Object.entries(n),a=e?`
`:` else `;a+=`if(fileUnions[${_e.length}].Check(c.body)){`;let o=``,s=0;for(let e=0;e<i.length;e++){let[t,n]=i[e];!n.extension||n[j]!==`File`&&n[j]!==`Files`||(s&&(o+=`,`),o+=`fileType(c.body.${t},${JSON.stringify(n.extension)},'body.${t}')`,s++)}o&&(s===1?a+=`await ${o}
`:s>1&&(a+=`await Promise.all([${o}])
`),a+=`}`,p+=a,_e.push(t))}}}}else if(n||!t&&(nv(`File`,pv(i.body.schema))||nv(`Files`,pv(i.body.schema)))){let e=``,t=0;for(let[n,r]of Object.entries(pv(i.body.schema).properties))!r.extension||r[j]!==`File`&&r[j]!==`Files`||(t&&(e+=`,`),e+=`fileType(c.body.${n},${JSON.stringify(r.extension)},'body.${n}')`,t++);t&&(p+=`
`),t===1?p+=`await ${e}
`:t>1&&(p+=`await Promise.all([${e}])
`)}}i.cookie&&(i.cookie.config=lh(i.cookie.config,i.cookie?.config??{}),p+=`let cookieValue={}
for(const [key,value] of Object.entries(c.cookie))cookieValue[key]=value.value
`,i.cookie.isOptional&&(p+=`if(isNotEmpty(c.cookie)){`),i.cookie.provider===`standard`?(p+=`let vac=validator.cookie.Check(cookieValue)
if(vac instanceof Promise)vac=await vac
if(vac.issues){`+y.validate(`cookie`,void 0,`vac.issues`)+`}else{cookieValue=vac.value}
`,p+=`for(const k of Object.keys(cookieValue))c.cookie[k].value=cookieValue[k]
`):i.body?.schema?.noValidate!==!0&&(p+=`if(validator.cookie.Check(cookieValue)===false){`+y.validate(`cookie`,`cookieValue`)+`}`,i.cookie.hasTransform&&(p+=Tv(`for(const [key,value] of Object.entries(validator.cookie.Decode(cookieValue))){c.cookie[key].cookie.value = value}`,`cookie`,ce))),i.cookie.isOptional&&(p+=`}`))}if(r?.beforeHandle||f){let e=le(`beforeHandle`,{total:r.beforeHandle?.length}),t=!1;if(r.beforeHandle?.length)for(let n=0;n<r.beforeHandle.length;n++){let o=r.beforeHandle[n],s=e.resolveChild(o.fn.name),c=Cv(o);if(o.subType===`resolve`||o.subType===`mapResolve`)t||(t=!0,p+=`
let resolved
`),p+=Sv(o)?`resolved=await e.beforeHandle[${n}](c);
`:`resolved=e.beforeHandle[${n}](c);
`,o.subType===`mapResolve`?p+=`if(resolved instanceof ElysiaCustomStatusResponse){`+C(`resolved`)+`}else{resolved.request=c.request
resolved.store=c.store
resolved.qi=c.qi
resolved.path=c.path
resolved.url=c.url
resolved.redirect=c.redirect
resolved.set=c.set
resolved.error=c.error
c=resolved}`:p+=`if(resolved instanceof ElysiaCustomStatusResponse){`+C(`resolved`)+`}else Object.assign(c, resolved)
`,s();else if(!c)p+=Sv(o)?`await e.beforeHandle[${n}](c)
`:`e.beforeHandle[${n}](c)
`,s();else{if(p+=Sv(o)?`be=await e.beforeHandle[${n}](c)
`:`be=e.beforeHandle[${n}](c)
`,s(`be`),p+=`if(be!==undefined){`,e.resolve(),r.afterHandle?.length||f){le(`handle`,{name:u?a.name:void 0}).resolve();let e=le(`afterHandle`,{total:r.afterHandle?.length});if(r.afterHandle?.length)for(let t=0;t<r.afterHandle.length;t++){let n=r.afterHandle[t],i=Cv(n),a=e.resolveChild(n.fn.name);p+=`c.response=c.responseValue=be
`,i?(p+=Sv(n.fn)?`af=await e.afterHandle[${t}](c)
`:`af=e.afterHandle[${t}](c)
`,p+=`if(af!==undefined) c.response=c.responseValue=be=af
`):p+=Sv(n.fn)?`await e.afterHandle[${t}](c, be)
`:`e.afterHandle[${t}](c, be)
`,a(`af`)}e.resolve()}i.response&&(p+=y.response(`be`));let t=le(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`c.response=c.responseValue=be
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`if(mr===undefined){mr=${yv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)be=c.response=c.responseValue=mr}`,i()}}t.resolve(),p+=S(),p+=ae(),p+=`return mapEarlyResponse(${de}be,c.set${w})}
`}}e.resolve()}function E(e){let t=le(`handle`,{name:e,alias:`reportHandler`});return()=>{f&&(p+=`if(r&&(r[Symbol.iterator]||r[Symbol.asyncIterator])&&typeof r.next==="function"){`+(he?``:`(async()=>{`)+`const stream=await tee(r,3)
r=stream[0]
const listener=stream[1]
`+(f||r.afterResponse?.length?`afterHandlerStreamListener=stream[2]
`:``)+`${Ev}(async ()=>{if(listener)for await(const v of listener){}
`,t.resolve(),p+=`})`+(he?``:`})()`)+`}else{`,t.resolve(),p+=`}
`)}}if(r.afterHandle?.length||f){let e=E(u?a.name:void 0);r.afterHandle?.length?p+=ue?`let r=c.response=c.responseValue=await ${d}
`:`let r=c.response=c.responseValue=${d}
`:p+=ue?`let r=await ${d}
`:`let r=${d}
`,e();let t=le(`afterHandle`,{total:r.afterHandle?.length});if(r.afterHandle?.length)for(let e=0;e<r.afterHandle.length;e++){let n=r.afterHandle[e],a=Cv(n),o=t.resolveChild(n.fn.name);a?(p+=Sv(n.fn)?`af=await e.afterHandle[${e}](c)
`:`af=e.afterHandle[${e}](c)
`,o(`af`),i.response?(p+=`if(af!==undefined){`,t.resolve(),p+=y.response(`af`),p+=`c.response=c.responseValue=af}`):(p+=`if(af!==undefined){`,t.resolve(),p+=`c.response=c.responseValue=af}`)):(p+=Sv(n.fn)?`await e.afterHandle[${e}](c)
`:`e.afterHandle[${e}](c)
`,o())}t.resolve(),r.afterHandle?.length&&(p+=`r=c.response
`),i.response&&(p+=y.response()),p+=ae();let n=le(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length)for(let e=0;e<r.mapResponse.length;e++){let t=r.mapResponse[e],i=n.resolveChild(t.fn.name);p+=`mr=${yv(t)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr
`,i()}n.resolve(),p+=C()}else{let e=E(u?a.name:void 0);if(i.response||r.mapResponse?.length||f){p+=ue?`let r=await ${d}
`:`let r=${d}
`,e(),i.response&&(p+=y.response());let t=le(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`
c.response=c.responseValue=r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`
if(mr===undefined){mr=${yv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}
`,i()}}t.resolve(),p+=ae(),a instanceof Response?(p+=S(),p+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${de}${d}.clone(),c.set${w})
else return ${d}.clone()`:`return ${d}.clone()`,p+=`
`):p+=C()}else if(re||f){p+=ue?`let r=await ${d}
`:`let r=${d}
`,e();let t=le(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`c.response=c.responseValue= r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`if(mr===undefined){mr=${yv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}`,i()}}t.resolve(),p+=ae()+C()}else{e();let t=ue?`await ${d}`:d;a instanceof Response?(p+=S(),p+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${de}${d}.clone(),c.set${w})
else return ${d}.clone()
`:`return ${d}.clone()
`):p+=C(t)}}if(p+=`
}catch(error){`,!he&&r.error?.length&&(p+=`return(async()=>{`),p+=`const set=c.set
if(!set.status||set.status<300)set.status=error?.status||500
`,re&&(p+=ae()),f&&r.trace)for(let e=0;e<r.trace.length;e++)p+=`report${e}?.resolve(error);reportChild${e}?.(error)
`;let ve=le(`error`,{total:r.error?.length});if(r.error?.length){p+=`c.error=error
`,m?p+=`if(error instanceof TypeBoxError){c.code="VALIDATION"
c.set.status=422}else{c.code=error.code??error[ERROR_CODE]??"UNKNOWN"}`:p+=`c.code=error.code??error[ERROR_CODE]??"UNKNOWN"
`,p+=`let er
`,r.mapResponse?.length&&(p+=`let mep
`);for(let e=0;e<r.error.length;e++){let t=ve.resolveChild(r.error[e].fn.name);if(Sv(r.error[e])?p+=`er=await e.error[${e}](c)
`:p+=`er=e.error[${e}](c)
if(er instanceof Promise)er=await er
`,t(),r.mapResponse?.length){let e=le(`mapResponse`,{total:r.mapResponse?.length});for(let t=0;t<r.mapResponse.length;t++){let n=r.mapResponse[t],i=e.resolveChild(n.fn.name);p+=`c.response=c.responseValue=er
mep=e.mapResponse[${t}](c)
if(mep instanceof Promise)er=await er
if(mep!==undefined)er=mep
`,i()}e.resolve()}if(p+=`er=mapEarlyResponse(er,set${w})
`,p+=`if(er){`,f&&r.trace){for(let e=0;e<r.trace.length;e++)p+=`report${e}.resolve()
`;ve.resolve()}p+=S(!1),p+=`return er}`}}ve.resolve(),p+=`return handleError(c,error,true)`,!he&&r.error?.length&&(p+=`})()`),p+=`}`;let ye=c.inject?Object.keys(c.inject).join(`,`)+`,`:``,be=`const {handler,handleError,hooks:e, `+$(`validator,`,m)+`mapResponse,mapCompactResponse,mapEarlyResponse,isNotEmpty,utils:{`+$(`parseQuery,`,_)+$(`parseQueryFromURL,`,h)+`},error:{`+$(`ValidationError,`,m)+$(`ParseError`,_)+`},fileType,schema,definitions,tee,ERROR_CODE,`+$(`parseCookie,`,re)+$(`signCookie,`,re)+$(`decodeURIComponent,`,h)+`ElysiaCustomStatusResponse,`+$(`ELYSIA_TRACE,`,f)+$(`ELYSIA_REQUEST_ID,`,f)+$(`parser,`,r.parse?.length)+$(`getServer,`,s.server)+$(`fileUnions,`,_e.length)+ye+$(`TypeBoxError`,m)+`}=hooks
const trace=e.trace
return ${he?`async `:``}function handle(c){`;r.beforeHandle?.length&&(be+=`let be
`),r.afterHandle?.length&&(be+=`let af
`),r.mapResponse?.length&&(be+=`let mr
`),o&&(be+=`c.schema=schema
c.defs=definitions
`),p=be+p+`}`,be=``;try{return Function(`hooks`,`"use strict";
`+p)({handler:a,hooks:Ph(r),validator:m?i:void 0,handleError:e.handleError,mapResponse:l.mapResponse,mapCompactResponse:l.mapCompactResponse,mapEarlyResponse:l.mapEarlyResponse,isNotEmpty:Y,utils:{parseQuery:_?E_:void 0,parseQueryFromURL:h?i.query?.provider===`standard`?T_:w_:void 0},error:{ValidationError:m?X:void 0,ParseError:_?tg:void 0},fileType:hg,schema:e.router.history,definitions:e.definitions.type,tee:l_,ERROR_CODE:Yh,parseCookie:re?$g:void 0,signCookie:re?Eh:void 0,Cookie:re?Zg:void 0,decodeURIComponent:h?mv.default:void 0,ElysiaCustomStatusResponse:Qh,ELYSIA_TRACE:f?D_:void 0,ELYSIA_REQUEST_ID:f?Rh:void 0,getServer:s.server?()=>e.getServer():void 0,fileUnions:_e.length?_e:void 0,TypeBoxError:m?Ze:void 0,parser:e[`~parser`],...c.inject})}catch(t){let n=Ph(r);return console.log(`[Composer] failed to generate optimized handler`),console.log(`---`),console.log({handler:typeof a==`function`?a.toString():a,instruction:p,hooks:{...n,transform:n?.transform?.map?.(e=>e.toString()),resolve:n?.resolve?.map?.(e=>e.toString()),beforeHandle:n?.beforeHandle?.map?.(e=>e.toString()),afterHandle:n?.afterHandle?.map?.(e=>e.toString()),mapResponse:n?.mapResponse?.map?.(e=>e.toString()),parse:n?.parse?.map?.(e=>e.toString()),error:n?.error?.map?.(e=>e.toString()),afterResponse:n?.afterResponse?.map?.(e=>e.toString()),stop:n?.stop?.map?.(e=>e.toString())},validator:i,definitions:e.definitions.type,error:t}),console.log(`---`),typeof process?.exit==`function`&&process.exit(1),()=>new Response(`Internal Server Error`,{status:500})}},Ov=(e,t)=>{let n=``,r=gv({trace:e.event.trace,addFn:t??(e=>{n+=e})})(`request`,{total:e.event.request?.length});if(e.event.request?.length){n+=`try{`;for(let t=0;t<e.event.request.length;t++){let i=e.event.request[t],a=Cv(i),o=Sv(i),s=r.resolveChild(e.event.request[t].fn.name);a?(n+=`re=mapEarlyResponse(${o?`await `:``}onRequest[${t}](c),c.set)
`,s(`re`),n+=`if(re!==undefined)return re
`):(n+=`${o?`await `:``}onRequest[${t}](c)
`,s())}n+=`}catch(error){return app.handleError(c,error,false)}`}return r.resolve(),n},kv=(e,t=`map`)=>{let n=e.extender.higherOrderFunctions;if(!n.length)return`return `+t;let r=e[`~adapter`].composeGeneralHandler,i=t;for(let e=0;e<n.length;e++)i=`hoc[${e}](${i},${r.parameters})`;return`return function hocMap(${r.parameters}){return ${i}(${r.parameters})}`},Av=e=>{let t=e[`~adapter`].composeGeneralHandler;e.router.http.build();let n=e[`~adapter`].isWebStandard,r=e.event.trace?.length,i=``,a=e.router,o=a.http.root.WS?`const route=router.find(r.method==='GET'&&r.headers.get('upgrade')==='websocket'?'WS':r.method,p)`:`const route=router.find(r.method,p)`;o+=a.http.root.ALL?`??router.find('ALL',p)
`:`
`,n&&(o+=`if(r.method==="HEAD"){const route=router.find("GET",p);if(route){c.params=route.params;const _res=route.store.handler?route.store.handler(c):route.store.compile()(c);if(_res)return Promise.resolve(_res).then((_res)=>{if(!_res.headers)_res.headers=new Headers();return getResponseLength(_res).then((length)=>{_res.headers.set("content-length", length);return new Response(null,{status:_res.status,statusText:_res.statusText,headers:_res.headers});})});}}`);let s=`c.error=notFound
`;if(e.event.afterResponse?.length&&!e.event.error){s=`
c.error=notFound
`;let t=e.event.afterResponse.some(Sv)?`async`:``;s+=`
${Ev}(${t}()=>{if(c.responseValue instanceof ElysiaCustomStatusResponse) c.set.status=c.responseValue.code
`;for(let t=0;t<e.event.afterResponse.length;t++){let n=e.event.afterResponse[t].fn;s+=`
${yv(n)?`await `:``}afterResponse[${t}](c)
`}s+=`})
`}e.inference.query&&(s+=`
if(c.qi===-1){c.query={}}else{c.query=parseQueryFromURL(c.url,c.qi+1)}`);let c=t.error404(!!e.event.request?.length,!!e.event.error?.length,s);o+=c.code,o+=`
c.params=route.params
if(route.store.handler)return route.store.handler(c)
return route.store.compile()(c)
`;let l=``;for(let[t,r]of Object.entries(a.static)){l+=`case'${t}':`,e.config.strictPath!==!0&&(l+=`case'${Uh(t)}':`);let i=Wh(t);t!==i&&(l+=`case'${i}':`),l+=`switch(r.method){`,(`GET`in r||`WS`in r)&&(l+=`case 'GET':`,`WS`in r&&(l+=`if(r.headers.get('upgrade')==='websocket')return ht[${r.WS}].composed(c)
`,`GET`in r||(`ALL`in r?l+=`return ht[${r.ALL}].composed(c)
`:l+=`break map
`)),`GET`in r&&(l+=`return ht[${r.GET}].composed(c)
`)),n&&(`GET`in r||`ALL`in r)&&!(`HEAD`in r)&&(l+=`case 'HEAD':return Promise.resolve(ht[${r.GET??r.ALL}].composed(c)).then(_ht=>getResponseLength(_ht).then((length)=>{_ht.headers.set('content-length', length)
return new Response(null,{status:_ht.status,statusText:_ht.statusText,headers:_ht.headers})
}))
`);for(let[e,t]of Object.entries(r))e===`ALL`||e===`GET`||e===`WS`||(l+=`case '${e}':return ht[${t}].composed(c)
`);`ALL`in r?l+=`default:return ht[${r.ALL}].composed(c)
`:l+=`default:break map
`,l+=`}`}let u=!!e.event.request?.some(Sv),d=t.inject?Object.keys(t.inject).join(`,`)+`,`:``;i+=`
const {app,mapEarlyResponse,NotFoundError,randomId,handleError,status,redirect,getResponseLength,ElysiaCustomStatusResponse,`+$(`parseQueryFromURL,`,e.inference.query)+$(`ELYSIA_TRACE,`,r)+$(`ELYSIA_REQUEST_ID,`,r)+d+`}=data
const store=app.singleton.store
const decorator=app.singleton.decorator
const staticRouter=app.router.static.http
const ht=app.router.history
const router=app.router.http
const trace=app.event.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const notFound=new NotFoundError()
const hoc=app.extender.higherOrderFunctions.map(x=>x.fn)
`,e.event.request?.length&&(i+=`const onRequest=app.event.request.map(x=>x.fn)
`),e.event.afterResponse?.length&&(i+=`const afterResponse=app.event.afterResponse.map(x=>x.fn)
`),i+=c.declare,e.event.trace?.length&&(i+=`const `+e.event.trace.map((e,t)=>`tr${t}=app.event.trace[${t}].fn`).join(`,`)+`
`),i+=`${u?`async `:``}function map(${t.parameters}){`,e.event.request?.length&&(i+=`let re
`),i+=t.createContext(e),e.event.trace?.length&&(i+=`c[ELYSIA_TRACE]=[`+e.event.trace.map((e,t)=>`tr${t}(c)`).join(`,`)+`]
`),i+=Ov(e),l&&(i+=`
map: switch(p){
`+l+`}`),i+=o+`}
`+kv(e);let f=jv(e);e.handleError=f;let p=Function(`data`,`"use strict";
`+i)({app:e,mapEarlyResponse:e[`~adapter`].handler.mapEarlyResponse,NotFoundError:eg,randomId:Bh,handleError:f,status:$h,redirect:Ih,getResponseLength:Kh,ElysiaCustomStatusResponse:Qh,parseQueryFromURL:e.inference.query?w_:void 0,ELYSIA_TRACE:r?D_:void 0,ELYSIA_REQUEST_ID:r?Rh:void 0,...t.inject});return Qm&&Bun.gc(!1),p},jv=e=>{let t=e.event,n=``,r=e[`~adapter`].composeError,i=r.inject?Object.keys(r.inject).join(`,`)+`,`:``,a=!!e.event.trace?.length;n+=`const {mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,ValidationError,TransformDecodeError,`+$(`onError,`,e.event.error)+$(`afterResponse,`,e.event.afterResponse)+$(`trace,`,e.event.trace)+$(`onMapResponse,`,e.event.mapResponse)+$(`ELYSIA_TRACE,`,a)+$(`ELYSIA_REQUEST_ID,`,a)+i+`}=inject
`,n+=`return async function(context,error,skipGlobal){`,n+=``,a&&(n+=`const id=context[ELYSIA_REQUEST_ID]
`);let o=gv({context:`context`,trace:t.trace,addFn:e=>{n+=e}}),s=()=>{if(!t.afterResponse?.length&&!a)return``;let e=``,n=t.afterResponse?.some(Sv)?`async`:``;e+=`
${Ev}(${n}()=>{`;let r=gv({context:`context`,trace:t.trace,addFn:t=>{e+=t}})(`afterResponse`,{total:t.afterResponse?.length,name:`context`});if(t.afterResponse?.length&&t.afterResponse)for(let n=0;n<t.afterResponse.length;n++){let i=t.afterResponse[n].fn,a=r.resolveChild(i.name);e+=`
${yv(i)?`await `:``}afterResponse[${n}](context)
`,a()}return r.resolve(),e+=`})
`,e};n+=`const set=context.set
let _r
if(!context.code)context.code=error.code??error[ERROR_CODE]
if(!(context.error instanceof Error))context.error=error
if(error instanceof ElysiaCustomStatusResponse){set.status=error.status=error.code
error.message=error.response}`,r.declare&&(n+=r.declare);let c=a||t.afterResponse?.length?`context.response = `:``;if(n+=`if(typeof error?.toResponse==='function'&&!(error instanceof ValidationError)&&!(error instanceof TransformDecodeError)){try{let raw=error.toResponse()
if(typeof raw?.then==='function')raw=await raw
if(raw instanceof Response)set.status=raw.status
context.response=context.responseValue=raw
}catch(toResponseError){
}
}
`,e.event.error)for(let i=0;i<e.event.error.length;i++){let a=e.event.error[i],l=`${Sv(a)?`await `:``}onError[${i}](context)
`;if(n+=`if(skipGlobal!==true&&!context.response){`,Cv(a)){n+=`_r=${l}
if(_r!==undefined){if(_r instanceof Response){`+s()+`return mapResponse(_r,set${r.mapResponseContext})}if(_r instanceof ElysiaCustomStatusResponse){error.status=error.code
error.message = error.response}if(set.status===200||!set.status)set.status=error.status
`;let e=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(t.mapResponse?.length)for(let r=0;r<t.mapResponse.length;r++){let i=t.mapResponse[r],a=e.resolveChild(i.fn.name);n+=`context.response=context.responseValue=_r_r=${yv(i)?`await `:``}onMapResponse[${r}](context)
`,a()}e.resolve(),n+=s()+`return mapResponse(${c}_r,set${r.mapResponseContext})}`}else n+=l;n+=`}`}n+=`if(error instanceof ValidationError||error instanceof TransformDecodeError){
if(error.error)error=error.error
set.status=error.status??422
`+s()+r.validationError+`
}
`,n+=`if(!context.response&&error instanceof Error){`+s()+r.unknownError+`
}`;let l=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(n+=`
if(!context.response)context.response=context.responseValue=error.message??error
`,t.mapResponse?.length){n+=`let mr
`;for(let e=0;e<t.mapResponse.length;e++){let r=t.mapResponse[e],i=l.resolveChild(r.fn.name);n+=`if(mr===undefined){mr=${yv(r)?`await `:``}onMapResponse[${e}](context)
if(mr!==undefined)error=context.response=context.responseValue=mr}`,i()}}l.resolve(),n+=s()+`
return mapResponse(${c}error,set${r.mapResponseContext})}`;let u=e=>typeof e==`function`?e:e.fn;return Function(`inject`,`"use strict";
`+n)({mapResponse:e[`~adapter`].handler.mapResponse,ERROR_CODE:Yh,ElysiaCustomStatusResponse:Qh,ValidationError:X,TransformDecodeError:Fp,onError:e.event.error?.map(u),afterResponse:e.event.afterResponse?.map(u),trace:e.event.trace?.map(u),onMapResponse:e.event.mapResponse?.map(u),ELYSIA_TRACE:a?D_:void 0,ELYSIA_REQUEST_ID:a?Rh:void 0,...r.inject})};function Mv(){try{if(typeof caches<`u`&&typeof caches.default<`u`||typeof WebSocketPair<`u`)return!0}catch{return!1}return!1}({...v_}),{...v_.composeGeneralHandler};var Nv=e=>{e.startsWith(`async`)&&(e=e.slice(5)),e=e.trimStart();let t=-1;if(e.charCodeAt(0)===40&&(t=e.indexOf(`=>`,e.indexOf(`)`)),t!==-1)){let n=t;for(;n>0&&e.charCodeAt(--n)!==41;);let r=e.slice(t+2);return r.charCodeAt(0)===32&&(r=r.trimStart()),[e.slice(1,n),r,{isArrowReturn:r.charCodeAt(0)!==123}]}if(/^(\w+)=>/g.test(e)&&(t=e.indexOf(`=>`),t!==-1)){let n=e.slice(t+2);return n.charCodeAt(0)===32&&(n=n.trimStart()),[e.slice(0,t),n,{isArrowReturn:n.charCodeAt(0)!==123}]}if(e.startsWith(`function`)){t=e.indexOf(`(`);let n=e.indexOf(`)`);return[e.slice(t+1,n),e.slice(n+2),{isArrowReturn:!1}]}let n=e.indexOf(`(`);if(n!==-1){let t=e.indexOf(`
`,2),r=e.slice(0,t),i=r.lastIndexOf(`)`)+1,a=e.slice(t+1);return[r.slice(n,i),`{`+a,{isArrowReturn:!1}]}let r=e.split(`
`,2);return[r[0],r[1],{isArrowReturn:!1}]},Pv=e=>{let t=e.indexOf(`{`);if(t===-1)return[-1,0];let n=t+1,r=1;for(;n<e.length;n++){let t=e.charCodeAt(n);if(t===123?r++:t===125&&r--,r===0)break}return r===0?[t,n+1]:[0,e.length]},Fv=e=>{let t=e.lastIndexOf(`}`);if(t===-1)return[-1,0];let n=t-1,r=1;for(;n>=0;n--){let t=e.charCodeAt(n);if(t===125?r++:t===123&&r--,r===0)break}return r===0?[n,t+1]:[-1,0]},Iv=e=>{for(;;){let t=e.indexOf(`:`);if(t===-1)break;let n=e.indexOf(`,`,t);n===-1&&(n=e.indexOf(`}`,t)-1),n===-2&&(n=e.length),e=e.slice(0,t)+e.slice(n)}return e},Lv=e=>{let t=!1;e.charCodeAt(0)===40&&(e=e.slice(1,-1)),e.charCodeAt(0)===123&&(t=!0,e=e.slice(1,-1)),e=e.replace(/( |\t|\n)/g,``).trim();let n=[];for(;;){let[t,r]=Pv(e);if(t===-1)break;n.push(e.slice(0,t-1)),e.charCodeAt(r)===44&&r++,e=e.slice(r)}e=Iv(e),e&&(n=n.concat(e.split(`,`)));let r=Object.create(null);for(let e of n){if(e.indexOf(`,`)===-1){r[e]=!0;continue}for(let t of e.split(`,`))r[t.trim()]=!0}return{hasParenthesis:t,parameters:r}},Rv=(e,t)=>{let{parameters:n,hasParenthesis:r}=Lv(e);return n.query&&(t.query=!0),n.headers&&(t.headers=!0),n.body&&(t.body=!0),n.cookie&&(t.cookie=!0),n.set&&(t.set=!0),n.server&&(t.server=!0),n.route&&(t.route=!0),n.url&&(t.url=!0),n.path&&(t.path=!0),r?`{ ${Object.keys(n).join(`, `)} }`:Object.keys(n).join(`, `)},zv=(e,t,n)=>{let r=RegExp(`${e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}[\\n\\t,; ]`);n!==void 0&&(r.lastIndex=n);let i=r.exec(t);return i?i.index:-1},Bv=(e,t,n=0)=>{if(n>5)return[];let r=[],i=t;for(;;){let t=zv(` = `+e,i);if(t===-1&&(t=zv(`=`+e,i)),t===-1){let n=i.indexOf(` = `+e);if(n===-1&&(n=i.indexOf(`=`+e)),n+3+e.length!==i.length)break;t=n}let n=i.slice(0,t),a=n.lastIndexOf(` `),o=n.slice(a===-1?-1:a+1);if(o===`}`){let[a,o]=Fv(n);r.push(Iv(i.slice(a,o))),i=i.slice(t+3+e.length);continue}for(;o.charCodeAt(0)===44;)o=o.slice(1);for(;o.charCodeAt(0)===9;)o=o.slice(1);o.includes(`(`)||r.push(o),i=i.slice(t+3+e.length)}for(let e of r){if(e.charCodeAt(0)===123)continue;let n=Bv(e,t);n.length>0&&r.push(...n)}return r},Vv=e=>{if(!e)return;if(e.charCodeAt(0)!==123)return e;if(e=e.slice(2,-2),!e.includes(`,`))return e.indexOf(`...`)===-1?void 0:e.slice(e.indexOf(`...`)+3);let t=e.indexOf(`...`);if(t!==-1)return e.slice(t+3).trimEnd()},Hv=(e,t,n)=>{let r=(t,n)=>RegExp(`${n}\\.(${t})|${n}\\["${t}"\\]|${n}\\['${t}'\\]`).test(e);for(let i of t)if(i){if(i.charCodeAt(0)===123){let e=Lv(i).parameters;e.query&&(n.query=!0),e.headers&&(n.headers=!0),e.body&&(n.body=!0),e.cookie&&(n.cookie=!0),e.set&&(n.set=!0),e.server&&(n.server=!0),e.url&&(n.url=!0),e.route&&(n.route=!0),e.path&&(n.path=!0);continue}if(!n.query&&(r(`query`,i)||e.includes(`return `+i)||e.includes(`return `+i+`.query`))&&(n.query=!0),!n.headers&&r(`headers`,i)&&(n.headers=!0),!n.body&&r(`body`,i)&&(n.body=!0),!n.cookie&&r(`cookie`,i)&&(n.cookie=!0),!n.set&&r(`set`,i)&&(n.set=!0),!n.server&&r(`server`,i)&&(n.server=!0),!n.route&&r(`route`,i)&&(n.route=!0),!n.url&&r(`url`,i)&&(n.url=!0),!n.path&&r(`path`,i)&&(n.path=!0),n.query&&n.headers&&n.body&&n.cookie&&n.set&&n.server&&n.route&&n.url&&n.path)break}return t},Uv=(e,t,n)=>{try{let r=RegExp(`\\w\\((?:.*?)?${e}(?:.*?)?\\)`,`gs`),i=RegExp(`${e}(,|\\))`,`gs`),a=t.length,o;for(o=r.exec(t)+``;r.lastIndex!==0&&r.lastIndex<a+(o?o.length:0);){if(o&&i.test(o))return n.query=!0,n.headers=!0,n.body=!0,n.cookie=!0,n.set=!0,n.server=!0,n.url=!0,n.route=!0,n.path=!0,!0;o=r.exec(t)+``}let s=t.charCodeAt(r.lastIndex);return s===41||s===44?(n.query=!0,n.headers=!0,n.body=!0,n.cookie=!0,n.set=!0,n.server=!0,n.url=!0,n.route=!0,n.path=!0,!0):!1}catch{return console.log(`[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:`),console.log(`--- body ---`),console.log(t),console.log(`--- context ---`),console.log(e),!0}},Wv,Gv={},Kv=e=>{e===null||Mv()||(e===void 0&&(e=295e3),Wv&&clearTimeout(Wv),Wv=setTimeout(()=>{Gv={},Wv=void 0,Qm&&Bun.gc(!1)},e))},qv=(e,t)=>({body:e.body||t.body,cookie:e.cookie||t.cookie,headers:e.headers||t.headers,query:e.query||t.query,set:e.set||t.set,server:e.server||t.server,url:e.url||t.url,route:e.route||t.route,path:e.path||t.path}),Jv=(e,t={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},n={})=>{let r=[];e.request?.length&&r.push(...e.request),e.beforeHandle?.length&&r.push(...e.beforeHandle),e.parse?.length&&r.push(...e.parse),e.error?.length&&r.push(...e.error),e.transform?.length&&r.push(...e.transform),e.afterHandle?.length&&r.push(...e.afterHandle),e.mapResponse?.length&&r.push(...e.mapResponse),e.afterResponse?.length&&r.push(...e.afterResponse),e.handler&&typeof e.handler==`function`&&r.push(e.handler);for(let e=0;e<r.length;e++){let i=r[e];if(!i)continue;let a=typeof i==`object`?i.fn:i;if(typeof a!=`function`)continue;let o=a.toString(),s=gh(o),c=Gv[s];if(c){t=qv(t,c);continue}Kv(n.gcTime);let l={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},[u,d]=Nv(o),f=Vv(Rv(u,l));if(f){let e=Bv(f,d.slice(1,-1));e.splice(0,-1,f);let t=d;t.charCodeAt(0)===123&&t.charCodeAt(d.length-1)===125&&(t=t.slice(1,-1).trim()),Uv(f,t,l)||Hv(t,e,l),!l.query&&t.includes(`return `+f+`.query`)&&(l.query=!0)}if(Gv[s]||(Gv[s]=l),t=qv(t,l),t.query&&t.headers&&t.body&&t.cookie&&t.set&&t.server&&t.url&&t.route&&t.path)break}return t},Yv=(e,t,n)=>{if(Y(t.headers)||t.status!==200||t.cookie)switch(s_(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Q(e.value,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Yv(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return ey(e,t,n);case`Error`:return Qv(e,t);case`Promise`:return e.then(e=>Yv(e,t,n));case`Function`:return Yv(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return ey(e,t,n);if(e instanceof Promise)return e.then(e=>Yv(e,t));if(e instanceof Error)return Qv(e,t);if(e instanceof Qh)return t.status=e.code,Yv(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return ty(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Yv(e,t));if(typeof e?.toResponse==`function`)return Yv(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return typeof e?.next==`function`||e instanceof ReadableStream?ty(e,t,n):Zv(e,n)},Xv=(e,t,n)=>{if(e!=null)if(Y(t.headers)||t.status!==200||t.cookie)switch(s_(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Q(e.value,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Xv(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return ey(e,t,n);case`Promise`:return e.then(e=>Xv(e,t));case`Error`:return Qv(e,t);case`Function`:return Xv(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return ey(e,t,n);if(e instanceof Promise)return e.then(e=>Xv(e,t));if(e instanceof Error)return Qv(e,t);if(e instanceof Qh)return t.status=e.code,Xv(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return ty(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Xv(e,t));if(typeof e?.toResponse==`function`)return Xv(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Q(e.value,t);case`File`:return Q(e,t);case`Blob`:return Q(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Xv(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Promise`:return e.then(e=>{let n=Xv(e,t);if(n!==void 0)return n});case`Error`:return Qv(e,t);case`Function`:return Zv(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof Zg?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Xv(e,t));if(e instanceof Error)return Qv(e,t);if(e instanceof Qh)return t.status=e.code,Xv(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return ty(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Xv(e,t));if(typeof e?.toResponse==`function`)return Xv(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},Zv=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e);case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return Q(e.value);case`File`:return Q(e);case`Blob`:return Q(e);case`ElysiaCustomStatusResponse`:return Yv(e.response,{status:e.code,headers:{}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Error`:return Qv(e);case`Promise`:return e.then(e=>Zv(e,t));case`Function`:return Zv(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Zv(e,t));if(e instanceof Error)return Qv(e);if(e instanceof Qh)return Yv(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`||e instanceof ReadableStream)return ty(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>Yv(e,set));if(typeof e?.toResponse==`function`)return Zv(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},Qv=(e,t)=>{if(typeof e?.toResponse==`function`){let n=e.toResponse(),r=t??{headers:{},status:200,redirect:``},i=e=>(e instanceof Response&&(r.status=e.status),Yv(e,r));return typeof n?.then==`function`?n.then(i):i(n)}return new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status===200?500:t?.status??500,headers:t?.headers})},$v=(e,t,n={})=>{if(typeof e==`function`)return;let r=Yv(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return()=>r.clone()},ey=c_({mapResponse:Yv,mapCompactResponse:Zv}),ty=a_({mapResponse:Yv,mapCompactResponse:Zv}),ny=(e,t)=>t?e:``,ry=(e,t,n,r=!1)=>{let i=``,a=e.setHeaders,o=!!e.event.trace?.length;o&&(i+=`const id=randomId()
`);let s=/[:*]/.test(t.path),c=`const u=request.url,s=u.indexOf('/',${e.config.handler?.standardHostname??!0?11:7}),qi=u.indexOf('?', s + 1)
`,l=n.query||!!t.hooks.query||!!t.hooks.standaloneValidator?.find(e=>e.query)||e.event.request?.length;l&&(i+=c);let u=n.path?s?`get path(){`+(l?``:c)+`if(qi===-1)return u.substring(s)
return u.substring(s,qi)
},`:`path:'${t.path}',`:``;i+=ny(`const c=`,!r)+`{request,store,`+ny(`qi,`,l)+ny(`params:request.params,`,s)+u+ny(`url:request.url,`,o||n.url||l)+`redirect,status,set:{headers:`+(Y(a)?`Object.assign({},app.setHeaders)`:`Object.create(null)`)+`,status:200}`,n.server&&(i+=`,get server(){return app.getServer()}`),o&&(i+=`,[ELYSIA_REQUEST_ID]:id`);{let t=``;for(let n of Object.keys(e.singleton.decorator))t+=`,'${n}':decorator['${n}']`;i+=t}return i+=`}
`,i},iy=(e,t)=>{let n=!!e.event.trace?.length,r=!!e.extender.higherOrderFunctions.length,i=Jv(t.hooks,e.inference);i=Jv({handler:t.handler},i);let a=`const handler=data.handler,app=data.app,store=data.store,decorator=data.decorator,redirect=data.redirect,route=data.route,mapEarlyResponse=data.mapEarlyResponse,`+ny(`randomId=data.randomId,`,n)+ny(`ELYSIA_REQUEST_ID=data.ELYSIA_REQUEST_ID,`,n)+ny(`ELYSIA_TRACE=data.ELYSIA_TRACE,`,n)+ny(`trace=data.trace,`,n)+ny(`hoc=data.hoc,`,r)+`status=data.status
`;e.event.request?.length&&(a+=`const onRequest=app.event.request.map(x=>x.fn)
`),a+=`${e.event.request?.find(Sv)?`async`:``} function map(request){`;let o=i.query||!!t.hooks.query||!!t.hooks.standaloneValidator?.find(e=>e.query);return n||o||e.event.request?.length?(a+=ry(e,t,i),a+=Ov(e),a+=`return handler(c)}`):a+=`return handler(${ry(e,t,i,!0)})}`,a+=kv(e),Function(`data`,a)({app:e,handler:t.compile?.()??t.composed,redirect:Ih,status:$h,hoc:e.extender.higherOrderFunctions.map(e=>e.fn),store:e.store,decorator:e.decorator,route:t.path,randomId:n?Bh:void 0,ELYSIA_TRACE:n?D_:void 0,ELYSIA_REQUEST_ID:n?Rh:void 0,trace:n?e.event.trace?.map(e=>e?.fn??e):void 0,mapEarlyResponse:Xv})},ay=(e,t,n)=>{if(typeof e==`function`||e instanceof Blob)return;if(fy(e))return()=>e;let r=Yv(e,n??{headers:{}});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return r instanceof Promise?r.then(e=>{if(e)return e.headers.has(`content-type`)||e.headers.append(`content-type`,`text/plain`),e.clone()}):(r.headers.has(`content-type`)||r.headers.append(`content-type`,`text/plain`),()=>r.clone())},oy={open(e){e.data.open?.(e)},message(e,t){e.data.message?.(e,t)},drain(e){e.data.drain?.(e)},close(e,t,n){e.data.close?.(e,t,n)},ping(e){e.data.ping?.(e)},pong(e){e.data.pong?.(e)}},sy=class{constructor(e,t,n=void 0){this.raw=e,this.data=t,this.body=n,this.validator=e.data?.validator,this.sendText=e.sendText.bind(e),this.sendBinary=e.sendBinary.bind(e),this.close=e.close.bind(e),this.terminate=e.terminate.bind(e),this.publishText=e.publishText.bind(e),this.publishBinary=e.publishBinary.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.isSubscribed=e.isSubscribed.bind(e),this.cork=e.cork.bind(e),this.remoteAddress=e.remoteAddress,this.binaryType=e.binaryType,this.data=e.data,this.send=this.send.bind(this),this.ping=this.ping.bind(this),this.pong=this.pong.bind(this),this.publish=this.publish.bind(this)}send(e,t){return Buffer.isBuffer(e)?this.raw.send(e,t):this.validator?.Check(e)===!1?this.raw.send(new X(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.send(e,t))}ping(e){return Buffer.isBuffer(e)?this.raw.ping(e):this.validator?.Check(e)===!1?this.raw.send(new X(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.ping(e))}pong(e){return Buffer.isBuffer(e)?this.raw.pong(e):this.validator?.Check(e)===!1?this.raw.send(new X(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.pong(e))}publish(e,t,n){return Buffer.isBuffer(t)?this.raw.publish(e,t,n):this.validator?.Check(t)===!1?this.raw.send(new X(`message`,this.validator,t).message):(typeof t==`object`&&(t=JSON.stringify(t)),this.raw.publish(e,t,n))}get readyState(){return this.raw.readyState}get id(){return this.data.id}},cy=e=>{let t=typeof e==`function`?[e]:e;return async function(e,n){if(typeof n==`string`){let e=n?.charCodeAt(0);if(e===34||e===47||e===91||e===123)try{n=JSON.parse(n)}catch{}else Ah(n)?n=+n:n===`true`?n=!0:n===`false`?n=!1:n===`null`&&(n=null)}if(t)for(let r=0;r<t.length;r++){let i=t[r](e,n);if(i instanceof Promise&&(i=await i),i!==void 0)return i}return n}},ly=e=>{let t=(n,r)=>{if(r instanceof Promise)return r.then(e=>t(n,e));if(Buffer.isBuffer(r))return n.send(r.toString());if(r===void 0)return;let i=e?e.provider===`standard`?t=>e.schema[`~standard`].validate(t).issues:t=>e.Check(t)===!1:void 0,a=t=>{if(i&&i(t)===!1)return n.send(new X(`message`,e,t).message);if(typeof t==`object`)return n.send(JSON.stringify(t));n.send(t)};if(typeof r?.next!=`function`)return void a(r);let o=r.next();if(o instanceof Promise)return(async()=>{let t=await o;if(i&&i(t))return n.send(new X(`message`,e,t).message);if(a(t.value),!t.done)for await(let e of r)a(e)})();if(a(o.value),!o.done)for(let e of r)a(e)};return t},uy=/:.+?\?(?=\/|$)/,dy=e=>{let t=uy.exec(e);if(!t)return[e];let n=[],r=e.slice(0,t.index),i=t[0].slice(0,-1),a=e.slice(t.index+t[0].length);n.push(r.slice(0,-1)),n.push(r+i);for(let e of dy(a))e&&(e.startsWith(`/:`)||n.push(r.slice(0,-1)+e),n.push(r+i+e));return n},fy=e=>typeof e==`object`&&!!e&&(e.toString()===`[object HTMLBundle]`||typeof e.index==`string`),py={GET:!0,HEAD:!0,OPTIONS:!0,DELETE:!0,PATCH:!0,POST:!0,PUT:!0},my=e=>{if(!e.config.aot||!e.config.systemRouter)return;let t={},n=(e,n)=>{let r=encodeURI(e.path);t[r]?t[r][e.method]||(t[r][e.method]=n):t[r]={[e.method]:n}},r=e.routeTree;for(let i of e.router.history){if(typeof i.handler!=`function`)continue;let a=i.method;if(a===`GET`&&`WS_${i.path}`in r||a===`WS`||i.path.charCodeAt(i.path.length-1)===42||!(a in py))continue;if(a===`ALL`){`WS_${i.path}`in r||(t[i.path]=i.hooks?.config?.mount?i.hooks.trace||e.event.trace||e.extender.higherOrderFunctions?iy(e,i):i.hooks.mount||i.handler:i.handler);continue}let o,s=e.config.precompile?iy(e,i):t=>o?o(t):(o=iy(e,i))(t);for(let e of dy(i.path))n({method:a,path:e},s)}return t},hy=(e,t)=>{if(!t)return e;for(let n of Object.keys(t))if(e[n]!==t[n]){if(!e[n]){e[n]=t[n];continue}if(e[n]&&t[n]){if(typeof e[n]==`function`||e[n]instanceof Response){e[n]=t[n];continue}e[n]={...e[n],...t[n]}}}return e},gy={...v_,name:`bun`,handler:{mapResponse:Yv,mapEarlyResponse:Xv,mapCompactResponse:Zv,createStaticHandler:$v,createNativeStaticHandler:ay},composeHandler:{...v_.composeHandler,headers:ih?`c.headers=c.request.headers.toJSON()
`:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`},listen(e){return(t,n)=>{if(typeof Bun>`u`)throw Error(`.listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch`);if(e.compile(),typeof t==`string`){if(!Ah(t))throw Error(`Port must be a numeric value`);t=parseInt(t)}let r=(e,{withAsync:t=!1}={})=>{let n={},r=[];for(let[i,a]of Object.entries(e))if(i=encodeURI(i),Gh){if(!a)continue;for(let[e,o]of Object.entries(a))if(!(!o||!(e in py))){if(o instanceof Promise){t&&(n[i]||(n[i]={}),r.push(o.then(t=>{t instanceof Response&&(n[i][e]=t),fy(t)&&(n[i][e]=t)})));continue}!(o instanceof Response)&&!fy(o)||(n[i]||(n[i]={}),n[i][e]=o)}}else{if(!a)continue;if(a instanceof Promise){t&&(n[i]||(n[i]={}),r.push(a.then(e=>{e instanceof Response&&(n[i]=e)})));continue}if(!(a instanceof Response))continue;n[i]=a}return t?Promise.all(r).then(()=>n):n},i=typeof t==`object`?{development:!Xh,reusePort:!0,idleTimeout:30,...e.config.serve||{},...t||{},routes:hy(hy(r(e.router.response),my(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...oy||{},...t.websocket||{}},fetch:e.fetch}:{development:!Xh,reusePort:!0,idleTimeout:30,...e.config.serve||{},routes:hy(hy(r(e.router.response),my(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...oy||{}},port:t,fetch:e.fetch};if(e.server=Bun.serve(i),e.event.start)for(let t=0;t<e.event.start.length;t++)e.event.start[t].fn(e);n&&n(e.server),process.on(`beforeExit`,async()=>{if(e.server&&(await e.server.stop?.(),e.server=null,e.event.stop))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)}),e.promisedModules.then(async()=>{e.config.aot,e.compile(),e.server?.reload({...i,fetch:e.fetch,routes:hy(hy(await r(e.router.response,{withAsync:!0}),my(e)),e.config.serve?.routes)}),Bun?.gc(!1)})}},async stop(e,t){if(e.server){if(await e.server.stop(t),e.server=null,e.event.stop?.length)for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)}else console.log("Elysia isn't running. Call `app.listen` to start the server.",Error().stack)},ws(e,t,n){let{parse:r,body:i,response:a,...o}=n,s=cv(i,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize}),c=s?s.provider===`standard`?e=>s.schema[`~standard`].validate(e).issues:e=>s.Check(e)===!1:void 0,l=cv(a,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize});e.route(`WS`,t,async t=>{let i=t.server??e.server,{set:a,path:o,qi:u,headers:d,query:f,params:p}=t;if(t.validator=l,n.upgrade)if(typeof n.upgrade==`function`){let e=n.upgrade(t);e instanceof Promise&&await e}else n.upgrade&&Object.assign(a.headers,n.upgrade);if(a.cookie&&Y(a.cookie)){let e=e_(a.cookie);e&&(a.headers[`set-cookie`]=e)}a.headers[`set-cookie`]&&Array.isArray(a.headers[`set-cookie`])&&(a.headers=n_(new Headers(a.headers),a.headers[`set-cookie`]));let m=ly(l),h=cy(r),g;if(typeof n.beforeHandle==`function`){let e=n.beforeHandle(t);e instanceof Promise&&await e}let _=[...n.error?Array.isArray(n.error)?n.error:[n.error]:[],...(e.event.error??[]).map(e=>typeof e==`function`?e:e.fn)].filter(e=>e),ee=_.length>0,te=ee?async(e,n)=>{for(let r of _){let i=r(Object.assign(t,{error:n}));if(i instanceof Promise&&(i=await i),await m(e,i),i)break}}:()=>{};if(!i?.upgrade(t.request,{headers:Y(a.headers)?a.headers:void 0,data:{...t,get id(){return g||=Bh()},validator:l,ping(e,t){n.ping?.(e,t)},pong(e,t){n.pong?.(e,t)},open:async e=>{try{await m(e,n.open?.(new sy(e,t)))}catch(t){te(e,t)}},message:async(e,r)=>{let i=await h(e,r);if(c&&c(i)){let t=new X(`message`,s,i);return ee?te(e,t):void e.send(t.message)}try{await m(e,n.message?.(new sy(e,t,i),i))}catch(t){te(e,t)}},drain:async e=>{try{await m(e,n.drain?.(new sy(e,t)))}catch(t){te(e,t)}},close:async(e,r,i)=>{try{await m(e,n.close?.(new sy(e,t),r,i))}catch(t){te(e,t)}}}}))return $h(400,`Expected a websocket connection`)},{...o,websocket:n})}},_y=(e,t)=>{let n=e.schema;if(n&&(n.$defs?.[n.$ref]&&(n=n.$defs[n.$ref]),n?.properties))for(let[e,r]of Object.entries(n.properties))t[e]??=r.default},vy=e=>{let{mapResponse:t,mapEarlyResponse:n}=e[`~adapter`].handler,r=e.setHeaders;return async i=>{let a=i.url,o=a.indexOf(`/`,11),s=a.indexOf(`?`,o+1),c=s===-1?a.substring(o):a.substring(o,s),l={cookie:{},status:200,headers:r?{...r}:{}},u=Object.assign({},e.singleton.decorator,{set:l,store:e.singleton.store,request:i,path:c,qi:s,error:$h,status:$h,redirect:Ih}),d;try{if(e.event.request)for(let t=0;t<e.event.request.length;t++){let r=e.event.request[t].fn,i=r(u);if(i instanceof Promise&&(i=await i),i=n(i,l),i)return u.response=i}let r=i.method===`GET`&&i.headers.get(`upgrade`)?.toLowerCase()===`websocket`?`WS`:i.method,o=e.router.dynamic.find(i.method,c)??e.router.dynamic.find(r,c)??e.router.dynamic.find(`ALL`,c);if(!o)throw u.query=s===-1?{}:E_(a.substring(s+1)),new eg;let{handle:f,validator:p,content:m,route:h}=o.store;d=o.store.hooks;let g;if(i.method!==`GET`&&i.method!==`HEAD`)if(m)switch(m){case`application/json`:g=await i.json();break;case`text/plain`:g=await i.text();break;case`application/x-www-form-urlencoded`:g=E_(await i.text());break;case`application/octet-stream`:g=await i.arrayBuffer();break;case`multipart/form-data`:{g={};let e=await i.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}}else{let t;if(i.body&&(t=i.headers.get(`content-type`)),t){let n=t.indexOf(`;`);if(n!==-1&&(t=t.slice(0,n)),u.contentType=t,d.parse)for(let n=0;n<d.parse.length;n++){let r=d.parse[n].fn;if(typeof r==`string`)switch(r){case`json`:case`application/json`:g=await i.json();break;case`text`:case`text/plain`:g=await i.text();break;case`urlencoded`:case`application/x-www-form-urlencoded`:g=E_(await i.text());break;case`arrayBuffer`:case`application/octet-stream`:g=await i.arrayBuffer();break;case`formdata`:case`multipart/form-data`:{g={};let e=await i.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}default:{let n=e[`~parser`][r];if(n){let e=n(u,t);if(e instanceof Promise&&(e=await e),e){g=e;break}}break}}else{let e=r(u,t);if(e instanceof Promise&&(e=await e),e){g=e;break}}}if(delete u.contentType,g===void 0)switch(t){case`application/json`:g=await i.json();break;case`text/plain`:g=await i.text();break;case`application/x-www-form-urlencoded`:g=E_(await i.text());break;case`application/octet-stream`:g=await i.arrayBuffer();break;case`multipart/form-data`:{g={};let e=await i.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}}}}u.route=h,u.body=g,u.params=o?.params||void 0,u.query=s===-1?{}:E_(a.substring(s+1)),u.headers={};for(let[e,t]of i.headers.entries())u.headers[e]=t;let _={domain:e.config.cookie?.domain??p?.cookie?.config.domain,expires:e.config.cookie?.expires??p?.cookie?.config.expires,httpOnly:e.config.cookie?.httpOnly??p?.cookie?.config.httpOnly,maxAge:e.config.cookie?.maxAge??p?.cookie?.config.maxAge,path:e.config.cookie?.path??p?.cookie?.config.path,priority:e.config.cookie?.priority??p?.cookie?.config.priority,partitioned:e.config.cookie?.partitioned??p?.cookie?.config.partitioned,sameSite:e.config.cookie?.sameSite??p?.cookie?.config.sameSite,secure:e.config.cookie?.secure??p?.cookie?.config.secure,secrets:e.config.cookie?.secrets??p?.cookie?.config.secrets,sign:e.config.cookie?.sign??p?.cookie?.config.sign},ee=i.headers.get(`cookie`);u.cookie=await $g(u.set,ee,_);let te=p?.createHeaders?.();te&&_y(te,u.headers);let ne=p?.createParams?.();ne&&_y(ne,u.params);let re=p?.createQuery?.();if(re&&_y(re,u.query),d.transform)for(let e=0;e<d.transform.length;e++){let t=d.transform[e],r=t.fn(u);if(r instanceof Promise&&(r=await r),r instanceof Qh){let e=n(r,u.set);if(e)return u.response=e}t.subType===`derive`&&Object.assign(u,r)}if(p){if(te){let e=structuredClone(u.headers);for(let[t,n]of i.headers)e[t]=n;if(p.headers.Check(e)===!1)throw new X(`header`,p.headers,e)}else p.headers?.Decode&&(u.headers=p.headers.Decode(u.headers));if(ne?.Check(u.params)===!1)throw new X(`params`,p.params,u.params);if(p.params?.Decode&&(u.params=p.params.Decode(u.params)),p.query?.schema){let e=p.query.schema;e.$defs?.[e.$ref]&&(e=e.$defs[e.$ref]);let t=e.properties;for(let e of Object.keys(t)){let n=t[e];(n.type===`array`||n.items?.type===`string`)&&typeof u.query[e]==`string`&&u.query[e]&&(u.query[e]=u.query[e].split(`,`))}}if(re?.Check(u.query)===!1)throw new X(`query`,p.query,u.query);if(p.query?.Decode&&(u.query=p.query.Decode(u.query)),p.createCookie?.()){let e={};for(let[t,n]of Object.entries(u.cookie))e[t]=n.value;if(p.cookie.Check(e)===!1)throw new X(`cookie`,p.cookie,e);p.cookie?.Decode&&(e=p.cookie.Decode(e))}if(p.createBody?.()?.Check(g)===!1)throw new X(`body`,p.body,g);p.body?.Decode&&(u.body=p.body.Decode(g))}if(d.beforeHandle)for(let e=0;e<d.beforeHandle.length;e++){let t=d.beforeHandle[e],r=t.fn(u);if(r instanceof Promise&&(r=await r),r instanceof Qh){let e=n(r,u.set);if(e)return u.response=e}if(t.subType===`resolve`){Object.assign(u,r);continue}if(r!==void 0){if(u.response=r,d.afterHandle)for(let e=0;e<d.afterHandle.length;e++){let t=d.afterHandle[e].fn(u);t instanceof Promise&&(t=await t),t&&(r=t)}let e=n(r,u.set);if(e)return u.response=e}}let v=typeof f==`function`?f(u):f;if(v instanceof Promise&&(v=await v),d.afterHandle?.length){u.response=v;for(let e=0;e<d.afterHandle.length;e++){let t=d.afterHandle[e].fn(u);t instanceof Promise&&(t=await t);let r=t instanceof Qh,i=r?t.code:l.status?typeof l.status==`string`?Sh[l.status]:l.status:200;r&&(l.status=i,t=t.response);let a=p?.createResponse?.()?.[i];if(a?.Check(t)===!1)if(a?.Clean){let e=a.Clean(t);if(a?.Check(e)===!1)throw new X(`response`,a,t);t=e}else throw new X(`response`,a,t);a?.Encode&&(u.response=t=a.Encode(t)),a?.Clean&&(u.response=t=a.Clean(t));let o=n(t,u.set);if(o!==void 0)return u.response=o}}else{let e=v instanceof Qh,t=e?v.code:l.status?typeof l.status==`string`?Sh[l.status]:l.status:200;e&&(l.status=t,v=v.response);let n=p?.createResponse?.()?.[t];if(n?.Check(v)===!1)if(n?.Clean){let e=n.Clean(v);if(n?.Check(e)===!1)throw new X(`response`,n,v);v=e}else throw new X(`response`,n,v);n?.Encode&&(v=n.Encode(v)),n?.Clean&&(v=n.Clean(v))}if(u.set.cookie&&_?.sign){let e=_.secrets?typeof _.secrets==`string`?_.secrets:_.secrets[0]:void 0;if(_.sign===!0){if(e)for(let[t,n]of Object.entries(u.set.cookie))u.set.cookie[t].value=await Eh(n.value,e)}else{let t=p?.cookie?.schema?.properties;if(e)for(let n of _.sign)n in t&&u.set.cookie[n]?.value&&(u.set.cookie[n].value=await Eh(u.set.cookie[n].value,e))}}return t(u.response=v,u.set)}catch(t){let n=t instanceof Fp&&t.error?t.error:t;return e.handleError(u,n)}finally{let t=d?d.afterResponse:e.event.afterResponse;t&&(hh?setImmediate(async()=>{for(let e of t)await e.fn(u)}):Promise.resolve().then(async()=>{for(let e of t)await e.fn(u)}))}}},yy=e=>{let{mapResponse:t}=e[`~adapter`].handler;return async(n,r)=>{let i=Object.assign(n,{error:r,code:r.code});if(i.set=n.set,typeof r?.toResponse==`function`&&!(r instanceof X)&&!(r instanceof Fp))try{let e=r.toResponse();typeof e?.then==`function`&&(e=await e),e instanceof Response&&(n.set.status=e.status),n.response=e}catch{}if(!n.response&&e.event.error)for(let r=0;r<e.event.error.length;r++){let a=e.event.error[r].fn(i);if(a instanceof Promise&&(a=await a),a!=null)return n.response=t(a,n.set)}if(n.response){if(e.event.mapResponse)for(let t=0;t<e.event.mapResponse.length;t++){let r=e.event.mapResponse[t].fn(i);r instanceof Promise&&(r=await r),r!=null&&(n.response=r)}return t(n.response,n.set)}return n.set.status=r.status??500,t(typeof r.cause==`string`?r.cause:r.message,n.set)}},by=e(Du(),1),xy=Symbol.dispose,Sy=class e{constructor(e={}){this.server=null,this.dependencies={},this[`~Prefix`]=``,this[`~Singleton`]=null,this[`~Definitions`]=null,this[`~Metadata`]=null,this[`~Ephemeral`]=null,this[`~Volatile`]=null,this[`~Routes`]=null,this.singleton={decorator:{},store:{},derive:{},resolve:{}},this.definitions={typebox:Z.Module({}),type:{},error:{}},this.extender={macro:{},higherOrderFunctions:[]},this.validator={global:null,scoped:null,local:null,getCandidate(){return!this.global&&!this.scoped&&!this.local?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:fh(fh(this.global,this.scoped),this.local)}},this.standaloneValidator={global:null,scoped:null,local:null},this.event={},this.router={"~http":void 0,get http(){return this[`~http`]||=new y({lazy:!0,onParam:by.default}),this[`~http`]},"~dynamic":void 0,get dynamic(){return this[`~dynamic`]||=new y({onParam:by.default}),this[`~dynamic`]},static:{},response:{},history:[]},this.routeTree={},this.inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1,path:!1,route:!1,url:!1},this[`~parser`]={},this.handle=async e=>this.fetch(e),this.handleError=async(e,t)=>(this.handleError=this.config.aot?jv(this):yy(this))(e,t),this.listen=(e,t)=>(this[`~adapter`].listen(this)(e,t),this),this.stop=async e=>(await this[`~adapter`].stop?.(this,e),this),this[xy]=()=>{this.server&&this.stop()},e.tags&&(e.detail?e.detail.tags=e.tags:e.detail={tags:e.tags}),this.config={aot:t_.ELYSIA_AOT!==`false`,nativeStaticResponse:!0,encodeSchema:!0,normalize:!0,...e,prefix:e.prefix?e.prefix.charCodeAt(0)===47?e.prefix:`/${e.prefix}`:void 0,cookie:{path:`/`,...e?.cookie},experimental:e?.experimental??{},seed:e?.seed===void 0?``:e?.seed},this[`~adapter`]=e.adapter??(typeof Bun<`u`?gy:v_),e?.analytic&&(e?.name||e?.seed!==void 0)&&(this.telemetry={stack:Error().stack})}get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}getGlobalDefinitions(){return this.definitions}getServer(){return this.server}getParent(){return null}get promisedModules(){return this._promisedModules||=new jh(console.error,()=>{}),this._promisedModules}env(e,t=t_){if(cv(e,{modules:this.definitions.typebox,dynamic:!0,additionalProperties:!0,coerce:!0,sanitize:()=>this.config.sanitize}).Check(t)===!1){let n=new X(`env`,e,t);throw Error(n.all.map(e=>e.summary).join(`
`))}return this}wrap(e){return this.extender.higherOrderFunctions.push({checksum:gh(JSON.stringify({name:this.config.name,seed:this.config.seed,content:e.toString()})),fn:e}),this}get models(){let e={};for(let t of Object.keys(this.definitions.type))e[t]=cv(this.definitions.typebox.Import(t));return e.modules=this.definitions.typebox,e}add(e,t,n,r,i){let a=i?.skipPrefix??!1,o=i?.allowMeta??!1;r??={},this.applyMacro(r);let s=[];if(r.standaloneValidator&&(s=s.concat(r.standaloneValidator)),this.standaloneValidator.local&&(s=s.concat(this.standaloneValidator.local)),this.standaloneValidator.scoped&&(s=s.concat(this.standaloneValidator.scoped)),this.standaloneValidator.global&&(s=s.concat(this.standaloneValidator.global)),t!==``&&t.charCodeAt(0)!==47&&(t=`/`+t),this.config.prefix&&!a&&(t=this.config.prefix+t),r?.type)switch(r.type){case`text`:r.type=`text/plain`;break;case`json`:r.type=`application/json`;break;case`formdata`:r.type=`multipart/form-data`;break;case`urlencoded`:r.type=`application/x-www-form-urlencoded`;break;case`arrayBuffer`:r.type=`application/octet-stream`;break;default:break}let c=this.validator.getCandidate(),l={body:r?.body??c?.body,headers:r?.headers??c?.headers,params:r?.params??c?.params,query:r?.query??c?.query,cookie:r?.cookie??c?.cookie,response:r?.response??c?.response},u=this.config.precompile===!0||typeof this.config.precompile==`object`&&this.config.precompile.compose===!0,d=()=>{let e=this.definitions.type,t=!this.config.aot,n=this.config.normalize,r=this.definitions.typebox,i=()=>this.config.sanitize,a=()=>{if(l.cookie||s.find(e=>e.cookie))return fv({modules:r,validator:l.cookie,defaultConfig:this.config.cookie,normalize:n,config:l.cookie?.config??{},dynamic:t,models:e,validators:s.map(e=>e.cookie),sanitize:i})};return u?{body:cv(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:(()=>{let t=tv(l.body,e,r);return t&&j in t&&(nv(`File`,t)||nv(`Files`,t))?Q_():X_()})(),validators:s.map(e=>e.body),sanitize:i}),headers:cv(l.headers,{modules:r,dynamic:t,models:e,additionalProperties:!0,coerce:!0,additionalCoerce:K_(),validators:s.map(e=>e.headers),sanitize:i}),params:cv(l.params,{modules:r,dynamic:t,models:e,coerce:!0,additionalCoerce:K_(),validators:s.map(e=>e.params),sanitize:i}),query:cv(l.query,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:J_(),validators:s.map(e=>e.query),sanitize:i}),cookie:a(),response:dv(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:s.map(e=>e.response),sanitize:i})}:{createBody(){return this.body?this.body:this.body=cv(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:(()=>{let t=tv(l.body,e,r);return t&&j in t&&(nv(`File`,t)||nv(`Files`,t))?Q_():X_()})(),validators:s.map(e=>e.body),sanitize:i})},createHeaders(){return this.headers?this.headers:this.headers=cv(l.headers,{modules:r,dynamic:t,models:e,normalize:n,additionalProperties:!n,coerce:!0,additionalCoerce:K_(),validators:s.map(e=>e.headers),sanitize:i})},createParams(){return this.params?this.params:this.params=cv(l.params,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:K_(),validators:s.map(e=>e.params),sanitize:i})},createQuery(){return this.query?this.query:this.query=cv(l.query,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:J_(),validators:s.map(e=>e.query),sanitize:i})},createCookie(){return this.cookie?this.cookie:this.cookie=a()},createResponse(){return this.response?this.response:this.response=dv(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:s.map(e=>e.response),sanitize:i})}}};(c.body||c.cookie||c.headers||c.params||c.query||c.response)&&(r=ph(r,c)),r.tags&&(r.detail?r.detail.tags=r.tags:r.detail={tags:r.tags}),Y(this.config.detail)&&(r.detail=ch(Object.assign({},this.config.detail),r.detail));let f=Y(this.event)?ph(this.event,Nh(r)):{...mh(Nh(r))};if(s.length&&Object.assign(f,{standaloneValidator:s}),this.config.aot===!1){let i=d();this.router.dynamic.add(e,t,{validator:i,hooks:f,content:r?.type,handle:n,route:t});let a=Wh(t,{dynamic:!0});if(t!==a&&this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t}),!this.config.strictPath){let a=Uh(t);this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t}),a!==Wh(a)&&this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t})}this.router.history.push({method:e,path:t,composed:null,handler:n,compile:void 0,hooks:f});return}let p=this[`~adapter`].handler,m=typeof n==`function`?void 0:()=>{let r={redirect:Ih,request:this[`~adapter`].isWebStandard?new Request(`http://ely.sia${t}`,{method:e}):void 0,server:null,set:{headers:Object.assign({},this.setHeaders)},status:$h,store:this.store};try{this.event.request?.map(e=>{if(typeof e.fn==`function`)return e.fn(r);if(typeof e==`function`)return e(r)})}catch(e){let t;r.error=e,this.event.error?.some(e=>{if(typeof e.fn==`function`)return t=e.fn(r);if(typeof e==`function`)return t=e(r)}),t!==void 0&&(n=t)}let i=p.createNativeStaticHandler?.(n,f,r.set);return i instanceof Promise?i.then(e=>{if(e)return e}):i?.()},h=this.config.nativeStaticResponse===!0,g=t=>{!h||!m||(Gh?this.router.response[t]?this.router.response[t][e]=m():this.router.response[t]={[e]:m()}:this.router.response[t]=m())};g(t);let _,ee=()=>{if(_)return _;let r=Dv({app:this,path:t,method:e,hooks:f,validator:d(),handler:typeof n!=`function`&&typeof p.createStaticHandler!=`function`?()=>n:n,allowMeta:o,inference:this.inference});return this.router.history[ne]&&(_=this.router.history[ne].composed=r),r},te;if(`${e}_${t}`in this.routeTree)for(let n=0;n<this.router.history.length;n++){let r=this.router.history[n];if(r.path===t&&r.method===e){te=n;break}}else this.routeTree[`${e}_${t}`]=this.router.history.length;let ne=te??this.router.history.length,re=this.router.history,v=u?ee():e=>_?_(e):(re[ne].composed=ee())(e);te===void 0?this.router.history.push(Object.assign({method:e,path:t,composed:v,compile:ee,handler:n,hooks:f},r.webSocket?{websocket:r.websocket}:void 0)):this.router.history[te]=Object.assign({method:e,path:t,composed:v,compile:ee,handler:n,hooks:f},s.length?{standaloneValidators:s}:void 0,r.webSocket?{websocket:r.websocket}:void 0);let ie={handler:u?re[ne].composed:void 0,compile(){return this.handler=ee()}},ae=this.router.static,oe=t.indexOf(`:`)===-1&&t.indexOf(`*`)===-1;if(e===`WS`){if(oe){t in ae?ae[t][e]=ne:ae[t]={[e]:ne};return}this.router.http.add(`WS`,t,ie),this.config.strictPath||this.router.http.add(`WS`,Uh(t),ie);let n=Wh(t,{dynamic:!0});t!==n&&this.router.http.add(`WS`,n,ie);return}if(oe)t in ae?ae[t][e]=ne:ae[t]={[e]:ne},this.config.strictPath||g(Uh(t));else{if(this.router.http.add(e,t,ie),!this.config.strictPath){let n=Uh(t);g(n),this.router.http.add(e,n,ie)}let n=Wh(t,{dynamic:!0});t!==n&&(this.router.http.add(e,n,ie),g(n))}}headers(e){return e?(this.setHeaders||={},this.setHeaders=ch(this.setHeaders,e),this):this}onStart(e){return this.on(`start`,e),this}onRequest(e){return this.on(`request`,e),this}onParse(e,t){return t?this.on(e,`parse`,t):typeof e==`string`?this.on(`parse`,this[`~parser`][e]):this.on(`parse`,e)}parser(e,t){return this[`~parser`][e]=t,this}onTransform(e,t){return t?this.on(e,`transform`,t):this.on(`transform`,e)}resolve(e,t){t||(t=e,e={as:`local`});let n={subType:`resolve`,fn:t};return this.onBeforeHandle(e,n)}mapResolve(e,t){t||(t=e,e={as:`local`});let n={subType:`mapResolve`,fn:t};return this.onBeforeHandle(e,n)}onBeforeHandle(e,t){return t?this.on(e,`beforeHandle`,t):this.on(`beforeHandle`,e)}onAfterHandle(e,t){return t?this.on(e,`afterHandle`,t):this.on(`afterHandle`,e)}mapResponse(e,t){return t?this.on(e,`mapResponse`,t):this.on(`mapResponse`,e)}onAfterResponse(e,t){return t?this.on(e,`afterResponse`,t):this.on(`afterResponse`,e)}trace(e,t){t||(t=e,e={as:`local`}),Array.isArray(t)||(t=[t]);for(let n of t)this.on(e,`trace`,k_(n));return this}error(e,t){switch(typeof e){case`string`:return t.prototype[Yh]=e,this.definitions.error[e]=t,this;case`function`:return this.definitions.error=e(this.definitions.error),this}for(let[t,n]of Object.entries(e))n.prototype[Yh]=t,this.definitions.error[t]=n;return this}onError(e,t){return t?this.on(e,`error`,t):this.on(`error`,e)}onStop(e){return this.on(`stop`,e),this}on(e,t,n){let r;switch(typeof e){case`string`:r=e,n=t;break;case`object`:r=t,!Array.isArray(t)&&typeof t==`object`&&(n=t);break}n=Array.isArray(n)?Mh(n):typeof n==`function`?[{fn:n}]:[n];let i=n;for(let t of i)t.scope=typeof e==`string`?`local`:e?.as??`local`,(r===`resolve`||r===`derive`)&&(t.subType=r);r!==`trace`&&(this.inference=Jv({[r]:i.map(e=>e.fn)},this.inference,this.config.sucrose));for(let e of i){let t=yh(e,`global`,{skipIfHasType:!0});switch(r){case`start`:this.event.start??=[],this.event.start.push(t);break;case`request`:this.event.request??=[],this.event.request.push(t);break;case`parse`:this.event.parse??=[],this.event.parse.push(t);break;case`transform`:this.event.transform??=[],this.event.transform.push(t);break;case`derive`:this.event.transform??=[],this.event.transform.push(Mh(t,`derive`));break;case`beforeHandle`:this.event.beforeHandle??=[],this.event.beforeHandle.push(t);break;case`resolve`:this.event.beforeHandle??=[],this.event.beforeHandle.push(Mh(t,`resolve`));break;case`afterHandle`:this.event.afterHandle??=[],this.event.afterHandle.push(t);break;case`mapResponse`:this.event.mapResponse??=[],this.event.mapResponse.push(t);break;case`afterResponse`:this.event.afterResponse??=[],this.event.afterResponse.push(t);break;case`trace`:this.event.trace??=[],this.event.trace.push(t);break;case`error`:this.event.error??=[],this.event.error.push(t);break;case`stop`:this.event.stop??=[],this.event.stop.push(t);break}}return this}as(e){return Hh(this.event.parse,e),Hh(this.event.transform,e),Hh(this.event.beforeHandle,e),Hh(this.event.afterHandle,e),Hh(this.event.mapResponse,e),Hh(this.event.afterResponse,e),Hh(this.event.trace,e),Hh(this.event.error,e),e===`scoped`?(this.validator.scoped=fh(this.validator.scoped,this.validator.local),this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null)):e===`global`&&(this.validator.global=fh(this.validator.global,fh(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null),this.standaloneValidator.scoped!==null&&(this.standaloneValidator.global||=[],this.standaloneValidator.global.push(...this.standaloneValidator.scoped),this.standaloneValidator.scoped=null)),this}group(t,n,r){let i=new e({...this.config,prefix:``});i.singleton={...this.singleton},i.definitions={...this.definitions},i.getServer=()=>this.getServer(),i.inference=Fh(this.inference),i.extender={...this.extender},i[`~parser`]=this[`~parser`],i.standaloneValidator={local:[...this.standaloneValidator.local??[]],scoped:[...this.standaloneValidator.scoped??[]],global:[...this.standaloneValidator.global??[]]};let a=typeof n==`object`,o=(a?r:n)(i);return this.singleton=ch(this.singleton,i.singleton),this.definitions=ch(this.definitions,i.definitions),o.event.request?.length&&(this.event.request=[...this.event.request||[],...o.event.request||[]]),o.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...o.event.mapResponse||[]]),this.model(o.definitions.type),Object.values(i.router.history).forEach(({method:e,path:r,handler:i,hooks:s})=>{if(r=(a?``:this.config.prefix??``)+t+r,a){let{body:t,headers:a,query:c,params:l,cookie:u,response:d,...f}=n,p=s,m=t||a||c||l||u||d;this.add(e,r,i,ph(f,{...p||{},error:p.error?Array.isArray(p.error)?[...p.error??[],...o.event.error??[]]:[p.error,...o.event.error??[]]:o.event.error,standaloneValidator:m?[...p.standaloneValidator??[],{body:t,headers:a,query:c,params:l,cookie:u,response:d}]:p.standaloneValidator}),void 0)}else this.add(e,r,i,ph(s,{error:o.event.error}),{skipPrefix:!0})}),this}guard(t,n){if(!n){if(typeof t==`object`){this.applyMacro(t),t.detail&&(this.config.detail?this.config.detail=ch(Object.assign({},this.config.detail),t.detail):this.config.detail=t.detail),t.tags&&(this.config.detail?this.config.detail.tags=t.tags:this.config.detail={tags:t.tags});let e=t.as??`local`;if(t.schema===`standalone`){this.standaloneValidator[e]||(this.standaloneValidator[e]=[]);let n=t?.response?typeof t.response==`string`||j in t.response||`~standard`in t.response?{200:t.response}:t?.response:void 0;this.standaloneValidator[e].push({body:t.body,headers:t.headers,params:t.params,query:t.query,response:n,cookie:t.cookie})}else this.validator[e]={body:t.body??this.validator[e]?.body,headers:t.headers??this.validator[e]?.headers,params:t.params??this.validator[e]?.params,query:t.query??this.validator[e]?.query,response:t.response??this.validator[e]?.response,cookie:t.cookie??this.validator[e]?.cookie};return t.parse&&this.on({as:e},`parse`,t.parse),t.transform&&this.on({as:e},`transform`,t.transform),t.derive&&this.on({as:e},`derive`,t.derive),t.beforeHandle&&this.on({as:e},`beforeHandle`,t.beforeHandle),t.resolve&&this.on({as:e},`resolve`,t.resolve),t.afterHandle&&this.on({as:e},`afterHandle`,t.afterHandle),t.mapResponse&&this.on({as:e},`mapResponse`,t.mapResponse),t.afterResponse&&this.on({as:e},`afterResponse`,t.afterResponse),t.error&&this.on({as:e},`error`,t.error),this}return this.guard({},t)}let r=new e({...this.config,prefix:``});r.singleton={...this.singleton},r.definitions={...this.definitions},r.inference=Fh(this.inference),r.extender={...this.extender},r.getServer=()=>this.getServer();let i=n(r);return this.singleton=ch(this.singleton,r.singleton),this.definitions=ch(this.definitions,r.definitions),i.getServer=()=>this.server,i.event.request?.length&&(this.event.request=[...this.event.request||[],...i.event.request||[]]),i.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...i.event.mapResponse||[]]),this.model(i.definitions.type),Object.values(r.router.history).forEach(({method:e,path:n,handler:r,hooks:a})=>{let{body:o,headers:s,query:c,params:l,cookie:u,response:d,...f}=t,p=o||s||c||l||u||d;this.add(e,n,r,ph(f,{...a||{},error:a.error?Array.isArray(a.error)?[...a.error??[],...i.event.error??[]]:[a.error,...i.event.error??[]]:i.event.error,standaloneValidator:p?[...a.standaloneValidator??[],{body:o,headers:s,query:c,params:l,cookie:u,response:d}]:a.standaloneValidator}))}),this}use(t){if(!t)return this;if(Array.isArray(t)){let e=this;for(let n of t)e=e.use(n);return e}return t instanceof Promise?(this.promisedModules.add(t.then(t=>{if(typeof t==`function`)return t(this);if(t instanceof e||t.constructor?.name===`Elysia`)return this._use(t).compile();if(typeof t.default==`function`)return t.default(this);if(t.default instanceof e||t.constructor?.name===`Elysia`||t.constructor?.name===`_Elysia`)return this._use(t.default);try{return this._use(t.default)}catch(e){throw console.error(`Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.`),e}}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):this._use(t)}propagatePromiseModules(e){if(e.promisedModules.size<=0)return this;for(let t of e.promisedModules.promises)this.promisedModules.add(t.then(e=>{if(!e)return;let t=this._use(e);return t instanceof Promise?t.then(t=>{t?t.compile():e.compile()}):e.compile()}));return this}_use(t){if(typeof t==`function`){let n=t(this);return n instanceof Promise?(this.promisedModules.add(n.then(t=>{if(t instanceof e){t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.model(this.definitions.type),t.error(this.definitions.error);for(let{method:e,path:n,handler:r,hooks:i}of Object.values(t.router.history))this.add(e,n,r,i,void 0);return t===this?void 0:(this.propagatePromiseModules(t),t)}return typeof t==`function`?t(this):typeof t.default==`function`?t.default(this):this._use(t)}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):n}this.propagatePromiseModules(t);let n=t.config.name,r=t.config.seed;if(t.getParent=()=>this,t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.standaloneValidator?.scoped&&(this.standaloneValidator.local?this.standaloneValidator.local=this.standaloneValidator.local.concat(t.standaloneValidator.scoped):this.standaloneValidator.local=t.standaloneValidator.scoped),t.standaloneValidator?.global&&(this.standaloneValidator.global?this.standaloneValidator.global=this.standaloneValidator.global.concat(t.standaloneValidator.global):this.standaloneValidator.global=t.standaloneValidator.global),Y(t[`~parser`])&&(this[`~parser`]={...t[`~parser`],...this[`~parser`]}),t.setHeaders&&this.headers(t.setHeaders),n){n in this.dependencies||(this.dependencies[n]=[]);let e=r===void 0?0:gh(n+JSON.stringify(r));this.dependencies[n].some(({checksum:t})=>e===t)||(this.extender.macro={...this.extender.macro,...t.extender.macro},this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions))}else Y(t.extender.macro)&&(this.extender.macro={...this.extender.macro,...t.extender.macro}),t.extender.higherOrderFunctions.length&&(this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions));if(t.extender.higherOrderFunctions.length){Vh(this.extender.higherOrderFunctions);let e=[];for(let t=0;t<this.extender.higherOrderFunctions.length;t++){let n=this.extender.higherOrderFunctions[t];n.checksum&&(e.includes(n.checksum)&&(this.extender.higherOrderFunctions.splice(t,1),t--),e.push(n.checksum))}e.length=0}this.inference=qv(this.inference,t.inference),Y(t.singleton.decorator)&&this.decorate(t.singleton.decorator),Y(t.singleton.store)&&this.state(t.singleton.store),Y(t.definitions.type)&&this.model(t.definitions.type),Y(t.definitions.error)&&this.error(t.definitions.error),Y(t.extender.macro)&&(this.extender.macro={...this.extender.macro,...t.extender.macro});for(let{method:e,path:n,handler:r,hooks:i}of Object.values(t.router.history))this.add(e,n,r,i);if(n){n in this.dependencies||(this.dependencies[n]=[]);let e=r===void 0?0:gh(n+JSON.stringify(r));if(this.dependencies[n].some(({checksum:t})=>e===t))return this;this.dependencies[n].push(this.config?.analytic?{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies,stack:t.telemetry?.stack,routes:t.router.history,decorators:t.singleton,store:t.singleton.store,error:t.definitions.error,derive:t.event.transform?.filter(e=>e?.subType===`derive`).map(e=>({fn:e.toString(),stack:Error().stack??``})),resolve:t.event.transform?.filter(e=>e?.subType===`resolve`).map(e=>({fn:e.toString(),stack:Error().stack??``}))}:{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies}),Y(t.event)&&(this.event=vh(this.event,xh(t.event),e))}else Y(t.event)&&(this.event=vh(this.event,xh(t.event)));return t.validator.global&&(this.validator.global=ph(this.validator.global,{...t.validator.global})),t.validator.scoped&&(this.validator.local=ph(this.validator.local,{...t.validator.scoped})),this}macro(e,t){if(typeof e==`string`&&!t)throw Error(`Macro function is required`);return typeof e==`string`?this.extender.macro[e]=t:this.extender.macro={...this.extender.macro,...e},this}applyMacro(e,t=e,{iteration:n=0,applied:r={}}={}){if(n>=16)return;let i=this.extender.macro;for(let[a,o]of Object.entries(t)){if(!(a in i))continue;let t=typeof i[a]==`function`?i[a](o):i[a];if(!t||typeof i[a]==`object`&&o===!1)return;let s=gh(a+JSON.stringify(t.seed??o));if(!(s in r)){r[s]=!0;for(let[o,s]of Object.entries(t))if(o!==`seed`){if(o in qh){Oh(e,o,s),delete e[a];continue}if(o===`introspect`){s?.(e),delete e[a];continue}if(o===`detail`){e.detail||={},e.detail=ch(e.detail,s,{mergeArray:!0}),delete e[a];continue}if(o in i){this.applyMacro(e,{[o]:s},{applied:r,iteration:n+1}),delete e[a];continue}switch((o===`derive`||o===`resolve`)&&typeof s==`function`&&(s={fn:s,subType:o}),typeof e[o]){case`function`:e[o]=[e[o],s];break;case`object`:Array.isArray(e[o])?e[o].push(s):e[o]=[e[o],s];break;case`undefined`:e[o]=s;break}delete e[a]}}}}mount(t,n,r){if(t instanceof e||typeof t==`function`||t.length===0||t===`/`){let i=typeof t==`function`?t:t instanceof e?t.compile().fetch:n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw Error(`Invalid handler`)})();return this.route(`ALL`,`/*`,({request:e,path:t})=>i(new Request(ah(e.url,t),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body})),{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}let i=n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw Error(`Invalid handler`)})(),a=t.length-(t.endsWith(`*`)?1:0),o=({request:e,path:t})=>i(new Request(ah(e.url,t.slice(a)||`/`),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body}));return this.route(`ALL`,t,o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this.route(`ALL`,t+(t.endsWith(`/`)?`*`:`/*`),o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}get(e,t,n){return this.add(`GET`,e,t,n),this}post(e,t,n){return this.add(`POST`,e,t,n),this}put(e,t,n){return this.add(`PUT`,e,t,n),this}patch(e,t,n){return this.add(`PATCH`,e,t,n),this}delete(e,t,n){return this.add(`DELETE`,e,t,n),this}options(e,t,n){return this.add(`OPTIONS`,e,t,n),this}all(e,t,n){return this.add(`ALL`,e,t,n),this}head(e,t,n){return this.add(`HEAD`,e,t,n),this}connect(e,t,n){return this.add(`CONNECT`,e,t,n),this}route(e,t,n,r){return this.add(e.toUpperCase(),t,n,r,r?.config),this}ws(e,t){return this[`~adapter`].ws?this[`~adapter`].ws(this,e,t):console.warn(`Current adapter doesn't support WebSocket`),this}state(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return!n||!Y(n)?this:t?(t in this.singleton.store?this.singleton.store[t]=ch(this.singleton.store[t],n,{override:r===`override`}):this.singleton.store[t]=n,this):(n===null||(this.singleton.store=ch(this.singleton.store,n,{override:r===`override`})),this);case`function`:return t?(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n):this.singleton.store=n(this.singleton.store),this;default:return(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n),this}}decorate(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return t?(t in this.singleton.decorator?this.singleton.decorator[t]=ch(this.singleton.decorator[t],n,{override:r===`override`}):this.singleton.decorator[t]=n,this):(n===null||(this.singleton.decorator=ch(this.singleton.decorator,n,{override:r===`override`})),this);case`function`:return t?(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n):this.singleton.decorator=n(this.singleton.decorator),this;default:return(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n),this}}derive(e,t){t||(t=e,e={as:`local`});let n={subType:`derive`,fn:t};return this.onTransform(e,n)}model(e,t){let n=e=>{let t={};for(let n in e)`~standard`in e[n]||(t[n]=e[n]);return t};switch(typeof e){case`object`:let r={},i=Object.entries(e);if(!i.length)return this;for(let[e,t]of i)e in this.definitions.type||(`~standard`in t?this.definitions.type[e]=t:(r[e]=this.definitions.type[e]=t,r[e].$id??=`#/components/schemas/${e}`));return this.definitions.typebox=Z.Module({...this.definitions.typebox.$defs,...r}),this;case`function`:let a=e(this.definitions.type);return this.definitions.type=a,this.definitions.typebox=Z.Module(n(a)),this;case`string`:if(!t)break;if(this.definitions.type[e]=t,`~standard`in t)return this;let o={...t,id:t.$id??`#/components/schemas/${e}`};return this.definitions.typebox=Z.Module({...this.definitions.typebox.$defs,...o}),this}return t?(this.definitions.type[e]=t,`~standard`in t||(this.definitions.typebox=Z.Module({...this.definitions.typebox.$defs,[e]:t})),this):this}Ref(e){return Z.Ref(e)}mapDerive(e,t){t||(t=e,e={as:`local`});let n={subType:`mapDerive`,fn:t};return this.onTransform(e,n)}affix(e,t,n){if(n===``)return this;let r=[`_`,`-`,` `],i=e=>e[0].toUpperCase()+e.slice(1),a=e===`prefix`?(e,t)=>r.includes(e.at(-1)??``)?e+t:e+i(t):r.includes(n.at(-1)??``)?(e,t)=>t+e:(e,t)=>t+i(e),o=e=>{let t={};switch(e){case`decorator`:for(let e in this.singleton.decorator)t[a(n,e)]=this.singleton.decorator[e];this.singleton.decorator=t;break;case`state`:for(let e in this.singleton.store)t[a(n,e)]=this.singleton.store[e];this.singleton.store=t;break;case`model`:for(let e in this.definitions.type)t[a(n,e)]=this.definitions.type[e];this.definitions.type=t;break;case`error`:for(let e in this.definitions.error)t[a(n,e)]=this.definitions.error[e];this.definitions.error=t;break}},s=Array.isArray(t)?t:[t];for(let e of s.some(e=>e===`all`)?[`decorator`,`state`,`model`,`error`]:s)o(e);return this}prefix(e,t){return this.affix(`prefix`,e,t)}suffix(e,t){return this.affix(`suffix`,e,t)}compile(){return this[`~adapter`].beforeCompile?.(this),this[`~adapter`].isWebStandard?(this._handle=this.config.aot?Av(this):vy(this),Object.defineProperty(this,`fetch`,{value:this._handle,configurable:!0,writable:!0}),typeof this.server?.reload==`function`&&this.server.reload({...this.server||{},fetch:this.fetch}),this):(typeof this.server?.reload==`function`&&this.server.reload(this.server||{}),this._handle=Av(this),this)}get fetch(){let e=this.config.aot?Av(this):vy(this);return Object.defineProperty(this,`fetch`,{value:e,configurable:!0,writable:!0}),e}get modules(){return this.promisedModules}};export{ae as a,X as i,Z as n,_g as r,Sy as t};