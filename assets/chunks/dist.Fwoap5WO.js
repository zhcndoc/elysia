const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/vite-browser-external.D7KW2JJD.js","assets/chunks/chunk.DklRhtxD.js","assets/chunks/core.6ue9YUui.js"])))=>i.map(i=>d[i]);
import{i as e,n as t,r as n,t as r}from"./chunk.DklRhtxD.js";import{B as i,F as a,Z as o,b as s,i as c,p as l,tL as u,tV as d,t_ as f,tt as p,tu as m,u as h}from"./runtime-core.esm-bundler.D02XvB7A.js";import{s as g}from"./runtime-dom.esm-bundler._PUIWB9-.js";import{t as _}from"./preload-helper.DNtGMa4k.js";var ee={class:`mockup-browser dark:bg-slate-800 border dark:border-slate-700 playground`},te={class:`mockup-browser-toolbar`},ne={class:`input`},re=[`value`],v={class:`flex justify-start items-stretch w-full h-full px-4 whitespace-pre-wrap pb-3`,style:{"min-height":`16rem`}},ie=s({__name:`playground`,props:{elysia:{},mock:{default:()=>({})},alias:{default:()=>({})}},setup(e){let t=e.elysia?.router.history,n=m({method:t?.[0]?.method??`get`,path:t?.[0]?.path??`/`}),r=m(``),s=async()=>{let{method:t,path:i}=n.value;if(e.mock&&i in e.mock&&t in e.mock[i]){r.value=e.mock[i][t];return}r.value=await e.elysia.handle(new Request(`http://elysiajs.com`+i,{method:t})).then(e=>e.text())};return s(),o([n],s),(e,o)=>(a(),l(`article`,ee,[h(`div`,te,[h(`div`,ne,[o[1]||=h(`span`,null,`localhost`,-1),p(h(`select`,{name:`route`,class:`select`,"onUpdate:modelValue":o[0]||=e=>n.value=e},[(a(!0),l(c,null,i(f(t),({method:t,path:n})=>(a(),l(`option`,{key:t+`_`+n,value:{method:t,path:n}},d(e.alias&&n in e.alias?e.alias[n]:n),9,re))),128))],512),[[g,n.value]])]),h(`p`,{class:u([`!my-0 font-bold pl-2 min-w-[5ch] text-right`,n.value.method===`GET`?`text-green-600`:`text-blue-500`])},d(n.value.method),3)]),h(`section`,v,d(r.value),1)]))}});function ae(e){return b(e)&&!oe(e)&&!C(e)&&Symbol.asyncIterator in e}function oe(e){return Array.isArray(e)}function se(e){return typeof e==`bigint`}function y(e){return typeof e==`boolean`}function ce(e){return e instanceof globalThis.Date}function le(e){return typeof e==`function`}function ue(e){return b(e)&&!oe(e)&&!C(e)&&Symbol.iterator in e}function de(e){return e===null}function fe(e){return typeof e==`number`}function b(e){return typeof e==`object`&&!!e}function pe(e){return e instanceof globalThis.RegExp}function x(e){return typeof e==`string`}function S(e){return typeof e==`symbol`}function C(e){return e instanceof globalThis.Uint8Array}function w(e){return e===void 0}function me(e){return e.map(e=>_e(e))}function T(e){return new Date(e.getTime())}function he(e){return new Uint8Array(e)}function E(e){return new RegExp(e.source,e.flags)}function ge(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=_e(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=_e(e[n]);return t}function _e(e){return oe(e)?me(e):ce(e)?T(e):C(e)?he(e):pe(e)?E(e):b(e)?ge(e):e}function ve(e){return _e(e)}function ye(e,t){return ve(t===void 0?e:{...t,...e})}function be(e){return Oe(e)&&globalThis.Symbol.asyncIterator in e}function xe(e){return Oe(e)&&globalThis.Symbol.iterator in e}function Se(e){return e instanceof globalThis.Promise}function Ce(e){return e instanceof Date&&globalThis.Number.isFinite(e.getTime())}function we(e){return e instanceof globalThis.Map}function Te(e){return e instanceof globalThis.Set}function Ee(e){return globalThis.ArrayBuffer.isView(e)}function De(e){return e instanceof globalThis.Uint8Array}function D(e,t){return t in e}function Oe(e){return typeof e==`object`&&!!e}function ke(e){return globalThis.Array.isArray(e)&&!globalThis.ArrayBuffer.isView(e)}function Ae(e){return e===void 0}function je(e){return e===null}function Me(e){return typeof e==`boolean`}function O(e){return typeof e==`number`}function Ne(e){return globalThis.Number.isInteger(e)}function Pe(e){return typeof e==`bigint`}function Fe(e){return typeof e==`string`}function Ie(e){return typeof e==`function`}function Le(e){return typeof e==`symbol`}function Re(e){return Pe(e)||Me(e)||je(e)||O(e)||Fe(e)||Le(e)||Ae(e)}var ze;(function(e){e.InstanceMode=`default`,e.ExactOptionalPropertyTypes=!1,e.AllowArrayObject=!1,e.AllowNaN=!1,e.AllowNullVoid=!1;function t(t,n){return e.ExactOptionalPropertyTypes?n in t:t[n]!==void 0}e.IsExactOptionalProperty=t;function n(t){let n=Oe(t);return e.AllowArrayObject?n:n&&!ke(t)}e.IsObjectLike=n;function r(e){return n(e)&&!(e instanceof Date)&&!(e instanceof Uint8Array)}e.IsRecordLike=r;function i(t){return e.AllowNaN?O(t):Number.isFinite(t)}e.IsNumberLike=i;function a(t){let n=Ae(t);return e.AllowNullVoid?n||t===null:n}e.IsVoidLike=a})(ze||={});function Be(e){return globalThis.Object.freeze(e).map(e=>Ge(e))}function Ve(e){return e}function He(e){return e}function Ue(e){return e}function We(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=Ge(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=Ge(e[n]);return globalThis.Object.freeze(t)}function Ge(e){return oe(e)?Be(e):ce(e)?Ve(e):C(e)?He(e):pe(e)?Ue(e):b(e)?We(e):e}function k(e,t){let n=t===void 0?e:{...t,...e};switch(ze.InstanceMode){case`freeze`:return Ge(n);case`clone`:return ve(n);default:return n}}var Ke=class extends Error{constructor(e){super(e)}};const qe=Symbol.for(`TypeBox.Transform`),Je=Symbol.for(`TypeBox.Readonly`),Ye=Symbol.for(`TypeBox.Optional`),Xe=Symbol.for(`TypeBox.Hint`),A=Symbol.for(`TypeBox.Kind`);function Ze(e){return b(e)&&e[Je]===`Readonly`}function Qe(e){return b(e)&&e[Ye]===`Optional`}function $e(e){return j(e,`Any`)}function et(e){return j(e,`Argument`)}function tt(e){return j(e,`Array`)}function nt(e){return j(e,`AsyncIterator`)}function rt(e){return j(e,`BigInt`)}function it(e){return j(e,`Boolean`)}function at(e){return j(e,`Computed`)}function ot(e){return j(e,`Constructor`)}function st(e){return j(e,`Date`)}function ct(e){return j(e,`Function`)}function lt(e){return j(e,`Integer`)}function ut(e){return j(e,`Intersect`)}function dt(e){return j(e,`Iterator`)}function j(e,t){return b(e)&&A in e&&e[A]===t}function ft(e){return y(e)||fe(e)||x(e)}function pt(e){return j(e,`Literal`)}function mt(e){return j(e,`MappedKey`)}function ht(e){return j(e,`MappedResult`)}function gt(e){return j(e,`Never`)}function _t(e){return j(e,`Not`)}function vt(e){return j(e,`Null`)}function yt(e){return j(e,`Number`)}function bt(e){return j(e,`Object`)}function xt(e){return j(e,`Promise`)}function St(e){return j(e,`Record`)}function Ct(e){return j(e,`Ref`)}function wt(e){return j(e,`RegExp`)}function Tt(e){return j(e,`String`)}function Et(e){return j(e,`Symbol`)}function Dt(e){return j(e,`TemplateLiteral`)}function Ot(e){return j(e,`This`)}function M(e){return b(e)&&qe in e}function kt(e){return j(e,`Tuple`)}function At(e){return j(e,`Undefined`)}function jt(e){return j(e,`Union`)}function Mt(e){return j(e,`Uint8Array`)}function Nt(e){return j(e,`Unknown`)}function Pt(e){return j(e,`Unsafe`)}function Ft(e){return j(e,`Void`)}function It(e){return b(e)&&A in e&&x(e[A])}function Lt(e){return $e(e)||et(e)||tt(e)||it(e)||rt(e)||nt(e)||at(e)||ot(e)||st(e)||ct(e)||lt(e)||ut(e)||dt(e)||pt(e)||mt(e)||ht(e)||gt(e)||_t(e)||vt(e)||yt(e)||bt(e)||xt(e)||St(e)||Ct(e)||wt(e)||Tt(e)||Et(e)||Dt(e)||Ot(e)||kt(e)||At(e)||jt(e)||Mt(e)||Nt(e)||Pt(e)||Ft(e)||It(e)}var Rt=`Argument.Any.Array.AsyncIterator.BigInt.Boolean.Computed.Constructor.Date.Enum.Function.Integer.Intersect.Iterator.Literal.MappedKey.MappedResult.Not.Null.Number.Object.Promise.Record.Ref.RegExp.String.Symbol.TemplateLiteral.This.Tuple.Undefined.Union.Uint8Array.Unknown.Void`.split(`.`);function zt(e){try{return new RegExp(e),!0}catch{return!1}}function Bt(e){if(!x(e))return!1;for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(n>=7&&n<=13||n===27||n===127)return!1}return!0}function Vt(e){return Ut(e)||L(e)}function Ht(e){return w(e)||se(e)}function N(e){return w(e)||fe(e)}function Ut(e){return w(e)||y(e)}function P(e){return w(e)||x(e)}function Wt(e){return w(e)||x(e)&&Bt(e)&&zt(e)}function Gt(e){return w(e)||x(e)&&Bt(e)}function Kt(e){return w(e)||L(e)}function qt(e){return b(e)&&e[Ye]===`Optional`}function Jt(e){return F(e,`Any`)&&P(e.$id)}function Yt(e){return F(e,`Argument`)&&fe(e.index)}function Xt(e){return F(e,`Array`)&&e.type===`array`&&P(e.$id)&&L(e.items)&&N(e.minItems)&&N(e.maxItems)&&Ut(e.uniqueItems)&&Kt(e.contains)&&N(e.minContains)&&N(e.maxContains)}function Zt(e){return F(e,`AsyncIterator`)&&e.type===`AsyncIterator`&&P(e.$id)&&L(e.items)}function Qt(e){return F(e,`BigInt`)&&e.type===`bigint`&&P(e.$id)&&Ht(e.exclusiveMaximum)&&Ht(e.exclusiveMinimum)&&Ht(e.maximum)&&Ht(e.minimum)&&Ht(e.multipleOf)}function $t(e){return F(e,`Boolean`)&&e.type===`boolean`&&P(e.$id)}function en(e){return F(e,`Computed`)&&x(e.target)&&oe(e.parameters)&&e.parameters.every(e=>L(e))}function tn(e){return F(e,`Constructor`)&&e.type===`Constructor`&&P(e.$id)&&oe(e.parameters)&&e.parameters.every(e=>L(e))&&L(e.returns)}function nn(e){return F(e,`Date`)&&e.type===`Date`&&P(e.$id)&&N(e.exclusiveMaximumTimestamp)&&N(e.exclusiveMinimumTimestamp)&&N(e.maximumTimestamp)&&N(e.minimumTimestamp)&&N(e.multipleOfTimestamp)}function rn(e){return F(e,`Function`)&&e.type===`Function`&&P(e.$id)&&oe(e.parameters)&&e.parameters.every(e=>L(e))&&L(e.returns)}function an(e){return F(e,`Integer`)&&e.type===`integer`&&P(e.$id)&&N(e.exclusiveMaximum)&&N(e.exclusiveMinimum)&&N(e.maximum)&&N(e.minimum)&&N(e.multipleOf)}function on(e){return b(e)&&Object.entries(e).every(([e,t])=>Bt(e)&&L(t))}function sn(e){return F(e,`Intersect`)&&!(x(e.type)&&e.type!==`object`)&&oe(e.allOf)&&e.allOf.every(e=>L(e)&&!On(e))&&P(e.type)&&(Ut(e.unevaluatedProperties)||Kt(e.unevaluatedProperties))&&P(e.$id)}function cn(e){return F(e,`Iterator`)&&e.type===`Iterator`&&P(e.$id)&&L(e.items)}function F(e,t){return b(e)&&A in e&&e[A]===t}function ln(e){return fn(e)&&x(e.const)}function un(e){return fn(e)&&fe(e.const)}function dn(e){return fn(e)&&y(e.const)}function fn(e){return F(e,`Literal`)&&P(e.$id)&&pn(e.const)}function pn(e){return y(e)||fe(e)||x(e)}function mn(e){return F(e,`MappedKey`)&&oe(e.keys)&&e.keys.every(e=>fe(e)||x(e))}function hn(e){return F(e,`MappedResult`)&&on(e.properties)}function gn(e){return F(e,`Never`)&&b(e.not)&&Object.getOwnPropertyNames(e.not).length===0}function _n(e){return F(e,`Not`)&&L(e.not)}function vn(e){return F(e,`Null`)&&e.type===`null`&&P(e.$id)}function yn(e){return F(e,`Number`)&&e.type===`number`&&P(e.$id)&&N(e.exclusiveMaximum)&&N(e.exclusiveMinimum)&&N(e.maximum)&&N(e.minimum)&&N(e.multipleOf)}function I(e){return F(e,`Object`)&&e.type===`object`&&P(e.$id)&&on(e.properties)&&Vt(e.additionalProperties)&&N(e.minProperties)&&N(e.maxProperties)}function bn(e){return F(e,`Promise`)&&e.type===`Promise`&&P(e.$id)&&L(e.item)}function xn(e){return F(e,`Record`)&&e.type===`object`&&P(e.$id)&&Vt(e.additionalProperties)&&b(e.patternProperties)&&(e=>{let t=Object.getOwnPropertyNames(e.patternProperties);return t.length===1&&zt(t[0])&&b(e.patternProperties)&&L(e.patternProperties[t[0]])})(e)}function Sn(e){return F(e,`Ref`)&&P(e.$id)&&x(e.$ref)}function Cn(e){return F(e,`RegExp`)&&P(e.$id)&&x(e.source)&&x(e.flags)&&N(e.maxLength)&&N(e.minLength)}function wn(e){return F(e,`String`)&&e.type===`string`&&P(e.$id)&&N(e.minLength)&&N(e.maxLength)&&Wt(e.pattern)&&Gt(e.format)}function Tn(e){return F(e,`Symbol`)&&e.type===`symbol`&&P(e.$id)}function En(e){return F(e,`TemplateLiteral`)&&e.type===`string`&&x(e.pattern)&&e.pattern[0]===`^`&&e.pattern[e.pattern.length-1]===`$`}function Dn(e){return F(e,`This`)&&P(e.$id)&&x(e.$ref)}function On(e){return b(e)&&qe in e}function kn(e){return F(e,`Tuple`)&&e.type===`array`&&P(e.$id)&&fe(e.minItems)&&fe(e.maxItems)&&e.minItems===e.maxItems&&(w(e.items)&&w(e.additionalItems)&&e.minItems===0||oe(e.items)&&e.items.every(e=>L(e)))}function An(e){return F(e,`Undefined`)&&e.type===`undefined`&&P(e.$id)}function jn(e){return F(e,`Union`)&&P(e.$id)&&b(e)&&oe(e.anyOf)&&e.anyOf.every(e=>L(e))}function Mn(e){return F(e,`Uint8Array`)&&e.type===`Uint8Array`&&P(e.$id)&&N(e.minByteLength)&&N(e.maxByteLength)}function Nn(e){return F(e,`Unknown`)&&P(e.$id)}function Pn(e){return F(e,`Unsafe`)}function Fn(e){return F(e,`Void`)&&e.type===`void`&&P(e.$id)}function In(e){return b(e)&&A in e&&x(e[A])&&!Rt.includes(e[A])}function L(e){return b(e)&&(Jt(e)||Yt(e)||Xt(e)||$t(e)||Qt(e)||Zt(e)||en(e)||tn(e)||nn(e)||rn(e)||an(e)||sn(e)||cn(e)||fn(e)||mn(e)||hn(e)||gn(e)||_n(e)||vn(e)||yn(e)||I(e)||bn(e)||xn(e)||Sn(e)||Cn(e)||wn(e)||Tn(e)||En(e)||Dn(e)||kn(e)||An(e)||jn(e)||Mn(e)||Nn(e)||Pn(e)||Fn(e)||In(e))}const Ln=`(true|false)`,Rn=`(0|[1-9][0-9]*)`,zn=`(.*)`;`${Ln}`;const Bn=`^${Rn}$`,Vn=`^${zn}$`;var Hn=new Map;function Un(e){return Hn.has(e)}function Wn(e,t){Hn.set(e,t)}function Gn(e){return Hn.get(e)}var Kn=new Map;function qn(e){return Kn.has(e)}function Jn(e,t){Kn.set(e,t)}function Yn(e){return Kn.get(e)}function Xn(e,t){return e.includes(t)}function Zn(e){return[...new Set(e)]}function Qn(e,t){return e.filter(e=>t.includes(e))}function $n(e,t){return e.reduce((e,t)=>Qn(e,t),t)}function er(e){return e.length===1?e[0]:e.length>1?$n(e.slice(1),e[0]):[]}function tr(e){let t=[];for(let n of e)t.push(...n);return t}function nr(e){return k({[A]:`Any`},e)}function rr(e,t){return k({[A]:`Array`,type:`array`,items:e},t)}function ir(e){return k({[A]:`Argument`,index:e})}function ar(e,t){return k({[A]:`AsyncIterator`,type:`AsyncIterator`,items:e},t)}function or(e,t,n){return k({[A]:`Computed`,target:e,parameters:t},n)}function sr(e,t){let{[t]:n,...r}=e;return r}function cr(e,t){return t.reduce((e,t)=>sr(e,t),e)}function R(e){return k({[A]:`Never`,not:{}},e)}function lr(e){return k({[A]:`MappedResult`,properties:e})}function ur(e,t,n){return k({[A]:`Constructor`,type:`Constructor`,parameters:e,returns:t},n)}function dr(e,t,n){return k({[A]:`Function`,type:`Function`,parameters:e,returns:t},n)}function fr(e,t){return k({[A]:`Union`,anyOf:e},t)}function pr(e){return e.some(e=>Qe(e))}function mr(e){return e.map(e=>Qe(e)?hr(e):e)}function hr(e){return cr(e,[Ye])}function gr(e,t){return pr(e)?na(fr(mr(e),t)):fr(mr(e),t)}function _r(e,t){return e.length===1?k(e[0],t):e.length===0?R(t):gr(e,t)}function vr(e,t){return e.length===0?R(t):e.length===1?k(e[0],t):fr(e,t)}var yr=class extends Ke{};function br(e){return e.replace(/\\\$/g,`$`).replace(/\\\*/g,`*`).replace(/\\\^/g,`^`).replace(/\\\|/g,`|`).replace(/\\\(/g,`(`).replace(/\\\)/g,`)`)}function xr(e,t,n){return e[t]===n&&e.charCodeAt(t-1)!==92}function Sr(e,t){return xr(e,t,`(`)}function Cr(e,t){return xr(e,t,`)`)}function wr(e,t){return xr(e,t,`|`)}function Tr(e){if(!(Sr(e,0)&&Cr(e,e.length-1)))return!1;let t=0;for(let n=0;n<e.length;n++)if(Sr(e,n)&&(t+=1),Cr(e,n)&&--t,t===0&&n!==e.length-1)return!1;return!0}function Er(e){return e.slice(1,e.length-1)}function Dr(e){let t=0;for(let n=0;n<e.length;n++)if(Sr(e,n)&&(t+=1),Cr(e,n)&&--t,wr(e,n)&&t===0)return!0;return!1}function Or(e){for(let t=0;t<e.length;t++)if(Sr(e,t))return!0;return!1}function kr(e){let[t,n]=[0,0],r=[];for(let i=0;i<e.length;i++)if(Sr(e,i)&&(t+=1),Cr(e,i)&&--t,wr(e,i)&&t===0){let t=e.slice(n,i);t.length>0&&r.push(jr(t)),n=i+1}let i=e.slice(n);return i.length>0&&r.push(jr(i)),r.length===0?{type:`const`,const:``}:r.length===1?r[0]:{type:`or`,expr:r}}function Ar(e){function t(e,t){if(!Sr(e,t))throw new yr(`TemplateLiteralParser: Index must point to open parens`);let n=0;for(let r=t;r<e.length;r++)if(Sr(e,r)&&(n+=1),Cr(e,r)&&--n,n===0)return[t,r];throw new yr(`TemplateLiteralParser: Unclosed group parens in expression`)}function n(e,t){for(let n=t;n<e.length;n++)if(Sr(e,n))return[t,n];return[t,e.length]}let r=[];for(let i=0;i<e.length;i++)if(Sr(e,i)){let[n,a]=t(e,i),o=e.slice(n,a+1);r.push(jr(o)),i=a}else{let[t,a]=n(e,i),o=e.slice(t,a);o.length>0&&r.push(jr(o)),i=a-1}return r.length===0?{type:`const`,const:``}:r.length===1?r[0]:{type:`and`,expr:r}}function jr(e){return Tr(e)?jr(Er(e)):Dr(e)?kr(e):Or(e)?Ar(e):{type:`const`,const:br(e)}}function Mr(e){return jr(e.slice(1,e.length-1))}var Nr=class extends Ke{};function Pr(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`0`&&e.expr[1].type===`const`&&e.expr[1].const===`[1-9][0-9]*`}function Fr(e){return e.type===`or`&&e.expr.length===2&&e.expr[0].type===`const`&&e.expr[0].const===`true`&&e.expr[1].type===`const`&&e.expr[1].const===`false`}function Ir(e){return e.type===`const`&&e.const===`.*`}function Lr(e){return Pr(e)||Ir(e)?!1:Fr(e)?!0:e.type===`and`||e.type===`or`?e.expr.every(e=>Lr(e)):e.type===`const`?!0:(()=>{throw new Nr(`Unknown expression type`)})()}function Rr(e){let t=Mr(e.pattern);return Lr(t)}var zr=class extends Ke{};function*Br(e){if(e.length===1)return yield*e[0];for(let t of e[0])for(let n of Br(e.slice(1)))yield`${t}${n}`}function*Vr(e){return yield*Br(e.expr.map(e=>[...Wr(e)]))}function*Hr(e){for(let t of e.expr)yield*Wr(t)}function*Ur(e){return yield e.const}function*Wr(e){return e.type===`and`?yield*Vr(e):e.type===`or`?yield*Hr(e):e.type===`const`?yield*Ur(e):(()=>{throw new zr(`Unknown expression`)})()}function Gr(e){let t=Mr(e.pattern);return Lr(t)?[...Wr(t)]:[]}function Kr(e,t){return k({[A]:`Literal`,const:e,type:typeof e},t)}function qr(e){return k({[A]:`Boolean`,type:`boolean`},e)}function Jr(e){return k({[A]:`BigInt`,type:`bigint`},e)}function Yr(e){return k({[A]:`Number`,type:`number`},e)}function Xr(e){return k({[A]:`String`,type:`string`},e)}function*Zr(e){let t=e.trim().replace(/"|'/g,``);return t===`boolean`?yield qr():t===`number`?yield Yr():t===`bigint`?yield Jr():t===`string`?yield Xr():yield(()=>{let e=t.split(`|`).map(e=>Kr(e.trim()));return e.length===0?R():e.length===1?e[0]:_r(e)})()}function*Qr(e){if(e[1]!==`{`){let t=Kr(`$`),n=$r(e.slice(1));return yield*[t,...n]}for(let t=2;t<e.length;t++)if(e[t]===`}`){let n=Zr(e.slice(2,t)),r=$r(e.slice(t+1));return yield*[...n,...r]}yield Kr(e)}function*$r(e){for(let t=0;t<e.length;t++)if(e[t]===`$`){let n=Kr(e.slice(0,t)),r=Qr(e.slice(t));return yield*[n,...r]}yield Kr(e)}function ei(e){return[...$r(e)]}var ti=class extends Ke{};function ni(e){return e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}function ri(e,t){return Dt(e)?e.pattern.slice(1,e.pattern.length-1):jt(e)?`(${e.anyOf.map(e=>ri(e,t)).join(`|`)})`:yt(e)||lt(e)||rt(e)?`${t}${Rn}`:Tt(e)?`${t}${zn}`:pt(e)?`${t}${ni(e.const.toString())}`:it(e)?`${t}${Ln}`:(()=>{throw new ti(`Unexpected Kind '${e[A]}'`)})()}function ii(e){return`^${e.map(e=>ri(e,``)).join(``)}\$`}function ai(e){let t=Gr(e).map(e=>Kr(e));return _r(t)}function oi(e,t){let n=x(e)?ii(ei(e)):ii(e);return k({[A]:`TemplateLiteral`,type:`string`,pattern:n},t)}function si(e){return Gr(e).map(e=>e.toString())}function ci(e){let t=[];for(let n of e)t.push(...ui(n));return t}function li(e){return[e.toString()]}function ui(e){return[...new Set(Dt(e)?si(e):jt(e)?ci(e.anyOf):pt(e)?li(e.const):yt(e)||lt(e)?[`[number]`]:[])]}function di(e,t,n){let r={};for(let i of Object.getOwnPropertyNames(t))r[i]=Ti(e,ui(t[i]),n);return r}function fi(e,t,n){return di(e,t.properties,n)}function pi(e,t,n){let r=fi(e,t,n);return lr(r)}function mi(e,t){return e.map(e=>Si(e,t))}function hi(e){return e.filter(e=>!gt(e))}function gi(e,t){return da(hi(mi(e,t)))}function _i(e){return e.some(e=>gt(e))?[]:e}function vi(e,t){return _r(_i(mi(e,t)))}function yi(e,t){return t in e?e[t]:t===`[number]`?_r(e):R()}function bi(e,t){return t===`[number]`?e:R()}function xi(e,t){return t in e?e[t]:R()}function Si(e,t){return ut(e)?gi(e.allOf,t):jt(e)?vi(e.anyOf,t):kt(e)?yi(e.items??[],t):tt(e)?bi(e.items,t):bt(e)?xi(e.properties,t):R()}function Ci(e,t){return t.map(t=>Si(e,t))}function wi(e,t){return _r(Ci(e,t))}function Ti(e,t,n){if(Ct(e)||Ct(t)){if(!Lt(e)||!Lt(t))throw new Ke(`Index types using Ref parameters require both Type and Key to be of TSchema`);return or(`Index`,[e,t])}return ht(t)?pi(e,t,n):mt(t)?ki(e,t,n):k(Lt(t)?wi(e,ui(t)):wi(e,t),n)}function Ei(e,t,n){return{[t]:Ti(e,[t],ve(n))}}function Di(e,t,n){return t.reduce((t,r)=>({...t,...Ei(e,r,n)}),{})}function Oi(e,t,n){return Di(e,t.keys,n)}function ki(e,t,n){let r=Oi(e,t,n);return lr(r)}function Ai(e,t){return k({[A]:`Iterator`,type:`Iterator`,items:e},t)}function ji(e){let t=[];for(let n in e)Qe(e[n])||t.push(n);return t}function Mi(e,t){let n=ji(e),r=n.length>0?{[A]:`Object`,type:`object`,properties:e,required:n}:{[A]:`Object`,type:`object`,properties:e};return k(r,t)}var Ni=Mi;function Pi(e,t){return k({[A]:`Promise`,type:`Promise`,item:e},t)}function Fi(e){return k(cr(e,[Je]))}function Ii(e){return k({...e,[Je]:`Readonly`})}function Li(e,t){return t===!1?Fi(e):Ii(e)}function Ri(e,t){let n=t??!0;return ht(e)?Vi(e,n):Li(e,n)}function zi(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ri(e[r],t);return n}function Bi(e,t){return zi(e.properties,t)}function Vi(e,t){let n=Bi(e,t);return lr(n)}function Hi(e,t){return k(e.length>0?{[A]:`Tuple`,type:`array`,items:e,additionalItems:!1,minItems:e.length,maxItems:e.length}:{[A]:`Tuple`,type:`array`,minItems:e.length,maxItems:e.length},t)}function Ui(e,t){return e in t?Xi(e,t[e]):lr(t)}function Wi(e){return{[e]:Kr(e)}}function Gi(e){let t={};for(let n of e)t[n]=Kr(n);return t}function Ki(e,t){return Xn(t,e)?Wi(e):Gi(t)}function qi(e,t){let n=Ki(e,t);return Ui(e,n)}function Ji(e,t){return t.map(t=>Xi(e,t))}function Yi(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(t))n[r]=Xi(e,t[r]);return n}function Xi(e,t){let n={...t};return Qe(t)?na(Xi(e,cr(t,[Ye]))):Ze(t)?Ri(Xi(e,cr(t,[Je]))):ht(t)?Ui(e,t.properties):mt(t)?qi(e,t.keys):ot(t)?ur(Ji(e,t.parameters),Xi(e,t.returns),n):ct(t)?dr(Ji(e,t.parameters),Xi(e,t.returns),n):nt(t)?ar(Xi(e,t.items),n):dt(t)?Ai(Xi(e,t.items),n):ut(t)?fa(Ji(e,t.allOf),n):jt(t)?vr(Ji(e,t.anyOf),n):kt(t)?Hi(Ji(e,t.items??[]),n):bt(t)?Ni(Yi(e,t.properties),n):tt(t)?rr(Xi(e,t.items),n):xt(t)?Pi(Xi(e,t.item),n):t}function Zi(e,t){let n={};for(let r of e)n[r]=Xi(r,t);return n}function Qi(e,t,n){let r=Lt(e)?ui(e):e,i=t({[A]:`MappedKey`,keys:r}),a=Zi(r,i);return Ni(a,n)}function $i(e){return k(cr(e,[Ye]))}function ea(e){return k({...e,[Ye]:`Optional`})}function ta(e,t){return t===!1?$i(e):ea(e)}function na(e,t){let n=t??!0;return ht(e)?aa(e,n):ta(e,n)}function ra(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=na(e[r],t);return n}function ia(e,t){return ra(e.properties,t)}function aa(e,t){let n=ia(e,t);return lr(n)}function oa(e,t={}){let n=e.every(e=>bt(e)),r=Lt(t.unevaluatedProperties)?{unevaluatedProperties:t.unevaluatedProperties}:{};return k(t.unevaluatedProperties===!1||Lt(t.unevaluatedProperties)||n?{...r,[A]:`Intersect`,type:`object`,allOf:e}:{...r,[A]:`Intersect`,allOf:e},t)}function sa(e){return e.every(e=>Qe(e))}function ca(e){return cr(e,[Ye])}function la(e){return e.map(e=>Qe(e)?ca(e):e)}function ua(e,t){return sa(e)?na(oa(la(e),t)):oa(la(e),t)}function da(e,t={}){if(e.length===1)return k(e[0],t);if(e.length===0)return R(t);if(e.some(e=>M(e)))throw Error(`Cannot intersect transform types`);return ua(e,t)}function fa(e,t){if(e.length===1)return k(e[0],t);if(e.length===0)return R(t);if(e.some(e=>M(e)))throw Error(`Cannot intersect transform types`);return oa(e,t)}function pa(...e){let[t,n]=typeof e[0]==`string`?[e[0],e[1]]:[e[0].$id,e[1]];if(typeof t!=`string`)throw new Ke(`Ref: $ref must be a string`);return k({[A]:`Ref`,$ref:t},n)}function ma(e,t){return or(`Awaited`,[or(e,t)])}function ha(e){return or(`Awaited`,[pa(e)])}function ga(e){return fa(ya(e))}function _a(e){return vr(ya(e))}function va(e){return ba(e)}function ya(e){return e.map(e=>ba(e))}function ba(e,t){return k(at(e)?ma(e.target,e.parameters):ut(e)?ga(e.allOf):jt(e)?_a(e.anyOf):xt(e)?va(e.item):Ct(e)?ha(e.$ref):e,t)}function xa(e){let t=[];for(let n of e)t.push(Oa(n));return t}function Sa(e){let t=xa(e);return tr(t)}function Ca(e){let t=xa(e);return er(t)}function wa(e){return e.map((e,t)=>t.toString())}function Ta(e){return[`[number]`]}function Ea(e){return globalThis.Object.getOwnPropertyNames(e)}function Da(e){return ka?globalThis.Object.getOwnPropertyNames(e).map(e=>e[0]===`^`&&e[e.length-1]===`$`?e.slice(1,e.length-1):e):[]}function Oa(e){return ut(e)?Sa(e.allOf):jt(e)?Ca(e.anyOf):kt(e)?wa(e.items??[]):tt(e)?Ta(e.items):bt(e)?Ea(e.properties):St(e)?Da(e.patternProperties):[]}var ka=!1;function Aa(e){ka=!0;let t=Oa(e);return ka=!1,`^(${t.map(e=>`(${e})`).join(`|`)})$`}function ja(e,t){return or(`KeyOf`,[or(e,t)])}function Ma(e){return or(`KeyOf`,[pa(e)])}function Na(e,t){let n=Oa(e),r=Pa(n),i=_r(r);return k(i,t)}function Pa(e){return e.map(e=>e===`[number]`?Yr():Kr(e))}function Fa(e,t){return at(e)?ja(e.target,e.parameters):Ct(e)?Ma(e.$ref):ht(e)?Ra(e,t):Na(e,t)}function Ia(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Fa(e[r],ve(t));return n}function La(e,t){return Ia(e.properties,t)}function Ra(e,t){let n=La(e,t);return lr(n)}function za(e){let t=Oa(e),n=Ci(e,t);return t.map((e,r)=>[t[r],n[r]])}function Ba(e){let t=[];for(let n of e)t.push(...Oa(n));return Zn(t)}function Va(e){return e.filter(e=>!gt(e))}function Ha(e,t){let n=[];for(let r of e)n.push(...Ci(r,[t]));return Va(n)}function Ua(e,t){let n={};for(let r of t)n[r]=da(Ha(e,r));return n}function Wa(e,t){let n=Ba(e),r=Ua(e,n);return Ni(r,t)}function Ga(e){return k({[A]:`Date`,type:`Date`},e)}function Ka(e){return k({[A]:`Null`,type:`null`},e)}function qa(e){return k({[A]:`Symbol`,type:`symbol`},e)}function Ja(e){return k({[A]:`Undefined`,type:`undefined`},e)}function Ya(e){return k({[A]:`Uint8Array`,type:`Uint8Array`},e)}function Xa(e){return k({[A]:`Unknown`},e)}function Za(e){return e.map(e=>eo(e,!1))}function Qa(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=Ri(eo(e[n],!1));return t}function $a(e,t){return t===!0?e:Ri(e)}function eo(e,t){return ae(e)||ue(e)?$a(nr(),t):oe(e)?Ri(Hi(Za(e))):C(e)?Ya():ce(e)?Ga():b(e)?$a(Ni(Qa(e)),t):le(e)?$a(dr([],Xa()),t):w(e)?Ja():de(e)?Ka():S(e)?qa():se(e)?Jr():fe(e)||y(e)||x(e)?Kr(e):Ni({})}function to(e,t){return k(eo(e,!0),t)}function no(e,t){return ot(e)?Hi(e.parameters,t):R(t)}function ro(e,t){if(w(e))throw Error(`Enum undefined or empty`);let n=globalThis.Object.getOwnPropertyNames(e).filter(e=>isNaN(e)).map(t=>e[t]),r=[...new Set(n)].map(e=>Kr(e));return vr(r,{...t,[Xe]:`Enum`})}var io=class extends Ke{},z;(function(e){e[e.Union=0]=`Union`,e[e.True=1]=`True`,e[e.False=2]=`False`})(z||={});function ao(e){return e===z.False?e:z.True}function oo(e){throw new io(e)}function so(e){return gn(e)||sn(e)||jn(e)||Nn(e)||Jt(e)}function co(e,t){return gn(t)?Do(e,t):sn(t)?Co(e,t):jn(t)?fs(e,t):Nn(t)?ms(e,t):Jt(t)?lo(e,t):oo(`StructuralRight`)}function lo(e,t){return z.True}function uo(e,t){return sn(t)?Co(e,t):jn(t)&&t.anyOf.some(e=>Jt(e)||Nn(e))?z.True:jn(t)?z.Union:Nn(t)||Jt(t)?z.True:z.Union}function fo(e,t){return Nn(e)?z.False:Jt(e)?z.Union:gn(e)?z.True:z.False}function po(e,t){return I(t)&&Wo(t)?z.True:so(t)?co(e,t):Xt(t)?ao(B(e.items,t.items)):z.False}function mo(e,t){return so(t)?co(e,t):Zt(t)?ao(B(e.items,t.items)):z.False}function ho(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):Qt(t)?z.True:z.False}function go(e,t){return dn(e)||$t(e)?z.True:z.False}function _o(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):$t(t)?z.True:z.False}function vo(e,t){return so(t)?co(e,t):I(t)?qo(e,t):tn(t)?e.parameters.length>t.parameters.length?z.False:e.parameters.every((e,n)=>ao(B(t.parameters[n],e))===z.True)?ao(B(e.returns,t.returns)):z.False:z.False}function yo(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):nn(t)?z.True:z.False}function bo(e,t){return so(t)?co(e,t):I(t)?qo(e,t):rn(t)?e.parameters.length>t.parameters.length?z.False:e.parameters.every((e,n)=>ao(B(t.parameters[n],e))===z.True)?ao(B(e.returns,t.returns)):z.False:z.False}function xo(e,t){return fn(e)&&fe(e.const)||yn(e)||an(e)?z.True:z.False}function So(e,t){return an(t)||yn(t)?z.True:so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):z.False}function Co(e,t){return t.allOf.every(t=>B(e,t)===z.True)?z.True:z.False}function wo(e,t){return e.allOf.some(e=>B(e,t)===z.True)?z.True:z.False}function To(e,t){return so(t)?co(e,t):cn(t)?ao(B(e.items,t.items)):z.False}function Eo(e,t){return fn(t)&&t.const===e.const?z.True:so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):wn(t)?ts(e,t):yn(t)?Mo(e,t):an(t)?xo(e,t):$t(t)?go(e,t):z.False}function Do(e,t){return z.False}function Oo(e,t){return z.True}function ko(e){let[t,n]=[e,0];for(;_n(t);)t=t.not,n+=1;return n%2==0?t:Xa()}function Ao(e,t){return _n(e)?B(ko(e),t):_n(t)?B(e,ko(t)):oo(`Invalid fallthrough for Not`)}function jo(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):vn(t)?z.True:z.False}function Mo(e,t){return un(e)||yn(e)||an(e)?z.True:z.False}function No(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):an(t)||yn(t)?z.True:z.False}function Po(e,t){return Object.getOwnPropertyNames(e.properties).length===t}function Fo(e){return Wo(e)}function Io(e){return Po(e,0)||Po(e,1)&&`description`in e.properties&&jn(e.properties.description)&&e.properties.description.anyOf.length===2&&(wn(e.properties.description.anyOf[0])&&An(e.properties.description.anyOf[1])||wn(e.properties.description.anyOf[1])&&An(e.properties.description.anyOf[0]))}function Lo(e){return Po(e,0)}function Ro(e){return Po(e,0)}function zo(e){return Po(e,0)}function Bo(e){return Po(e,0)}function Vo(e){return Wo(e)}function Ho(e){let t=Yr();return Po(e,0)||Po(e,1)&&`length`in e.properties&&ao(B(e.properties.length,t))===z.True}function Uo(e){return Po(e,0)}function Wo(e){let t=Yr();return Po(e,0)||Po(e,1)&&`length`in e.properties&&ao(B(e.properties.length,t))===z.True}function Go(e){let t=dr([nr()],nr());return Po(e,0)||Po(e,1)&&`then`in e.properties&&ao(B(e.properties.then,t))===z.True}function Ko(e,t){return B(e,t)===z.False||qt(e)&&!qt(t)?z.False:z.True}function qo(e,t){return Nn(e)?z.False:Jt(e)?z.Union:gn(e)||ln(e)&&Fo(t)||un(e)&&Lo(t)||dn(e)&&Ro(t)||Tn(e)&&Io(t)||Qt(e)&&zo(t)||wn(e)&&Fo(t)||Tn(e)&&Io(t)||yn(e)&&Lo(t)||an(e)&&Lo(t)||$t(e)&&Ro(t)||Mn(e)&&Vo(t)||nn(e)&&Bo(t)||tn(e)&&Uo(t)||rn(e)&&Ho(t)?z.True:xn(e)&&wn(Xo(e))?(()=>t[Xe]===`Record`?z.True:z.False)():xn(e)&&yn(Xo(e))?(()=>Po(t,0)?z.True:z.False)():z.False}function Jo(e,t){return so(t)?co(e,t):xn(t)?Qo(e,t):I(t)?(()=>{for(let n of Object.getOwnPropertyNames(t.properties)){if(!(n in e.properties)&&!qt(t.properties[n]))return z.False;if(qt(t.properties[n]))return z.True;if(Ko(e.properties[n],t.properties[n])===z.False)return z.False}return z.True})():z.False}function Yo(e,t){return so(t)?co(e,t):I(t)&&Go(t)?z.True:bn(t)?ao(B(e.item,t.item)):z.False}function Xo(e){return Bn in e.patternProperties?Yr():Vn in e.patternProperties?Xr():oo(`Unknown record key pattern`)}function Zo(e){return Bn in e.patternProperties?e.patternProperties[Bn]:Vn in e.patternProperties?e.patternProperties[Vn]:oo(`Unable to get record value schema`)}function Qo(e,t){let[n,r]=[Xo(t),Zo(t)];return ln(e)&&yn(n)&&ao(B(e,r))===z.True?z.True:Mn(e)&&yn(n)||wn(e)&&yn(n)||Xt(e)&&yn(n)?B(e,r):I(e)?(()=>{for(let t of Object.getOwnPropertyNames(e.properties))if(Ko(r,e.properties[t])===z.False)return z.False;return z.True})():z.False}function $o(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?B(Zo(e),Zo(t)):z.False}function es(e,t){let n=Cn(e)?Xr():e,r=Cn(t)?Xr():t;return B(n,r)}function ts(e,t){return fn(e)&&x(e.const)||wn(e)?z.True:z.False}function ns(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):wn(t)?z.True:z.False}function rs(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):Tn(t)?z.True:z.False}function os(e,t){return En(e)?B(ai(e),t):En(t)?B(e,ai(t)):oo(`Invalid fallthrough for TemplateLiteral`)}function ss(e,t){return Xt(t)&&e.items!==void 0&&e.items.every(e=>B(e,t.items)===z.True)}function cs(e,t){return gn(e)?z.True:Nn(e)?z.False:Jt(e)?z.Union:z.False}function ls(e,t){return so(t)?co(e,t):I(t)&&Wo(t)||Xt(t)&&ss(e,t)?z.True:kn(t)?w(e.items)&&!w(t.items)||!w(e.items)&&w(t.items)?z.False:w(e.items)&&!w(t.items)||e.items.every((e,n)=>B(e,t.items[n])===z.True)?z.True:z.False:z.False}function us(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):Mn(t)?z.True:z.False}function ds(e,t){return so(t)?co(e,t):I(t)?qo(e,t):xn(t)?Qo(e,t):Fn(t)?gs(e,t):An(t)?z.True:z.False}function fs(e,t){return t.anyOf.some(t=>B(e,t)===z.True)?z.True:z.False}function ps(e,t){return e.anyOf.every(e=>B(e,t)===z.True)?z.True:z.False}function ms(e,t){return z.True}function hs(e,t){return gn(t)?Do(e,t):sn(t)?Co(e,t):jn(t)?fs(e,t):Jt(t)?lo(e,t):wn(t)?ts(e,t):yn(t)?Mo(e,t):an(t)?xo(e,t):$t(t)?go(e,t):Xt(t)?fo(e,t):kn(t)?cs(e,t):I(t)?qo(e,t):Nn(t)?z.True:z.False}function gs(e,t){return An(e)||An(e)?z.True:z.False}function _s(e,t){return sn(t)?Co(e,t):jn(t)?fs(e,t):Nn(t)?ms(e,t):Jt(t)?lo(e,t):I(t)?qo(e,t):Fn(t)?z.True:z.False}function B(e,t){return En(e)||En(t)?os(e,t):Cn(e)||Cn(t)?es(e,t):_n(e)||_n(t)?Ao(e,t):Jt(e)?uo(e,t):Xt(e)?po(e,t):Qt(e)?ho(e,t):$t(e)?_o(e,t):Zt(e)?mo(e,t):tn(e)?vo(e,t):nn(e)?yo(e,t):rn(e)?bo(e,t):an(e)?So(e,t):sn(e)?wo(e,t):cn(e)?To(e,t):fn(e)?Eo(e,t):gn(e)?Oo(e,t):vn(e)?jo(e,t):yn(e)?No(e,t):I(e)?Jo(e,t):xn(e)?$o(e,t):wn(e)?ns(e,t):Tn(e)?rs(e,t):kn(e)?ls(e,t):bn(e)?Yo(e,t):Mn(e)?us(e,t):An(e)?ds(e,t):jn(e)?ps(e,t):Nn(e)?hs(e,t):Fn(e)?_s(e,t):oo(`Unknown left type operand '${e[A]}'`)}function vs(e,t){return B(e,t)}function ys(e,t,n,r,i){let a={};for(let o of globalThis.Object.getOwnPropertyNames(e))a[o]=Cs(e[o],t,n,r,ve(i));return a}function bs(e,t,n,r,i){return ys(e.properties,t,n,r,i)}function xs(e,t,n,r,i){let a=bs(e,t,n,r,i);return lr(a)}function Ss(e,t,n,r){let i=vs(e,t);return i===z.Union?vr([n,r]):i===z.True?n:r}function Cs(e,t,n,r,i){return ht(e)?xs(e,t,n,r,i):mt(e)?k(Ds(e,t,n,r,i)):k(Ss(e,t,n,r),i)}function ws(e,t,n,r,i){return{[e]:Cs(Kr(e),t,n,r,ve(i))}}function Ts(e,t,n,r,i){return e.reduce((e,a)=>({...e,...ws(a,t,n,r,i)}),{})}function Es(e,t,n,r,i){return Ts(e.keys,t,n,r,i)}function Ds(e,t,n,r,i){let a=Es(e,t,n,r,i);return lr(a)}function Os(e){return e.allOf.every(e=>js(e))}function ks(e){return e.anyOf.some(e=>js(e))}function As(e){return!js(e.not)}function js(e){return e[A]===`Intersect`?Os(e):e[A]===`Union`?ks(e):e[A]===`Not`?As(e):e[A]===`Undefined`}function Ms(e,t){return Ps(ai(e),t)}function Ns(e,t){let n=e.filter(e=>vs(e,t)===z.False);return n.length===1?n[0]:vr(n)}function Ps(e,t,n={}){return Dt(e)?k(Ms(e,t),n):ht(e)?k(Ls(e,t),n):k(jt(e)?Ns(e.anyOf,t):vs(e,t)===z.False?e:R(),n)}function Fs(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Ps(e[r],t);return n}function Is(e,t){return Fs(e.properties,t)}function Ls(e,t){let n=Is(e,t);return lr(n)}function Rs(e,t){return Bs(ai(e),t)}function zs(e,t){let n=e.filter(e=>vs(e,t)!==z.False);return n.length===1?n[0]:vr(n)}function Bs(e,t,n){return Dt(e)?k(Rs(e,t),n):ht(e)?k(Us(e,t),n):k(jt(e)?zs(e.anyOf,t):vs(e,t)===z.False?R():e,n)}function Vs(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Bs(e[r],t);return n}function Hs(e,t){return Vs(e.properties,t)}function Us(e,t){let n=Hs(e,t);return lr(n)}function Ws(e,t){return ot(e)?k(e.returns,t):R(t)}function Gs(e){return Ri(na(e))}function Ks(e,t,n){return k({[A]:`Record`,type:`object`,patternProperties:{[e]:t}},n)}function qs(e,t,n){let r={};for(let n of e)r[n]=t;return Ni(r,{...n,[Xe]:`Record`})}function Js(e,t,n){return Rr(e)?qs(ui(e),t,n):Ks(e.pattern,t,n)}function Ys(e,t,n){return qs(ui(vr(e)),t,n)}function Xs(e,t,n){return qs([e.toString()],t,n)}function Zs(e,t,n){return Ks(e.source,t,n)}function Qs(e,t,n){let r=w(e.pattern)?Vn:e.pattern;return Ks(r,t,n)}function $s(e,t,n){return Ks(Vn,t,n)}function ec(e,t,n){return Ks(`^(?!.*)$`,t,n)}function tc(e,t,n){return Ni({true:t,false:t},n)}function nc(e,t,n){return Ks(Bn,t,n)}function rc(e,t,n){return Ks(Bn,t,n)}function ic(e,t,n={}){return jt(e)?Ys(e.anyOf,t,n):Dt(e)?Js(e,t,n):pt(e)?Xs(e.const,t,n):it(e)?tc(e,t,n):lt(e)?nc(e,t,n):yt(e)?rc(e,t,n):wt(e)?Zs(e,t,n):Tt(e)?Qs(e,t,n):$e(e)?$s(e,t,n):gt(e)?ec(e,t,n):R(n)}function ac(e){return globalThis.Object.getOwnPropertyNames(e.patternProperties)[0]}function oc(e){let t=ac(e);return t===Vn?Xr():t===Bn?Yr():Xr({pattern:t})}function sc(e){return e.patternProperties[ac(e)]}function cc(e,t){return t.parameters=Sc(e,t.parameters),t.returns=Cc(e,t.returns),t}function lc(e,t){return t.parameters=Sc(e,t.parameters),t.returns=Cc(e,t.returns),t}function uc(e,t){return t.allOf=Sc(e,t.allOf),t}function dc(e,t){return t.anyOf=Sc(e,t.anyOf),t}function fc(e,t){return w(t.items)||(t.items=Sc(e,t.items)),t}function pc(e,t){return t.items=Cc(e,t.items),t}function mc(e,t){return t.items=Cc(e,t.items),t}function hc(e,t){return t.items=Cc(e,t.items),t}function gc(e,t){return t.item=Cc(e,t.item),t}function _c(e,t){let n=xc(e,t.properties);return{...t,...Ni(n)}}function vc(e,t){let n=Cc(e,oc(t)),r=Cc(e,sc(t)),i=ic(n,r);return{...t,...i}}function yc(e,t){return t.index in e?e[t.index]:Xa()}function bc(e,t){let n=Ze(t),r=Qe(t),i=Cc(e,t);return n&&r?Gs(i):n&&!r?Ri(i):!n&&r?na(i):i}function xc(e,t){return globalThis.Object.getOwnPropertyNames(t).reduce((n,r)=>({...n,[r]:bc(e,t[r])}),{})}function Sc(e,t){return t.map(t=>Cc(e,t))}function Cc(e,t){return ot(t)?cc(e,t):ct(t)?lc(e,t):ut(t)?uc(e,t):jt(t)?dc(e,t):kt(t)?fc(e,t):tt(t)?pc(e,t):nt(t)?mc(e,t):dt(t)?hc(e,t):xt(t)?gc(e,t):bt(t)?_c(e,t):St(t)?vc(e,t):et(t)?yc(e,t):t}function wc(e,t){return Cc(t,ye(e))}function Tc(e){return k({[A]:`Integer`,type:`integer`},e)}function Ec(e,t,n){return{[e]:Lc(Kr(e),t,ve(n))}}function Dc(e,t,n){return e.reduce((e,r)=>({...e,...Ec(r,t,n)}),{})}function Oc(e,t,n){return Dc(e.keys,t,n)}function kc(e,t,n){let r=Oc(e,t,n);return lr(r)}function Ac(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toLowerCase(),n].join(``)}function jc(e){let[t,n]=[e.slice(0,1),e.slice(1)];return[t.toUpperCase(),n].join(``)}function Mc(e){return e.toUpperCase()}function Nc(e){return e.toLowerCase()}function Pc(e,t,n){let r=Mr(e.pattern);if(!Lr(r))return{...e,pattern:Fc(e.pattern,t)};let i=[...Wr(r)].map(e=>Kr(e)),a=Ic(i,t),o=vr(a);return oi([o],n)}function Fc(e,t){return typeof e==`string`?t===`Uncapitalize`?Ac(e):t===`Capitalize`?jc(e):t===`Uppercase`?Mc(e):t===`Lowercase`?Nc(e):e:e.toString()}function Ic(e,t){return e.map(e=>Lc(e,t))}function Lc(e,t,n={}){return mt(e)?kc(e,t,n):Dt(e)?Pc(e,t,n):jt(e)?vr(Ic(e.anyOf,t),n):pt(e)?Kr(Fc(e.const,t),n):k(e,n)}function Rc(e,t={}){return Lc(e,`Capitalize`,t)}function zc(e,t={}){return Lc(e,`Lowercase`,t)}function Bc(e,t={}){return Lc(e,`Uncapitalize`,t)}function Vc(e,t={}){return Lc(e,`Uppercase`,t)}function Hc(e,t,n){let r={};for(let i of globalThis.Object.getOwnPropertyNames(e))r[i]=Qc(e[i],t,ve(n));return r}function Uc(e,t,n){return Hc(e.properties,t,n)}function Wc(e,t,n){let r=Uc(e,t,n);return lr(r)}function Gc(e,t){return e.map(e=>Zc(e,t))}function Kc(e,t){return e.map(e=>Zc(e,t))}function qc(e,t){let{[t]:n,...r}=e;return r}function Jc(e,t){return t.reduce((e,t)=>qc(e,t),e)}function Yc(e,t){let n=cr(e,[qe,`$id`,`required`,`properties`]),r=Jc(e.properties,t);return Ni(r,n)}function Xc(e){let t=e.reduce((e,t)=>ft(t)?[...e,Kr(t)]:e,[]);return vr(t)}function Zc(e,t){return ut(e)?fa(Gc(e.allOf,t)):jt(e)?vr(Kc(e.anyOf,t)):bt(e)?Yc(e,t):Ni({})}function Qc(e,t,n){let r=oe(t)?Xc(t):t,i=Lt(t)?ui(t):t,a=Ct(e),o=Ct(t);return ht(e)?Wc(e,i,n):mt(t)?nl(e,t,n):a&&o||!a&&o||a&&!o?or(`Omit`,[e,r],n):k({...Zc(e,i),...n})}function $c(e,t,n){return{[t]:Qc(e,[t],ve(n))}}function el(e,t,n){return t.reduce((t,r)=>({...t,...$c(e,r,n)}),{})}function tl(e,t,n){return el(e,t.keys,n)}function nl(e,t,n){let r=tl(e,t,n);return lr(r)}function rl(e,t,n){let r={};for(let i of globalThis.Object.getOwnPropertyNames(e))r[i]=fl(e[i],t,ve(n));return r}function il(e,t,n){return rl(e.properties,t,n)}function al(e,t,n){let r=il(e,t,n);return lr(r)}function ol(e,t){return e.map(e=>dl(e,t))}function sl(e,t){return e.map(e=>dl(e,t))}function cl(e,t){let n={};for(let r of t)r in e&&(n[r]=e[r]);return n}function ll(e,t){let n=cr(e,[qe,`$id`,`required`,`properties`]),r=cl(e.properties,t);return Ni(r,n)}function ul(e){let t=e.reduce((e,t)=>ft(t)?[...e,Kr(t)]:e,[]);return vr(t)}function dl(e,t){return ut(e)?fa(ol(e.allOf,t)):jt(e)?vr(sl(e.anyOf,t)):bt(e)?ll(e,t):Ni({})}function fl(e,t,n){let r=oe(t)?ul(t):t,i=Lt(t)?ui(t):t,a=Ct(e),o=Ct(t);return ht(e)?al(e,i,n):mt(t)?gl(e,t,n):a&&o||!a&&o||a&&!o?or(`Pick`,[e,r],n):k({...dl(e,i),...n})}function pl(e,t,n){return{[t]:fl(e,[t],ve(n))}}function ml(e,t,n){return t.reduce((t,r)=>({...t,...pl(e,r,n)}),{})}function hl(e,t,n){return ml(e,t.keys,n)}function gl(e,t,n){let r=hl(e,t,n);return lr(r)}function _l(e,t){return or(`Partial`,[or(e,t)])}function vl(e){return or(`Partial`,[pa(e)])}function yl(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=na(e[n]);return t}function bl(e){let t=cr(e,[qe,`$id`,`required`,`properties`]),n=yl(e.properties);return Ni(n,t)}function xl(e){return e.map(e=>Sl(e))}function Sl(e){return at(e)?_l(e.target,e.parameters):Ct(e)?vl(e.$ref):ut(e)?fa(xl(e.allOf)):jt(e)?vr(xl(e.anyOf)):bt(e)?bl(e):rt(e)||it(e)||lt(e)||pt(e)||vt(e)||yt(e)||Tt(e)||Et(e)||At(e)?e:Ni({})}function Cl(e,t){return ht(e)?El(e,t):k({...Sl(e),...t})}function wl(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Cl(e[r],ve(t));return n}function Tl(e,t){return wl(e.properties,t)}function El(e,t){let n=Tl(e,t);return lr(n)}function Dl(e,t){return or(`Required`,[or(e,t)])}function Ol(e){return or(`Required`,[pa(e)])}function kl(e){let t={};for(let n of globalThis.Object.getOwnPropertyNames(e))t[n]=cr(e[n],[Ye]);return t}function Al(e){let t=cr(e,[qe,`$id`,`required`,`properties`]),n=kl(e.properties);return Ni(n,t)}function jl(e){return e.map(e=>Ml(e))}function Ml(e){return at(e)?Dl(e.target,e.parameters):Ct(e)?Ol(e.$ref):ut(e)?fa(jl(e.allOf)):jt(e)?vr(jl(e.anyOf)):bt(e)?Al(e):rt(e)||it(e)||lt(e)||pt(e)||vt(e)||yt(e)||Tt(e)||Et(e)||At(e)?e:Ni({})}function Nl(e,t){return ht(e)?Il(e,t):k({...Ml(e),...t})}function Pl(e,t){let n={};for(let r of globalThis.Object.getOwnPropertyNames(e))n[r]=Nl(e[r],t);return n}function Fl(e,t){return Pl(e.properties,t)}function Il(e,t){let n=Fl(e,t);return lr(n)}function Ll(e,t){return t.map(t=>Ct(t)?Rl(e,t.$ref):au(e,t))}function Rl(e,t){return t in e?Ct(e[t])?Rl(e,e[t].$ref):au(e,e[t]):R()}function zl(e){return ba(e[0])}function Bl(e){return Ti(e[0],e[1])}function Vl(e){return Fa(e[0])}function Hl(e){return Cl(e[0])}function Ul(e){return Qc(e[0],e[1])}function Wl(e){return fl(e[0],e[1])}function Gl(e){return Nl(e[0])}function Kl(e,t,n){let r=Ll(e,n);return t===`Awaited`?zl(r):t===`Index`?Bl(r):t===`KeyOf`?Vl(r):t===`Partial`?Hl(r):t===`Omit`?Ul(r):t===`Pick`?Wl(r):t===`Required`?Gl(r):R()}function ql(e,t){return rr(au(e,t))}function Jl(e,t){return ar(au(e,t))}function Yl(e,t,n){return ur(iu(e,t),au(e,n))}function Xl(e,t,n){return dr(iu(e,t),au(e,n))}function Zl(e,t){return fa(iu(e,t))}function Ql(e,t){return Ai(au(e,t))}function $l(e,t){return Ni(globalThis.Object.keys(t).reduce((n,r)=>({...n,[r]:au(e,t[r])}),{}))}function eu(e,t){let[n,r]=[au(e,sc(t)),ac(t)],i=ye(t);return i.patternProperties[r]=n,i}function tu(e,t){return Ct(t)?{...Rl(e,t.$ref),[qe]:t[qe]}:t}function nu(e,t){return Hi(iu(e,t))}function ru(e,t){return vr(iu(e,t))}function iu(e,t){return t.map(t=>au(e,t))}function au(e,t){return Qe(t)?k(au(e,cr(t,[Ye])),t):Ze(t)?k(au(e,cr(t,[Je])),t):M(t)?k(tu(e,t),t):tt(t)?k(ql(e,t.items),t):nt(t)?k(Jl(e,t.items),t):at(t)?k(Kl(e,t.target,t.parameters)):ot(t)?k(Yl(e,t.parameters,t.returns),t):ct(t)?k(Xl(e,t.parameters,t.returns),t):ut(t)?k(Zl(e,t.allOf),t):dt(t)?k(Ql(e,t.items),t):bt(t)?k($l(e,t.properties),t):St(t)?k(eu(e,t)):kt(t)?k(nu(e,t.items||[]),t):jt(t)?k(ru(e,t.anyOf),t):t}function ou(e,t){return t in e?au(e,e[t]):R()}function su(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>({...t,[n]:ou(e,n)}),{})}var cu=class{constructor(e){let t=su(e);this.$defs=this.WithIdentifiers(t)}Import(e,t){let n={...this.$defs,[e]:k(this.$defs[e],t)};return k({[A]:`Import`,$defs:n,$ref:e})}WithIdentifiers(e){return globalThis.Object.getOwnPropertyNames(e).reduce((t,n)=>({...t,[n]:{...e[n],$id:n}}),{})}};function lu(e){return new cu(e)}function uu(e,t){return k({[A]:`Not`,not:e},t)}function du(e,t){return ct(e)?Hi(e.parameters,t):R()}var fu=0;function pu(e,t={}){w(t.$id)&&(t.$id=`T${fu++}`);let n=ye(e({[A]:`This`,$ref:`${t.$id}`}));return n.$id=t.$id,k({[Xe]:`Recursive`,...n},t)}function mu(e,t){let n=x(e)?new globalThis.RegExp(e):e;return k({[A]:`RegExp`,type:`RegExp`,source:n.source,flags:n.flags},t)}function hu(e){return ut(e)?e.allOf:jt(e)?e.anyOf:kt(e)?e.items??[]:[]}function gu(e){return hu(e)}function _u(e,t){return ct(e)?k(e.returns,t):R(t)}var vu=class{constructor(e){this.schema=e}Decode(e){return new yu(this.schema,e)}},yu=class{constructor(e,t){this.schema=e,this.decode=t}EncodeTransform(e,t){let n={Encode:n=>t[qe].Encode(e(n)),Decode:e=>this.decode(t[qe].Decode(e))};return{...t,[qe]:n}}EncodeSchema(e,t){let n={Decode:this.decode,Encode:e};return{...t,[qe]:n}}Encode(e){return M(this.schema)?this.EncodeTransform(e,this.schema):this.EncodeSchema(e,this.schema)}};function bu(e){return new vu(e)}function xu(e={}){return k({[A]:e[A]??`Unsafe`},e)}function Su(e){return k({[A]:`Void`,type:`void`},e)}var Cu=t({Any:()=>nr,Argument:()=>ir,Array:()=>rr,AsyncIterator:()=>ar,Awaited:()=>ba,BigInt:()=>Jr,Boolean:()=>qr,Capitalize:()=>Rc,Composite:()=>Wa,Const:()=>to,Constructor:()=>ur,ConstructorParameters:()=>no,Date:()=>Ga,Enum:()=>ro,Exclude:()=>Ps,Extends:()=>Cs,Extract:()=>Bs,Function:()=>dr,Index:()=>Ti,InstanceType:()=>Ws,Instantiate:()=>wc,Integer:()=>Tc,Intersect:()=>fa,Iterator:()=>Ai,KeyOf:()=>Fa,Literal:()=>Kr,Lowercase:()=>zc,Mapped:()=>Qi,Module:()=>lu,Never:()=>R,Not:()=>uu,Null:()=>Ka,Number:()=>Yr,Object:()=>Ni,Omit:()=>Qc,Optional:()=>na,Parameters:()=>du,Partial:()=>Cl,Pick:()=>fl,Promise:()=>Pi,Readonly:()=>Ri,ReadonlyOptional:()=>Gs,Record:()=>ic,Recursive:()=>pu,Ref:()=>pa,RegExp:()=>mu,Required:()=>Nl,Rest:()=>gu,ReturnType:()=>_u,String:()=>Xr,Symbol:()=>qa,TemplateLiteral:()=>oi,Transform:()=>bu,Tuple:()=>Hi,Uint8Array:()=>Ya,Uncapitalize:()=>Bc,Undefined:()=>Ja,Union:()=>vr,Unknown:()=>Xa,Unsafe:()=>xu,Uppercase:()=>Vc,Void:()=>Su}),wu=r(((exports,t)=>{var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7];function r(e){var t=e.indexOf(`%`);if(t===-1)return e;for(var r=e.length,i=``,o=0,s=0,c=t,l=12;t>-1&&t<r;){var u=a(e[t+1],4),d=a(e[t+2],0),f=u|d,p=n[f];if(l=n[256+l+p],s=s<<6|f&n[364+p],l===12)i+=e.slice(o,c),i+=s<=65535?String.fromCharCode(s):String.fromCharCode(55232+(s>>10),56320+(s&1023)),s=0,o=t+3,t=c=e.indexOf(`%`,o);else if(l===0)return null;else{if(t+=3,t<r&&e.charCodeAt(t)===37)continue;return null}}return i+e.slice(o)}var i={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};function a(e,t){var n=i[e];return n===void 0?255:n<<t}t.exports=r}));function Tu(e){switch(e.errorType){case H.ArrayContains:return`Expected array to contain at least one matching value`;case H.ArrayMaxContains:return`Expected array to contain no more than ${e.schema.maxContains} matching values`;case H.ArrayMinContains:return`Expected array to contain at least ${e.schema.minContains} matching values`;case H.ArrayMaxItems:return`Expected array length to be less or equal to ${e.schema.maxItems}`;case H.ArrayMinItems:return`Expected array length to be greater or equal to ${e.schema.minItems}`;case H.ArrayUniqueItems:return`Expected array elements to be unique`;case H.Array:return`Expected array`;case H.AsyncIterator:return`Expected AsyncIterator`;case H.BigIntExclusiveMaximum:return`Expected bigint to be less than ${e.schema.exclusiveMaximum}`;case H.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${e.schema.exclusiveMinimum}`;case H.BigIntMaximum:return`Expected bigint to be less or equal to ${e.schema.maximum}`;case H.BigIntMinimum:return`Expected bigint to be greater or equal to ${e.schema.minimum}`;case H.BigIntMultipleOf:return`Expected bigint to be a multiple of ${e.schema.multipleOf}`;case H.BigInt:return`Expected bigint`;case H.Boolean:return`Expected boolean`;case H.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${e.schema.exclusiveMinimumTimestamp}`;case H.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${e.schema.exclusiveMaximumTimestamp}`;case H.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${e.schema.minimumTimestamp}`;case H.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${e.schema.maximumTimestamp}`;case H.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${e.schema.multipleOfTimestamp}`;case H.Date:return`Expected Date`;case H.Function:return`Expected function`;case H.IntegerExclusiveMaximum:return`Expected integer to be less than ${e.schema.exclusiveMaximum}`;case H.IntegerExclusiveMinimum:return`Expected integer to be greater than ${e.schema.exclusiveMinimum}`;case H.IntegerMaximum:return`Expected integer to be less or equal to ${e.schema.maximum}`;case H.IntegerMinimum:return`Expected integer to be greater or equal to ${e.schema.minimum}`;case H.IntegerMultipleOf:return`Expected integer to be a multiple of ${e.schema.multipleOf}`;case H.Integer:return`Expected integer`;case H.IntersectUnevaluatedProperties:return`Unexpected property`;case H.Intersect:return`Expected all values to match`;case H.Iterator:return`Expected Iterator`;case H.Literal:return`Expected ${typeof e.schema.const==`string`?`'${e.schema.const}'`:e.schema.const}`;case H.Never:return`Never`;case H.Not:return`Value should not match`;case H.Null:return`Expected null`;case H.NumberExclusiveMaximum:return`Expected number to be less than ${e.schema.exclusiveMaximum}`;case H.NumberExclusiveMinimum:return`Expected number to be greater than ${e.schema.exclusiveMinimum}`;case H.NumberMaximum:return`Expected number to be less or equal to ${e.schema.maximum}`;case H.NumberMinimum:return`Expected number to be greater or equal to ${e.schema.minimum}`;case H.NumberMultipleOf:return`Expected number to be a multiple of ${e.schema.multipleOf}`;case H.Number:return`Expected number`;case H.Object:return`Expected object`;case H.ObjectAdditionalProperties:return`Unexpected property`;case H.ObjectMaxProperties:return`Expected object to have no more than ${e.schema.maxProperties} properties`;case H.ObjectMinProperties:return`Expected object to have at least ${e.schema.minProperties} properties`;case H.ObjectRequiredProperty:return`Expected required property`;case H.Promise:return`Expected Promise`;case H.RegExp:return`Expected string to match regular expression`;case H.StringFormatUnknown:return`Unknown format '${e.schema.format}'`;case H.StringFormat:return`Expected string to match '${e.schema.format}' format`;case H.StringMaxLength:return`Expected string length less or equal to ${e.schema.maxLength}`;case H.StringMinLength:return`Expected string length greater or equal to ${e.schema.minLength}`;case H.StringPattern:return`Expected string to match '${e.schema.pattern}'`;case H.String:return`Expected string`;case H.Symbol:return`Expected symbol`;case H.TupleLength:return`Expected tuple to have ${e.schema.maxItems||0} elements`;case H.Tuple:return`Expected tuple`;case H.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${e.schema.maxByteLength}`;case H.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${e.schema.minByteLength}`;case H.Uint8Array:return`Expected Uint8Array`;case H.Undefined:return`Expected undefined`;case H.Union:return`Expected union value`;case H.Void:return`Expected void`;case H.Kind:return`Expected kind '${e.schema[A]}'`;default:return`Unknown error type`}}var Eu=Tu;function Du(){return Eu}var Ou=class extends Ke{constructor(e){super(`Unable to dereference schema with $id '${e.$ref}'`),this.schema=e}};function ku(e,t){let n=t.find(t=>t.$id===e.$ref);if(n===void 0)throw new Ou(e);return ju(n,t)}function Au(e,t){return!Fe(e.$id)||t.some(t=>t.$id===e.$id)||t.push(e),t}function ju(e,t){return e[A]===`This`||e[A]===`Ref`?ku(e,t):e}var Mu=class extends Ke{constructor(e){super(`Unable to hash value`),this.value=e}},Nu;(function(e){e[e.Undefined=0]=`Undefined`,e[e.Null=1]=`Null`,e[e.Boolean=2]=`Boolean`,e[e.Number=3]=`Number`,e[e.String=4]=`String`,e[e.Object=5]=`Object`,e[e.Array=6]=`Array`,e[e.Date=7]=`Date`,e[e.Uint8Array=8]=`Uint8Array`,e[e.Symbol=9]=`Symbol`,e[e.BigInt=10]=`BigInt`})(Nu||={});var Pu=BigInt(`14695981039346656037`),[Fu,Iu]=[BigInt(`1099511628211`),BigInt(`18446744073709551616`)],Lu=Array.from({length:256}).map((e,t)=>BigInt(t)),Ru=new Float64Array(1),zu=new DataView(Ru.buffer),Bu=new Uint8Array(Ru.buffer);function*Vu(e){let t=e===0?1:Math.ceil(Math.floor(Math.log2(e)+1)/8);for(let n=0;n<t;n++)yield e>>8*(t-1-n)&255}function Hu(e){ed(Nu.Array);for(let t of e)$u(t)}function Uu(e){ed(Nu.Boolean),ed(e?1:0)}function Wu(e){ed(Nu.BigInt),zu.setBigInt64(0,e);for(let e of Bu)ed(e)}function Gu(e){ed(Nu.Date),$u(e.getTime())}function Ku(e){ed(Nu.Null)}function qu(e){ed(Nu.Number),zu.setFloat64(0,e);for(let e of Bu)ed(e)}function Ju(e){ed(Nu.Object);for(let t of globalThis.Object.getOwnPropertyNames(e).sort())$u(t),$u(e[t])}function Yu(e){ed(Nu.String);for(let t=0;t<e.length;t++)for(let n of Vu(e.charCodeAt(t)))ed(n)}function Xu(e){ed(Nu.Symbol),$u(e.description)}function Zu(e){ed(Nu.Uint8Array);for(let t=0;t<e.length;t++)ed(e[t])}function Qu(e){return ed(Nu.Undefined)}function $u(e){if(ke(e))return Hu(e);if(Me(e))return Uu(e);if(Pe(e))return Wu(e);if(Ce(e))return Gu(e);if(je(e))return Ku(e);if(O(e))return qu(e);if(Oe(e))return Ju(e);if(Fe(e))return Yu(e);if(Le(e))return Xu(e);if(De(e))return Zu(e);if(Ae(e))return Qu(e);throw new Mu(e)}function ed(e){Pu^=Lu[e],Pu=Pu*Fu%Iu}function td(e){return Pu=BigInt(`14695981039346656037`),$u(e),Pu}var nd=class extends Ke{constructor(e){super(`Unknown type`),this.schema=e}};function rd(e){return e[A]===`Any`||e[A]===`Unknown`}function V(e){return e!==void 0}function id(e,t,n){return!0}function ad(e,t,n){return!0}function od(e,t,n){if(!ke(n)||V(e.minItems)&&!(n.length>=e.minItems)||V(e.maxItems)&&!(n.length<=e.maxItems)||!n.every(n=>Rd(e.items,t,n))||e.uniqueItems===!0&&!(function(){let e=new Set;for(let t of n){let n=td(t);if(e.has(n))return!1;e.add(n)}return!0})())return!1;if(!(V(e.contains)||O(e.minContains)||O(e.maxContains)))return!0;let r=V(e.contains)?e.contains:R(),i=n.reduce((e,n)=>Rd(r,t,n)?e+1:e,0);return!(i===0||O(e.minContains)&&i<e.minContains||O(e.maxContains)&&i>e.maxContains)}function sd(e,t,n){return be(n)}function cd(e,t,n){return!(!Pe(n)||V(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||V(e.maximum)&&!(n<=e.maximum)||V(e.minimum)&&!(n>=e.minimum)||V(e.multipleOf)&&n%e.multipleOf!==BigInt(0))}function ld(e,t,n){return Me(n)}function ud(e,t,n){return Rd(e.returns,t,n.prototype)}function dd(e,t,n){return!(!Ce(n)||V(e.exclusiveMaximumTimestamp)&&!(n.getTime()<e.exclusiveMaximumTimestamp)||V(e.exclusiveMinimumTimestamp)&&!(n.getTime()>e.exclusiveMinimumTimestamp)||V(e.maximumTimestamp)&&!(n.getTime()<=e.maximumTimestamp)||V(e.minimumTimestamp)&&!(n.getTime()>=e.minimumTimestamp)||V(e.multipleOfTimestamp)&&n.getTime()%e.multipleOfTimestamp!==0)}function fd(e,t,n){return Ie(n)}function pd(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Rd(i,[...t,...r],n)}function md(e,t,n){return!(!Ne(n)||V(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||V(e.maximum)&&!(n<=e.maximum)||V(e.minimum)&&!(n>=e.minimum)||V(e.multipleOf)&&n%e.multipleOf!==0)}function hd(e,t,n){let r=e.allOf.every(e=>Rd(e,t,n));if(e.unevaluatedProperties===!1){let t=new RegExp(Aa(e)),i=Object.getOwnPropertyNames(n).every(e=>t.test(e));return r&&i}else if(Lt(e.unevaluatedProperties)){let i=new RegExp(Aa(e)),a=Object.getOwnPropertyNames(n).every(r=>i.test(r)||Rd(e.unevaluatedProperties,t,n[r]));return r&&a}else return r}function gd(e,t,n){return xe(n)}function _d(e,t,n){return n===e.const}function vd(e,t,n){return!1}function yd(e,t,n){return!Rd(e.not,t,n)}function bd(e,t,n){return je(n)}function xd(e,t,n){return!(!ze.IsNumberLike(n)||V(e.exclusiveMaximum)&&!(n<e.exclusiveMaximum)||V(e.exclusiveMinimum)&&!(n>e.exclusiveMinimum)||V(e.minimum)&&!(n>=e.minimum)||V(e.maximum)&&!(n<=e.maximum)||V(e.multipleOf)&&n%e.multipleOf!==0)}function Sd(e,t,n){if(!ze.IsObjectLike(n)||V(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||V(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let r=Object.getOwnPropertyNames(e.properties);for(let i of r){let r=e.properties[i];if(e.required&&e.required.includes(i)){if(!Rd(r,t,n[i])||(js(r)||rd(r))&&!(i in n))return!1}else if(ze.IsExactOptionalProperty(n,i)&&!Rd(r,t,n[i]))return!1}if(e.additionalProperties===!1){let t=Object.getOwnPropertyNames(n);return e.required&&e.required.length===r.length&&t.length===r.length?!0:t.every(e=>r.includes(e))}else if(typeof e.additionalProperties==`object`)return Object.getOwnPropertyNames(n).every(i=>r.includes(i)||Rd(e.additionalProperties,t,n[i]));else return!0}function Cd(e,t,n){return Se(n)}function wd(e,t,n){if(!ze.IsRecordLike(n)||V(e.minProperties)&&!(Object.getOwnPropertyNames(n).length>=e.minProperties)||V(e.maxProperties)&&!(Object.getOwnPropertyNames(n).length<=e.maxProperties))return!1;let[r,i]=Object.entries(e.patternProperties)[0],a=new RegExp(r),o=Object.entries(n).every(([e,n])=>a.test(e)?Rd(i,t,n):!0),s=typeof e.additionalProperties==`object`?Object.entries(n).every(([n,r])=>a.test(n)?!0:Rd(e.additionalProperties,t,r)):!0,c=e.additionalProperties===!1?Object.getOwnPropertyNames(n).every(e=>a.test(e)):!0;return o&&s&&c}function Td(e,t,n){return Rd(ju(e,t),t,n)}function Ed(e,t,n){let r=new RegExp(e.source,e.flags);return V(e.minLength)&&!(n.length>=e.minLength)||V(e.maxLength)&&!(n.length<=e.maxLength)?!1:r.test(n)}function Dd(e,t,n){return!Fe(n)||V(e.minLength)&&!(n.length>=e.minLength)||V(e.maxLength)&&!(n.length<=e.maxLength)||V(e.pattern)&&!new RegExp(e.pattern).test(n)?!1:V(e.format)?Un(e.format)?Gn(e.format)(n):!1:!0}function Od(e,t,n){return Le(n)}function kd(e,t,n){return Fe(n)&&new RegExp(e.pattern).test(n)}function Ad(e,t,n){return Rd(ju(e,t),t,n)}function jd(e,t,n){if(!ke(n)||e.items===void 0&&n.length!==0||n.length!==e.maxItems)return!1;if(!e.items)return!0;for(let r=0;r<e.items.length;r++)if(!Rd(e.items[r],t,n[r]))return!1;return!0}function Md(e,t,n){return Ae(n)}function Nd(e,t,n){return e.anyOf.some(e=>Rd(e,t,n))}function Pd(e,t,n){return!(!De(n)||V(e.maxByteLength)&&!(n.length<=e.maxByteLength)||V(e.minByteLength)&&!(n.length>=e.minByteLength))}function Fd(e,t,n){return!0}function Id(e,t,n){return ze.IsVoidLike(n)}function Ld(e,t,n){return qn(e[A])?Yn(e[A])(e,n):!1}function Rd(e,t,n){let r=V(e.$id)?Au(e,t):t,i=e;switch(i[A]){case`Any`:return id(i,r,n);case`Argument`:return ad(i,r,n);case`Array`:return od(i,r,n);case`AsyncIterator`:return sd(i,r,n);case`BigInt`:return cd(i,r,n);case`Boolean`:return ld(i,r,n);case`Constructor`:return ud(i,r,n);case`Date`:return dd(i,r,n);case`Function`:return fd(i,r,n);case`Import`:return pd(i,r,n);case`Integer`:return md(i,r,n);case`Intersect`:return hd(i,r,n);case`Iterator`:return gd(i,r,n);case`Literal`:return _d(i,r,n);case`Never`:return vd(i,r,n);case`Not`:return yd(i,r,n);case`Null`:return bd(i,r,n);case`Number`:return xd(i,r,n);case`Object`:return Sd(i,r,n);case`Promise`:return Cd(i,r,n);case`Record`:return wd(i,r,n);case`Ref`:return Td(i,r,n);case`RegExp`:return Ed(i,r,n);case`String`:return Dd(i,r,n);case`Symbol`:return Od(i,r,n);case`TemplateLiteral`:return kd(i,r,n);case`This`:return Ad(i,r,n);case`Tuple`:return jd(i,r,n);case`Undefined`:return Md(i,r,n);case`Union`:return Nd(i,r,n);case`Uint8Array`:return Pd(i,r,n);case`Unknown`:return Fd(i,r,n);case`Void`:return Id(i,r,n);default:if(!qn(i[A]))throw new nd(i);return Ld(i,r,n)}}function zd(...e){return e.length===3?Rd(e[0],e[1],e[2]):Rd(e[0],[],e[1])}var H;(function(e){e[e.ArrayContains=0]=`ArrayContains`,e[e.ArrayMaxContains=1]=`ArrayMaxContains`,e[e.ArrayMaxItems=2]=`ArrayMaxItems`,e[e.ArrayMinContains=3]=`ArrayMinContains`,e[e.ArrayMinItems=4]=`ArrayMinItems`,e[e.ArrayUniqueItems=5]=`ArrayUniqueItems`,e[e.Array=6]=`Array`,e[e.AsyncIterator=7]=`AsyncIterator`,e[e.BigIntExclusiveMaximum=8]=`BigIntExclusiveMaximum`,e[e.BigIntExclusiveMinimum=9]=`BigIntExclusiveMinimum`,e[e.BigIntMaximum=10]=`BigIntMaximum`,e[e.BigIntMinimum=11]=`BigIntMinimum`,e[e.BigIntMultipleOf=12]=`BigIntMultipleOf`,e[e.BigInt=13]=`BigInt`,e[e.Boolean=14]=`Boolean`,e[e.DateExclusiveMaximumTimestamp=15]=`DateExclusiveMaximumTimestamp`,e[e.DateExclusiveMinimumTimestamp=16]=`DateExclusiveMinimumTimestamp`,e[e.DateMaximumTimestamp=17]=`DateMaximumTimestamp`,e[e.DateMinimumTimestamp=18]=`DateMinimumTimestamp`,e[e.DateMultipleOfTimestamp=19]=`DateMultipleOfTimestamp`,e[e.Date=20]=`Date`,e[e.Function=21]=`Function`,e[e.IntegerExclusiveMaximum=22]=`IntegerExclusiveMaximum`,e[e.IntegerExclusiveMinimum=23]=`IntegerExclusiveMinimum`,e[e.IntegerMaximum=24]=`IntegerMaximum`,e[e.IntegerMinimum=25]=`IntegerMinimum`,e[e.IntegerMultipleOf=26]=`IntegerMultipleOf`,e[e.Integer=27]=`Integer`,e[e.IntersectUnevaluatedProperties=28]=`IntersectUnevaluatedProperties`,e[e.Intersect=29]=`Intersect`,e[e.Iterator=30]=`Iterator`,e[e.Kind=31]=`Kind`,e[e.Literal=32]=`Literal`,e[e.Never=33]=`Never`,e[e.Not=34]=`Not`,e[e.Null=35]=`Null`,e[e.NumberExclusiveMaximum=36]=`NumberExclusiveMaximum`,e[e.NumberExclusiveMinimum=37]=`NumberExclusiveMinimum`,e[e.NumberMaximum=38]=`NumberMaximum`,e[e.NumberMinimum=39]=`NumberMinimum`,e[e.NumberMultipleOf=40]=`NumberMultipleOf`,e[e.Number=41]=`Number`,e[e.ObjectAdditionalProperties=42]=`ObjectAdditionalProperties`,e[e.ObjectMaxProperties=43]=`ObjectMaxProperties`,e[e.ObjectMinProperties=44]=`ObjectMinProperties`,e[e.ObjectRequiredProperty=45]=`ObjectRequiredProperty`,e[e.Object=46]=`Object`,e[e.Promise=47]=`Promise`,e[e.RegExp=48]=`RegExp`,e[e.StringFormatUnknown=49]=`StringFormatUnknown`,e[e.StringFormat=50]=`StringFormat`,e[e.StringMaxLength=51]=`StringMaxLength`,e[e.StringMinLength=52]=`StringMinLength`,e[e.StringPattern=53]=`StringPattern`,e[e.String=54]=`String`,e[e.Symbol=55]=`Symbol`,e[e.TupleLength=56]=`TupleLength`,e[e.Tuple=57]=`Tuple`,e[e.Uint8ArrayMaxByteLength=58]=`Uint8ArrayMaxByteLength`,e[e.Uint8ArrayMinByteLength=59]=`Uint8ArrayMinByteLength`,e[e.Uint8Array=60]=`Uint8Array`,e[e.Undefined=61]=`Undefined`,e[e.Union=62]=`Union`,e[e.Void=63]=`Void`})(H||={});var Bd=class extends Ke{constructor(e){super(`Unknown type`),this.schema=e}};function Vd(e){return e.replace(/~/g,`~0`).replace(/\//g,`~1`)}function U(e){return e!==void 0}var Hd=class{constructor(e){this.iterator=e}[Symbol.iterator](){return this.iterator}First(){let e=this.iterator.next();return e.done?void 0:e.value}};function W(e,t,n,r,i=[]){return{type:e,schema:t,path:n,value:r,message:Du()({errorType:e,path:n,schema:t,value:r,errors:i}),errors:i}}function*Ud(e,t,n,r){}function*Wd(e,t,n,r){}function*Gd(e,t,n,r){if(!ke(r))return yield W(H.Array,e,n,r);U(e.minItems)&&!(r.length>=e.minItems)&&(yield W(H.ArrayMinItems,e,n,r)),U(e.maxItems)&&!(r.length<=e.maxItems)&&(yield W(H.ArrayMaxItems,e,n,r));for(let i=0;i<r.length;i++)yield*Tf(e.items,t,`${n}/${i}`,r[i]);if(e.uniqueItems===!0&&!(function(){let e=new Set;for(let t of r){let n=td(t);if(e.has(n))return!1;e.add(n)}return!0})()&&(yield W(H.ArrayUniqueItems,e,n,r)),!(U(e.contains)||U(e.minContains)||U(e.maxContains)))return;let i=U(e.contains)?e.contains:R(),a=r.reduce((e,r,a)=>Tf(i,t,`${n}${a}`,r).next().done===!0?e+1:e,0);a===0&&(yield W(H.ArrayContains,e,n,r)),O(e.minContains)&&a<e.minContains&&(yield W(H.ArrayMinContains,e,n,r)),O(e.maxContains)&&a>e.maxContains&&(yield W(H.ArrayMaxContains,e,n,r))}function*Kd(e,t,n,r){be(r)||(yield W(H.AsyncIterator,e,n,r))}function*qd(e,t,n,r){if(!Pe(r))return yield W(H.BigInt,e,n,r);U(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield W(H.BigIntExclusiveMaximum,e,n,r)),U(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield W(H.BigIntExclusiveMinimum,e,n,r)),U(e.maximum)&&!(r<=e.maximum)&&(yield W(H.BigIntMaximum,e,n,r)),U(e.minimum)&&!(r>=e.minimum)&&(yield W(H.BigIntMinimum,e,n,r)),U(e.multipleOf)&&r%e.multipleOf!==BigInt(0)&&(yield W(H.BigIntMultipleOf,e,n,r))}function*Jd(e,t,n,r){Me(r)||(yield W(H.Boolean,e,n,r))}function*Yd(e,t,n,r){yield*Tf(e.returns,t,n,r.prototype)}function*Xd(e,t,n,r){if(!Ce(r))return yield W(H.Date,e,n,r);U(e.exclusiveMaximumTimestamp)&&!(r.getTime()<e.exclusiveMaximumTimestamp)&&(yield W(H.DateExclusiveMaximumTimestamp,e,n,r)),U(e.exclusiveMinimumTimestamp)&&!(r.getTime()>e.exclusiveMinimumTimestamp)&&(yield W(H.DateExclusiveMinimumTimestamp,e,n,r)),U(e.maximumTimestamp)&&!(r.getTime()<=e.maximumTimestamp)&&(yield W(H.DateMaximumTimestamp,e,n,r)),U(e.minimumTimestamp)&&!(r.getTime()>=e.minimumTimestamp)&&(yield W(H.DateMinimumTimestamp,e,n,r)),U(e.multipleOfTimestamp)&&r.getTime()%e.multipleOfTimestamp!==0&&(yield W(H.DateMultipleOfTimestamp,e,n,r))}function*Zd(e,t,n,r){Ie(r)||(yield W(H.Function,e,n,r))}function*Qd(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref];yield*Tf(a,[...t,...i],n,r)}function*$d(e,t,n,r){if(!Ne(r))return yield W(H.Integer,e,n,r);U(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield W(H.IntegerExclusiveMaximum,e,n,r)),U(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield W(H.IntegerExclusiveMinimum,e,n,r)),U(e.maximum)&&!(r<=e.maximum)&&(yield W(H.IntegerMaximum,e,n,r)),U(e.minimum)&&!(r>=e.minimum)&&(yield W(H.IntegerMinimum,e,n,r)),U(e.multipleOf)&&r%e.multipleOf!==0&&(yield W(H.IntegerMultipleOf,e,n,r))}function*ef(e,t,n,r){let i=!1;for(let a of e.allOf)for(let e of Tf(a,t,n,r))i=!0,yield e;if(i)return yield W(H.Intersect,e,n,r);if(e.unevaluatedProperties===!1){let t=new RegExp(Aa(e));for(let i of Object.getOwnPropertyNames(r))t.test(i)||(yield W(H.IntersectUnevaluatedProperties,e,`${n}/${i}`,r))}if(typeof e.unevaluatedProperties==`object`){let i=new RegExp(Aa(e));for(let a of Object.getOwnPropertyNames(r))if(!i.test(a)){let i=Tf(e.unevaluatedProperties,t,`${n}/${a}`,r[a]).next();i.done||(yield i.value)}}}function*tf(e,t,n,r){xe(r)||(yield W(H.Iterator,e,n,r))}function*nf(e,t,n,r){r!==e.const&&(yield W(H.Literal,e,n,r))}function*rf(e,t,n,r){yield W(H.Never,e,n,r)}function*af(e,t,n,r){Tf(e.not,t,n,r).next().done===!0&&(yield W(H.Not,e,n,r))}function*sf(e,t,n,r){je(r)||(yield W(H.Null,e,n,r))}function*cf(e,t,n,r){if(!ze.IsNumberLike(r))return yield W(H.Number,e,n,r);U(e.exclusiveMaximum)&&!(r<e.exclusiveMaximum)&&(yield W(H.NumberExclusiveMaximum,e,n,r)),U(e.exclusiveMinimum)&&!(r>e.exclusiveMinimum)&&(yield W(H.NumberExclusiveMinimum,e,n,r)),U(e.maximum)&&!(r<=e.maximum)&&(yield W(H.NumberMaximum,e,n,r)),U(e.minimum)&&!(r>=e.minimum)&&(yield W(H.NumberMinimum,e,n,r)),U(e.multipleOf)&&r%e.multipleOf!==0&&(yield W(H.NumberMultipleOf,e,n,r))}function*lf(e,t,n,r){if(!ze.IsObjectLike(r))return yield W(H.Object,e,n,r);U(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)&&(yield W(H.ObjectMinProperties,e,n,r)),U(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties)&&(yield W(H.ObjectMaxProperties,e,n,r));let i=Array.isArray(e.required)?e.required:[],a=Object.getOwnPropertyNames(e.properties),o=Object.getOwnPropertyNames(r);for(let t of i){if(o.includes(t))continue;yield W(H.ObjectRequiredProperty,e.properties[t],`${n}/${Vd(t)}`,void 0)}if(e.additionalProperties===!1)for(let t of o)a.includes(t)||(yield W(H.ObjectAdditionalProperties,e,`${n}/${Vd(t)}`,r[t]));if(typeof e.additionalProperties==`object`)for(let i of o){if(a.includes(i))continue;yield*Tf(e.additionalProperties,t,`${n}/${Vd(i)}`,r[i])}for(let i of a){let a=e.properties[i];e.required&&e.required.includes(i)?(yield*Tf(a,t,`${n}/${Vd(i)}`,r[i]),js(e)&&!(i in r)&&(yield W(H.ObjectRequiredProperty,a,`${n}/${Vd(i)}`,void 0))):ze.IsExactOptionalProperty(r,i)&&(yield*Tf(a,t,`${n}/${Vd(i)}`,r[i]))}}function*uf(e,t,n,r){Se(r)||(yield W(H.Promise,e,n,r))}function*df(e,t,n,r){if(!ze.IsRecordLike(r))return yield W(H.Object,e,n,r);U(e.minProperties)&&!(Object.getOwnPropertyNames(r).length>=e.minProperties)&&(yield W(H.ObjectMinProperties,e,n,r)),U(e.maxProperties)&&!(Object.getOwnPropertyNames(r).length<=e.maxProperties)&&(yield W(H.ObjectMaxProperties,e,n,r));let[i,a]=Object.entries(e.patternProperties)[0],o=new RegExp(i);for(let[e,i]of Object.entries(r))o.test(e)&&(yield*Tf(a,t,`${n}/${Vd(e)}`,i));if(typeof e.additionalProperties==`object`)for(let[i,a]of Object.entries(r))o.test(i)||(yield*Tf(e.additionalProperties,t,`${n}/${Vd(i)}`,a));if(e.additionalProperties===!1)for(let[t,i]of Object.entries(r)){if(o.test(t))continue;return yield W(H.ObjectAdditionalProperties,e,`${n}/${Vd(t)}`,i)}}function*ff(e,t,n,r){yield*Tf(ju(e,t),t,n,r)}function*pf(e,t,n,r){if(!Fe(r))return yield W(H.String,e,n,r);if(U(e.minLength)&&!(r.length>=e.minLength)&&(yield W(H.StringMinLength,e,n,r)),U(e.maxLength)&&!(r.length<=e.maxLength)&&(yield W(H.StringMaxLength,e,n,r)),!new RegExp(e.source,e.flags).test(r))return yield W(H.RegExp,e,n,r)}function*mf(e,t,n,r){if(!Fe(r))return yield W(H.String,e,n,r);U(e.minLength)&&!(r.length>=e.minLength)&&(yield W(H.StringMinLength,e,n,r)),U(e.maxLength)&&!(r.length<=e.maxLength)&&(yield W(H.StringMaxLength,e,n,r)),Fe(e.pattern)&&(new RegExp(e.pattern).test(r)||(yield W(H.StringPattern,e,n,r))),Fe(e.format)&&(Un(e.format)?Gn(e.format)(r)||(yield W(H.StringFormat,e,n,r)):yield W(H.StringFormatUnknown,e,n,r))}function*hf(e,t,n,r){Le(r)||(yield W(H.Symbol,e,n,r))}function*gf(e,t,n,r){if(!Fe(r))return yield W(H.String,e,n,r);new RegExp(e.pattern).test(r)||(yield W(H.StringPattern,e,n,r))}function*_f(e,t,n,r){yield*Tf(ju(e,t),t,n,r)}function*vf(e,t,n,r){if(!ke(r))return yield W(H.Tuple,e,n,r);if(e.items===void 0&&r.length!==0||r.length!==e.maxItems)return yield W(H.TupleLength,e,n,r);if(e.items)for(let i=0;i<e.items.length;i++)yield*Tf(e.items[i],t,`${n}/${i}`,r[i])}function*yf(e,t,n,r){Ae(r)||(yield W(H.Undefined,e,n,r))}function*bf(e,t,n,r){if(zd(e,t,r))return;let i=e.anyOf.map(e=>new Hd(Tf(e,t,n,r)));yield W(H.Union,e,n,r,i)}function*xf(e,t,n,r){if(!De(r))return yield W(H.Uint8Array,e,n,r);U(e.maxByteLength)&&!(r.length<=e.maxByteLength)&&(yield W(H.Uint8ArrayMaxByteLength,e,n,r)),U(e.minByteLength)&&!(r.length>=e.minByteLength)&&(yield W(H.Uint8ArrayMinByteLength,e,n,r))}function*Sf(e,t,n,r){}function*Cf(e,t,n,r){ze.IsVoidLike(r)||(yield W(H.Void,e,n,r))}function*wf(e,t,n,r){Yn(e[A])(e,r)||(yield W(H.Kind,e,n,r))}function*Tf(e,t,n,r){let i=U(e.$id)?[...t,e]:t,a=e;switch(a[A]){case`Any`:return yield*Ud(a,i,n,r);case`Argument`:return yield*Wd(a,i,n,r);case`Array`:return yield*Gd(a,i,n,r);case`AsyncIterator`:return yield*Kd(a,i,n,r);case`BigInt`:return yield*qd(a,i,n,r);case`Boolean`:return yield*Jd(a,i,n,r);case`Constructor`:return yield*Yd(a,i,n,r);case`Date`:return yield*Xd(a,i,n,r);case`Function`:return yield*Zd(a,i,n,r);case`Import`:return yield*Qd(a,i,n,r);case`Integer`:return yield*$d(a,i,n,r);case`Intersect`:return yield*ef(a,i,n,r);case`Iterator`:return yield*tf(a,i,n,r);case`Literal`:return yield*nf(a,i,n,r);case`Never`:return yield*rf(a,i,n,r);case`Not`:return yield*af(a,i,n,r);case`Null`:return yield*sf(a,i,n,r);case`Number`:return yield*cf(a,i,n,r);case`Object`:return yield*lf(a,i,n,r);case`Promise`:return yield*uf(a,i,n,r);case`Record`:return yield*df(a,i,n,r);case`Ref`:return yield*ff(a,i,n,r);case`RegExp`:return yield*pf(a,i,n,r);case`String`:return yield*mf(a,i,n,r);case`Symbol`:return yield*hf(a,i,n,r);case`TemplateLiteral`:return yield*gf(a,i,n,r);case`This`:return yield*_f(a,i,n,r);case`Tuple`:return yield*vf(a,i,n,r);case`Undefined`:return yield*yf(a,i,n,r);case`Union`:return yield*bf(a,i,n,r);case`Uint8Array`:return yield*xf(a,i,n,r);case`Unknown`:return yield*Sf(a,i,n,r);case`Void`:return yield*Cf(a,i,n,r);default:if(!qn(a[A]))throw new Bd(e);return yield*wf(a,i,n,r)}}function Ef(...e){let t=e.length===3?Tf(e[0],e[1],``,e[2]):Tf(e[0],[],``,e[1]);return new Hd(t)}function Df(e){let t={};for(let n of Object.getOwnPropertyNames(e))t[n]=Pf(e[n]);for(let n of Object.getOwnPropertySymbols(e))t[n]=Pf(e[n]);return t}function Of(e){return e.map(e=>Pf(e))}function kf(e){return e.slice()}function Af(e){return new Map(Pf([...e.entries()]))}function jf(e){return new Set(Pf([...e.entries()]))}function Mf(e){return new Date(e.toISOString())}function Nf(e){return e}function Pf(e){if(ke(e))return Of(e);if(Ce(e))return Mf(e);if(Ee(e))return kf(e);if(we(e))return Af(e);if(Te(e))return jf(e);if(Oe(e))return Df(e);if(Re(e))return Nf(e);throw Error(`ValueClone: Unable to clone value`)}var Ff=class extends Ke{constructor(e,t){super(t),this.schema=e}};function G(e){return Ie(e)?e():Pf(e)}function If(e,t){return D(e,`default`)?G(e.default):{}}function Lf(e,t){return{}}function Rf(e,t){if(e.uniqueItems===!0&&!D(e,`default`))throw new Ff(e,`Array with the uniqueItems constraint requires a default value`);if(`contains`in e&&!D(e,`default`))throw new Ff(e,`Array with the contains constraint requires a default value`);return`default`in e?G(e.default):e.minItems===void 0?[]:Array.from({length:e.minItems}).map(n=>gp(e.items,t))}function zf(e,t){return D(e,`default`)?G(e.default):(async function*(){})()}function Bf(e,t){return D(e,`default`)?G(e.default):BigInt(0)}function Vf(e,t){return D(e,`default`)?G(e.default):!1}function Hf(e,t){if(D(e,`default`))return G(e.default);{let n=gp(e.returns,t);return typeof n==`object`&&!Array.isArray(n)?class{constructor(){for(let[e,t]of Object.entries(n)){let n=this;n[e]=t}}}:class{}}}function Uf(e,t){return D(e,`default`)?G(e.default):e.minimumTimestamp===void 0?new Date:new Date(e.minimumTimestamp)}function Wf(e,t){return D(e,`default`)?G(e.default):()=>gp(e.returns,t)}function Gf(e,t){let n=globalThis.Object.values(e.$defs),r=e.$defs[e.$ref];return gp(r,[...t,...n])}function Kf(e,t){return D(e,`default`)?G(e.default):e.minimum===void 0?0:e.minimum}function qf(e,t){if(D(e,`default`))return G(e.default);{let n=e.allOf.reduce((e,n)=>{let r=gp(n,t);return typeof r==`object`?{...e,...r}:r},{});if(!zd(e,t,n))throw new Ff(e,`Intersect produced invalid value. Consider using a default value.`);return n}}function Jf(e,t){return D(e,`default`)?G(e.default):(function*(){})()}function Yf(e,t){return D(e,`default`)?G(e.default):e.const}function Xf(e,t){if(D(e,`default`))return G(e.default);throw new Ff(e,`Never types cannot be created. Consider using a default value.`)}function Zf(e,t){if(D(e,`default`))return G(e.default);throw new Ff(e,`Not types must have a default value`)}function Qf(e,t){return D(e,`default`)?G(e.default):null}function $f(e,t){return D(e,`default`)?G(e.default):e.minimum===void 0?0:e.minimum}function ep(e,t){if(D(e,`default`))return G(e.default);{let n=new Set(e.required),r={};for(let[i,a]of Object.entries(e.properties)){if(!n.has(i))continue;r[i]=gp(a,t)}return r}}function tp(e,t){return D(e,`default`)?G(e.default):Promise.resolve(gp(e.item,t))}function np(e,t){return D(e,`default`)?G(e.default):{}}function rp(e,t){return D(e,`default`)?G(e.default):gp(ju(e,t),t)}function ip(e,t){if(D(e,`default`))return G(e.default);throw new Ff(e,`RegExp types cannot be created. Consider using a default value.`)}function ap(e,t){if(e.pattern!==void 0){if(D(e,`default`))return G(e.default);throw new Ff(e,`String types with patterns must specify a default value`)}else if(e.format!==void 0){if(D(e,`default`))return G(e.default);throw new Ff(e,`String types with formats must specify a default value`)}else if(D(e,`default`))return G(e.default);else if(e.minLength!==void 0)return Array.from({length:e.minLength}).map(()=>` `).join(``);else return``}function op(e,t){return D(e,`default`)?G(e.default):`value`in e?Symbol.for(e.value):Symbol()}function sp(e,t){if(D(e,`default`))return G(e.default);if(!Rr(e))throw new Ff(e,`Can only create template literals that produce a finite variants. Consider using a default value.`);return Gr(e)[0]}function cp(e,t){if(_p++>512)throw new Ff(e,`Cannot create recursive type as it appears possibly infinite. Consider using a default.`);return D(e,`default`)?G(e.default):gp(ju(e,t),t)}function lp(e,t){return D(e,`default`)?G(e.default):e.items===void 0?[]:Array.from({length:e.minItems}).map((n,r)=>gp(e.items[r],t))}function up(e,t){if(D(e,`default`))return G(e.default)}function dp(e,t){if(D(e,`default`))return G(e.default);if(e.anyOf.length===0)throw Error(`ValueCreate.Union: Cannot create Union with zero variants`);return gp(e.anyOf[0],t)}function fp(e,t){return D(e,`default`)?G(e.default):e.minByteLength===void 0?new Uint8Array:new Uint8Array(e.minByteLength)}function pp(e,t){return D(e,`default`)?G(e.default):{}}function mp(e,t){if(D(e,`default`))return G(e.default)}function hp(e,t){if(D(e,`default`))return G(e.default);throw Error(`User defined types must specify a default value`)}function gp(e,t){let n=Au(e,t),r=e;switch(r[A]){case`Any`:return If(r,n);case`Argument`:return Lf(r,n);case`Array`:return Rf(r,n);case`AsyncIterator`:return zf(r,n);case`BigInt`:return Bf(r,n);case`Boolean`:return Vf(r,n);case`Constructor`:return Hf(r,n);case`Date`:return Uf(r,n);case`Function`:return Wf(r,n);case`Import`:return Gf(r,n);case`Integer`:return Kf(r,n);case`Intersect`:return qf(r,n);case`Iterator`:return Jf(r,n);case`Literal`:return Yf(r,n);case`Never`:return Xf(r,n);case`Not`:return Zf(r,n);case`Null`:return Qf(r,n);case`Number`:return $f(r,n);case`Object`:return ep(r,n);case`Promise`:return tp(r,n);case`Record`:return np(r,n);case`Ref`:return rp(r,n);case`RegExp`:return ip(r,n);case`String`:return ap(r,n);case`Symbol`:return op(r,n);case`TemplateLiteral`:return sp(r,n);case`This`:return cp(r,n);case`Tuple`:return lp(r,n);case`Undefined`:return up(r,n);case`Union`:return dp(r,n);case`Uint8Array`:return fp(r,n);case`Unknown`:return pp(r,n);case`Void`:return mp(r,n);default:if(!qn(r[A]))throw new Ff(r,`Unknown type`);return hp(r,n)}}var _p=0;function vp(...e){return _p=0,e.length===2?gp(e[0],e[1]):gp(e[0],[])}function yp(e){return It(e)&&e[A]!==`Unsafe`}function bp(e,t,n){return ke(n)?n.map(n=>kp(e.items,t,n)):n}function xp(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return kp(i,[...t,...r],n)}function Sp(e,t,n){let r=e.unevaluatedProperties,i=e.allOf.map(e=>kp(e,t,Pf(n))).reduce((e,t)=>Oe(t)?{...e,...t}:t,{});if(!Oe(n)||!Oe(i)||!It(r))return i;let a=Oa(e);for(let e of Object.getOwnPropertyNames(n)){if(a.includes(e))continue;zd(r,t,n[e])&&(i[e]=kp(r,t,n[e]))}return i}function Cp(e,t,n){if(!Oe(n)||ke(n))return n;let r=e.additionalProperties;for(let i of Object.getOwnPropertyNames(n)){if(D(e.properties,i)){n[i]=kp(e.properties[i],t,n[i]);continue}if(It(r)&&zd(r,t,n[i])){n[i]=kp(r,t,n[i]);continue}delete n[i]}return n}function wp(e,t,n){if(!Oe(n))return n;let r=e.additionalProperties,i=Object.getOwnPropertyNames(n),[a,o]=Object.entries(e.patternProperties)[0],s=new RegExp(a);for(let e of i){if(s.test(e)){n[e]=kp(o,t,n[e]);continue}if(It(r)&&zd(r,t,n[e])){n[e]=kp(r,t,n[e]);continue}delete n[e]}return n}function Tp(e,t,n){return kp(ju(e,t),t,n)}function Ep(e,t,n){return kp(ju(e,t),t,n)}function Dp(e,t,n){if(!ke(n))return n;if(Ae(e.items))return[];let r=Math.min(n.length,e.items.length);for(let i=0;i<r;i++)n[i]=kp(e.items[i],t,n[i]);return n.length>r?n.slice(0,r):n}function Op(e,t,n){for(let r of e.anyOf)if(yp(r)&&zd(r,t,n))return kp(r,t,n);return n}function kp(e,t,n){let r=Fe(e.$id)?Au(e,t):t,i=e;switch(i[A]){case`Array`:return bp(i,r,n);case`Import`:return xp(i,r,n);case`Intersect`:return Sp(i,r,n);case`Object`:return Cp(i,r,n);case`Record`:return wp(i,r,n);case`Ref`:return Tp(i,r,n);case`This`:return Ep(i,r,n);case`Tuple`:return Dp(i,r,n);case`Union`:return Op(i,r,n);default:return n}}function Ap(...e){return e.length===3?kp(e[0],e[1],e[2]):kp(e[0],[],e[1])}var jp=class extends Ke{constructor(e,t,n){super(`Unable to decode value as it does not match the expected schema`),this.schema=e,this.value=t,this.error=n}},Mp=class extends Ke{constructor(e,t,n,r){super(r instanceof Error?r.message:`Unknown error`),this.schema=e,this.path=t,this.value=n,this.error=r}};function K(e,t,n){try{return M(e)?e[qe].Decode(n):n}catch(r){throw new Mp(e,t,n,r)}}function Np(e,t,n,r){return ke(r)?K(e,n,r.map((r,i)=>Up(e.items,t,`${n}/${i}`,r))):K(e,n,r)}function Pp(e,t,n,r){if(!Oe(r)||Re(r))return K(e,n,r);let i=za(e),a=i.map(e=>e[0]),o={...r};for(let[e,r]of i)e in o&&(o[e]=Up(r,t,`${n}/${e}`,o[e]));if(!M(e.unevaluatedProperties))return K(e,n,o);let s=Object.getOwnPropertyNames(o),c=e.unevaluatedProperties,l={...o};for(let e of s)a.includes(e)||(l[e]=K(c,`${n}/${e}`,l[e]));return K(e,n,l)}function Fp(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref],o=Up(a,[...t,...i],n,r);return K(e,n,o)}function Ip(e,t,n,r){return K(e,n,Up(e.not,t,n,r))}function Lp(e,t,n,r){if(!Oe(r))return K(e,n,r);let i=Oa(e),a={...r};for(let r of i){if(!D(a,r)||Ae(a[r])&&(!At(e.properties[r])||ze.IsExactOptionalProperty(a,r)))continue;a[r]=Up(e.properties[r],t,`${n}/${r}`,a[r])}if(!Lt(e.additionalProperties))return K(e,n,a);let o=Object.getOwnPropertyNames(a),s=e.additionalProperties,c={...a};for(let e of o)i.includes(e)||(c[e]=K(s,`${n}/${e}`,c[e]));return K(e,n,c)}function Rp(e,t,n,r){if(!Oe(r))return K(e,n,r);let i=Object.getOwnPropertyNames(e.patternProperties)[0],a=new RegExp(i),o={...r};for(let s of Object.getOwnPropertyNames(r))a.test(s)&&(o[s]=Up(e.patternProperties[i],t,`${n}/${s}`,o[s]));if(!Lt(e.additionalProperties))return K(e,n,o);let s=Object.getOwnPropertyNames(o),c=e.additionalProperties,l={...o};for(let e of s)a.test(e)||(l[e]=K(c,`${n}/${e}`,l[e]));return K(e,n,l)}function zp(e,t,n,r){let i=ju(e,t);return K(e,n,Up(i,t,n,r))}function Bp(e,t,n,r){let i=ju(e,t);return K(e,n,Up(i,t,n,r))}function Vp(e,t,n,r){return ke(r)&&ke(e.items)?K(e,n,e.items.map((e,i)=>Up(e,t,`${n}/${i}`,r[i]))):K(e,n,r)}function Hp(e,t,n,r){for(let i of e.anyOf){if(!zd(i,t,r))continue;let a=Up(i,t,n,r);return K(e,n,a)}return K(e,n,r)}function Up(e,t,n,r){let i=Au(e,t),a=e;switch(e[A]){case`Array`:return Np(a,i,n,r);case`Import`:return Fp(a,i,n,r);case`Intersect`:return Pp(a,i,n,r);case`Not`:return Ip(a,i,n,r);case`Object`:return Lp(a,i,n,r);case`Record`:return Rp(a,i,n,r);case`Ref`:return zp(a,i,n,r);case`Symbol`:return K(a,n,r);case`This`:return Bp(a,i,n,r);case`Tuple`:return Vp(a,i,n,r);case`Union`:return Hp(a,i,n,r);default:return K(a,n,r)}}function Wp(e,t,n){return Up(e,t,``,n)}var Gp=class extends Ke{constructor(e,t,n){super(`The encoded value does not match the expected schema`),this.schema=e,this.value=t,this.error=n}},Kp=class extends Ke{constructor(e,t,n,r){super(`${r instanceof Error?r.message:`Unknown error`}`),this.schema=e,this.path=t,this.value=n,this.error=r}};function qp(e,t,n){try{return M(e)?e[qe].Encode(n):n}catch(r){throw new Kp(e,t,n,r)}}function Jp(e,t,n,r){let i=qp(e,n,r);return ke(i)?i.map((r,i)=>im(e.items,t,`${n}/${i}`,r)):i}function Yp(e,t,n,r){let i=globalThis.Object.values(e.$defs),a=e.$defs[e.$ref],o=qp(e,n,r);return im(a,[...t,...i],n,o)}function Xp(e,t,n,r){let i=qp(e,n,r);if(!Oe(r)||Re(r))return i;let a=za(e),o=a.map(e=>e[0]),s={...i};for(let[e,r]of a)e in s&&(s[e]=im(r,t,`${n}/${e}`,s[e]));if(!M(e.unevaluatedProperties))return s;let c=Object.getOwnPropertyNames(s),l=e.unevaluatedProperties,u={...s};for(let e of c)o.includes(e)||(u[e]=qp(l,`${n}/${e}`,u[e]));return u}function Zp(e,t,n,r){return qp(e.not,n,qp(e,n,r))}function Qp(e,t,n,r){let i=qp(e,n,r);if(!Oe(i))return i;let a=Oa(e),o={...i};for(let r of a){if(!D(o,r)||Ae(o[r])&&(!At(e.properties[r])||ze.IsExactOptionalProperty(o,r)))continue;o[r]=im(e.properties[r],t,`${n}/${r}`,o[r])}if(!Lt(e.additionalProperties))return o;let s=Object.getOwnPropertyNames(o),c=e.additionalProperties,l={...o};for(let e of s)a.includes(e)||(l[e]=qp(c,`${n}/${e}`,l[e]));return l}function $p(e,t,n,r){let i=qp(e,n,r);if(!Oe(r))return i;let a=Object.getOwnPropertyNames(e.patternProperties)[0],o=new RegExp(a),s={...i};for(let i of Object.getOwnPropertyNames(r))o.test(i)&&(s[i]=im(e.patternProperties[a],t,`${n}/${i}`,s[i]));if(!Lt(e.additionalProperties))return s;let c=Object.getOwnPropertyNames(s),l=e.additionalProperties,u={...s};for(let e of c)o.test(e)||(u[e]=qp(l,`${n}/${e}`,u[e]));return u}function em(e,t,n,r){let i=ju(e,t),a=im(i,t,n,r);return qp(e,n,a)}function tm(e,t,n,r){let i=ju(e,t),a=im(i,t,n,r);return qp(e,n,a)}function nm(e,t,n,r){let i=qp(e,n,r);return ke(e.items)?e.items.map((e,r)=>im(e,t,`${n}/${r}`,i[r])):[]}function rm(e,t,n,r){for(let i of e.anyOf){if(!zd(i,t,r))continue;let a=im(i,t,n,r);return qp(e,n,a)}for(let i of e.anyOf){let a=im(i,t,n,r);if(!zd(e,t,a))continue;return qp(e,n,a)}return qp(e,n,r)}function im(e,t,n,r){let i=Au(e,t),a=e;switch(e[A]){case`Array`:return Jp(a,i,n,r);case`Import`:return Yp(a,i,n,r);case`Intersect`:return Xp(a,i,n,r);case`Not`:return Zp(a,i,n,r);case`Object`:return Qp(a,i,n,r);case`Record`:return $p(a,i,n,r);case`Ref`:return em(a,i,n,r);case`This`:return tm(a,i,n,r);case`Tuple`:return nm(a,i,n,r);case`Union`:return rm(a,i,n,r);default:return qp(a,n,r)}}function am(e,t,n){return im(e,t,``,n)}function om(e,t){return M(e)||xm(e.items,t)}function sm(e,t){return M(e)||xm(e.items,t)}function cm(e,t){return M(e)||xm(e.returns,t)||e.parameters.some(e=>xm(e,t))}function lm(e,t){return M(e)||xm(e.returns,t)||e.parameters.some(e=>xm(e,t))}function um(e,t){return M(e)||M(e.unevaluatedProperties)||e.allOf.some(e=>xm(e,t))}function dm(e,t){let n=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>[...t,e.$defs[n]],[]),r=e.$defs[e.$ref];return M(e)||xm(r,[...n,...t])}function fm(e,t){return M(e)||xm(e.items,t)}function pm(e,t){return M(e)||xm(e.not,t)}function mm(e,t){return M(e)||Object.values(e.properties).some(e=>xm(e,t))||Lt(e.additionalProperties)&&xm(e.additionalProperties,t)}function hm(e,t){return M(e)||xm(e.item,t)}function gm(e,t){let n=Object.getOwnPropertyNames(e.patternProperties)[0],r=e.patternProperties[n];return M(e)||xm(r,t)||Lt(e.additionalProperties)&&M(e.additionalProperties)}function _m(e,t){return M(e)?!0:xm(ju(e,t),t)}function vm(e,t){return M(e)?!0:xm(ju(e,t),t)}function ym(e,t){return M(e)||!Ae(e.items)&&e.items.some(e=>xm(e,t))}function bm(e,t){return M(e)||e.anyOf.some(e=>xm(e,t))}function xm(e,t){let n=Au(e,t),r=e;if(e.$id&&Sm.has(e.$id))return!1;switch(e.$id&&Sm.add(e.$id),e[A]){case`Array`:return om(r,n);case`AsyncIterator`:return sm(r,n);case`Constructor`:return cm(r,n);case`Function`:return lm(r,n);case`Import`:return dm(r,n);case`Intersect`:return um(r,n);case`Iterator`:return fm(r,n);case`Not`:return pm(r,n);case`Object`:return mm(r,n);case`Promise`:return hm(r,n);case`Record`:return gm(r,n);case`Ref`:return _m(r,n);case`This`:return vm(r,n);case`Tuple`:return ym(r,n);case`Union`:return bm(r,n);default:return M(e)}}var Sm=new Set;function Cm(e,t){return Sm.clear(),xm(e,t)}function wm(...e){let[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]];if(!zd(t,n,r))throw new jp(t,r,Ef(t,n,r).First());return Cm(t,n)?Wp(t,n,r):r}function Tm(e,t){let n=D(e,`default`)?e.default:void 0,r=Ie(n)?n():Pf(n);return Ae(t)?r:Oe(t)&&Oe(r)?Object.assign(r,t):t}function Em(e){return It(e)&&`default`in e}function Dm(e,t,n){if(ke(n)){for(let r=0;r<n.length;r++)n[r]=Lm(e.items,t,n[r]);return n}let r=Tm(e,n);if(!ke(r))return r;for(let n=0;n<r.length;n++)r[n]=Lm(e.items,t,r[n]);return r}function Om(e,t,n){return Ce(n)?n:Tm(e,n)}function km(e,t,n){let r=globalThis.Object.values(e.$defs),i=e.$defs[e.$ref];return Lm(i,[...t,...r],n)}function Am(e,t,n){let r=Tm(e,n);return e.allOf.reduce((e,n)=>{let i=Lm(n,t,r);return Oe(i)?{...e,...i}:i},{})}function jm(e,t,n){let r=Tm(e,n);if(!Oe(r))return r;let i=Object.getOwnPropertyNames(e.properties);for(let n of i){let i=Lm(e.properties[n],t,r[n]);if(Ae(i))continue;r[n]=Lm(e.properties[n],t,r[n])}if(!Em(e.additionalProperties))return r;for(let n of Object.getOwnPropertyNames(r)){if(i.includes(n))continue;r[n]=Lm(e.additionalProperties,t,r[n])}return r}function Mm(e,t,n){let r=Tm(e,n);if(!Oe(r))return r;let i=e.additionalProperties,[a,o]=Object.entries(e.patternProperties)[0],s=new RegExp(a);for(let e of Object.getOwnPropertyNames(r)){if(!(s.test(e)&&Em(o)))continue;r[e]=Lm(o,t,r[e])}if(!Em(i))return r;for(let e of Object.getOwnPropertyNames(r)){if(s.test(e))continue;r[e]=Lm(i,t,r[e])}return r}function Nm(e,t,n){return Lm(ju(e,t),t,Tm(e,n))}function Pm(e,t,n){return Lm(ju(e,t),t,n)}function Fm(e,t,n){let r=Tm(e,n);if(!ke(r)||Ae(e.items))return r;let[i,a]=[e.items,Math.max(e.items.length,r.length)];for(let e=0;e<a;e++)e<i.length&&(r[e]=Lm(i[e],t,r[e]));return r}function Im(e,t,n){let r=Tm(e,n);for(let n of e.anyOf){let e=Lm(n,t,Pf(r));if(zd(n,t,e))return e}return r}function Lm(e,t,n){let r=Au(e,t),i=e;switch(i[A]){case`Array`:return Dm(i,r,n);case`Date`:return Om(i,r,n);case`Import`:return km(i,r,n);case`Intersect`:return Am(i,r,n);case`Object`:return jm(i,r,n);case`Record`:return Mm(i,r,n);case`Ref`:return Nm(i,r,n);case`This`:return Pm(i,r,n);case`Tuple`:return Fm(i,r,n);case`Union`:return Im(i,r,n);default:return Tm(i,n)}}function Rm(...e){return e.length===3?Lm(e[0],e[1],e[2]):Lm(e[0],[],e[1])}function zm(...e){let[t,n,r]=e.length===3?[e[0],e[1],e[2]]:[e[0],[],e[1]],i=Cm(t,n)?am(t,n,r):r;if(!zd(t,n,i))throw new Gp(t,i,Ef(t,n,i).First());return i}var Bm=class{constructor(e,t,n,r){this.schema=e,this.references=t,this.checkFunc=n,this.code=r,this.hasTransform=Cm(e,t)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(e){return Ef(this.schema,this.references,e)}Check(e){return this.checkFunc(e)}Decode(e){if(!this.checkFunc(e))throw new jp(this.schema,e,this.Errors(e).First());return this.hasTransform?Wp(this.schema,this.references,e):e}Encode(e){let t=this.hasTransform?am(this.schema,this.references,e):e;if(!this.checkFunc(t))throw new Gp(this.schema,e,this.Errors(e).First());return t}},Vm;(function(e){function t(e){return e===36}e.DollarSign=t;function n(e){return e===95}e.IsUnderscore=n;function r(e){return e>=65&&e<=90||e>=97&&e<=122}e.IsAlpha=r;function i(e){return e>=48&&e<=57}e.IsNumeric=i})(Vm||={});var Hm;(function(e){function t(e){return e.length===0?!1:Vm.IsNumeric(e.charCodeAt(0))}function n(e){if(t(e))return!1;for(let t=0;t<e.length;t++){let n=e.charCodeAt(t);if(!(Vm.IsAlpha(n)||Vm.IsNumeric(n)||Vm.DollarSign(n)||Vm.IsUnderscore(n)))return!1}return!0}function r(e){return e.replace(/'/g,`\\'`)}function i(e,t){return n(t)?`${e}.${t}`:`${e}['${r(t)}']`}e.Encode=i})(Hm||={});var Um;(function(e){function t(e){let t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);Vm.IsNumeric(r)||Vm.IsAlpha(r)?t.push(e.charAt(n)):t.push(`_${r}_`)}return t.join(``).replace(/__/g,`_`)}e.Encode=t})(Um||={});var Wm;(function(e){function t(e){return e.replace(/'/g,`\\'`)}e.Escape=t})(Wm||={});var Gm=class extends Ke{constructor(e){super(`Unknown type`),this.schema=e}},Km=class extends Ke{constructor(e){super(`Preflight validation check failed to guard for the given schema`),this.schema=e}},qm;(function(e){function t(e,t,n){return ze.ExactOptionalPropertyTypes?`('${t}' in ${e} ? ${n} : true)`:`(${Hm.Encode(e,t)} !== undefined ? ${n} : true)`}e.IsExactOptionalProperty=t;function n(e){return ze.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null)`:`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}))`}e.IsObjectLike=n;function r(e){return ze.AllowArrayObject?`(typeof ${e} === 'object' && ${e} !== null && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`:`(typeof ${e} === 'object' && ${e} !== null && !Array.isArray(${e}) && !(${e} instanceof Date) && !(${e} instanceof Uint8Array))`}e.IsRecordLike=r;function i(e){return ze.AllowNaN?`typeof ${e} === 'number'`:`Number.isFinite(${e})`}e.IsNumberLike=i;function a(e){return ze.AllowNullVoid?`(${e} === undefined || ${e} === null)`:`${e} === undefined`}e.IsVoidLike=a})(qm||={});var Jm;(function(e){function t(e){return e[A]===`Any`||e[A]===`Unknown`}function*n(e,t,n){yield`true`}function*r(e,t,n){yield`true`}function*i(e,t,n){yield`Array.isArray(${n})`;let[r,i]=[E(`value`,`any`),E(`acc`,`number`)];O(e.maxItems)&&(yield`${n}.length <= ${e.maxItems}`),O(e.minItems)&&(yield`${n}.length >= ${e.minItems}`);let a=w(e.items,t,`value`);if(yield`${n}.every((${r}) => ${a})`,L(e.contains)||O(e.minContains)||O(e.maxContains)){let a=L(e.contains)?e.contains:R(),o=w(a,t,`value`),s=O(e.minContains)?[`(count >= ${e.minContains})`]:[],c=O(e.maxContains)?[`(count <= ${e.maxContains})`]:[],l=`const count = value.reduce((${i}, ${r}) => ${o} ? acc + 1 : acc, 0)`,u=[`(count > 0)`,...s,...c].join(` && `);yield`((${r}) => { ${l}; return ${u}})(${n})`}e.uniqueItems===!0&&(yield`((${r}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${n})`)}function*a(e,t,n){yield`(typeof value === 'object' && Symbol.asyncIterator in ${n})`}function*o(e,t,n){yield`(typeof ${n} === 'bigint')`,Pe(e.exclusiveMaximum)&&(yield`${n} < BigInt(${e.exclusiveMaximum})`),Pe(e.exclusiveMinimum)&&(yield`${n} > BigInt(${e.exclusiveMinimum})`),Pe(e.maximum)&&(yield`${n} <= BigInt(${e.maximum})`),Pe(e.minimum)&&(yield`${n} >= BigInt(${e.minimum})`),Pe(e.multipleOf)&&(yield`(${n} % BigInt(${e.multipleOf})) === 0`)}function*s(e,t,n){yield`(typeof ${n} === 'boolean')`}function*c(e,t,n){yield*S(e.returns,t,`${n}.prototype`)}function*l(e,t,n){yield`(${n} instanceof Date) && Number.isFinite(${n}.getTime())`,O(e.exclusiveMaximumTimestamp)&&(yield`${n}.getTime() < ${e.exclusiveMaximumTimestamp}`),O(e.exclusiveMinimumTimestamp)&&(yield`${n}.getTime() > ${e.exclusiveMinimumTimestamp}`),O(e.maximumTimestamp)&&(yield`${n}.getTime() <= ${e.maximumTimestamp}`),O(e.minimumTimestamp)&&(yield`${n}.getTime() >= ${e.minimumTimestamp}`),O(e.multipleOfTimestamp)&&(yield`(${n}.getTime() % ${e.multipleOfTimestamp}) === 0`)}function*u(e,t,n){yield`(typeof ${n} === 'function')`}function*d(e,t,n){let r=globalThis.Object.getOwnPropertyNames(e.$defs).reduce((t,n)=>[...t,e.$defs[n]],[]);yield*S(pa(e.$ref),[...t,...r],n)}function*f(e,t,n){yield`Number.isInteger(${n})`,O(e.exclusiveMaximum)&&(yield`${n} < ${e.exclusiveMaximum}`),O(e.exclusiveMinimum)&&(yield`${n} > ${e.exclusiveMinimum}`),O(e.maximum)&&(yield`${n} <= ${e.maximum}`),O(e.minimum)&&(yield`${n} >= ${e.minimum}`),O(e.multipleOf)&&(yield`(${n} % ${e.multipleOf}) === 0`)}function*p(e,t,n){let r=e.allOf.map(e=>w(e,t,n)).join(` && `);if(e.unevaluatedProperties===!1){let t=T(`${new RegExp(Aa(e))};`),i=`Object.getOwnPropertyNames(${n}).every(key => ${t}.test(key))`;yield`(${r} && ${i})`}else if(L(e.unevaluatedProperties)){let i=T(`${new RegExp(Aa(e))};`),a=`Object.getOwnPropertyNames(${n}).every(key => ${i}.test(key) || ${w(e.unevaluatedProperties,t,`${n}[key]`)})`;yield`(${r} && ${a})`}else yield`(${r})`}function*m(e,t,n){yield`(typeof value === 'object' && Symbol.iterator in ${n})`}function*h(e,t,n){typeof e.const==`number`||typeof e.const==`boolean`?yield`(${n} === ${e.const})`:yield`(${n} === '${Wm.Escape(e.const)}')`}function*g(e,t,n){yield`false`}function*_(e,t,n){yield`(!${w(e.not,t,n)})`}function*ee(e,t,n){yield`(${n} === null)`}function*te(e,t,n){yield qm.IsNumberLike(n),O(e.exclusiveMaximum)&&(yield`${n} < ${e.exclusiveMaximum}`),O(e.exclusiveMinimum)&&(yield`${n} > ${e.exclusiveMinimum}`),O(e.maximum)&&(yield`${n} <= ${e.maximum}`),O(e.minimum)&&(yield`${n} >= ${e.minimum}`),O(e.multipleOf)&&(yield`(${n} % ${e.multipleOf}) === 0`)}function*ne(e,n,r){yield qm.IsObjectLike(r),O(e.minProperties)&&(yield`Object.getOwnPropertyNames(${r}).length >= ${e.minProperties}`),O(e.maxProperties)&&(yield`Object.getOwnPropertyNames(${r}).length <= ${e.maxProperties}`);let i=Object.getOwnPropertyNames(e.properties);for(let a of i){let i=Hm.Encode(r,a),o=e.properties[a];if(e.required&&e.required.includes(a))yield*S(o,n,i),(js(o)||t(o))&&(yield`('${a}' in ${r})`);else{let e=w(o,n,i);yield qm.IsExactOptionalProperty(r,a,e)}}if(e.additionalProperties===!1)if(e.required&&e.required.length===i.length)yield`Object.getOwnPropertyNames(${r}).length === ${i.length}`;else{let e=`[${i.map(e=>`'${e}'`).join(`, `)}]`;yield`Object.getOwnPropertyNames(${r}).every(key => ${e}.includes(key))`}if(typeof e.additionalProperties==`object`){let t=w(e.additionalProperties,n,`${r}[key]`),a=`[${i.map(e=>`'${e}'`).join(`, `)}]`;yield`(Object.getOwnPropertyNames(${r}).every(key => ${a}.includes(key) || ${t}))`}}function*re(e,t,n){yield`${n} instanceof Promise`}function*v(e,t,n){yield qm.IsRecordLike(n),O(e.minProperties)&&(yield`Object.getOwnPropertyNames(${n}).length >= ${e.minProperties}`),O(e.maxProperties)&&(yield`Object.getOwnPropertyNames(${n}).length <= ${e.maxProperties}`);let[r,i]=Object.entries(e.patternProperties)[0],a=T(`${new RegExp(r)}`),o=w(i,t,`value`),s=L(e.additionalProperties)?w(e.additionalProperties,t,n):e.additionalProperties===!1?`false`:`true`,c=`(${a}.test(key) ? ${o} : ${s})`;yield`(Object.entries(${n}).every(([key, value]) => ${c}))`}function*ie(e,t,n){let r=ju(e,t);if(C.functions.has(e.$ref))return yield`${me(e.$ref)}(${n})`;yield*S(r,t,n)}function*ae(e,t,n){let r=T(`${new RegExp(e.source,e.flags)};`);yield`(typeof ${n} === 'string')`,O(e.maxLength)&&(yield`${n}.length <= ${e.maxLength}`),O(e.minLength)&&(yield`${n}.length >= ${e.minLength}`),yield`${r}.test(${n})`}function*oe(e,t,n){yield`(typeof ${n} === 'string')`,O(e.maxLength)&&(yield`${n}.length <= ${e.maxLength}`),O(e.minLength)&&(yield`${n}.length >= ${e.minLength}`),e.pattern!==void 0&&(yield`${T(`${new RegExp(e.pattern)};`)}.test(${n})`),e.format!==void 0&&(yield`format('${e.format}', ${n})`)}function*se(e,t,n){yield`(typeof ${n} === 'symbol')`}function*y(e,t,n){yield`(typeof ${n} === 'string')`,yield`${T(`${new RegExp(e.pattern)};`)}.test(${n})`}function*ce(e,t,n){yield`${me(e.$ref)}(${n})`}function*le(e,t,n){if(yield`Array.isArray(${n})`,e.items===void 0)return yield`${n}.length === 0`;yield`(${n}.length === ${e.maxItems})`;for(let r=0;r<e.items.length;r++)yield`${w(e.items[r],t,`${n}[${r}]`)}`}function*ue(e,t,n){yield`${n} === undefined`}function*de(e,t,n){yield`(${e.anyOf.map(e=>w(e,t,n)).join(` || `)})`}function*fe(e,t,n){yield`${n} instanceof Uint8Array`,O(e.maxByteLength)&&(yield`(${n}.length <= ${e.maxByteLength})`),O(e.minByteLength)&&(yield`(${n}.length >= ${e.minByteLength})`)}function*b(e,t,n){yield`true`}function*pe(e,t,n){yield qm.IsVoidLike(n)}function*x(e,t,n){let r=C.instances.size;C.instances.set(r,e),yield`kind('${e[A]}', ${r}, ${n})`}function*S(e,t,S,w=!0){let T=Fe(e.$id)?[...t,e]:t,E=e;if(w&&Fe(e.$id)){let n=me(e.$id);if(C.functions.has(n))return yield`${n}(${S})`;{C.functions.set(n,`<deferred>`);let r=he(n,e,t,`value`,!1);return C.functions.set(n,r),yield`${n}(${S})`}}switch(E[A]){case`Any`:return yield*n(E,T,S);case`Argument`:return yield*r(E,T,S);case`Array`:return yield*i(E,T,S);case`AsyncIterator`:return yield*a(E,T,S);case`BigInt`:return yield*o(E,T,S);case`Boolean`:return yield*s(E,T,S);case`Constructor`:return yield*c(E,T,S);case`Date`:return yield*l(E,T,S);case`Function`:return yield*u(E,T,S);case`Import`:return yield*d(E,T,S);case`Integer`:return yield*f(E,T,S);case`Intersect`:return yield*p(E,T,S);case`Iterator`:return yield*m(E,T,S);case`Literal`:return yield*h(E,T,S);case`Never`:return yield*g(E,T,S);case`Not`:return yield*_(E,T,S);case`Null`:return yield*ee(E,T,S);case`Number`:return yield*te(E,T,S);case`Object`:return yield*ne(E,T,S);case`Promise`:return yield*re(E,T,S);case`Record`:return yield*v(E,T,S);case`Ref`:return yield*ie(E,T,S);case`RegExp`:return yield*ae(E,T,S);case`String`:return yield*oe(E,T,S);case`Symbol`:return yield*se(E,T,S);case`TemplateLiteral`:return yield*y(E,T,S);case`This`:return yield*ce(E,T,S);case`Tuple`:return yield*le(E,T,S);case`Undefined`:return yield*ue(E,T,S);case`Union`:return yield*de(E,T,S);case`Uint8Array`:return yield*fe(E,T,S);case`Unknown`:return yield*b(E,T,S);case`Void`:return yield*pe(E,T,S);default:if(!qn(E[A]))throw new Gm(e);return yield*x(E,T,S)}}let C={language:`javascript`,functions:new Map,variables:new Map,instances:new Map};function w(e,t,n,r=!0){return`(${[...S(e,t,n,r)].join(` && `)})`}function me(e){return`check_${Um.Encode(e)}`}function T(e){let t=`local_${C.variables.size}`;return C.variables.set(t,`const ${t} = ${e}`),t}function he(e,t,n,r,i=!0){let[a,o]=[`
`,e=>``.padStart(e,` `)],s=E(`value`,`any`),c=ge(`boolean`),l=[...S(t,n,r,i)].map(e=>`${o(4)}${e}`).join(` &&${a}`);return`function ${e}(${s})${c} {${a}${o(2)}return (${a}${l}${a}${o(2)})\n}`}function E(e,t){let n=C.language===`typescript`?`: ${t}`:``;return`${e}${n}`}function ge(e){return C.language===`typescript`?`: ${e}`:``}function _e(e,t,n){let r=he(`check`,e,t,`value`),i=E(`value`,`any`),a=ge(`boolean`),o=[...C.functions.values()],s=[...C.variables.values()],c=Fe(e.$id)?`return function check(${i})${a} {\n  return ${me(e.$id)}(value)\n}`:`return ${r}`;return[...s,...o,c].join(`
`)}function ve(...e){let t={language:`javascript`},[n,r,i]=e.length===2&&ke(e[1])?[e[0],e[1],t]:e.length===2&&!ke(e[1])?[e[0],[],e[1]]:e.length===3?[e[0],e[1],e[2]]:e.length===1?[e[0],[],t]:[null,[],t];if(C.language=i.language,C.variables.clear(),C.functions.clear(),C.instances.clear(),!L(n))throw new Km(n);for(let e of r)if(!L(e))throw new Km(e);return _e(n,r,i)}e.Code=ve;function ye(e,t=[]){let n=ve(e,t,{language:`javascript`}),r=globalThis.Function(`kind`,`format`,`hash`,n),i=new Map(C.instances);function a(e,t,n){if(!qn(e)||!i.has(t))return!1;let r=Yn(e),a=i.get(t);return r(a,n)}function o(e,t){return Un(e)?Gn(e)(t):!1}function s(e){return td(e)}let c=r(a,o,s);return new Bm(e,t,c,n)}e.Compile=ye})(Jm||={});var Ym=r((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.parse=s,exports.serialize=u;var t=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,n=/^[\u0021-\u003A\u003C-\u007E]*$/,r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,i=/^[\u0020-\u003A\u003D-\u007E]*$/,a=Object.prototype.toString,o=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function s(e,t){let n=new o,r=e.length;if(r<2)return n;let i=t?.decode||d,a=0;do{let t=e.indexOf(`=`,a);if(t===-1)break;let o=e.indexOf(`;`,a),s=o===-1?r:o;if(t>s){a=e.lastIndexOf(`;`,t-1)+1;continue}let u=c(e,a,t),d=l(e,t,u),f=e.slice(u,d);if(n[f]===void 0){let r=c(e,t+1,s),a=l(e,s,r);n[f]=i(e.slice(r,a))}a=s+1}while(a<r);return n}function c(e,t,n){do{let n=e.charCodeAt(t);if(n!==32&&n!==9)return t}while(++t<n);return n}function l(e,t,n){for(;t>n;){let n=e.charCodeAt(--t);if(n!==32&&n!==9)return t+1}return n}function u(e,a,o){let s=o?.encode||encodeURIComponent;if(!t.test(e))throw TypeError(`argument name is invalid: ${e}`);let c=s(a);if(!n.test(c))throw TypeError(`argument val is invalid: ${a}`);let l=e+`=`+c;if(!o)return l;if(o.maxAge!==void 0){if(!Number.isInteger(o.maxAge))throw TypeError(`option maxAge is invalid: ${o.maxAge}`);l+=`; Max-Age=`+o.maxAge}if(o.domain){if(!r.test(o.domain))throw TypeError(`option domain is invalid: ${o.domain}`);l+=`; Domain=`+o.domain}if(o.path){if(!i.test(o.path))throw TypeError(`option path is invalid: ${o.path}`);l+=`; Path=`+o.path}if(o.expires){if(!f(o.expires)||!Number.isFinite(o.expires.valueOf()))throw TypeError(`option expires is invalid: ${o.expires}`);l+=`; Expires=`+o.expires.toUTCString()}if(o.httpOnly&&(l+=`; HttpOnly`),o.secure&&(l+=`; Secure`),o.partitioned&&(l+=`; Partitioned`),o.priority)switch(typeof o.priority==`string`?o.priority.toLowerCase():void 0){case`low`:l+=`; Priority=Low`;break;case`medium`:l+=`; Priority=Medium`;break;case`high`:l+=`; Priority=High`;break;default:throw TypeError(`option priority is invalid: ${o.priority}`)}if(o.sameSite)switch(typeof o.sameSite==`string`?o.sameSite.toLowerCase():o.sameSite){case!0:case`strict`:l+=`; SameSite=Strict`;break;case`lax`:l+=`; SameSite=Lax`;break;case`none`:l+=`; SameSite=None`;break;default:throw TypeError(`option sameSite is invalid: ${o.sameSite}`)}return l}function d(e){if(e.indexOf(`%`)===-1)return e;try{return decodeURIComponent(e)}catch{return e}}function f(e){return a.call(e)===`[object Date]`}})),Xm=Symbol.for(`TypeBox.Kind`),Zm=Symbol.for(`TypeBox.Hint`),Qm=e=>/(\ |-|\t|\n|\.)/.test(e)||!isNaN(+e[0]),$m=(e,t,n=!1)=>typeof t==`number`?`${e}[${t}]`:Qm(t)?`${e}${n?`?.`:``}["${t}"]`:`${e}${n?`?`:``}.${t}`,eh=e=>Qm(e)?`"${e}"`:e,th=(e,t=0,n)=>{if(n.type!==`string`||n.const||n.trusted)return e;let r=``;for(let e=t-1;e>=0;e--)r+=`d.h${e}(`;return r+e+`)`.repeat(t)},nh=e=>{if(!e.allOf||Xm in e&&(e[Xm]!==`Intersect`||e.type!==`object`))return e;let{allOf:t,...n}=e;n.properties={},Xm in n&&(n[Xm]=`Object`);for(let e of t){if(e.type!==`object`)continue;let{properties:t,required:r,type:i,[Xm]:a,...o}=e;for(let t in r&&(n.required=n.required?n.required.concat(r):r),Object.assign(n,o),e.properties)n.properties[t]=nh(e.properties[t])}return n},rh=(e,t,n)=>{let r=e.patternProperties[`^(.*)$`]??e.patternProperties[Object.keys(e.patternProperties)[0]];if(!r)return t;let i=n.array;n.array++;let a=`(()=>{const ar${i}s=Object.keys(${t}),ar${i}v={};for(let i=0;i<ar${i}s.length;i++){const ar${i}p=${t}[ar${i}s[i]];ar${i}v[ar${i}s[i]]=${sh(r,`ar${i}p`,n)}`,o=n.optionalsInArray[i+1];if(o)for(let e=0;e<o.length;e++){let t=`ar${i}v[ar${i}s[i]].${o[e]}`;a+=`;if(${t}===undefined)delete ${t}`}return a+=`}return ar${i}v})()`,a},ih=(e,t,n)=>{let r=n.array;n.array++;let i=t===`v`&&!n.unions.length,a=``;i||(a=`(()=>{`),a+=`const ar${r}v=[`;for(let r=0;r<e.length;r++)r!==0&&(a+=`,`),a+=sh(e[r],$m(t,r,n.parentIsOptional),n);return a+=`];`,i||(a+=`return ar${r}v})()`),a};function ah(e,t=new WeakMap){if(typeof e!=`object`||!e||typeof e==`function`)return e;if(t.has(e))return t.get(e);if(Array.isArray(e)){let n=Array(e.length);t.set(e,n);for(let r=0;r<e.length;r++)n[r]=ah(e[r],t);return n}if(typeof e==`object`){let n=Object.keys(e).concat(Object.getOwnPropertySymbols(e)),r={};for(let i of n)r[i]=ah(e[i],t);return r}return e}var oh=(e,t,n)=>{if(n.TypeCompiler===void 0)return n.typeCompilerWanred||=(console.warn(Error(`[exact-mirror] TypeBox's TypeCompiler is required to use Union`)),!0),t;n.unionKeys[t]=1;let r=n.unions.length,i=n.unions[r]=[],a=`(()=>{
`,o=e=>{if(!(Xm in e)||!e.$ref)return e;if(e[Xm]===`This`)return ah(n.definitions[e.$ref]);if(e[Xm]===`Ref`)if(!n.modules)console.warn(Error(`[exact-mirror] modules is required when using nested cyclic reference`));else return n.modules.Import(e.$ref);return e};for(let s=0;s<e.length;s++){let c=o(e[s]);if(Array.isArray(c.anyOf))for(let e=0;e<c.anyOf.length;e++)c.anyOf[e]=o(c.anyOf[e]);else if(c.items)if(Array.isArray(c.items))for(let e=0;e<c.items.length;e++)c.items[e]=o(c.items[e]);else c.items=o(c.items);i.push(Jm.Compile(c)),a+=`if(d.unions[${r}][${s}].Check(${t})){return ${sh(c,t,{...n,recursion:n.recursion+1,parentIsOptional:!0})}}
`}return a+=`return ${n.removeUnknownUnionType?`undefined`:t}})()`,a},sh=(e,t,n)=>{if(!e)return``;let r=t===`v`&&!n.unions.length;if(Xm in e&&e[Xm]===`Import`&&e.$ref in e.$defs)return sh(e.$defs[e.$ref],t,{...n,definitions:Object.assign(n.definitions,e.$defs)});if(r&&e.type!==`object`&&e.type!==`array`&&!e.anyOf)return`return ${th(`v`,n.sanitize?.length,e)}`;if(n.recursion>=n.recursionLimit)return t;let i=``;switch(e.$id&&Zm in e&&(n.definitions[e.$id]=e),e.type){case`object`:if(e[Xm]===`Record`){i=rh(e,t,n);break}e=nh(e),i+=`{`,e.additionalProperties&&(i+=`...${t},`);let a=Object.keys(e.properties);for(let r=0;r<a.length;r++){let o=a[r],s=!e.required||e.required&&!e.required.includes(o)||Array.isArray(e.properties[o].anyOf),c=$m(t,o,n.parentIsOptional);if(s){let e=n.array;if(t.startsWith(`ar`)){let t=c.slice(c.indexOf(`.`)+1),r=n.optionalsInArray;r[e]?r[e].push(t):r[e]=[t]}else n.optionals.push(c)}let l=e.properties[o];r!==0&&(i+=`,`),i+=`${eh(o)}:${s?`${c}===undefined?undefined:`:``}${sh(l,c,{...n,recursion:n.recursion+1,parentIsOptional:s})}`}i+=`}`;break;case`array`:if(e.items.type!==`object`&&e.items.type!==`array`)if(Array.isArray(e.items)){i=ih(e.items,t,n);break}else if(r)return`return v`;else if(Xm in e.items&&e.items.$ref&&(e.items[Xm]===`Ref`||e.items[Xm]===`This`))i=sh(ah(n.definitions[e.items.$ref]),t,{...n,parentIsOptional:!0,recursion:n.recursion+1});else{i=t;break}let o=n.array;n.array++;let s=t;r?i=`const ar${o}v=new Array(${t}.length);`:(s=`ar${o}s`,i=`((${s})=>{const ar${o}v=new Array(${s}.length);`),i+=`for(let i=0;i<${s}.length;i++){const ar${o}p=${s}[i];ar${o}v[i]=${sh(e.items,`ar${o}p`,n)}`;let c=n.optionalsInArray[o+1];if(c)for(let e=0;e<c.length;e++){let t=`ar${o}v[i].${c[e]}`;i+=`;if(${t}===undefined)delete ${t}`}i+=`}`,r||(i+=`return ar${o}v})(${t})`);break;default:if(e.$ref&&e.$ref in n.definitions)return sh(n.definitions[e.$ref],t,n);if(Array.isArray(e.anyOf)){i=oh(e.anyOf,t,n);break}i=th(t,n.sanitize?.length,e);break}if(!r)return i;i=e.type===`array`?`${i}const x=ar0v;`:`const x=${i}
`;for(let t=0;t<n.optionals.length;t++){let r=n.optionals[t],a=r.slice(1);i+=`if(${r}===undefined`,n.unionKeys[r]&&(i+=`||x${a}===undefined`);let o=a.charCodeAt(0)!==63&&e.type!==`array`;i+=`)delete x${o?a.charCodeAt(0)===91?`?.`:`?`:``}${a}
`}return`${i}return x`},ch=(e,{TypeCompiler:t,modules:n,definitions:r,sanitize:i,recursionLimit:a=8,removeUnknownUnionType:o=!1}={})=>{let s=[];typeof i==`function`&&(i=[i]);let c=sh(e,`v`,{optionals:[],optionalsInArray:[],array:0,parentIsOptional:!1,unions:s,unionKeys:{},TypeCompiler:t,modules:n,definitions:r??n?.$defs??{},sanitize:i,recursion:0,recursionLimit:a,removeUnknownUnionType:o});if(!s.length&&!i?.length)return Function(`v`,c);let l;if(i?.length){l={};for(let e=0;e<i.length;e++)l[`h${e}`]=i[e]}return Function(`d`,`return function mirror(v){${c}}`)({unions:s,...l})},lh=e(wu(),1),uh=e(Ym(),1),dh=e(wu(),1),fh=e(wu(),1),ph=e(wu(),1),mh=(e,t)=>{let n=t?.length?{}:null;if(n)for(let e of t)n[e.part.charCodeAt(0)]=e;return{part:e,store:null,inert:n,params:null,wildcardStore:null}},hh=(e,t)=>({...e,part:t}),gh=e=>({name:e,store:null,inert:null}),_h=class e{constructor(e={}){this.config=e,e.lazy&&(this.find=this.lazyFind),e.onParam&&!Array.isArray(e.onParam)&&(this.config.onParam=[this.config.onParam])}root={};history=[];deferred=[];static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/(\/:\w+\?)/g};lazyFind=(e,t)=>this.config.lazy?(this.build(),this.find(e,t)):this.find;build(){if(this.config.lazy){for(let[e,t,n]of this.deferred)this.add(e,t,n,{lazy:!1,ignoreHistory:!0});this.deferred=[],this.find=(e,t)=>{let n=this.root[e];return n?vh(t,t.length,n,0,this.config.onParam):null}}}add(t,n,r,{ignoreError:i=!1,ignoreHistory:a=!1,lazy:o=this.config.lazy}={}){if(o)return this.find=this.lazyFind,this.deferred.push([t,n,r]),r;if(typeof n!=`string`)throw TypeError(`Route path must be a string`);n===``?n=`/`:n[0]!==`/`&&(n=`/${n}`);let s=n[n.length-1]===`*`,c=n.match(e.regex.optionalParams);if(c){let e=n.replaceAll(`?`,``);this.add(t,e,r,{ignoreError:i,ignoreHistory:a,lazy:o});for(let e=0;e<c.length;e++){let i=n.replace(c[e],``);this.add(t,i,r,{ignoreError:!0,ignoreHistory:a,lazy:o})}return r}if(c&&(n=n.replaceAll(`?`,``)),this.history.find(([e,r,i])=>e===t&&r===n))return r;(s||c&&n.charCodeAt(n.length-1)===63)&&(n=n.slice(0,-1)),a||this.history.push([t,n,r]);let l=n.split(e.regex.static),u=n.match(e.regex.params)||[];l[l.length-1]===``&&l.pop();let d=this.root[t]?this.root[t]:this.root[t]=mh(`/`),f=0;for(let e=0;e<l.length;++e){let t=l[e];if(e>0){let e=u[f++].slice(1);if(d.params===null)d.params=gh(e);else if(d.params.name!==e){if(i)return r;throw Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}let a=d.params;if(a.inert===null){d=a.inert=mh(t);continue}d=a.inert}for(let e=0;;){if(e===t.length){if(e<d.part.length){let n=hh(d,d.part.slice(e));Object.assign(d,mh(t,[n]))}break}if(e===d.part.length){d.inert===null&&(d.inert={});let n=d.inert[t.charCodeAt(e)];if(n){d=n,t=t.slice(e),e=0;continue}let r=mh(t.slice(e));d.inert[t.charCodeAt(e)]=r,d=r;break}if(t[e]!==d.part[e]){let n=hh(d,d.part.slice(e)),r=mh(t.slice(e));Object.assign(d,mh(d.part.slice(0,e),[n,r])),d=r;break}++e}}if(f<u.length){let e=u[f].slice(1);if(d.params===null)d.params=gh(e);else if(d.params.name!==e){if(i)return r;throw Error(`Cannot create route "${n}" with parameter "${e}" because a route already exists with a different parameter name ("${d.params.name}") in the same location`)}return d.params.store===null&&(d.params.store=r),d.params.store}return s?(d.wildcardStore===null&&(d.wildcardStore=r),d.wildcardStore):(d.store===null&&(d.store=r),d.store)}find(e,t){let n=this.root[e];return n?vh(t,t.length,n,0,this.config.onParam):null}},vh=(e,t,n,r,i)=>{let a=n.part,o=a.length,s=r+o;if(o>1){if(s>t)return null;if(o<15){for(let t=1,n=r+1;t<o;++t,++n)if(a.charCodeAt(t)!==e.charCodeAt(n))return null}else if(e.slice(r,s)!==a)return null}if(s===t)return n.store===null?n.wildcardStore===null?null:{store:n.wildcardStore,params:{"*":``}}:{store:n.store,params:{}};if(n.inert!==null){let r=n.inert[e.charCodeAt(s)];if(r!==void 0){let n=vh(e,t,r,s,i);if(n!==null)return n}}if(n.params!==null){let{store:r,name:a,inert:o}=n.params,c=e.indexOf(`/`,s);if(c!==s){if(c===-1||c>=t){if(r!==null){let n={};if(n[a]=e.substring(s,t),i)for(let e=0;e<i.length;e++){let t=i[e](n[a],a);t!==void 0&&(n[a]=t)}return{store:r,params:n}}}else if(o!==null){let n=vh(e,t,o,c,i);if(n!==null){if(n.params[a]=e.substring(s,c),i)for(let e=0;e<i.length;e++){let t=i[e](n.params[a],a);t!==void 0&&(n.params[a]=t)}return n}}}}return n.wildcardStore===null?null:{store:n.wildcardStore,params:{"*":e.substring(s,t)}}},yh={date:Ch,time:Th(!0),"date-time":Oh(!0),"iso-time":Th(!1),"iso-date-time":Oh(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:jh,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:Bh,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:Nh,int32:{type:`number`,validate:Ih},int64:{type:`number`,validate:Lh},float:{type:`number`,validate:Rh},double:{type:`number`,validate:Rh},password:!0,binary:!0};function bh(e){return e%4==0&&(e%100!=0||e%400==0)}var xh=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Sh=[0,31,28,31,30,31,30,31,31,30,31,30,31];function Ch(e){let t=xh.exec(e);if(!t)return!1;let n=+t[1],r=+t[2],i=+t[3];return r>=1&&r<=12&&i>=1&&i<=(r===2&&bh(n)?29:Sh[r])}var wh=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function Th(e){return function(t){let n=wh.exec(t);if(!n)return!1;let r=+n[1],i=+n[2],a=+n[3],o=n[4],s=n[5]===`-`?-1:1,c=+(n[6]||0),l=+(n[7]||0);if(c>23||l>59||e&&!o)return!1;if(r<=23&&i<=59&&a<60)return!0;let u=i-l*s,d=r-c*s-(u<0?1:0);return(d===23||d===-1)&&(u===59||u===-1)&&a<61}}var Eh=e=>e.charCodeAt(e.length-6)===32?e.slice(0,-6)+`+`+e.slice(-5):e,Dh=/t|\s/i;function Oh(e){let t=Th(e);return function(e){let n=e.split(Dh);return n.length===2&&Ch(n[0])&&t(n[1])}}var kh=/\/|:/,Ah=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function jh(e){return kh.test(e)&&Ah.test(e)}var Mh=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function Nh(e){return Mh.lastIndex=0,Mh.test(e)}var Ph=-(2**31),Fh=2**31-1;function Ih(e){return Number.isInteger(e)&&e<=Fh&&e>=Ph}function Lh(e){return Number.isInteger(e)}function Rh(){return!0}var zh=/[^\\]\\Z/;function Bh(e){if(zh.test(e))return!1;try{return new RegExp(e),!0}catch{return!1}}var Vh=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,Hh=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,Uh=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,Wh=yh.date,Gh=yh[`date-time`];Un(`date`)||Wn(`date`,e=>{let t=Eh(e).replace(/"/g,``);if(Vh.test(t)||Hh.test(t)||Uh.test(t)||Wh(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1}),Un(`date-time`)||Wn(`date-time`,e=>{let t=e.replace(/"/g,``);if(Vh.test(t)||Hh.test(t)||Uh.test(t)||Gh(t)){let e=new Date(t);if(!Number.isNaN(e.getTime()))return!0}return!1}),Object.entries(yh).forEach(e=>{let[t,n]=e;Un(t)||(n instanceof RegExp?Wn(t,e=>n.test(e)):typeof n==`function`&&Wn(t,n))}),Un(`numeric`)||Wn(`numeric`,e=>!!e&&!isNaN(+e)),Un(`integer`)||Wn(`integer`,e=>!!e&&Number.isInteger(+e)),Un(`boolean`)||Wn(`boolean`,e=>e===`true`||e===`false`),Un(`ObjectString`)||Wn(`ObjectString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}}),Un(`ArrayString`)||Wn(`ArrayString`,e=>{let t=e.charCodeAt(0);if((t===9||t===10||t===32)&&(t=e.trimStart().charCodeAt(0)),t!==123&&t!==91)return!1;try{return JSON.parse(e),!0}catch{return!1}});var Kh=typeof Bun<`u`,qh={aac:`audio/aac`,abw:`application/x-abiword`,ai:`application/postscript`,arc:`application/octet-stream`,avi:`video/x-msvideo`,azw:`application/vnd.amazon.ebook`,bin:`application/octet-stream`,bz:`application/x-bzip`,bz2:`application/x-bzip2`,csh:`application/x-csh`,css:`text/css`,csv:`text/csv`,doc:`application/msword`,dll:`application/octet-stream`,eot:`application/vnd.ms-fontobject`,epub:`application/epub+zip`,gif:`image/gif`,htm:`text/html`,html:`text/html`,ico:`image/x-icon`,ics:`text/calendar`,jar:`application/java-archive`,jpeg:`image/jpeg`,jpg:`image/jpeg`,js:`application/javascript`,json:`application/json`,mid:`audio/midi`,midi:`audio/midi`,mp2:`audio/mpeg`,mp3:`audio/mpeg`,mp4:`video/mp4`,mpa:`video/mpeg`,mpe:`video/mpeg`,mpeg:`video/mpeg`,mpkg:`application/vnd.apple.installer+xml`,odp:`application/vnd.oasis.opendocument.presentation`,ods:`application/vnd.oasis.opendocument.spreadsheet`,odt:`application/vnd.oasis.opendocument.text`,oga:`audio/ogg`,ogv:`video/ogg`,ogx:`application/ogg`,otf:`font/otf`,png:`image/png`,pdf:`application/pdf`,ppt:`application/vnd.ms-powerpoint`,rar:`application/x-rar-compressed`,rtf:`application/rtf`,sh:`application/x-sh`,svg:`image/svg+xml`,swf:`application/x-shockwave-flash`,tar:`application/x-tar`,tif:`image/tiff`,tiff:`image/tiff`,ts:`application/typescript`,ttf:`font/ttf`,txt:`text/plain`,vsd:`application/vnd.visio`,wav:`audio/x-wav`,weba:`audio/webm`,webm:`video/webm`,webp:`image/webp`,woff:`font/woff`,woff2:`font/woff2`,xhtml:`application/xhtml+xml`,xls:`application/vnd.ms-excel`,xlsx:`application/vnd.ms-excel`,xlsx_OLD:`application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`,xml:`application/xml`,xul:`application/vnd.mozilla.xul+xml`,zip:`application/zip`,"3gp":`video/3gpp`,"3gp_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp`,"3gp2":`video/3gpp2`,"3gp2_DOES_NOT_CONTAIN_VIDEO":`audio/3gpp2`,"7z":`application/x-7z-compressed`},Jh=e=>{let t=e.lastIndexOf(`.`);return t===-1?``:e.slice(t+1)},Yh,Xh,Zh=class{constructor(e){if(this.path=e,Kh)this.value=Bun.file(e);else if(typeof window<`u`)console.warn(`Browser environment does not support file`);else if(!Yh||!Xh)try{this.value=_(()=>import(`./vite-browser-external.D7KW2JJD.js`).then(n(1)),__vite__mapDeps([0,1])).then(t=>(Yh=t.createReadStream,t.createReadStream(e))),this.stats=_(()=>import(`./vite-browser-external.D7KW2JJD.js`).then(n(1)),__vite__mapDeps([0,1])).then(t=>(Xh=t.stat,t.stat(e)))}catch{}else this.value=Yh(e),this.stats=Xh(e)}get type(){return qh[Jh(this.path)]||`application/octet-stream`}get length(){return Kh?this.value.size:this.stats?.then(e=>e.size)??0}},Qh=`toJSON`in new Headers,$h=(e,t)=>{let n=new URL(e);return n.pathname=t,n.toString()},eg=e=>typeof e==`function`&&/^\s*class\s+/.test(e.toString())||e.toString&&e.toString().startsWith(`[object `)&&e.toString()!==`[object Object]`||J(Object.getPrototypeOf(e)),tg=e=>e&&typeof e==`object`&&!Array.isArray(e),ng=(e,t,n)=>{let r=n?.skipKeys,i=n?.override??!0,a=n?.mergeArray??!0;if(!tg(e)||!tg(t))return e;for(let[n,o]of Object.entries(t))if(!r?.includes(n)){if(a&&Array.isArray(o)){e[n]=Array.isArray(e[n])?[...e[n],...o]:e[n]=o;continue}if(!tg(o)||!(n in e)||eg(o)){(i||!(n in e))&&(e[n]=o);continue}e[n]=ng(e[n],o,{skipKeys:r,override:i,mergeArray:a})}return e},rg=(e,t)=>{let n=ng(Object.assign({},e),t,{skipKeys:[`properties`],mergeArray:!1});return n.properties&&delete n.properties,n},q=(e,t)=>{if(!t)return e;let n=[],r=[];if(e){Array.isArray(e)||(e=[e]);for(let t of e)n.push(t),t.checksum&&r.push(t.checksum)}if(t){Array.isArray(t)||(t=[t]);for(let e of t)r.includes(e.checksum)||n.push(e)}return n};[`start`,`request`,`parse`,`transform`,`resolve`,`beforeHandle`,`afterHandle`,`mapResponse`,`afterResponse`,`trace`,`error`,`stop`,`body`,`headers`,`params`,`query`,`response`,`type`,`detail`].reduce((e,t)=>(e[t]=!0,e),{});var ig=e=>typeof e==`object`&&Object.keys(e).every(e=>!isNaN(+e)),ag=(e,t)=>ig(e)&&ig(t)?Object.assign({},e,t):e&&!ig(e)&&ig(t)?Object.assign({200:e},t):t??e,og=(e,t)=>!e&&!t?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:{body:t?.body??e?.body,headers:t?.headers??e?.headers,params:t?.params??e?.params,query:t?.query??e?.query,cookie:t?.cookie??e?.cookie,response:ag(e?.response,t?.response)},sg=(e,t)=>{if(!t)return e??{};if(!e)return t??{};if(!Object.values(t).find(e=>e!=null))return{...e};let n={...e,...t,body:t.body??e.body,headers:t.headers??e.headers,params:t.params??e.params,query:t.query??e.query,cookie:t.cookie??e.cookie,response:ag(e.response,t.response),type:e.type||t.type,detail:ng(t.detail??{},e.detail??{}),parse:q(e.parse,t.parse),transform:q(e.transform,t.transform),beforeHandle:q(q(Dg(e.resolve,`resolve`),e.beforeHandle),q(Dg(t.resolve,`resolve`),t.beforeHandle)),afterHandle:q(e.afterHandle,t.afterHandle),mapResponse:q(e.mapResponse,t.mapResponse),afterResponse:q(e.afterResponse,t.afterResponse),trace:q(e.trace,t.trace),error:q(e.error,t.error),standaloneSchema:e.standaloneSchema||t.standaloneSchema?e.standaloneSchema&&!t.standaloneSchema?e.standaloneSchema:t.standaloneSchema&&!e.standaloneSchema?t.standaloneSchema:[...e.standaloneSchema??[],...t.standaloneSchema??[]]:void 0};return n.resolve&&delete n.resolve,n},cg=e=>{e.parse&&!Array.isArray(e.parse)&&(e.parse=[e.parse]),e.transform&&!Array.isArray(e.transform)&&(e.transform=[e.transform]),e.afterHandle&&!Array.isArray(e.afterHandle)&&(e.afterHandle=[e.afterHandle]),e.mapResponse&&!Array.isArray(e.mapResponse)&&(e.mapResponse=[e.mapResponse]),e.afterResponse&&!Array.isArray(e.afterResponse)&&(e.afterResponse=[e.afterResponse]),e.trace&&!Array.isArray(e.trace)&&(e.trace=[e.trace]),e.error&&!Array.isArray(e.error)&&(e.error=[e.error]);let t=[];return e.resolve&&(t=Dg(Array.isArray(e.resolve)?e.resolve:[e.resolve],`resolve`),delete e.resolve),e.beforeHandle&&(t=t.length?t.concat(Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]):Array.isArray(e.beforeHandle)?e.beforeHandle:[e.beforeHandle]),t.length&&(e.beforeHandle=t),e},lg=typeof Bun<`u`,ug=lg&&typeof Bun.hash==`function`,dg=e=>{if(ug)return Bun.hash(e);let t=9;for(let n=0;n<e.length;)t=Math.imul(t^e.charCodeAt(n++),9**9);return t^=t>>>9},fg=(e,t)=>{if(!t)return;if(!Array.isArray(t)){let n=t;return e&&!n.checksum&&(n.checksum=e),n.scope===`scoped`&&(n.scope=`local`),n}let n=[...t];for(let t of n)e&&!t.checksum&&(t.checksum=e),t.scope===`scoped`&&(t.scope=`local`);return n},pg=(e,t,n)=>({start:q(e.start,fg(n,t?.start)),request:q(e.request,fg(n,t?.request)),parse:q(e.parse,fg(n,t?.parse)),transform:q(e.transform,fg(n,t?.transform)),beforeHandle:q(q(Dg(e.resolve,`resolve`),e.beforeHandle),fg(n,q(Dg(t?.resolve,`resolve`),t?.beforeHandle))),afterHandle:q(e.afterHandle,fg(n,t?.afterHandle)),mapResponse:q(e.mapResponse,fg(n,t?.mapResponse)),afterResponse:q(e.afterResponse,fg(n,t?.afterResponse)),trace:q(e.trace,fg(n,t?.trace)),error:q(e.error,fg(n,t?.error)),stop:q(e.stop,fg(n,t?.stop))}),mg=(e,t,{skipIfHasType:n=!1})=>{if(!e)return e;if(!Array.isArray(e))return n?e.scope??=t:e.scope=t,e;for(let r of e)n?r.scope??=t:r.scope=t;return e},hg=e=>{if(!e)return e;if(!Array.isArray(e))switch(e.scope){case`global`:case`scoped`:return{...e};default:return{fn:e}}let t=[];for(let n of e)switch(n.scope){case`global`:case`scoped`:t.push({...n});break}return t},gg=e=>({...e,type:e?.type,detail:e?.detail,parse:hg(e?.parse),transform:hg(e?.transform),beforeHandle:hg(e?.beforeHandle),afterHandle:hg(e?.afterHandle),mapResponse:hg(e?.mapResponse),afterResponse:hg(e?.afterResponse),error:hg(e?.error),trace:hg(e?.trace)}),_g={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Enhance Your Calm":420,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},vg=Object.fromEntries(Object.entries(_g).map(([e,t])=>[t,e]));function yg(e){let t=e;for(;t.endsWith(`=`);)t=t.slice(0,-1);return t}var bg=new TextEncoder,xg=async(e,t)=>{if(typeof e==`object`?e=JSON.stringify(e):typeof e!=`string`&&(e+=``),t===null)throw TypeError(`Secret key must be provided.`);let n=await crypto.subtle.importKey(`raw`,bg.encode(t),{name:`HMAC`,hash:`SHA-256`},!1,[`sign`]),r=await crypto.subtle.sign(`HMAC`,n,bg.encode(e));return e+`.`+yg(Buffer.from(r).toString(`base64`))},Sg=async(e,t)=>{if(typeof e!=`string`)throw TypeError(`Signed cookie string must be provided.`);if(t===null)throw TypeError(`Secret key must be provided.`);let n=e.slice(0,e.lastIndexOf(`.`));return await xg(n,t)===e?n:!1},Cg=(e,t,n)=>{if(!e.standaloneValidator?.length||!Array.isArray(e.standaloneValidator)){e.standaloneValidator=[{[t]:n}];return}let r=e.standaloneValidator[e.standaloneValidator.length-1];t in r?e.standaloneValidator.push({[t]:n}):r[t]=n},wg=e=>{if(typeof e==`number`)return e;if(e.length<16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)?null:t}if(e.length===16){if(e.trim().length===0)return null;let t=Number(e);return Number.isNaN(t)||t.toString()!==e?null:t}return null},Tg=e=>wg(e)!==null,Eg=class{constructor(e=console.error,t=()=>{}){this.onError=e,this.onFinally=t,this.root=null,this.promises=[]}get size(){return this.promises.length}add(e){return this.promises.push(e),this.root||=this.drain(),this.promises.length===1&&this.then(this.onFinally),e}async drain(){for(;this.promises.length>0;){try{await this.promises[0]}catch(e){this.onError(e)}this.promises.shift()}this.root=null}then(e,t){return(this.root??Promise.resolve()).then(e,t)}},Dg=(e,t)=>{if(!e)return e;if(!Array.isArray(e)){if(typeof e==`function`||typeof e==`string`)return t?{fn:e,subType:t}:{fn:e};if(`fn`in e)return e}let n=[];for(let r of e)typeof r==`function`||typeof r==`string`?n.push(t?{fn:r,subType:t}:{fn:r}):`fn`in r&&n.push(r);return n},Og=e=>(e.start&&=Dg(e.start),e.request&&=Dg(e.request),e.parse&&=Dg(e.parse),e.transform&&=Dg(e.transform),e.beforeHandle&&=Dg(e.beforeHandle),e.afterHandle&&=Dg(e.afterHandle),e.mapResponse&&=Dg(e.mapResponse),e.afterResponse&&=Dg(e.afterResponse),e.trace&&=Dg(e.trace),e.error&&=Dg(e.error),e.stop&&=Dg(e.stop),e),kg=e=>{let t=Object.create(null);return e.start?.map&&(t.start=e.start.map(e=>e.fn)),e.request?.map&&(t.request=e.request.map(e=>e.fn)),e.parse?.map&&(t.parse=e.parse.map(e=>e.fn)),e.transform?.map&&(t.transform=e.transform.map(e=>e.fn)),e.beforeHandle?.map&&(t.beforeHandle=e.beforeHandle.map(e=>e.fn)),e.afterHandle?.map&&(t.afterHandle=e.afterHandle.map(e=>e.fn)),e.mapResponse?.map&&(t.mapResponse=e.mapResponse.map(e=>e.fn)),e.afterResponse?.map&&(t.afterResponse=e.afterResponse.map(e=>e.fn)),e.error?.map&&(t.error=e.error.map(e=>e.fn)),e.stop?.map&&(t.stop=e.stop.map(e=>e.fn)),e.trace?.map?t.trace=e.trace.map(e=>e.fn):t.trace=[],t},Ag=e=>({body:e.body,cookie:e.cookie,headers:e.headers,query:e.query,set:e.set,server:e.server,path:e.path,route:e.route,url:e.url}),jg=(e,t=302)=>Response.redirect(e,t),Mg=Symbol(`ElysiaFormData`),Ng=Symbol(`ElysiaRequestId`),Pg=e=>{let t=new FormData;if(t[Mg]={},e)for(let[n,r]of Object.entries(e)){if(Array.isArray(r)){t[Mg][n]=[];for(let e of r)r instanceof File?t.append(n,r,r.name):r instanceof Zh?t.append(n,r.value,r.value?.name):t.append(n,r),t[Mg][n].push(r);continue}r instanceof File?t.append(n,r,r.name):r instanceof Zh?t.append(n,r.value,r.value?.name):t.append(n,r),t[Mg][n]=r}return t},Fg=()=>{let e=crypto.randomUUID();return e.slice(0,8)+e.slice(24,32)},Ig=e=>{if(!e.length)return[];let t=[];for(let n=0;n<e.length;n++){let r=e[n];r.checksum&&(t.includes(r.checksum)&&(e.splice(n,1),n--),t.push(r.checksum))}return e},Lg=(e,t=`scoped`)=>{if(e){if(t===`scoped`){for(let t of e)`scope`in t&&t.scope===`local`&&(t.scope=`scoped`);return}for(let t of e)`scope`in t&&(t.scope=`global`)}},Rg=e=>e.charCodeAt(e.length-1)===47?e.slice(0,e.length-1):e+`/`,J=e=>{if(!e)return!1;for(let t in e)return!0;return!1},zg=(e,{dynamic:t=!1}={})=>{let n=encodeURIComponent(e).replace(/%2F/g,`/`);return t&&(n=n.replace(/%3A/g,`:`).replace(/%3F/g,`?`)),n},Bg=(()=>{if(typeof Bun>`u`)return!0;let e=Bun.version.split(`.`);return!(+e[0]<1||+e[1]<2||+e[2]<14)})();async function Vg(e){if(e.bodyUsed||!e.body)return 0;let t=0,n=e.body.getReader();for(;;){let{done:e,value:r}=await n.read();if(e)break;t+=r.byteLength}return t}var Hg={headers:!0,cookie:!0,query:!0,params:!0,body:!0,response:!0},Ug=typeof Bun<`u`?Bun.env:typeof process<`u`?{}:void 0,Wg=Symbol(`ElysiaErrorCode`),Gg=(Ug?.NODE_ENV??Ug?.ENV)===`production`,Kg={101:void 0,204:void 0,205:void 0,304:void 0,307:void 0,308:void 0},qg=class{constructor(e,t){let n=t??(e in vg?vg[e]:e);this.code=_g[e]??e,e in Kg?this.response=void 0:this.response=n}},Jg=(e,t)=>new qg(e,t);Jg(403,`a`),Jg(403,`b`),Error;var Yg=class extends Error{constructor(e){super(e??`NOT_FOUND`),this.code=`NOT_FOUND`,this.status=404}},Xg=class extends Error{constructor(e){super(`Bad Request`,{cause:e}),this.code=`PARSE`,this.status=400}},Zg=class extends Error{constructor(e,t){super(t??`"${e}" has invalid cookie signature`),this.key=e,this.code=`INVALID_COOKIE_SIGNATURE`,this.status=400}},Qg=e=>{if(!e)return{summary:void 0};let{message:t,path:n,value:r,type:i}=e,a=n.slice(1).replaceAll(`/`,`.`),o=n===``;switch(i){case 42:return{...e,summary:o?`Value should not be provided`:`Property '${a}' should not be provided`};case 45:return{...e,summary:o?`Value is missing`:`Property '${a}' is missing`};case 50:let n=t.indexOf(`'`),i=t.slice(n+1,t.indexOf(`'`,n+1));return{...e,summary:o?`Value should be an email`:`Property '${a}' should be ${i}`};case 54:return{...e,summary:`${t.slice(0,9).trim()} property '${a}' to be ${t.slice(8).trim()} but found: ${r}`};case 62:let s=e.schema.anyOf.map(e=>`'${e?.format??e.type}'`).join(`, `);return{...e,summary:o?`Value should be one of ${s}`:`Property '${a}' should be one of: ${s}`};default:return{summary:t,...e}}},$g=class e extends Error{constructor(t,n,r=`"${t}" has invalid file type`){super(r),this.property=t,this.expected=n,this.message=r,this.code=`INVALID_FILE_TYPE`,this.status=422,Object.setPrototypeOf(this,e.prototype)}toResponse(e){return Gg?new Response(JSON.stringify({type:`validation`,on:`body`}),{status:422,headers:{...e,"content-type":`application/json`}}):new Response(JSON.stringify({type:`validation`,on:`body`,summary:`Invalid file type`,message:this.message,property:this.property,expected:this.expected}),{status:422,headers:{...e,"content-type":`application/json`}})}},Y=class e extends Error{constructor(t,n,r,i){let a=``,o,s,c;if(n?.provider===`standard`||`~standard`in n||n.schema&&`~standard`in n.schema){let e=(`~standard`in n?n:n.schema)[`~standard`];o=(i??e.validate(r).issues)?.[0],a=Gg?JSON.stringify({type:`validation`,on:t,found:r}):JSON.stringify({type:`validation`,on:t,property:o.path?.[0]||`root`,message:o?.message,summary:o?.problem,expected:s,found:r,errors:i},null,2),c=o?.message}else{r&&typeof r==`object`&&r instanceof qg&&(r=r.response),o=i?.First()??(`Errors`in n?n.Errors(r).First():Ef(n,r).First());let e=o?.path||`root`,l=n?.schema??n;if(!Gg)try{s=vp(l)}catch(e){s={type:`Could not create expected value`,message:e?.message,error:e}}c=o?.schema?.message||o?.schema?.error!==void 0?typeof o.schema.error==`function`?o.schema.error(Gg?{type:`validation`,on:t,found:r}:{type:`validation`,on:t,value:r,property:e,message:o?.message,summary:Qg(o).summary,found:r,expected:s,errors:`Errors`in n?[...n.Errors(r)].map(Qg):[...Ef(n,r)].map(Qg)},n):o.schema.error:void 0,a=c===void 0?Gg?JSON.stringify({type:`validation`,on:t,found:r}):JSON.stringify({type:`validation`,on:t,property:e,message:o?.message,summary:Qg(o).summary,expected:s,found:r,errors:`Errors`in n?[...n.Errors(r)].map(Qg):[...Ef(n,r)].map(Qg)},null,2):typeof c==`object`?JSON.stringify(c):c+``}super(a),this.type=t,this.validator=n,this.value=r,this.code=`VALIDATION`,this.status=422,this.valueError=o,this.expected=s,this.customError=c,Object.setPrototypeOf(this,e.prototype)}get all(){return`Errors`in this.validator?[...this.validator.Errors(this.value)].map(Qg):[...Ef(this.validator,this.value)].map(Qg)}static simplifyModel(e){let t=`schema`in e?e.schema:e;try{return vp(t)}catch{return t}}get model(){return`~standard`in this.validator?this.validator:e.simplifyModel(this.validator)}toResponse(e){return new Response(this.message,{status:400,headers:{...e,"content-type":`application/json`}})}detail(e){if(!this.customError)return this.message;this.validator;let t=this.value,n=this.expected,r=this.all;return Gg?{type:`validation`,on:this.type,found:t,message:e}:{type:`validation`,on:this.type,property:this.valueError?.path||`root`,message:e,summary:Qg(this.valueError).summary,found:t,expected:n,errors:r}}},e_=(e,t)=>{try{return JSON.parse(e)}catch{throw new Y(`property`,t,e)}};function t_(e,t){return qn(e)||Jn(e,t),(t={})=>xu({...t,[A]:e})}var n_=e=>{try{let t=Jm.Compile(e);return t.Create=()=>vp(e),t.Error=n=>new Y(`property`,e,n,t.Errors(n)),t}catch{return{Check:t=>zd(e,t),CheckThrow:t=>{if(!zd(e,t))throw new Y(`property`,e,t,Ef(e,t))},Decode:t=>wm(e,t),Create:()=>vp(e),Error:t=>new Y(`property`,e,t,Ef(e,t))}}},r_=e=>{if(typeof e==`string`)switch(e.slice(-1)){case`k`:return e.slice(0,e.length-1)*1024;case`m`:return e.slice(0,e.length-1)*1048576;default:return+e}return e},i_=(e,t)=>e.startsWith(t)?!0:t.charCodeAt(t.length-1)===42&&t.charCodeAt(t.length-2)===47&&e.startsWith(t.slice(0,-1)),a_=!1,o_=()=>{a_||=(console.warn(`[Elysia] Attempt to validate file type without 'file-type'. This may lead to security risks. We recommend installing 'file-type' to properly validate file extension.`),!0)},s_=async()=>_(()=>import(`./core.6ue9YUui.js`),__vite__mapDeps([2,1])).then(e=>(c_=e.fileTypeFromBlob,c_)).catch(o_),c_,l_=e=>c_?c_(e):s_().then(t=>{if(t)return t(e)}),u_=async(e,t,n=e?.name??``)=>{if(Array.isArray(e))return await Promise.all(e.map(e=>u_(e,t,n))),!0;if(!e)return!1;let r=await l_(e);if(!r||typeof t==`string`&&!i_(r.mime,t))throw new $g(n,t);for(let e=0;e<t.length;e++)if(i_(r.mime,t[e]))return!0;throw new $g(n,t)},d_=(e,t)=>{if(t instanceof Zh)return!0;if(!(t instanceof Blob)||e.minSize&&t.size<r_(e.minSize)||e.maxSize&&t.size>r_(e.maxSize))return!1;if(e.extension){if(typeof e.extension==`string`)return i_(t.type,e.extension);for(let n=0;n<e.extension.length;n++)if(i_(t.type,e.extension[n]))return!0;return!1}return!0},f_=e=>t=>({...t,message:e}),X=Object.assign({},Cu);t_(`UnionEnum`,(e,t)=>(typeof t==`number`||typeof t==`string`||t===null)&&e.enum.includes(t)),t_(`ArrayBuffer`,(e,t)=>t instanceof ArrayBuffer);var p_=t_(`Files`,(e,t)=>{if(e.minItems&&e.minItems>1&&!Array.isArray(t))return!1;if(!Array.isArray(t))return d_(e,t);if(e.minItems&&t.length<e.minItems||e.maxItems&&t.length>e.maxItems)return!1;for(let n=0;n<t.length;n++)if(!d_(e,t[n]))return!1;return!0}),m_=t_(`ElysiaForm`,({compiler:e,...t},n)=>{if(!(n instanceof FormData))return!1;if(e){if(!(Mg in n))throw new Y(`property`,t,n);if(!e.Check(n[Mg]))throw e.Error(n[Mg])}return!0}),h_={String:e=>Cu.String(e),Numeric:e=>{let t=Cu.Number(e),n=n_(t);return X.Transform(X.Union([X.String({format:`numeric`,default:0}),X.Number(e)],e)).Decode(t=>{let r=+t;if(isNaN(r))return t;if(e&&!n.Check(r))throw n.Error(r);return r}).Encode(e=>e)},Integer:e=>{let t=Cu.Integer(e),n=n_(t);return X.Transform(X.Union([X.String({format:`integer`,default:0}),Cu.Integer(e)],e)).Decode(e=>{let t=+e;if(!n.Check(t))throw n.Error(t);return t}).Encode(e=>e)},Date:e=>{let t=Cu.Date(e),n=n_(t),r=e?.default?new Date(e.default):void 0;return X.Transform(X.Union([Cu.Date(e),X.String({format:`date-time`,default:r?.toISOString()}),X.String({format:`date`,default:r?.toISOString()}),X.Number({default:r?.getTime()})],e)).Decode(e=>{if(typeof e==`number`){let t=new Date(e);if(!n.Check(t))throw n.Error(t);return t}if(e instanceof Date)return e;let r=new Date(Eh(e));if(!r||isNaN(r.getTime()))throw new Y(`property`,t,r);if(!n.Check(r))throw n.Error(r);return r}).Encode(e=>{if(e instanceof Date)return e.toISOString();if(typeof e==`string`){if(isNaN(new Date(Eh(e)).getTime()))throw new Y(`property`,t,e);return e}if(!n.Check(e))throw n.Error(e);return e})},BooleanString:e=>{let t=Cu.Boolean(e),n=n_(t);return X.Transform(X.Union([X.Boolean(e),X.String({format:`boolean`,default:!1})],e)).Decode(e=>{if(typeof e==`string`)return e===`true`;if(e!==void 0&&!n.Check(e))throw n.Error(e);return e}).Encode(e=>e)},ObjectString:(e,t)=>{let n=X.Object(e,t),r=n_(n);return X.Transform(X.Union([X.String({format:`ObjectString`,default:`{}`}),n],{elysiaMeta:`ObjectString`})).Decode(e=>{if(typeof e==`string`){if(e.charCodeAt(0)!==123)throw new Y(`property`,n,e);if(!r.Check(e=e_(e,n)))throw r.Error(e);return r.Decode(e)}return e}).Encode(e=>{let t;if(typeof e==`string`&&(e=e_(t=e,n)),!r.Check(e))throw r.Error(e);return t??JSON.stringify(e)})},ArrayString:(e=X.String(),t)=>{let n=X.Array(e,t),r=n_(n),i=(e,t=!1)=>{if(e.charCodeAt(0)===91){if(!r.Check(e=e_(e,n)))throw r.Error(e);return r.Decode(e)}if(t)return e;throw new Y(`property`,n,e)};return X.Transform(X.Union([X.String({format:`ArrayString`,default:t?.default}),n])).Decode(e=>{if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r==`string`){let e=i(r,!0);Array.isArray(e)?t=t.concat(e):t.push(e);continue}t.push(r)}return t}return typeof e==`string`?i(e):e}).Encode(e=>{let t;if(typeof e==`string`&&(e=e_(t=e,n)),!r.Check(e))throw new Y(`property`,n,e);return t??JSON.stringify(e)})},ArrayQuery:(e=X.String(),t)=>{let n=X.Array(e,t),r=n_(n),i=e=>e.indexOf(`,`)===-1?[e]:r.Decode(e.split(`,`));return X.Transform(X.Union([X.String({default:t?.default}),n],{elysiaMeta:`ArrayQuery`})).Decode(e=>{if(Array.isArray(e)){let t=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r==`string`){let e=i(r);Array.isArray(e)?t=t.concat(e):t.push(e);continue}t.push(r)}return t}return typeof e==`string`?i(e):e}).Encode(e=>{let t;if(typeof e==`string`&&(e=e_(t=e,n)),!r.Check(e))throw new Y(`property`,n,e);return t??JSON.stringify(e)})},File:t_(`File`,d_),Files:(e={})=>X.Transform(p_(e)).Decode(e=>Array.isArray(e)?e:[e]).Encode(e=>e),Nullable:(e,t)=>X.Union([e,X.Null()],{...t,nullable:!0}),MaybeEmpty:(e,t)=>X.Union([e,X.Null(),X.Undefined()],t),Cookie:(e,{domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u,...d}={})=>{let f=X.Object(e,d);return f.config={domain:t,expires:n,httpOnly:r,maxAge:i,path:a,priority:o,sameSite:s,secure:c,secrets:l,sign:u},f},UnionEnum:(e,t={})=>{let n=e.every(e=>typeof e==`string`)?{type:`string`}:e.every(e=>typeof e==`number`)?{type:`number`}:e.every(e=>e===null)?{type:`null`}:{};if(e.some(e=>typeof e==`object`&&!!e))throw Error(`This type does not support objects or arrays`);return{default:e[0],...t,[A]:`UnionEnum`,...n,enum:e}},NoValidate:(e,t=!0)=>(e.noValidate=t,e),Form:(e,t={})=>{let n=X.Object(e,{default:Pg({}),...t}),r=n_(n);return X.Union([n,m_({compiler:r})])},ArrayBuffer(e={}){return{default:[1,2,3],...e,[A]:`ArrayBuffer`}},Uint8Array:e=>{let t=Cu.Uint8Array(e),n=n_(t);return X.Transform(X.Union([X.ArrayBuffer(),Cu.Uint8Array(e)])).Decode(e=>{if(e instanceof ArrayBuffer){if(!n.Check(e=new Uint8Array(e)))throw n.Error(e);return e}return e}).Encode(e=>e)}};X.BooleanString=h_.BooleanString,X.ObjectString=h_.ObjectString,X.ArrayString=h_.ArrayString,X.ArrayQuery=h_.ArrayQuery,X.Numeric=h_.Numeric,X.Integer=h_.Integer,X.File=e=>(e?.type&&s_(),h_.File({default:`File`,...e,extension:e?.type,type:`string`,format:`binary`})),X.Files=e=>(e?.type&&s_(),h_.Files({...e,elysiaMeta:`Files`,default:`Files`,extension:e?.type,type:`array`,items:{...e,default:`Files`,type:`string`,format:`binary`}})),X.Nullable=h_.Nullable,X.MaybeEmpty=h_.MaybeEmpty,X.Cookie=h_.Cookie,X.Date=h_.Date,X.UnionEnum=h_.UnionEnum,X.NoValidate=h_.NoValidate,X.Form=h_.Form,X.ArrayBuffer=h_.ArrayBuffer,X.Uint8Array=h_.Uint8Array;var g_=e=>{e.startsWith(`async`)&&(e=e.slice(5)),e=e.trimStart();let t=-1;if(e.charCodeAt(0)===40&&(t=e.indexOf(`=>`,e.indexOf(`)`)),t!==-1)){let n=t;for(;n>0&&e.charCodeAt(--n)!==41;);let r=e.slice(t+2);return r.charCodeAt(0)===32&&(r=r.trimStart()),[e.slice(1,n),r,{isArrowReturn:r.charCodeAt(0)!==123}]}if(/^(\w+)=>/g.test(e)&&(t=e.indexOf(`=>`),t!==-1)){let n=e.slice(t+2);return n.charCodeAt(0)===32&&(n=n.trimStart()),[e.slice(0,t),n,{isArrowReturn:n.charCodeAt(0)!==123}]}if(e.startsWith(`function`)){t=e.indexOf(`(`);let n=e.indexOf(`)`);return[e.slice(t+1,n),e.slice(n+2),{isArrowReturn:!1}]}let n=e.indexOf(`(`);if(n!==-1){let t=e.indexOf(`
`,2),r=e.slice(0,t),i=r.lastIndexOf(`)`)+1,a=e.slice(t+1);return[r.slice(n,i),`{`+a,{isArrowReturn:!1}]}let r=e.split(`
`,2);return[r[0],r[1],{isArrowReturn:!1}]},__=e=>{let t=e.indexOf(`{`);if(t===-1)return[-1,0];let n=t+1,r=1;for(;n<e.length;n++){let t=e.charCodeAt(n);if(t===123?r++:t===125&&r--,r===0)break}return r===0?[t,n+1]:[0,e.length]},v_=e=>{let t=e.lastIndexOf(`}`);if(t===-1)return[-1,0];let n=t-1,r=1;for(;n>=0;n--){let t=e.charCodeAt(n);if(t===125?r++:t===123&&r--,r===0)break}return r===0?[n,t+1]:[-1,0]},y_=e=>{for(;;){let t=e.indexOf(`:`);if(t===-1)break;let n=e.indexOf(`,`,t);n===-1&&(n=e.indexOf(`}`,t)-1),n===-2&&(n=e.length),e=e.slice(0,t)+e.slice(n)}return e},b_=e=>{let t=!1;e.charCodeAt(0)===40&&(e=e.slice(1,-1)),e.charCodeAt(0)===123&&(t=!0,e=e.slice(1,-1)),e=e.replace(/( |\t|\n)/g,``).trim();let n=[];for(;;){let[t,r]=__(e);if(t===-1)break;n.push(e.slice(0,t-1)),e.charCodeAt(r)===44&&r++,e=e.slice(r)}e=y_(e),e&&(n=n.concat(e.split(`,`)));let r=Object.create(null);for(let e of n){if(e.indexOf(`,`)===-1){r[e]=!0;continue}for(let t of e.split(`,`))r[t.trim()]=!0}return{hasParenthesis:t,parameters:r}},x_=(e,t)=>{let{parameters:n,hasParenthesis:r}=b_(e);return n.query&&(t.query=!0),n.headers&&(t.headers=!0),n.body&&(t.body=!0),n.cookie&&(t.cookie=!0),n.set&&(t.set=!0),n.server&&(t.server=!0),n.route&&(t.route=!0),n.url&&(t.url=!0),n.path&&(t.path=!0),r?`{ ${Object.keys(n).join(`, `)} }`:Object.keys(n).join(`, `)},S_=(e,t,n)=>{let r=RegExp(`${e.replace(/[.*+?^${}()|[\]\\]/g,`\\$&`)}[\\n\\t,; ]`);n!==void 0&&(r.lastIndex=n);let i=r.exec(t);return i?i.index:-1},C_=(e,t,n=0)=>{if(n>5)return[];let r=[],i=t;for(;;){let t=S_(` = `+e,i);if(t===-1&&(t=S_(`=`+e,i)),t===-1){let n=i.indexOf(` = `+e);if(n===-1&&(n=i.indexOf(`=`+e)),n+3+e.length!==i.length)break;t=n}let n=i.slice(0,t),a=n.lastIndexOf(` `),o=n.slice(a===-1?-1:a+1);if(o===`}`){let[a,o]=v_(n);r.push(y_(i.slice(a,o))),i=i.slice(t+3+e.length);continue}for(;o.charCodeAt(0)===44;)o=o.slice(1);for(;o.charCodeAt(0)===9;)o=o.slice(1);o.includes(`(`)||r.push(o),i=i.slice(t+3+e.length)}for(let e of r){if(e.charCodeAt(0)===123)continue;let n=C_(e,t);n.length>0&&r.push(...n)}return r},w_=e=>{if(!e)return;if(e.charCodeAt(0)!==123)return e;if(e=e.slice(2,-2),!e.includes(`,`))return e.indexOf(`...`)===-1?void 0:e.slice(e.indexOf(`...`)+3);let t=e.indexOf(`...`);if(t!==-1)return e.slice(t+3).trimEnd()},T_=(e,t,n)=>{let r=(t,n)=>RegExp(`${n}\\.(${t})|${n}\\["${t}"\\]|${n}\\['${t}'\\]`).test(e);for(let i of t)if(i){if(i.charCodeAt(0)===123){let e=b_(i).parameters;e.query&&(n.query=!0),e.headers&&(n.headers=!0),e.body&&(n.body=!0),e.cookie&&(n.cookie=!0),e.set&&(n.set=!0),e.server&&(n.server=!0),e.url&&(n.url=!0),e.route&&(n.route=!0),e.path&&(n.path=!0);continue}if(!n.query&&(r(`query`,i)||e.includes(`return `+i)||e.includes(`return `+i+`.query`))&&(n.query=!0),!n.headers&&r(`headers`,i)&&(n.headers=!0),!n.body&&r(`body`,i)&&(n.body=!0),!n.cookie&&r(`cookie`,i)&&(n.cookie=!0),!n.set&&r(`set`,i)&&(n.set=!0),!n.server&&r(`server`,i)&&(n.server=!0),!n.route&&r(`route`,i)&&(n.route=!0),!n.url&&r(`url`,i)&&(n.url=!0),!n.path&&r(`path`,i)&&(n.path=!0),n.query&&n.headers&&n.body&&n.cookie&&n.set&&n.server&&n.route&&n.url&&n.path)break}return t},E_=(e,t,n)=>{try{let r=RegExp(`\\w\\((.*?)?${e}`,`gs`);r.test(t);let i=t.charCodeAt(r.lastIndex);return i===41||i===44?(n.query=!0,n.headers=!0,n.body=!0,n.cookie=!0,n.set=!0,n.server=!0,n.url=!0,n.route=!0,n.path=!0,!0):!1}catch{return console.log(`[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:`),console.log(`--- body ---`),console.log(t),console.log(`--- context ---`),console.log(e),!0}},D_,O_={},k_=(e=0)=>{D_&&clearTimeout(D_),D_=setTimeout(()=>{O_={},D_=void 0,Kh&&Bun.gc(!1)},e)},A_=(e,t)=>({body:e.body||t.body,cookie:e.cookie||t.cookie,headers:e.headers||t.headers,query:e.query||t.query,set:e.set||t.set,server:e.server||t.server,url:e.url||t.url,route:e.route||t.route,path:e.path||t.path}),j_=(e,t={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1})=>{let n=[];e.request?.length&&n.push(...e.request),e.beforeHandle?.length&&n.push(...e.beforeHandle),e.parse?.length&&n.push(...e.parse),e.error?.length&&n.push(...e.error),e.transform?.length&&n.push(...e.transform),e.afterHandle?.length&&n.push(...e.afterHandle),e.mapResponse?.length&&n.push(...e.mapResponse),e.afterResponse?.length&&n.push(...e.afterResponse),e.handler&&typeof e.handler==`function`&&n.push(e.handler);for(let e=0;e<n.length;e++){let r=n[e];if(!r)continue;let i=typeof r==`object`?r.fn:r;if(typeof i!=`function`)continue;let a=i.toString(),o=dg(a),s=O_[o];if(s){t=A_(t,s);continue}let c={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},[l,u]=g_(a),d=x_(l,c),f=w_(d);if(f){let e=C_(f,u.slice(1,-1));e.splice(0,-1,f);let t=u;t.charCodeAt(0)===123&&t.charCodeAt(u.length-1)===125&&(t=t.slice(1,-1)),E_(f,t,c)||T_(t,e,c),!c.query&&t.includes(`return `+f+`.query`)&&(c.query=!0)}if(O_[o]||(O_[o]=c),t=A_(t,c),t.query&&t.headers&&t.body&&t.cookie&&t.set&&t.server&&t.url&&t.route&&t.path)break}return t},M_=class{constructor(e,t,n={}){this.name=e,this.jar=t,this.initial=n}get cookie(){return this.jar[this.name]??this.initial}set cookie(e){this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]=e}get setCookie(){return this.name in this.jar||(this.jar[this.name]=this.initial),this.jar[this.name]}set setCookie(e){this.cookie=e}get value(){return this.cookie.value}set value(e){this.setCookie.value=e}get expires(){return this.cookie.expires}set expires(e){this.setCookie.expires=e}get maxAge(){return this.cookie.maxAge}set maxAge(e){this.setCookie.maxAge=e}get domain(){return this.cookie.domain}set domain(e){this.setCookie.domain=e}get path(){return this.cookie.path}set path(e){this.setCookie.path=e}get secure(){return this.cookie.secure}set secure(e){this.setCookie.secure=e}get httpOnly(){return this.cookie.httpOnly}set httpOnly(e){this.setCookie.httpOnly=e}get sameSite(){return this.cookie.sameSite}set sameSite(e){this.setCookie.sameSite=e}get priority(){return this.cookie.priority}set priority(e){this.setCookie.priority=e}get partitioned(){return this.cookie.partitioned}set partitioned(e){this.setCookie.partitioned=e}get secrets(){return this.cookie.secrets}set secrets(e){this.setCookie.secrets=e}update(e){return this.setCookie=Object.assign(this.cookie,typeof e==`function`?e(this.cookie):e),this}set(e){return this.setCookie=Object.assign({...this.initial,value:this.value},typeof e==`function`?e(this.cookie):e),this}remove(){if(this.value!==void 0)return this.set({expires:new Date(0),maxAge:0,value:``}),this}toString(){return typeof this.value==`object`?JSON.stringify(this.value):this.value?.toString()??``}},N_=(e,t,n)=>(e.cookie||={},new Proxy(t,{get(r,i){return i in t?new M_(i,e.cookie,Object.assign({},n??{},t[i])):new M_(i,e.cookie,Object.assign({},n))}})),P_=async(e,t,{secrets:n,sign:r,...i}={})=>{if(!t)return N_(e,{},i);let a=typeof n==`string`;r&&r!==!0&&!Array.isArray(r)&&(r=[r]);let o={},s=(0,uh.parse)(t);for(let[e,t]of Object.entries(s)){if(t===void 0)continue;let i=(0,dh.default)(t);if(i){let e=i.charCodeAt(0),t=i.charCodeAt(i.length-1);if(e===123&&t===125||e===91&&t===93)try{i=JSON.parse(i)}catch{}}if(r===!0||r?.includes(e)){if(!n)throw Error(`No secret is provided to cookie plugin`);if(a){let t=await Sg(i,n);if(t===!1)throw new Zg(e);i=t}else{let t=!0;for(let e=0;e<n.length;e++){let r=await Sg(i,n[e]);if(r!==!1){t=!0,i=r;break}}if(!t)throw new Zg(e)}}o[e]={value:i}}return N_(e,o,i)},F_=e=>{if(!e||!J(e))return;let t=[];for(let[n,r]of Object.entries(e)){if(!n||!r)continue;let e=r.value;e!=null&&t.push((0,uh.serialize)(n,typeof e==`object`?JSON.stringify(e):e+``,r))}if(t.length!==0)return t.length===1?t[0]:t},Z=(e,t)=>{if(!Kh&&e instanceof Promise)return e.then(e=>Z(e,t));let n=e.size,r=t&&(t.status===206||t.status===304||t.status===412||t.status===416),i=r?{"transfer-encoding":`chunked`}:{"accept-ranges":`bytes`,"content-range":n?`bytes 0-${n-1}/${n}`:void 0,"transfer-encoding":`chunked`};if(!t&&!n)return new Response(e);if(!t)return new Response(e,{headers:i});if(t.headers instanceof Headers){for(let e of Object.keys(i))e in t.headers&&t.headers.append(e,i[e]);return r&&(t.headers.delete(`content-length`),t.headers.delete(`accept-ranges`)),new Response(e,t)}return J(t.headers)?new Response(e,{status:t.status,headers:Object.assign(i,t.headers)}):new Response(e,{status:t.status,headers:i})},I_=(e,t)=>{if(!e)return e;e.delete(`set-cookie`);for(let n=0;n<t.length;n++){let r=t[n].indexOf(`=`);e.append(`set-cookie`,`${t[n].slice(0,r)}=${t[n].slice(r+1)||``}`)}return e},L_=(e,t)=>{if(t?.headers){if(e)if(Qh)Object.assign(t.headers,e.headers.toJSON());else for(let[n,r]of e.headers.entries())n in t.headers&&(t.headers[n]=r);return t.status===200&&(t.status=e.status),t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t}if(!e)return{headers:{},status:t?.status??200};if(Qh)return t={headers:e.headers.toJSON(),status:t?.status??200},t.headers[`content-encoding`]&&delete t.headers[`content-encoding`],t;t={headers:{},status:t?.status??200};for(let[n,r]of e.headers.entries())n!==`content-encoding`&&n in t.headers&&(t.headers[n]=r);return t},R_=({mapResponse:e,mapCompactResponse:t})=>async(n,r,i)=>{let a=n.next?.();if(a instanceof Promise&&(a=await a),a?.value instanceof ReadableStream)n=a.value;else if(a&&(typeof a?.done>`u`||a?.done))return r?e(a.value,r,i):t(a.value,i);let o=a?.value?.sse??n?.sse??r?.headers[`content-type`]?.startsWith(`text/event-stream`),s=o?e=>`data: ${e}

`:e=>e,c=o?`text/event-stream`:a?.value&&typeof a?.value==`object`?`application/json`:`text/plain`;return r?.headers?(r.headers[`transfer-encoding`]||(r.headers[`transfer-encoding`]=`chunked`),r.headers[`content-type`]||(r.headers[`content-type`]=c),r.headers[`cache-control`]||(r.headers[`cache-control`]=`no-cache`)):r={status:200,headers:{"content-type":c,"transfer-encoding":`chunked`,"cache-control":`no-cache`,connection:`keep-alive`}},new Response(new ReadableStream({async start(e){let t=!1;if(i?.signal?.addEventListener(`abort`,()=>{t=!0;try{e.close()}catch{}}),!(!a||a.value instanceof ReadableStream)&&a.value!==void 0&&a.value!==null)if(a.value.toSSE)e.enqueue(a.value.toSSE());else if(typeof a.value==`object`)try{e.enqueue(s(JSON.stringify(a.value)))}catch{e.enqueue(s(a.value.toString()))}else e.enqueue(s(a.value.toString()));try{for await(let r of n){if(t)break;if(r!=null)if(r.toSSE)e.enqueue(r.toSSE());else{if(typeof r==`object`)try{e.enqueue(s(JSON.stringify(r)))}catch{e.enqueue(s(r.toString()))}else e.enqueue(s(r.toString()));o||await new Promise(e=>setTimeout(()=>e(),0))}}}catch(e){console.warn(e)}try{e.close()}catch{}}}),r)};async function*z_(e){let t=e.body;if(!t)return;let n=t.getReader(),r=new TextDecoder;try{for(;;){let{done:e,value:t}=await n.read();if(e)break;typeof t==`string`?yield t:yield r.decode(t)}}finally{n.releaseLock()}}var B_=e=>{if(typeof e.status==`string`&&(e.status=_g[e.status]),e.cookie&&J(e.cookie)){let t=F_(e.cookie);t&&(e.headers[`set-cookie`]=t)}e.headers[`set-cookie`]&&Array.isArray(e.headers[`set-cookie`])&&(e.headers=I_(new Headers(e.headers),e.headers[`set-cookie`]))},V_=e=>{let t=R_(e);return(e,n,r)=>{let i=!1;if(n.headers instanceof Headers)for(let t of n.headers.keys())if(t===`set-cookie`){if(i)continue;i=!0;for(let t of n.headers.getSetCookie())e.headers.append(`set-cookie`,t)}else e.headers.append(t,n.headers?.get(t)??``);else for(let t in n.headers)e.headers.append(t,n.headers[t]);let a=n.status??200;return e.status!==a&&a!==200&&(e.status<=300||e.status>400)?e.text().then(i=>{let a=new Response(i,{headers:e.headers,status:n.status});return!a.headers.has(`content-length`)&&a.headers.get(`transfer-encoding`)===`chunked`?t(z_(a),L_(a,n),r):a}):!e.headers.has(`content-length`)&&e.headers.get(`transfer-encoding`)===`chunked`?t(z_(e),L_(e,n),r):e}},H_=(e,t={headers:{}})=>{let n=e.path,r=qh[n.slice(n.lastIndexOf(`.`)+1)];return r&&(t.headers[`content-type`]=r),e.stats&&t.status!==206&&t.status!==304&&t.status!==412&&t.status!==416?e.stats.then(n=>{let r=n.size;return r!==void 0&&(t.headers[`content-range`]=`bytes 0-${r-1}/${r}`,t.headers[`content-length`]=r),Z(e.value,t)}):Z(e.value,t)},U_=(e,t,n)=>{if(J(t.headers)||t.status!==200||t.cookie)switch(B_(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return H_(e,t);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,U_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return J_(e,t,n);case`Error`:return K_(e,t);case`Promise`:return e.then(e=>U_(e,t,n));case`Function`:return U_(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return J_(e,t,n);if(e instanceof Promise)return e.then(e=>U_(e,t));if(e instanceof Error)return K_(e,t);if(e instanceof qg)return t.status=e.code,U_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return Y_(e,t,n);if(typeof e?.then==`function`)return e.then(e=>U_(e,t));if(typeof e?.toResponse==`function`)return U_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return typeof e?.next==`function`||e instanceof ReadableStream?Y_(e,t,n):G_(e,n)},W_=(e,t,n)=>{if(e!=null)if(J(t.headers)||t.status!==200||t.cookie)switch(B_(t),e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return H_(e,t);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,W_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return J_(e,t,n);case`Promise`:return e.then(e=>W_(e,t));case`Error`:return K_(e,t);case`Function`:return W_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return J_(e,t,n);if(e instanceof Promise)return e.then(e=>W_(e,t));if(e instanceof Error)return K_(e,t);if(e instanceof qg)return t.status=e.code,W_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return Y_(e,t,n);if(typeof e?.then==`function`)return e.then(e=>W_(e,t));if(typeof e?.toResponse==`function`)return W_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return t.headers[`content-type`]=`text/plain`,new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return H_(e,t);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,W_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Promise`:return e.then(e=>{let n=W_(e,t);if(n!==void 0)return n});case`Error`:return K_(e,t);case`Function`:return G_(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>W_(e,t));if(e instanceof Error)return K_(e,t);if(e instanceof qg)return t.status=e.code,W_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return Y_(e,t,n);if(typeof e?.then==`function`)return e.then(e=>W_(e,t));if(typeof e?.toResponse==`function`)return W_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},G_=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e,{headers:{"Content-Type":`text/plain`}});case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return H_(e);case`File`:return Z(e);case`Blob`:return Z(e);case`ElysiaCustomStatusResponse`:return U_(e.response,{status:e.code,headers:{}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Error`:return K_(e);case`Promise`:return e.then(e=>G_(e,t));case`Function`:return G_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>G_(e,t));if(e instanceof Error)return K_(e);if(e instanceof qg)return U_(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`||e instanceof ReadableStream)return Y_(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>U_(e,set));if(typeof e?.toResponse==`function`)return G_(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},K_=(e,t)=>new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status===200?500:t?.status??500,headers:t?.headers}),q_=(e,t,n={})=>{if(typeof e==`function`)return;let r=U_(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return()=>r.clone()},J_=V_({mapResponse:U_,mapCompactResponse:G_}),Y_=R_({mapResponse:U_,mapCompactResponse:G_}),X_={name:`web-standard`,isWebStandard:!0,handler:{mapResponse:U_,mapEarlyResponse:W_,mapCompactResponse:G_,createStaticHandler:q_},composeHandler:{mapResponseContext:`c.request`,preferWebstandardHeaders:!0,headers:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`,parser:{json(e){return e?`try{c.body=await c.request.json()}catch{}
`:`c.body=await c.request.json()
`},text(){return`c.body=await c.request.text()
`},urlencoded(){return`c.body=parseQuery(await c.request.text())
`},arrayBuffer(){return`c.body=await c.request.arrayBuffer()
`},formData(e){let t=`
c.body={}
`;return e?t+=`let form;try{form=await c.request.formData()}catch{}`:t+=`const form=await c.request.formData()
`,t+`for(const key of form.keys()){if(c.body[key]) continue
const value=form.getAll(key)
if(value.length===1)c.body[key]=value[0]
else c.body[key]=value}`}}},async stop(e,t){if(!e.server)throw Error("Elysia isn't running. Call `app.listen` to start the server.");if(e.server&&(e.server.stop(t),e.server=null,e.event.stop?.length))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)},composeGeneralHandler:{parameters:`r`,createContext(e){let t=``,n=``,r=e.setHeaders;for(let n of Object.keys(e.decorator))t+=`,'${n}':decorator['${n}']`;let i=e.config.handler?.standardHostname??!0,a=!!e.event.trace?.length;return n+=`const u=r.url,s=u.indexOf('/',${i?11:7}),qi=u.indexOf('?',s+1)
let p
if(qi===-1)p=u.substring(s)
else p=u.substring(s, qi)
`,a&&(n+=`const id=randomId()
`),n+=`const c={request:r,store,qi,path:p,url:u,redirect,status,set:{headers:`,n+=Object.keys(r??{}).length?`Object.assign({},app.setHeaders)`:`Object.create(null)`,n+=`,status:200}`,e.inference.server&&(n+=`,get server(){return app.getServer()}`),a&&(n+=`,[ELYSIA_REQUEST_ID]:id`),n+=t,n+=`}
`,n},error404(e,t,n=``){let r=`if(route===null){`+n+`
return `;return t?r+=`app.handleError(c,notFound,false,${this.parameters})`:r+=e?`new Response(error404Message,{status:c.set.status===200?404:c.set.status,headers:c.set.headers})`:`error404.clone()`,r+=`}`,{declare:t?``:`const error404Message=notFound.message.toString()
const error404=new Response(error404Message,{status:404})
`,code:r}}},composeError:{mapResponseContext:``,validationError:`return new Response(error.message,{headers:Object.assign({'content-type':'application/json'},set.headers),status:set.status})`,unknownError:`return new Response(error.message,{headers:set.headers,status:error.status??set.status??500})`},listen(){return()=>{throw Error(`WebStandard does not support listen, you might want to export default Elysia.fetch instead`)}}},Z_=(e,t,n)=>{if(J(t.headers)||t.status!==200||t.cookie)switch(B_(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Z(e.value);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Z_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):new Response(``,t);case`Response`:return nv(e,t,n);case`Error`:return ev(e,t);case`Promise`:return e.then(e=>Z_(e,t,n));case`Function`:return Z_(e(),t,n);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e,t);default:if(e instanceof Response)return nv(e,t,n);if(e instanceof Promise)return e.then(e=>Z_(e,t));if(e instanceof Error)return ev(e,t);if(e instanceof qg)return t.status=e.code,Z_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return rv(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Z_(e,t));if(typeof e?.toResponse==`function`)return Z_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}return typeof e?.next==`function`||e instanceof ReadableStream?rv(e,t,n):$_(e,n)},Q_=(e,t,n)=>{if(e!=null)if(J(t.headers)||t.status!==200||t.cookie)switch(B_(t),e?.constructor?.name){case`String`:return new Response(e,t);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Z(e.value);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Q_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),t):void 0;case`Response`:return nv(e,t,n);case`Promise`:return e.then(e=>Q_(e,t));case`Error`:return ev(e,t);case`Function`:return Q_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString(),t);case`FormData`:return new Response(e);case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);default:if(e instanceof Response)return nv(e,t,n);if(e instanceof Promise)return e.then(e=>Q_(e,t));if(e instanceof Error)return ev(e,t);if(e instanceof qg)return t.status=e.code,Q_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return rv(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Q_(e,t));if(typeof e?.toResponse==`function`)return Q_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e,t)}else switch(e?.constructor?.name){case`String`:return new Response(e);case`Array`:case`Object`:return t.headers[`content-type`]=`application/json`,new Response(JSON.stringify(e),t);case`ElysiaFile`:return Z(e.value);case`File`:return Z(e,t);case`Blob`:return Z(e,t);case`ElysiaCustomStatusResponse`:return t.status=e.code,Q_(e.response,t,n);case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Promise`:return e.then(e=>{let n=Q_(e,t);if(n!==void 0)return n});case`Error`:return ev(e,t);case`Function`:return $_(e(),n);case`Number`:case`Boolean`:return new Response(e.toString());case`Cookie`:return e instanceof M_?new Response(e.value,t):new Response(e?.toString(),t);case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>Q_(e,t));if(e instanceof Error)return ev(e,t);if(e instanceof qg)return t.status=e.code,Q_(e.response,t,n);if(typeof e?.next==`function`||e instanceof ReadableStream)return rv(e,t,n);if(typeof e?.then==`function`)return e.then(e=>Q_(e,t));if(typeof e?.toResponse==`function`)return Q_(e.toResponse(),t);if(`charCodeAt`in e){let n=e.charCodeAt(0);if(n===123||n===91)return t.headers[`Content-Type`]||(t.headers[`Content-Type`]=`application/json`),new Response(JSON.stringify(e),t)}return new Response(e)}},$_=(e,t)=>{switch(e?.constructor?.name){case`String`:return new Response(e);case`Object`:case`Array`:return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}});case`ElysiaFile`:return Z(e.value);case`File`:return Z(e);case`Blob`:return Z(e);case`ElysiaCustomStatusResponse`:return Z_(e.response,{status:e.code,headers:{}});case void 0:return e?new Response(JSON.stringify(e),{headers:{"content-type":`application/json`}}):new Response(``);case`Response`:return e;case`Error`:return ev(e);case`Promise`:return e.then(e=>$_(e,t));case`Function`:return $_(e(),t);case`Number`:case`Boolean`:return new Response(e.toString());case`FormData`:return new Response(e);default:if(e instanceof Response)return e;if(e instanceof Promise)return e.then(e=>$_(e,t));if(e instanceof Error)return ev(e);if(e instanceof qg)return Z_(e.response,{status:e.code,headers:{}});if(typeof e?.next==`function`||e instanceof ReadableStream)return rv(e,void 0,t);if(typeof e?.then==`function`)return e.then(e=>Z_(e,set));if(typeof e?.toResponse==`function`)return $_(e.toResponse());if(`charCodeAt`in e){let t=e.charCodeAt(0);if(t===123||t===91)return new Response(JSON.stringify(e),{headers:{"Content-Type":`application/json`}})}return new Response(e)}},ev=(e,t)=>new Response(JSON.stringify({name:e?.name,message:e?.message,cause:e?.cause}),{status:t?.status===200?500:t?.status??500,headers:t?.headers}),tv=(e,t,n={})=>{if(typeof e==`function`)return;let r=Z_(e,{headers:n});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return()=>r.clone()},nv=V_({mapResponse:Z_,mapCompactResponse:$_}),rv=R_({mapResponse:Z_,mapCompactResponse:$_});function iv(e,t=0,n,r){let i=Object.create(null),a=0,o=e.length,s=t-1,c=s;for(let t=0;t<o;t++)switch(e.charCodeAt(t)){case 38:l(e,t),s=t,c=t,a=0;break;case 61:c<=s?c=t:a|=8;break;case 43:c>s?a|=4:a|=1;break;case 37:c>s?a|=8:a|=2;break}return s<o&&l(e,o),i;function l(e,t){let o=c>s,l=o?c:t,u=e.slice(s+1,l);if(!o&&u.length===0)return;let d=u;a&1&&(d=d.replace(/\+/g,` `)),a&2&&(d=(0,ph.default)(d)||d);let f=``;if(o){let n=e.slice(c+1,t);a&4&&(n=n.replace(/\+/g,` `)),a&8&&(n=(0,ph.default)(n)||n),f=n}let p=i[d];n?.[d]?f.charCodeAt(0)===91?(f=r?.[d]?JSON.parse(f):f.slice(1,-1).split(`,`),p===void 0?i[d]=f:Array.isArray(p)?p.push(...f):(i[d]=f,i[d].unshift(p))):p===void 0?i[d]=f:Array.isArray(p)?p.push(f):i[d]=[p,f]:i[d]=f}}function av(e,t=0){let n=Object.create(null),r=0,i=e.length,a=t-1,o=a;for(let t=0;t<i;t++)switch(e.charCodeAt(t)){case 38:s(e,t),a=t,o=t,r=0;break;case 61:o<=a?o=t:r|=8;break;case 43:o>a?r|=4:r|=1;break;case 37:o>a?r|=8:r|=2;break}return a<i&&s(e,i),n;function s(e,t){let i=o>a,s=i?o:t,c=e.slice(a+1,s);if(!i&&c.length===0)return;let l=c;r&1&&(l=l.replace(/\+/g,` `)),r&2&&(l=(0,ph.default)(l)||l);let u=``;if(i){let n=e.slice(o+1,t);r&4&&(n=n.replace(/\+/g,` `)),r&8&&(n=(0,ph.default)(n)||n),u=n}let d=n[l];if(u.charCodeAt(0)===91&&u.charCodeAt(u.length-1)===93){try{u=JSON.parse(u)}catch{}d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}else if(u.charCodeAt(0)===123&&u.charCodeAt(u.length-1)===125){try{u=JSON.parse(u)}catch{}d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}else u.includes(`,`)&&(u=u.split(`,`)),d===void 0?n[l]=u:Array.isArray(d)?d.push(u):n[l]=[d,u]}}function ov(e){let t=Object.create(null),n=0,r=e.length,i=-1,a=-1;for(let t=0;t<r;t++)switch(e.charCodeAt(t)){case 38:o(e,t),i=t,a=t,n=0;break;case 61:a<=i?a=t:n|=8;break;case 43:a>i?n|=4:n|=1;break;case 37:a>i?n|=8:n|=2;break}return i<r&&o(e,r),t;function o(e,r){let o=a>i,s=o?a:r,c=e.slice(i+1,s);if(!o&&c.length===0)return;let l=c;n&1&&(l=l.replace(/\+/g,` `)),n&2&&(l=(0,ph.default)(l)||l);let u=``;if(o){let t=e.slice(a+1,r);n&4&&(t=t.replace(/\+/g,` `)),n&8&&(t=(0,ph.default)(t)||t),u=t}let d=t[l];d===void 0?t[l]=u:Array.isArray(d)?d.push(u):t[l]=[d,u]}}var sv=Symbol(`ElysiaTrace`),cv=()=>{let{promise:e,resolve:t}=Promise.withResolvers(),{promise:n,resolve:r}=Promise.withResolvers(),{promise:i,resolve:a}=Promise.withResolvers(),o=[],s=[];return[t=>(t&&o.push(t),e),e=>{let c=[],l=[],u=null;for(let t=0;t<(e.total??0);t++){let{promise:e,resolve:n}=Promise.withResolvers(),{promise:r,resolve:i}=Promise.withResolvers(),{promise:a,resolve:o}=Promise.withResolvers(),s=[],d=[];c.push(t=>(t&&s.push(t),e)),l.push(e=>{let c={...e,end:r,error:a,index:t,onStop(e){return e&&d.push(e),r}};n(c);for(let e=0;e<s.length;e++)s[e](c);return(t=null)=>{let n=performance.now();t&&(u=t);let r={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<d.length;e++)d[e](r);i(n),o(t)}})}let d={...e,end:n,error:i,onEvent(e){for(let t=0;t<c.length;t++)c[t](e)},onStop(e){return e&&s.push(e),n}};t(d);for(let e=0;e<o.length;e++)o[e](d);return{resolveChild:l,resolve(t=null){let n=performance.now();!t&&u&&(t=u);let i={end:n,error:t,get elapsed(){return n-e.begin}};for(let e=0;e<s.length;e++)s[e](i);r(n),a(t)}}}]},lv=e=>t=>{let[n,r]=cv(),[i,a]=cv(),[o,s]=cv(),[c,l]=cv(),[u,d]=cv(),[f,p]=cv(),[m,h]=cv(),[g,_]=cv(),[ee,te]=cv();return e({id:t[Ng],context:t,set:t.set,onRequest:n,onParse:i,onTransform:o,onBeforeHandle:c,onHandle:u,onAfterHandle:f,onMapResponse:g,onAfterResponse:ee,onError:m,time:Date.now(),store:t.store}),{request:r,parse:a,transform:s,beforeHandle:l,handle:d,afterHandle:p,error:h,mapResponse:_,afterResponse:te}},uv=e=>e?e?.[A]===`Import`&&e.References?e.References().some(uv):(e.schema&&(e=e.schema),!!e&&Ye in e):!1,dv=e=>{if(!e)return!1;let t=e?.schema??e;if(t[A]===`Import`&&e.References)return e.References().some(dv);if(t.anyOf)return t.anyOf.some(dv);if(t.someOf)return t.someOf.some(dv);if(t.allOf)return t.allOf.some(dv);if(t.not)return t.not.some(dv);if(t.type===`object`){let e=t.properties;if(`additionalProperties`in t)return t.additionalProperties;if(`patternProperties`in t)return!1;for(let t of Object.keys(e)){let n=e[t];if(n.type===`object`){if(dv(n))return!0}else if(n.anyOf){for(let e=0;e<n.anyOf.length;e++)if(dv(n.anyOf[e]))return!0}return n.additionalProperties}return!1}return t.type===`array`&&t.items&&!Array.isArray(t.items)?dv(t.items):!1},fv=(e,t)=>{if(!t)return!1;if(A in t&&t[A]===e)return!0;if(t.type===`object`){let n=t.properties;if(!n)return!1;for(let t of Object.keys(n)){let r=n[t];if(r.type===`object`){if(fv(e,r))return!0}else if(r.anyOf){for(let t=0;t<r.anyOf.length;t++)if(fv(e,r.anyOf[t]))return!0}if(A in r&&r[A]===e)return!0}return!1}return!!t.properties&&A in t.properties&&t.properties[A]===e},pv=(e,t)=>{if(!t)return!1;let n=t?.schema??t;if(n.elysiaMeta===e)return!0;if(n[A]===`Import`&&t.References)return t.References().some(t=>pv(e,t));if(n.anyOf)return n.anyOf.some(t=>pv(e,t));if(n.someOf)return n.someOf.some(t=>pv(e,t));if(n.allOf)return n.allOf.some(t=>pv(e,t));if(n.not)return n.not.some(t=>pv(e,t));if(n.type===`object`){let t=n.properties;for(let r of Object.keys(t)){let i=t[r];if(i.type===`object`){if(pv(e,i))return!0}else if(i.anyOf){for(let t=0;t<i.anyOf.length;t++)if(pv(e,i.anyOf[t]))return!0}return n.elysiaMeta===e}return!1}return n.type===`array`&&n.items&&!Array.isArray(n.items)?pv(e,n.items):!1},mv=(e,t)=>{if(!t)return;let n=t.schema??t;if(n[A]===`Import`&&t.References)return t.References().some(t=>mv(e,t));if(n.type===`object`){let t=n.properties;if(!t)return!1;for(let n of Object.keys(t)){let r=t[n];if(e in r)return!0;if(r.type===`object`){if(mv(e,r))return!0}else if(r.anyOf){for(let t=0;t<r.anyOf.length;t++)if(mv(e,r.anyOf[t]))return!0}}return!1}return e in n},hv=e=>{if(!e)return!1;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(hv(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(hv(e.anyOf[t]))return!0}if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(hv(e.oneOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(hv(e.allOf[t]))return!0}if(e.not&&hv(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(hv(n)||n.type===`array`&&n.items&&hv(n.items))return!0}}return e.type===`array`&&e.items&&hv(e.items)?!0:e[A]===`Ref`&&`$ref`in e},gv=e=>{if(!e)return!1;if(e.$ref&&e.$defs&&e.$ref in e.$defs&&gv(e.$defs[e.$ref]))return!0;if(e.oneOf){for(let t=0;t<e.oneOf.length;t++)if(gv(e.oneOf[t]))return!0}if(e.anyOf){for(let t=0;t<e.anyOf.length;t++)if(gv(e.anyOf[t]))return!0}if(e.allOf){for(let t=0;t<e.allOf.length;t++)if(gv(e.allOf[t]))return!0}if(e.not&&gv(e.not))return!0;if(e.type===`object`&&e.properties){let t=e.properties;for(let e of Object.keys(t)){let n=t[e];if(gv(n)||n.type===`array`&&n.items&&gv(n.items))return!0}}return e.type===`array`&&e.items&&gv(e.items)?!0:qe in e},_v=(e,t,n={})=>{let r=n;if(r.root=!0,!Array.isArray(t))return t.original=e,vv(e,t,r);for(let n of t)n.original=e,e=vv(e,n,r);return e},vv=(e,t,n)=>{if(!e)return e;let r=n.root;if(t.onlyFirst&&e.type===t.onlyFirst)return t.to(e)??e;if(t.untilObjectFound&&!r&&e.type===`object`)return e;let i=t.from[A];if(e.oneOf){for(let r=0;r<e.oneOf.length;r++)e.oneOf[r]=vv(e.oneOf[r],t,n);return e}if(e.anyOf){for(let r=0;r<e.anyOf.length;r++)e.anyOf[r]=vv(e.anyOf[r],t,n);return e}if(e.allOf){for(let r=0;r<e.allOf.length;r++)e.allOf[r]=vv(e.allOf[r],t,n);return e}if(e.not)return vv(e.not,t,n);let a=r&&!!t.excludeRoot;if(e[A]===i){let{anyOf:r,oneOf:i,allOf:o,not:s,properties:c,items:l,...u}=e,d=t.to(u);if(!d)return e;let f,p=e=>{let t=m(e);return t.$id&&delete t.$id,t},m=e=>{if(c&&e.type===`object`){let r={};for(let[e,i]of Object.entries(c))r[e]=vv(i,t,{...n,root:!1});return{...u,...e,properties:r}}if(l&&e.type===`array`)return{...u,...e,items:vv(l,t,{...n,root:!1})};let r={...u,...e};return delete r.required,c&&e.type===`string`&&e.format===`ObjectString`&&e.default===`{}`?(f=X.ObjectString(c,u),r.properties=c):l&&e.type===`string`&&e.format===`ArrayString`&&e.default===`[]`&&(f=X.ArrayString(l,u),r.items=l),r};if(a){if(c){let e={};for(let[r,i]of Object.entries(c))e[r]=vv(i,t,{...n,root:!1});return{...u,properties:e}}else if(l?.map)return{...u,items:l.map(e=>vv(e,t,{...n,root:!1}))};return u}if(d.anyOf)for(let e=0;e<d.anyOf.length;e++)d.anyOf[e]=p(d.anyOf[e]);else if(d.oneOf)for(let e=0;e<d.oneOf.length;e++)d.oneOf[e]=p(d.oneOf[e]);else if(d.allOf)for(let e=0;e<d.allOf.length;e++)d.allOf[e]=p(d.allOf[e]);else d.not&&=p(d.not);if(f&&(d[qe]=f[qe]),d.anyOf||d.oneOf||d.allOf||d.not)return d;if(c){let e={};for(let[r,i]of Object.entries(c))e[r]=vv(i,t,{...n,root:!1});return{...u,...d,properties:e}}else if(l?.map)return{...u,...d,items:l.map(e=>vv(e,t,{...n,root:!1}))};return{...u,...d}}let o=e?.properties;if(o&&r&&t.rootOnly!==!0)for(let[r,a]of Object.entries(o))switch(a[A]){case i:let{anyOf:s,oneOf:c,allOf:l,not:u,type:d,...f}=a,p=t.to(f);if(!p)return e;if(p.anyOf)for(let e=0;e<p.anyOf.length;e++)p.anyOf[e]={...f,...p.anyOf[e]};else if(p.oneOf)for(let e=0;e<p.oneOf.length;e++)p.oneOf[e]={...f,...p.oneOf[e]};else if(p.allOf)for(let e=0;e<p.allOf.length;e++)p.allOf[e]={...f,...p.allOf[e]};else p.not&&={...f,...p.not};o[r]={...f,...vv(f,t,{...n,root:!1})};break;case`Object`:case`Union`:o[r]=vv(a,t,{...n,root:!1});break;default:if(Array.isArray(a.items))for(let e=0;e<a.items.length;e++)a.items[e]=vv(a.items[e],t,{...n,root:!1});else a.anyOf||a.oneOf||a.allOf||a.not?o[r]=vv(a,t,{...n,root:!1}):a.type===`array`&&(a.items=vv(a.items,t,{...n,root:!1}));break}return e.type===`array`&&e.items&&(Array.isArray(e.items)?e.items=e.items.map(e=>vv(e,t,{...n,root:!1})):e.items=vv(e.items,t,{...n,root:!1})),e},yv=e=>t=>{if(typeof t==`object`)try{return Ap(e,t)}catch{}return t},bv=(e,{models:t={},dynamic:n=!1,modules:r,normalize:i=!1,additionalProperties:a=!1,forceAdditionalProperties:o=!1,coerce:s=!1,additionalCoerce:c=[],validators:l,sanitize:u}={})=>{if(l=l?.filter(e=>e),!e){if(!l?.length)return;e=l[0],l=l.slice(1)}let d=e=>s?_v(e,[{from:X.Number(),to:e=>X.Numeric(e),untilObjectFound:!0},{from:X.Boolean(),to:e=>X.BooleanString(e),untilObjectFound:!0},...Array.isArray(c)?c:[c]]):_v(e,c),f=e=>{if(e&&typeof e!=`string`&&`~standard`in e)return e;if(!e)return;let n;if(typeof e!=`string`)n=e;else if(n=r&&e in r.$defs?r.Import(e):t[e],!n)return;if(A in n)if(n[A]===`Import`)hv(n.$defs[n.$ref])||(n=n.$defs[n.$ref],(s||c)&&(n=d(n)));else if(hv(n)){let e=Fg();n=X.Module({...r?.$defs,[e]:n}).Import(e)}else (s||c)&&(n=d(n));return n},p=f(e),m=l;if(`~standard`in p||l?.length&&l.some(e=>e&&typeof e!=`string`&&`~standard`in e)){let e=e=>{let a;if(i===!0||i===`exactMirror`)try{a=ch(e,{TypeCompiler:Jm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(e),a=yv(e)}let o=bv(e,{models:t,modules:r,dynamic:n,normalize:i,additionalProperties:!0,forceAdditionalProperties:!0,coerce:s,additionalCoerce:c});return o.Decode=a,e=>o.Check(e)?{value:o.Decode(e)}:{issues:[...o.Errors(e)]}},a=p[`~standard`]?p[`~standard`].validate:e(p),o=[];if(l?.length){for(let t of l)if(t&&typeof t!=`string`){if(t?.[`~standard`]){o.push(t[`~standard`]);continue}if(A in t){o.push(e(t));continue}}}async function d(e){let t=a(e);if(t instanceof Promise&&(t=await t),t.issues)return t;let n=[];t&&typeof t==`object`&&n.push(t.value);for(let r=0;r<o.length;r++){if(t=o[r].validate(e),t instanceof Promise&&(t=await t),t.issues)return t;t&&typeof t==`object`&&n.push(t.value)}if(!n.length)return{value:t};if(n.length===1)return{value:n[0]};if(n.length===2)return{value:ng(n[0],n[1])};let r=ng(n[0],n[1]);for(let e=2;e<n.length;e++)r=ng(r,n[e]);return{value:r}}let f={provider:`standard`,schema:p,references:``,checkFunc:()=>{},code:``,Check:d,Errors:e=>d(e)?.then?.(e=>e?.issues),Code:()=>``,Decode:d,Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return f.parse=e=>{try{return f.Decode(f.Clean?.(e)??e)}catch{throw[...f.Errors(e)].map(Qg)}},f.safeParse=e=>{try{return{success:!0,data:f.Decode(f.Clean?.(e)??e),error:null}}catch{let t=[...h.Errors(e)].map(Qg);return{success:!1,data:null,error:t[0]?.summary,errors:t}}},f}else if(l?.length){let e=!1,t=m,{schema:n,notObjects:r}=Sv([p,...t.map(f)]);r&&(p=X.Intersect([...n?[n]:[],...r.map(t=>{let n=f(t);return n.type===`object`&&`additionalProperties`in n&&(!e&&n.additionalProperties===!1&&(e=!0),delete n.additionalProperties),n})]),p.type===`object`&&e&&(p.additionalProperties=!1))}else p.type===`object`&&(!(`additionalProperties`in p)||o)?p.additionalProperties=a:p=_v(p,{onlyFirst:`object`,from:X.Object({}),to({properties:e,...t}){if(e&&!(`additionalProperties`in p))return X.Object(e,{...t,additionalProperties:!1})}});if(n)if(A in p){let e={provider:`typebox`,schema:p,references:``,checkFunc:()=>{},code:``,Check:e=>zd(p,e),Errors:e=>Ef(p,e),Code:()=>``,Clean:yv(p),Decode:e=>wm(p,e),Encode:e=>zm(p,e),get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=dv(p)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=mv(`default`,p)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=uv(p)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=gv(p)},"~hasRef":void 0,get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=gv(p)}};if(p.config&&(e.config=p.config,e?.schema?.config&&delete e.schema.config),i&&p.additionalProperties===!1)if(i===!0||i===`exactMirror`)try{e.Clean=ch(p,{TypeCompiler:Jm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.warn(p),e.Clean=yv(p)}else e.Clean=yv(p);return e.parse=t=>{try{return e.Decode(e.Clean?.(t)??t)}catch{throw[...e.Errors(t)].map(Qg)}},e.safeParse=t=>{try{return{success:!0,data:e.Decode(e.Clean?.(t)??t),error:null}}catch{let e=[...h.Errors(t)].map(Qg);return{success:!1,data:null,error:e[0]?.summary,errors:e}}},e}else{let e={provider:`standard`,schema:p,references:``,checkFunc:()=>{},code:``,Check:e=>p[`~standard`].validate(e),Errors(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t.issues},Code:()=>``,Decode(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return e.parse=t=>{try{return e.Decode(e.Clean?.(t)??t)}catch{throw[...e.Errors(t)].map(Qg)}},e.safeParse=t=>{try{return{success:!0,data:e.Decode(e.Clean?.(t)??t),error:null}}catch{let e=[...h.Errors(t)].map(Qg);return{success:!1,data:null,error:e[0]?.summary,errors:e}}},e}let h;if(A in p)if(h=Jm.Compile(p,Object.values(t).filter(e=>A in e)),h.provider=`typebox`,p.config&&(h.config=p.config,h?.schema?.config&&delete h.schema.config),i===!0||i===`exactMirror`)try{h.Clean=ch(p,{TypeCompiler:Jm,sanitize:u?.(),modules:r})}catch{console.warn(`Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues`),console.dir(p,{depth:null}),h.Clean=yv(p)}else i===`typebox`&&(h.Clean=yv(p));else h={provider:`standard`,schema:p,references:``,checkFunc(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},code:``,Check:e=>p[`~standard`].validate(e),Errors(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t.issues},Code:()=>``,Decode(e){let t=p[`~standard`].validate(e);if(t instanceof Promise)throw Error(`Async validation is not supported in non-dynamic schema`);return t},Encode:e=>e,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return h.parse=e=>{try{return h.Decode(h.Clean?.(e)??e)}catch{throw[...h.Errors(e)].map(Qg)}},h.safeParse=e=>{try{return{success:!0,data:h.Decode(h.Clean?.(e)??e),error:null}}catch{let t=[...h.Errors(e)].map(Qg);return{success:!1,data:null,error:t[0]?.summary,errors:t}}},A in p&&Object.assign(h,{get hasAdditionalProperties(){return`~hasAdditionalProperties`in this?this[`~hasAdditionalProperties`]:this[`~hasAdditionalProperties`]=dv(h)},get hasDefault(){return`~hasDefault`in this?this[`~hasDefault`]:this[`~hasDefault`]=mv(`default`,h)},get isOptional(){return`~isOptional`in this?this[`~isOptional`]:this[`~isOptional`]=uv(h)},get hasTransform(){return`~hasTransform`in this?this[`~hasTransform`]:this[`~hasTransform`]=gv(p)},get hasRef(){return`~hasRef`in this?this[`~hasRef`]:this[`~hasRef`]=hv(p)},"~hasRef":void 0}),h},xv=e=>e[A]===`Union`||!e.schema&&!!e.anyOf,Sv=e=>{if(e.length===0)return{schema:void 0,notObjects:[]};if(e.length===1)return e[0].type===`object`?{schema:e[0],notObjects:[]}:{schema:void 0,notObjects:e};let t,n=[],r=!1,i=!1;for(let a of e){if(a.type!==`object`){n.push(a);continue}if(`additionalProperties`in a&&(a.additionalProperties===!0?r=!0:a.additionalProperties===!1&&(i=!0)),!t){t=a;continue}t={...t,...a,properties:{...t.properties,...a.properties},required:[...t?.required??[],...a.required]}}return t&&(t.required&&=[...new Set(t.required)],i?t.additionalProperties=!1:r&&(t.additionalProperties=!0)),{schema:t,notObjects:n}},Cv=(e,{models:t={},modules:n,dynamic:r=!1,normalize:i=!1,additionalProperties:a=!1,validators:o=[],sanitize:s})=>{if(o=o.filter(e=>e),!e){if(!o?.length)return;e=o[0],o=o.slice(1)}let c;if(typeof e!=`string`)c=e;else if(c=n&&e in n.$defs?n.Import(e):t[e],!c)return;if(!c)return;if(A in c||`~standard`in c)return{200:bv(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(e=>e[200]),sanitize:s})};let l={};return Object.keys(c).forEach(e=>{if(isNaN(+e))return;let u=c[+e];if(typeof u==`string`){if(u in t){let c=t[u];if(!c)return;l[+e]=A in c||`~standard`in c?bv(c,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):c}return}l[+e]=A in u||`~standard`in u?bv(u,{modules:n,models:t,additionalProperties:a,dynamic:r,normalize:i,coerce:!1,additionalCoerce:[],validators:o.map(t=>t[+e]),sanitize:s}):u}),l},wv,Tv=()=>(wv||=[{from:X.Object({}),to:()=>X.ObjectString({}),excludeRoot:!0},{from:X.Array(X.Any()),to:()=>X.ArrayString(X.Any())}],wv),Ev,Dv=()=>(Ev||=[{from:X.Object({}),to:()=>X.ObjectString({}),excludeRoot:!0},{from:X.Array(X.Any()),to:()=>X.ArrayQuery(X.Any())}],Ev),Ov,kv=()=>(Ov||=[{from:X.Number(),to:e=>X.Numeric(e),rootOnly:!0},{from:X.Boolean(),to:e=>X.BooleanString(e),rootOnly:!0}],Ov),Av=({validator:e,modules:t,defaultConfig:n={},config:r,dynamic:i,normalize:a=!1,models:o,validators:s,sanitize:c})=>{let l=e?.provider?e:bv(e,{modules:t,dynamic:i,models:o,normalize:a,additionalProperties:!0,coerce:!0,additionalCoerce:Tv(),validators:s,sanitize:c});return l?l.config=rg(l.config,r):(l=bv(X.Cookie(X.Any()),{modules:t,dynamic:i,models:o,additionalProperties:!0,validators:s,sanitize:c}),l.config=n),l},jv=e=>e&&e[A]===`Import`&&e.$defs[e.$ref][A]===`Object`?e.$defs[e.$ref]:e,Q=(e,t)=>t?e:``,Mv=[`json`,`text`,`urlencoded`,`arrayBuffer`,`formdata`,`application/json`,`text/plain`,`application/x-www-form-urlencoded`,`application/octet-stream`,`multipart/form-data`],Nv=({context:e=`c`,trace:t=[],addFn:n})=>{if(!t.length)return()=>({resolveChild(){return()=>{}},resolve(){}});for(let r=0;r<t.length;r++)n(`let report${r},reportChild${r},reportErr${r},reportErrChild${r};let trace${r}=${e}[ELYSIA_TRACE]?.[${r}]??trace[${r}](${e});
`);return(e,{name:r,total:i=0}={})=>{r||=`anonymous`;let a=e===`error`?`reportErr`:`report`;for(let o=0;o<t.length;o++)n(`${a}${o} = trace${o}.${e}({id,event:'${e}',name:'${r}',begin:performance.now(),total:${i}})
`);return{resolve(){for(let e=0;e<t.length;e++)n(`${a}${e}.resolve()
`)},resolveChild(r){for(let i=0;i<t.length;i++)n(`${a}Child${i}=${a}${i}.resolveChild?.shift()?.({id,event:'${e}',name:'${r}',begin:performance.now()})
`);return e=>{for(let r=0;r<t.length;r++)n(e?`if(${e} instanceof Error){${a}Child${r}?.(${e}) }else{${a}Child${r}?.()}`:`${a}Child${r}?.()
`)}}}}},Pv=({schema:e,name:t,type:n,typeAlias:r=n,normalize:i,ignoreTryCatch:a=!1})=>!i||!e.Clean?``:i===!0||i===`exactMirror`?a?`${t}=validator.${r}.Clean(${t})
`:`try{${t}=validator.${r}.Clean(${t})
}catch{}`:i===`typebox`?`${t}=validator.${r}.Clean(${t})
`:``,Fv=({injectResponse:e=``,normalize:t=!1,validator:n,encodeSchema:r=!1,isStaticResponse:i=!1,hasSanitize:a=!1})=>({validate:(e,t=`c.${e}`,n)=>`c.set.status=422;throw new ValidationError('${e}',validator.${e},${t}${n?`,`+n:``})`,response:(o=`r`)=>{if(i||!n.response)return``;let s=e+`
`;s+=`if(${o} instanceof ElysiaCustomStatusResponse){c.set.status=${o}.code
${o}=${o}.response}if(${o} instanceof Response === false)switch(c.set.status){`;for(let[e,i]of Object.entries(n.response)){if(s+=`
case ${e}:
`,i.provider===`standard`){s+=`let vare${e}=validator.response[${e}].Check(${o})
if(vare${e} instanceof Promise)vare${e}=await vare${e}
if(vare${e}.issues)throw new ValidationError('response',validator.response[${e}],${o},vare${e}.issues)
${o}=vare${e}.value
c.set.status=${e}
break
`;continue}let n=i.schema?.noValidate===!0;if(!n&&i.schema?.$ref&&i.schema?.$defs){let e=i.schema.$ref,t=typeof e==`string`&&e.includes(`/`)?e.split(`/`).pop():e;i.schema.$defs[t]?.noValidate===!0&&(n=!0)}let c=n||a,l=({ignoreTryCatch:n=!1}={})=>Pv({name:o,schema:i,type:`response`,typeAlias:`response[${e}]`,normalize:t,ignoreTryCatch:n});c&&(s+=l());let u=!c&&t&&!n;r&&i.hasTransform&&!n?(s+=`try{${o}=validator.response[${e}].Encode(${o})
`,c||(s+=l({ignoreTryCatch:!0})),s+=`c.set.status=${e}}catch{`+(u?`try{
`+l({ignoreTryCatch:!0})+`${o}=validator.response[${e}].Encode(${o})
}catch{throw new ValidationError('response',validator.response[${e}],${o})}`:`throw new ValidationError('response',validator.response[${e}],${o})`)+`}`):(c||(s+=l()),n||(s+=`if(validator.response[${e}].Check(${o})===false)throw new ValidationError('response',validator.response[${e}],${o})
c.set.status=${e}
`)),s+=`break
`}return s+`}`}}),Iv=e=>(e?.fn??e).constructor.name===`AsyncFunction`,Lv=/=>\s?response\.clone\(/,Rv=/(?:return|=>)\s?\S+\(|a(?:sync|wait)/,$=e=>{let t=typeof e==`object`;if(t&&e.isAsync!==void 0)return e.isAsync;let n=t?e.fn:e;if(n.constructor.name===`AsyncFunction`)return!0;let r=n.toString();if(Lv.test(r))return t&&(e.isAsync=!1),!1;let i=Rv.test(r);return t&&(e.isAsync=i),i},zv=e=>{let t=typeof e==`object`;if(t&&e.hasReturn!==void 0)return e.hasReturn;let n=t?e.fn.toString():typeof e==`string`?e.toString():e,r=n.indexOf(`)`);if(n.charCodeAt(r+2)===61&&n.charCodeAt(r+5)!==123)return t&&(e.hasReturn=!0),!0;let i=n.includes(`return`);return t&&(e.hasReturn=i),i},Bv=e=>{let t=e?.fn??e;return t.constructor.name===`AsyncGeneratorFunction`||t.constructor.name===`GeneratorFunction`},Vv=(e,t,n=`c.${t}`)=>`try{${e}}catch(error){if(error.constructor.name === 'TransformDecodeError'){c.set.status=422
throw error.error ?? new ValidationError('${t}',validator.${t},${n})}}`,Hv=({app:e,path:t,method:n,hooks:r,validator:i,handler:a,allowMeta:o=!1,inference:s})=>{let c=e[`~adapter`].composeHandler,l=e[`~adapter`].handler,u=typeof a==`function`;if(!u){a=l.mapResponse(a,{headers:e.setHeaders??{}});let t=a instanceof Response||a?.constructor?.name===`Response`&&typeof a?.clone==`function`;if(r.parse?.length&&r.transform?.length&&r.beforeHandle?.length&&r.afterHandle?.length)return t?Function(`a`,`"use strict";
return function(){return a.clone()}`)(a):Function(`a`,`"use strict";
return function(){return a}`)(a);if(t){let e=a;a=()=>e.clone()}}let d=u?`handler(c)`:`handler`,f=!!r.trace?.length,p=``;if(s=j_(r,s),s=j_({handler:a},s),c.declare){let e=c.declare(s);e&&(p+=e)}s.server&&(p+=`Object.defineProperty(c,'server',{get:function(){return getServer()}})
`),i.createBody?.(),i.createQuery?.(),i.createHeaders?.(),i.createParams?.(),i.createCookie?.(),i.createResponse?.();let m=!!i.body||!!i.headers||!!i.params||!!i.query||!!i.cookie||!!i.response,h=s.query||!!i.query,g=r.parse?.length===1&&r.parse[0].fn===`none`,_=n!==``&&n!==`GET`&&n!==`HEAD`&&(s.body||!!i.body||!!r.parse?.length)&&!g,ee=e.setHeaders,te=ee&&!!Object.keys(ee).length,ne=s.headers||!!i.headers||c.preferWebstandardHeaders!==!0&&s.body,re=s.cookie||!!i.cookie,v=i.cookie?.config?rg(i?.cookie?.config,e.config.cookie):e.config.cookie,ie=``,ae=()=>{if(ie)return ie;if(v?.sign){if(!v.secrets)throw Error(`t.Cookie required secret which is not set in (${n}) ${t}.`);let e=v.secrets?typeof v.secrets==`string`?v.secrets:v.secrets[0]:void 0;if(ie+=`const _setCookie = c.set.cookie
if(_setCookie){`,v.sign===!0)ie+=`for(const [key, cookie] of Object.entries(_setCookie)){c.set.cookie[key].value=await signCookie(cookie.value,'${e}')}`;else for(let t of v.sign)ie+=`if(_setCookie['${t}']?.value)c.set.cookie['${t}'].value=await signCookie(_setCookie['${t}'].value,'${e}')
`;ie+=`}
`}return ie},oe=e.config.normalize,se=e.config.encodeSchema,y=Fv({normalize:oe,validator:i,encodeSchema:se,isStaticResponse:a instanceof Response,hasSanitize:!!e.config.sanitize});ne&&(p+=c.headers),f&&(p+=`const id=c[ELYSIA_REQUEST_ID]
`);let ce=Nv({trace:r.trace,addFn:e=>{p+=e}});if(p+=`try{`,re){let e=(e,t)=>{let n=v?.[e]??t;return n?typeof n==`string`?`${e}:'${n}',`:n instanceof Date?`${e}: new Date(${n.getTime()}),`:`${e}:${n},`:typeof t==`string`?`${e}:"${t}",`:`${e}:${t},`},t=v?`{secrets:${v.secrets===void 0?`undefined`:typeof v.secrets==`string`?`'${v.secrets}'`:`[`+v.secrets.reduce((e,t)=>e+`'${t}',`,``)+`]`},sign:${v.sign===!0?!0:v.sign===void 0?`undefined`:`[`+v.sign.reduce((e,t)=>e+`'${t}',`,``)+`]`},`+e(`domain`)+e(`expires`)+e(`httpOnly`)+e(`maxAge`)+e(`path`,`/`)+e(`priority`)+e(`sameSite`)+e(`secure`)+`}`:`undefined`;ne?p+=`
c.cookie=await parseCookie(c.set,c.headers.cookie,${t})
`:p+=`
c.cookie=await parseCookie(c.set,c.request.headers.get('cookie'),${t})
`}if(h){let e={},t={},n=!1,r=!1;if(i.query?.schema){let a=jv(i.query?.schema);if(A in a&&a.properties)for(let[i,o]of Object.entries(a.properties))pv(`ArrayQuery`,o)&&(e[i]=1,n=!0),pv(`ObjectString`,o)&&(t[i]=1,r=!0)}p+=`if(c.qi===-1){c.query=Object.create(null)}else{c.query=parseQueryFromURL(c.url,c.qi+1,${n?JSON.stringify(e):void 0},${r?JSON.stringify(t):void 0})}`}let le=typeof a==`function`&&$(a),ue=f||r.afterResponse?.length?`c.response=c.responseValue= `:``,de=Object.keys(i.response??{}),fe=de.length>1,b=de.length===0||de.length===1&&de[0]===`200`,pe=re||_||le||!!r.parse?.length||!!r.afterHandle?.some($)||!!r.beforeHandle?.some($)||!!r.transform?.some($)||!!r.mapResponse?.some($)||i.body?.provider===`standard`||i.headers?.provider===`standard`||i.query?.provider===`standard`||i.params?.provider===`standard`||i.cookie?.provider===`standard`||Object.values(i.response??{}).find(e=>e.provider===`standard`),x=(typeof a==`function`?Bv(a):!1)||!!r.beforeHandle?.some(Bv)||!!r.afterHandle?.some(Bv)||!!r.transform?.some(Bv),S=s.cookie||s.set||ne||f||fe||!b||u&&te||x,C=()=>{if(!r.afterResponse?.length&&!f)return``;let e=``,t=r.afterResponse?.some($)?`async `:``;e+=`
setImmediate(${t}()=>{`;let n=Nv({trace:r.trace,addFn:t=>{e+=t}})(`afterResponse`,{total:r.afterResponse?.length});if(r.afterResponse?.length&&r.afterResponse)for(let t=0;t<r.afterResponse.length;t++){let i=n.resolveChild(r.afterResponse[t].fn.name),a=$(r.afterResponse[t])?`await `:``;e+=`
${a}e.afterResponse[${t}](c)
`,i()}return n.resolve(),e+=`})
`,e},w=(e=`r`)=>{let t=C(),n=`${S?`mapResponse`:`mapCompactResponse`}(${ue}${e}${S?`,c.set`:``}${me})
`;return t?`const _res=${n}`+t+`return _res`:`return ${n}`},me=x||c.mapResponseContext?`,${c.mapResponseContext}`:``;(f||s.route)&&(p+=`c.route=\`${t}\`
`);let T=ce(`parse`,{total:r.parse?.length});if(_){let t=!!r.parse?.length||s.body||i.body;c.parser.declare&&(p+=c.parser.declare),p+=`
try{`;let n=typeof r.parse==`string`?r.parse:Array.isArray(r.parse)&&r.parse.length===1?typeof r.parse[0]==`string`?r.parse[0]:typeof r.parse[0].fn==`string`?r.parse[0].fn:void 0:void 0;if(!n&&i.body&&!r.parse?.length){let e=i.body.schema;e&&e.anyOf&&e[A]===`Union`&&e.anyOf?.length===2&&e.anyOf?.find(e=>e[A]===`ElysiaForm`)&&(n=`formdata`)}if(n&&Mv.includes(n)){let t=ce(`parse`,{total:r.parse?.length}),a=!!i.body?.isOptional;switch(n){case`json`:case`application/json`:p+=c.parser.json(a);break;case`text`:case`text/plain`:p+=c.parser.text(a);break;case`urlencoded`:case`application/x-www-form-urlencoded`:p+=c.parser.urlencoded(a);break;case`arrayBuffer`:case`application/octet-stream`:p+=c.parser.arrayBuffer(a);break;case`formdata`:case`multipart/form-data`:p+=c.parser.formData(a);break;default:n[0]in e[`~parser`]&&(p+=ne?`let contentType = c.headers['content-type']`:`let contentType = c.request.headers.get('content-type')`,p+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0,index)}
else{contentType=''}c.contentType=contentType
let result=parser['${n}'](c, contentType)
if(result instanceof Promise)result=await result
if(result instanceof ElysiaCustomStatusResponse)throw result
if(result!==undefined)c.body=result
delete c.contentType
`);break}t.resolve()}else if(t){p+=`
`,p+=`let contentType
if(c.request.body)`,p+=ne?`contentType=c.headers['content-type']
`:`contentType=c.request.headers.get('content-type')
`;let t=!1;if(r.parse?.length)p+=`if(contentType){
const index=contentType.indexOf(';')

if(index!==-1)contentType=contentType.substring(0,index)}else{contentType=''}let used=false
c.contentType=contentType
`;else{t=!0;let e=!!i.body?.isOptional;p+=`if(contentType)switch(contentType.charCodeAt(12)){
case 106:`+c.parser.json(e)+`break
case 120:`+c.parser.urlencoded(e)+`break
case 111:`+c.parser.arrayBuffer(e)+`break
case 114:`+c.parser.formData(e)+`break
default:if(contentType.charCodeAt(0)===116){`+c.parser.text(e)+`}break
}`}let n=ce(`parse`,{total:r.parse?.length});if(r.parse)for(let e=0;e<r.parse.length;e++){let a=`bo${e}`;if(e!==0&&(p+=`
if(!used){`),typeof r.parse[e].fn==`string`){let o=n.resolveChild(r.parse[e].fn),s=!!i.body?.isOptional;switch(r.parse[e].fn){case`json`:case`application/json`:t=!0,p+=c.parser.json(s);break;case`text`:case`text/plain`:t=!0,p+=c.parser.text(s);break;case`urlencoded`:case`application/x-www-form-urlencoded`:t=!0,p+=c.parser.urlencoded(s);break;case`arrayBuffer`:case`application/octet-stream`:t=!0,p+=c.parser.arrayBuffer(s);break;case`formdata`:case`multipart/form-data`:t=!0,p+=c.parser.formData(s);break;default:p+=`let ${a}=parser['${r.parse[e].fn}'](c,contentType)
if(${a} instanceof Promise)${a}=await ${a}
if(${a}!==undefined){c.body=${a};used=true;}
`}o()}else{let t=n.resolveChild(r.parse[e].fn.name);p+=`let ${a}=e.parse[${e}]
${a}=${a}(c,contentType)
if(${a} instanceof Promise)${a}=await ${a}
if(${a}!==undefined){c.body=${a};used=true}`,t()}if(e!==0&&(p+=`}`),t)break}if(n.resolve(),!t){let t=!!i.body?.isOptional;r.parse?.length&&(p+=`
if(!used){
`),p+=`switch(contentType){case 'application/json':
`+c.parser.json(t)+`break
case 'text/plain':`+c.parser.text(t)+`break
case 'application/x-www-form-urlencoded':`+c.parser.urlencoded(t)+`break
case 'application/octet-stream':`+c.parser.arrayBuffer(t)+`break
case 'multipart/form-data':`+c.parser.formData(t)+`break
`;for(let t of Object.keys(e[`~parser`]))p+=`case '${t}':let bo${t}=parser['${t}'](c,contentType)
if(bo${t} instanceof Promise)bo${t}=await bo${t}
if(bo${t} instanceof ElysiaCustomStatusResponse){`+w(`bo${t}`)+`}if(bo${t}!==undefined)c.body=bo${t}
break
`;r.parse?.length&&(p+=`}`),p+=`}`}r.parse?.length&&(p+=`
delete c.contentType`)}p+=`}catch(error){throw new ParseError(error)}`}if(T.resolve(),r?.transform||f){let e=ce(`transform`,{total:r.transform?.length});if(r.transform?.length){p+=`let transformed
`;for(let t=0;t<r.transform.length;t++){let n=r.transform[t],i=e.resolveChild(n.fn.name);p+=$(n)?`transformed=await e.transform[${t}](c)
`:`transformed=e.transform[${t}](c)
`,n.subType===`mapDerive`?p+=`if(transformed instanceof ElysiaCustomStatusResponse){`+w(`transformed`)+`}else{transformed.request=c.request
transformed.store=c.store
transformed.qi=c.qi
transformed.path=c.path
transformed.url=c.url
transformed.redirect=c.redirect
transformed.set=c.set
transformed.error=c.error
c=transformed}`:p+=`if(transformed instanceof ElysiaCustomStatusResponse){`+w(`transformed`)+`}else Object.assign(c,transformed)
`,i()}}e.resolve()}let he=[];if(i){if(i.headers){if(i.headers.hasDefault)for(let[e,t]of Object.entries(Rm(i.headers.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`c.headers['${e}']??=${n}
`)}p+=Pv({name:`c.headers`,schema:i.headers,type:`headers`,normalize:oe}),i.headers.isOptional&&(p+=`if(isNotEmpty(c.headers)){`),i.headers?.provider===`standard`?p+=`let vah=validator.headers.Check(c.headers)
if(vah instanceof Promise)vah=await vah
if(vah.issues){`+y.validate(`headers`,void 0,`vah.issues`)+`}else{c.headers=vah.value}
`:i.headers?.schema?.noValidate!==!0&&(p+=`if(validator.headers.Check(c.headers) === false){`+y.validate(`headers`)+`}`),i.headers.hasTransform&&(p+=Vv(`c.headers=validator.headers.Decode(c.headers)
`,`headers`)),i.headers.isOptional&&(p+=`}`)}if(i.params){if(i.params.hasDefault)for(let[e,t]of Object.entries(Rm(i.params.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`c.params['${e}']??=${n}
`)}i.params.provider===`standard`?p+=`let vap=validator.params.Check(c.params)
if(vap instanceof Promise)vap=await vap
if(vap.issues){`+y.validate(`params`,void 0,`vap.issues`)+`}else{c.params=vap.value}
`:i.params?.schema?.noValidate!==!0&&(p+=`if(validator.params.Check(c.params)===false){`+y.validate(`params`)+`}`),i.params.hasTransform&&(p+=Vv(`c.params=validator.params.Decode(c.params)
`,`params`))}if(i.query){if(A in i.query?.schema&&i.query.hasDefault)for(let[e,t]of Object.entries(Rm(i.query.schema,{}))){let n=typeof t==`object`?JSON.stringify(t):typeof t==`string`?`'${t}'`:t;n!==void 0&&(p+=`if(c.query['${e}']===undefined)c.query['${e}']=${n}
`)}p+=Pv({name:`c.query`,schema:i.query,type:`query`,normalize:oe}),i.query.isOptional&&(p+=`if(isNotEmpty(c.query)){`),i.query.provider===`standard`?p+=`let vaq=validator.query.Check(c.query)
if(vaq instanceof Promise)vaq=await vaq
if(vaq.issues){`+y.validate(`query`,void 0,`vaq.issues`)+`}else{c.query=vaq.value}
`:i.query?.schema?.noValidate!==!0&&(p+=`if(validator.query.Check(c.query)===false){`+y.validate(`query`)+`}`),i.query.hasTransform&&(p+=Vv(`c.query=validator.query.Decode(c.query)
`,`query`),p+=Vv(`c.query=validator.query.Decode(c.query)
`,`query`)),i.query.isOptional&&(p+=`}`)}if(_&&i.body){(i.body.hasTransform||i.body.isOptional)&&(p+=`const isNotEmptyObject=c.body&&(typeof c.body==="object"&&(isNotEmpty(c.body)||c.body instanceof ArrayBuffer))
`);let t=xv(i.body.schema),n=!1;if(i.body.hasDefault){let e=Rm(i.body.schema,i.body.schema.type===`object`||jv(i.body.schema)[A]===`Object`?{}:void 0),r=jv(i.body.schema);if(!t&&e&&typeof e==`object`&&(fv(`File`,r)||fv(`Files`,r))){n=!0;for(let[t,n]of Object.entries(e))(n===`File`||n===`Files`)&&delete e[t];J(e)||(e=void 0)}let a=typeof e==`object`?JSON.stringify(e):typeof e==`string`?`'${e}'`:e;e!=null&&(Array.isArray(e)?p+=`if(!c.body)c.body=${a}
`:typeof e==`object`?p+=`c.body=Object.assign(${a},c.body)
`:p+=`c.body=${a}
`),p+=Pv({name:`c.body`,schema:i.body,type:`body`,normalize:oe}),i.body.provider===`standard`?p+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+y.validate(`body`,void 0,`vab.issues`)+`}else{c.body=vab.value}
`:i.body?.schema?.noValidate!==!0&&(i.body.isOptional?p+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`:p+=`if(validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`)}else p+=Pv({name:`c.body`,schema:i.body,type:`body`,normalize:oe}),i.body.provider===`standard`?p+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+y.validate(`body`,void 0,`vab.issues`)+`}else{c.body=vab.value}
`:i.body?.schema?.noValidate!==!0&&(i.body.isOptional?p+=`if(isNotEmptyObject&&validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`:p+=`if(validator.body.Check(c.body)===false){`+y.validate(`body`)+`}`);if(i.body.hasTransform&&(p+=Vv(`if(isNotEmptyObject)c.body=validator.body.Decode(c.body)
`,`body`)),t&&i.body.schema.anyOf?.length){let t=Object.values(i.body.schema.anyOf);for(let n=0;n<t.length;n++){let r=t[n];if(fv(`File`,r)||fv(`Files`,r)){let t=bv(r,{modules:e.definitions.typebox,dynamic:!e.config.aot,models:e.definitions.type,normalize:e.config.normalize,additionalCoerce:kv(),sanitize:()=>e.config.sanitize});if(t){let e=he.length===0,n=Object.entries(r.properties),i=e?`
`:` else `;i+=`if(fileUnions[${he.length}].Check(c.body)){`;let a=``,o=0;for(let e=0;e<n.length;e++){let[t,r]=n[e];!r.extension||r[A]!==`File`&&r[A]!==`Files`||(o&&(a+=`,`),a+=`fileType(c.body.${t},${JSON.stringify(r.extension)},'body.${t}')`,o++)}a&&(o===1?i+=`await ${a}
`:o>1&&(i+=`await Promise.all([${a}])
`),i+=`}`,p+=i,he.push(t))}}}}else if(n||!t&&(fv(`File`,jv(i.body.schema))||fv(`Files`,jv(i.body.schema)))){let e=``,t=0;for(let[n,r]of Object.entries(jv(i.body.schema).properties))!r.extension||r[A]!==`File`&&r[A]!==`Files`||(t&&(e+=`,`),e+=`fileType(c.body.${n},${JSON.stringify(r.extension)},'body.${n}')`,t++);t&&(p+=`
`),t===1?p+=`await ${e}
`:t>1&&(p+=`await Promise.all([${e}])
`)}}i.cookie&&(i.cookie.config=rg(i.cookie.config,i.cookie?.config??{}),p+=`let cookieValue={}
for(const [key,value] of Object.entries(c.cookie))cookieValue[key]=value.value
`,i.cookie.isOptional&&(p+=`if(isNotEmpty(c.cookie)){`),i.cookie.provider===`standard`?(p+=`let vac=validator.cookie.Check(cookieValue)
if(vac instanceof Promise)vac=await vac
if(vac.issues){`+y.validate(`cookie`,void 0,`vac.issues`)+`}else{cookieValue=vac.value}
`,p+=`for(const k of Object.keys(cookieValue))c.cookie[k].value=cookieValue[k]
`):i.body?.schema?.noValidate!==!0&&(p+=`if(validator.cookie.Check(cookieValue)===false){`+y.validate(`cookie`,`cookieValue`)+`}`,i.cookie.hasTransform&&(p+=Vv(`for(const [key,value] of Object.entries(validator.cookie.Decode(cookieValue))){c.cookie[key].value=value}`,`cookie`))),i.cookie.isOptional&&(p+=`}`))}if(r?.beforeHandle||f){let e=ce(`beforeHandle`,{total:r.beforeHandle?.length}),t=!1;if(r.beforeHandle?.length)for(let n=0;n<r.beforeHandle.length;n++){let o=r.beforeHandle[n],s=e.resolveChild(o.fn.name),c=zv(o);if(o.subType===`resolve`||o.subType===`mapResolve`)t||(t=!0,p+=`
let resolved
`),p+=$(o)?`resolved=await e.beforeHandle[${n}](c);
`:`resolved=e.beforeHandle[${n}](c);
`,o.subType===`mapResolve`?p+=`if(resolved instanceof ElysiaCustomStatusResponse){`+w(`resolved`)+`}else{resolved.request=c.request
resolved.store=c.store
resolved.qi=c.qi
resolved.path=c.path
resolved.url=c.url
resolved.redirect=c.redirect
resolved.set=c.set
resolved.error=c.error
c=resolved}`:p+=`if(resolved instanceof ElysiaCustomStatusResponse){`+w(`resolved`)+`}else Object.assign(c, resolved)
`,s();else if(!c)p+=$(o)?`await e.beforeHandle[${n}](c)
`:`e.beforeHandle[${n}](c)
`,s();else{if(p+=$(o)?`be=await e.beforeHandle[${n}](c)
`:`be=e.beforeHandle[${n}](c)
`,s(`be`),p+=`if(be!==undefined){`,e.resolve(),r.afterHandle?.length||f){ce(`handle`,{name:u?a.name:void 0}).resolve();let e=ce(`afterHandle`,{total:r.afterHandle?.length});if(r.afterHandle?.length)for(let t=0;t<r.afterHandle.length;t++){let n=r.afterHandle[t],i=zv(n),a=e.resolveChild(n.fn.name);p+=`c.response = be
`,i?(p+=$(n.fn)?`af=await e.afterHandle[${t}](c)
`:`af=e.afterHandle[${t}](c)
`,p+=`if(af!==undefined) c.response=c.responseValue=be=af
`):p+=$(n.fn)?`await e.afterHandle[${t}](c, be)
`:`e.afterHandle[${t}](c, be)
`,a(`af`)}e.resolve()}i.response&&(p+=y.response(`be`));let t=ce(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`c.response=c.responseValue=be
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`if(mr===undefined){mr=${Iv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)be=c.response=c.responseValue=mr}`,i()}}t.resolve(),p+=ae(),p+=`return mapEarlyResponse(${ue}be,c.set${me})}
`}}e.resolve()}if(r.afterHandle?.length||f){let e=ce(`handle`,{name:u?a.name:void 0});r.afterHandle?.length?p+=le?`let r=c.response=c.responseValue=await ${d}
`:`let r=c.response=c.responseValue=${d}
`:p+=le?`let r=await ${d}
`:`let r=${d}
`,e.resolve();let t=ce(`afterHandle`,{total:r.afterHandle?.length});if(r.afterHandle?.length)for(let e=0;e<r.afterHandle.length;e++){let n=r.afterHandle[e],a=zv(n),o=t.resolveChild(n.fn.name);a?(p+=$(n.fn)?`af=await e.afterHandle[${e}](c)
`:`af=e.afterHandle[${e}](c)
`,o(`af`),i.response?(p+=`if(af!==undefined){`,t.resolve(),p+=y.response(`af`),p+=`c.response=c.responseValue=af}`):(p+=`if(af!==undefined){`,t.resolve(),p+=`c.response=c.responseValue=af}`)):(p+=$(n.fn)?`await e.afterHandle[${e}](c)
`:`e.afterHandle[${e}](c)
`,o())}t.resolve(),r.afterHandle?.length&&(p+=`r=c.response
`),i.response&&(p+=y.response()),p+=ae();let n=ce(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length)for(let e=0;e<r.mapResponse.length;e++){let t=r.mapResponse[e],i=n.resolveChild(t.fn.name);p+=`mr=${Iv(t)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr
`,i()}n.resolve(),p+=w()}else{let e=ce(`handle`,{name:u?a.name:void 0});if(i.response||r.mapResponse?.length||f){p+=le?`let r=await ${d}
`:`let r=${d}
`,e.resolve(),i.response&&(p+=y.response());let t=ce(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`
c.response=c.responseValue=r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`
if(mr===undefined){mr=${Iv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}
`,i()}}t.resolve(),p+=ae(),a instanceof Response?(p+=C(),p+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ue}${d}.clone(),c.set${me})
else return ${d}.clone()`:`return ${d}.clone()`,p+=`
`):p+=w()}else if(re||f){p+=le?`let r=await ${d}
`:`let r=${d}
`,e.resolve();let t=ce(`mapResponse`,{total:r.mapResponse?.length});if(r.mapResponse?.length){p+=`c.response=c.responseValue= r
`;for(let e=0;e<r.mapResponse.length;e++){let n=r.mapResponse[e],i=t.resolveChild(n.fn.name);p+=`if(mr===undefined){mr=${Iv(n)?`await `:``}e.mapResponse[${e}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}`,i()}}t.resolve(),p+=ae()+w()}else{e.resolve();let t=le?`await ${d}`:d;a instanceof Response?(p+=C(),p+=s.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${ue}${d}.clone(),c.set${me})
else return ${d}.clone()
`:`return ${d}.clone()
`):p+=w(t)}}if(p+=`
}catch(error){`,!pe&&r.error?.length&&(p+=`return(async()=>{`),p+=`const set=c.set
if(!set.status||set.status<300)set.status=error?.status||500
`,re&&(p+=ae()),f&&r.trace)for(let e=0;e<r.trace.length;e++)p+=`report${e}?.resolve(error);reportChild${e}?.(error)
`;let E=ce(`error`,{total:r.error?.length});if(r.error?.length){p+=`c.error=error
`,m?p+=`if(error instanceof TypeBoxError){c.code="VALIDATION"
c.set.status=422}else{c.code=error.code??error[ERROR_CODE]??"UNKNOWN"}`:p+=`c.code=error.code??error[ERROR_CODE]??"UNKNOWN"
`,p+=`let er
`,r.mapResponse?.length&&(p+=`let mep
`);for(let e=0;e<r.error.length;e++){let t=E.resolveChild(r.error[e].fn.name);if($(r.error[e])?p+=`er=await e.error[${e}](c)
`:p+=`er=e.error[${e}](c)
if(er instanceof Promise)er=await er
`,t(),r.mapResponse?.length){let e=ce(`mapResponse`,{total:r.mapResponse?.length});for(let t=0;t<r.mapResponse.length;t++){let n=r.mapResponse[t],i=e.resolveChild(n.fn.name);p+=`c.response=c.responseValue=er
mep=e.mapResponse[${t}](c)
if(mep instanceof Promise)er=await er
if(mep!==undefined)er=mep
`,i()}e.resolve()}if(p+=`er=mapEarlyResponse(er,set${me})
`,p+=`if(er){`,f&&r.trace){for(let e=0;e<r.trace.length;e++)p+=`report${e}.resolve()
`;E.resolve()}p+=`return er}`}}E.resolve(),p+=`return handleError(c,error,true)`,!pe&&r.error?.length&&(p+=`})()`),p+=`}`;let ge=c.inject?Object.keys(c.inject).join(`,`)+`,`:``,_e=`const {handler,handleError,hooks:e, `+Q(`validator,`,m)+`mapResponse,mapCompactResponse,mapEarlyResponse,isNotEmpty,utils:{`+Q(`parseQuery,`,_)+Q(`parseQueryFromURL,`,h)+`},error:{`+Q(`ValidationError,`,m)+Q(`ParseError`,_)+`},fileType,schema,definitions,ERROR_CODE,`+Q(`parseCookie,`,re)+Q(`signCookie,`,re)+Q(`decodeURIComponent,`,h)+`ElysiaCustomStatusResponse,`+Q(`ELYSIA_TRACE,`,f)+Q(`ELYSIA_REQUEST_ID,`,f)+Q(`parser,`,r.parse?.length)+Q(`getServer,`,s.server)+Q(`fileUnions,`,he.length)+ge+Q(`TypeBoxError`,m)+`}=hooks
const trace=e.trace
return ${pe?`async `:``}function handle(c){`;r.beforeHandle?.length&&(_e+=`let be
`),r.afterHandle?.length&&(_e+=`let af
`),r.mapResponse?.length&&(_e+=`let mr
`),o&&(_e+=`c.schema=schema
c.defs=definitions
`),p=_e+p+`}`,_e=``;try{return Function(`hooks`,`"use strict";
`+p)({handler:a,hooks:kg(r),validator:m?i:void 0,handleError:e.handleError,mapResponse:l.mapResponse,mapCompactResponse:l.mapCompactResponse,mapEarlyResponse:l.mapEarlyResponse,isNotEmpty:J,utils:{parseQuery:_?ov:void 0,parseQueryFromURL:h?i.query?.provider===`standard`?av:iv:void 0},error:{ValidationError:m?Y:void 0,ParseError:_?Xg:void 0},fileType:u_,schema:e.router.history,definitions:e.definitions.type,ERROR_CODE:Wg,parseCookie:re?P_:void 0,signCookie:re?xg:void 0,decodeURIComponent:h?fh.default:void 0,ElysiaCustomStatusResponse:qg,ELYSIA_TRACE:f?sv:void 0,ELYSIA_REQUEST_ID:f?Ng:void 0,getServer:s.server?()=>e.getServer():void 0,fileUnions:he.length?he:void 0,TypeBoxError:m?Ke:void 0,parser:e[`~parser`],...c.inject})}catch(t){let n=kg(r);console.log(`[Composer] failed to generate optimized handler`),console.log(`---`),console.log({handler:typeof a==`function`?a.toString():a,instruction:p,hooks:{...n,transform:n?.transform?.map?.(e=>e.toString()),resolve:n?.resolve?.map?.(e=>e.toString()),beforeHandle:n?.beforeHandle?.map?.(e=>e.toString()),afterHandle:n?.afterHandle?.map?.(e=>e.toString()),mapResponse:n?.mapResponse?.map?.(e=>e.toString()),parse:n?.parse?.map?.(e=>e.toString()),error:n?.error?.map?.(e=>e.toString()),afterResponse:n?.afterResponse?.map?.(e=>e.toString()),stop:n?.stop?.map?.(e=>e.toString())},validator:i,definitions:e.definitions.type,error:t}),console.log(`---`),process.exit(1)}},Uv=(e,t)=>{let n=``,r=Nv({trace:e.event.trace,addFn:t??(e=>{n+=e})})(`request`,{total:e.event.request?.length});if(e.event.request?.length){n+=`try{`;for(let t=0;t<e.event.request.length;t++){let i=e.event.request[t],a=zv(i),o=$(i),s=r.resolveChild(e.event.request[t].fn.name);a?(n+=`re=mapEarlyResponse(${o?`await `:``}onRequest[${t}](c),c.set)
`,s(`re`),n+=`if(re!==undefined)return re
`):(n+=`${o?`await `:``}onRequest[${t}](c)
`,s())}n+=`}catch(error){return app.handleError(c,error,false)}`}return r.resolve(),n},Wv=(e,t=`map`)=>{let n=e.extender.higherOrderFunctions;if(!n.length)return`return `+t;let r=e[`~adapter`].composeGeneralHandler,i=t;for(let e=0;e<n.length;e++)i=`hoc[${e}](${i},${r.parameters})`;return`return function hocMap(${r.parameters}){return ${i}(${r.parameters})}`},Gv=e=>{let t=e[`~adapter`].composeGeneralHandler;e.router.http.build();let n=e[`~adapter`].isWebStandard,r=e.event.trace?.length,i=``,a=e.router,o=a.http.root.WS?`const route=router.find(r.method==='GET'&&r.headers.get('upgrade')==='websocket'?'WS':r.method,p)`:`const route=router.find(r.method,p)`;o+=a.http.root.ALL?`??router.find('ALL',p)
`:`
`,n&&(o+=`if(r.method==='HEAD'){const route=router.find('GET',p)
if(route){c.params=route.params
const _res=route.store.handler?route.store.handler(c):route.store.compile()(c)
if(_res)return getResponseLength(_res).then((length)=>{_res.headers.set('content-length', length)
return new Response(null,{status:_res.status,statusText:_res.statusText,headers:_res.headers})
})}}`);let s=`c.error=notFound
`;if(e.event.afterResponse?.length&&!e.event.error){s=`
c.error=notFound
`;let t=e.event.afterResponse.some($)?`async`:``;s+=`
setImmediate(${t}()=>{`;for(let t=0;t<e.event.afterResponse.length;t++){let n=e.event.afterResponse[t].fn;s+=`
${Iv(n)?`await `:``}afterResponse[${t}](c)
`}s+=`})
`}e.inference.query&&(s+=`
if(c.qi===-1){c.query={}}else{c.query=parseQueryFromURL(c.url,c.qi+1)}`);let c=t.error404(!!e.event.request?.length,!!e.event.error?.length,s);o+=c.code,o+=`
c.params=route.params
if(route.store.handler)return route.store.handler(c)
return route.store.compile()(c)
`;let l=``;for(let[t,r]of Object.entries(a.static)){l+=`case'${t}':`,e.config.strictPath!==!0&&(l+=`case'${Rg(t)}':`);let i=zg(t);t!==i&&(l+=`case'${i}':`),l+=`switch(r.method){`,(`GET`in r||`WS`in r)&&(l+=`case 'GET':`,`WS`in r&&(l+=`if(r.headers.get('upgrade')==='websocket')return ht[${r.WS}].composed(c)
`,`GET`in r||(`ALL`in r?l+=`return ht[${r.ALL}].composed(c)
`:l+=`break map
`)),`GET`in r&&(l+=`return ht[${r.GET}].composed(c)
`)),n&&(`GET`in r||`ALL`in r)&&!(`HEAD`in r)&&(l+=`case 'HEAD':const _res=ht[${r.GET??r.ALL}].composed(c)
return getResponseLength(_res).then((length)=>{_res.headers.set('content-length', length)
return new Response(null,{status:_res.status,statusText:_res.statusText,headers:_res.headers})
})
`);for(let[e,t]of Object.entries(r))e===`ALL`||e===`GET`||e===`WS`||(l+=`case '${e}':return ht[${t}].composed(c)
`);`ALL`in r?l+=`default:return ht[${r.ALL}].composed(c)
`:l+=`default:break map
`,l+=`}`}let u=!!e.event.request?.some($),d=t.inject?Object.keys(t.inject).join(`,`)+`,`:``;i+=`
const {app,mapEarlyResponse,NotFoundError,randomId,handleError,status,redirect,getResponseLength,`+Q(`parseQueryFromURL,`,e.inference.query)+Q(`ELYSIA_TRACE,`,r)+Q(`ELYSIA_REQUEST_ID,`,r)+d+`}=data
const store=app.singleton.store
const decorator=app.singleton.decorator
const staticRouter=app.router.static.http
const ht=app.router.history
const router=app.router.http
const trace=app.event.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const notFound=new NotFoundError()
const hoc=app.extender.higherOrderFunctions.map(x=>x.fn)
`,e.event.request?.length&&(i+=`const onRequest=app.event.request.map(x=>x.fn)
`),e.event.afterResponse?.length&&(i+=`const afterResponse=app.event.afterResponse.map(x=>x.fn)
`),i+=c.declare,e.event.trace?.length&&(i+=`const `+e.event.trace.map((e,t)=>`tr${t}=app.event.trace[${t}].fn`).join(`,`)+`
`),i+=`${u?`async `:``}function map(${t.parameters}){`,e.event.request?.length&&(i+=`let re
`),i+=t.createContext(e),e.event.trace?.length&&(i+=`c[ELYSIA_TRACE]=[`+e.event.trace.map((e,t)=>`tr${t}(c)`).join(`,`)+`]
`),i+=Uv(e),l&&(i+=`
map: switch(p){
`+l+`}`),i+=o+`}
`+Wv(e);let f=Kv(e);e.handleError=f;let p=Function(`data`,`"use strict";
`+i)({app:e,mapEarlyResponse:e[`~adapter`].handler.mapEarlyResponse,NotFoundError:Yg,randomId:Fg,handleError:f,status:Jg,redirect:jg,getResponseLength:Vg,parseQueryFromURL:e.inference.query?iv:void 0,ELYSIA_TRACE:r?sv:void 0,ELYSIA_REQUEST_ID:r?Ng:void 0,...t.inject});return Kh&&Bun.gc(!1),p},Kv=e=>{let t=e.event,n=``,r=e[`~adapter`].composeError,i=r.inject?Object.keys(r.inject).join(`,`)+`,`:``,a=!!e.event.trace?.length;n+=`const {mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,`+Q(`onError,`,e.event.error)+Q(`afterResponse,`,e.event.afterResponse)+Q(`trace,`,e.event.trace)+Q(`onMapResponse,`,e.event.mapResponse)+Q(`ELYSIA_TRACE,`,a)+Q(`ELYSIA_REQUEST_ID,`,a)+i+`}=inject
`,n+=`return ${e.event.error?.find($)||e.event.mapResponse?.find($)?`async `:``}function(context,error,skipGlobal){`,n+=``,a&&(n+=`const id=context[ELYSIA_REQUEST_ID]
`);let o=Nv({context:`context`,trace:t.trace,addFn:e=>{n+=e}}),s=()=>{if(!t.afterResponse?.length&&!a)return``;let e=``,n=t.afterResponse?.some($)?`async`:``;e+=`
setImmediate(${n}()=>{`;let r=Nv({context:`context`,trace:t.trace,addFn:t=>{e+=t}})(`afterResponse`,{total:t.afterResponse?.length,name:`context`});if(t.afterResponse?.length&&t.afterResponse)for(let n=0;n<t.afterResponse.length;n++){let i=t.afterResponse[n].fn,a=r.resolveChild(i.name);e+=`
${Iv(i)?`await `:``}afterResponse[${n}](context)
`,a()}return r.resolve(),e+=`})
`,e};n+=`const set=context.set
let _r
if(!context.code)context.code=error.code??error[ERROR_CODE]
if(!(context.error instanceof Error))context.error=error
if(error instanceof ElysiaCustomStatusResponse){set.status=error.status=error.code
error.message=error.response}`,r.declare&&(n+=r.declare);let c=a||t.afterResponse?.length?`context.response = `:``;if(e.event.error)for(let i=0;i<e.event.error.length;i++){let a=e.event.error[i],l=`${$(a)?`await `:``}onError[${i}](context)
`;if(n+=`if(skipGlobal!==true){`,zv(a)){n+=`_r=${l}
if(_r!==undefined){if(_r instanceof Response){`+s()+`return mapResponse(_r,set${r.mapResponseContext})}if(_r instanceof ElysiaCustomStatusResponse){error.status=error.code
error.message = error.response}if(set.status===200||!set.status)set.status=error.status
`;let e=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(t.mapResponse?.length)for(let r=0;r<t.mapResponse.length;r++){let i=t.mapResponse[r],a=e.resolveChild(i.fn.name);n+=`context.response=context.responseValue=_r_r=${Iv(i)?`await `:``}onMapResponse[${r}](context)
`,a()}e.resolve(),n+=s()+`return mapResponse(${c}_r,set${r.mapResponseContext})}`}else n+=l;n+=`}`}n+=`if(error.constructor.name==="ValidationError"||error.constructor.name==="TransformDecodeError"){
if(error.error)error=error.error
set.status=error.status??422
`+s()+r.validationError+`
}
`,n+=`if(error instanceof Error){`+s()+`
if(typeof error.toResponse==='function')return context.response=context.responseValue=error.toResponse()
`+r.unknownError+`
}`;let l=o(`mapResponse`,{total:t.mapResponse?.length,name:`context`});if(n+=`
if(!context.response)context.response=context.responseValue=error.message??error
`,t.mapResponse?.length){n+=`let mr
`;for(let e=0;e<t.mapResponse.length;e++){let r=t.mapResponse[e],i=l.resolveChild(r.fn.name);n+=`if(mr===undefined){mr=${Iv(r)?`await `:``}onMapResponse[${e}](context)
if(mr!==undefined)error=context.response=context.responseValue=mr}`,i()}}l.resolve(),n+=s()+`
return mapResponse(${c}error,set${r.mapResponseContext})}`;let u=e=>typeof e==`function`?e:e.fn;return Function(`inject`,`"use strict";
`+n)({mapResponse:e[`~adapter`].handler.mapResponse,ERROR_CODE:Wg,ElysiaCustomStatusResponse:qg,onError:e.event.error?.map(u),afterResponse:e.event.afterResponse?.map(u),trace:e.event.trace?.map(u),onMapResponse:e.event.mapResponse?.map(u),ELYSIA_TRACE:a?sv:void 0,ELYSIA_REQUEST_ID:a?Ng:void 0,...r.inject})},qv=(e,t)=>t?e:``,Jv=(e,t,n,r=!1)=>{let i=``,a=e.setHeaders,o=!!e.event.trace?.length;o&&(i+=`const id=randomId()
`);let s=/[:*]/.test(t.path),c=`const u=request.url,s=u.indexOf('/',${e.config.handler?.standardHostname??!0?11:7}),qi=u.indexOf('?', s + 1)
`,l=n.query||!!t.hooks.query||!!t.hooks.standaloneValidator?.find(e=>e.query)||e.event.request?.length;l&&(i+=c);let u=n.path?s?`get path(){`+(l?``:c)+`if(qi===-1)return u.substring(s)
return u.substring(s,qi)
},`:`path:'${t.path}',`:``;i+=qv(`const c=`,!r)+`{request,store,`+qv(`qi,`,l)+qv(`params:request.params,`,s)+u+qv(`url:request.url,`,o||n.url||l)+`redirect,status,set:{headers:`+(J(a)?`Object.assign({},app.setHeaders)`:`Object.create(null)`)+`,status:200}`,n.server&&(i+=`,get server(){return app.getServer()}`),o&&(i+=`,[ELYSIA_REQUEST_ID]:id`);{let t=``;for(let n of Object.keys(e.singleton.decorator))t+=`,'${n}':decorator['${n}']`;i+=t}return i+=`}
`,i},Yv=(e,t)=>{let n=!!e.event.trace?.length,r=!!e.extender.higherOrderFunctions.length,i=j_(t.hooks,e.inference);i=j_({handler:t.handler},i);let a=`const handler=data.handler,app=data.app,store=data.store,decorator=data.decorator,redirect=data.redirect,route=data.route,mapEarlyResponse=data.mapEarlyResponse,`+qv(`randomId=data.randomId,`,n)+qv(`ELYSIA_REQUEST_ID=data.ELYSIA_REQUEST_ID,`,n)+qv(`ELYSIA_TRACE=data.ELYSIA_TRACE,`,n)+qv(`trace=data.trace,`,n)+qv(`hoc=data.hoc,`,r)+`status=data.status
`;e.event.request?.length&&(a+=`const onRequest=app.event.request.map(x=>x.fn)
`),a+=`${e.event.request?.find($)?`async`:``} function map(request){`;let o=i.query||!!t.hooks.query||!!t.hooks.standaloneValidator?.find(e=>e.query);return n||o||e.event.request?.length?(a+=Jv(e,t,i),a+=Uv(e),a+=`return handler(c)}`):a+=`return handler(${Jv(e,t,i,!0)})}`,a+=Wv(e),Function(`data`,a)({app:e,handler:t.compile?.()??t.composed,redirect:jg,status:Jg,hoc:e.extender.higherOrderFunctions.map(e=>e.fn),store:e.store,decorator:e.decorator,route:t.path,randomId:n?Fg:void 0,ELYSIA_TRACE:n?sv:void 0,ELYSIA_REQUEST_ID:n?Ng:void 0,trace:n?e.event.trace?.map(e=>e?.fn??e):void 0,mapEarlyResponse:Q_})},Xv=(e,t,n)=>{if(typeof e==`function`||e instanceof Blob)return;if(ry(e))return()=>e;let r=Z_(e,n??{headers:{}});if(!t.parse?.length&&!t.transform?.length&&!t.beforeHandle?.length&&!t.afterHandle?.length)return r instanceof Promise?r.then(e=>{if(e)return e.headers.has(`content-type`)||e.headers.append(`content-type`,`text/plain`),e.clone()}):(r.headers.has(`content-type`)||r.headers.append(`content-type`,`text/plain`),()=>r.clone())},Zv={open(e){e.data.open?.(e)},message(e,t){e.data.message?.(e,t)},drain(e){e.data.drain?.(e)},close(e,t,n){e.data.close?.(e,t,n)}},Qv=class{constructor(e,t,n=void 0){this.raw=e,this.data=t,this.body=n,this.validator=e.data?.validator,this.sendText=e.sendText.bind(e),this.sendBinary=e.sendBinary.bind(e),this.close=e.close.bind(e),this.terminate=e.terminate.bind(e),this.publishText=e.publishText.bind(e),this.publishBinary=e.publishBinary.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.isSubscribed=e.isSubscribed.bind(e),this.cork=e.cork.bind(e),this.remoteAddress=e.remoteAddress,this.binaryType=e.binaryType,this.data=e.data,this.send=this.send.bind(this),this.ping=this.ping.bind(this),this.pong=this.pong.bind(this),this.publish=this.publish.bind(this)}send(e,t){return Buffer.isBuffer(e)?this.raw.send(e,t):this.validator?.Check(e)===!1?this.raw.send(new Y(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.send(e,t))}ping(e){return Buffer.isBuffer(e)?this.raw.ping(e):this.validator?.Check(e)===!1?this.raw.send(new Y(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.ping(e))}pong(e){return Buffer.isBuffer(e)?this.raw.pong(e):this.validator?.Check(e)===!1?this.raw.send(new Y(`message`,this.validator,e).message):(typeof e==`object`&&(e=JSON.stringify(e)),this.raw.pong(e))}publish(e,t,n){return Buffer.isBuffer(t)?this.raw.publish(e,t,n):this.validator?.Check(t)===!1?this.raw.send(new Y(`message`,this.validator,t).message):(typeof t==`object`&&(t=JSON.stringify(t)),this.raw.publish(e,t,n))}get readyState(){return this.raw.readyState}get id(){return this.data.id}},$v=e=>{let t=typeof e==`function`?[e]:e;return async function(e,n){if(typeof n==`string`){let e=n?.charCodeAt(0);if(e===34||e===47||e===91||e===123)try{n=JSON.parse(n)}catch{}else Tg(n)?n=+n:n===`true`?n=!0:n===`false`?n=!1:n===`null`&&(n=null)}if(t)for(let r=0;r<t.length;r++){let i=t[r](e,n);if(i instanceof Promise&&(i=await i),i!==void 0)return i}return n}},ey=e=>{let t=(n,r)=>{if(r instanceof Promise)return r.then(e=>t(n,e));if(Buffer.isBuffer(r))return n.send(r.toString());if(r===void 0)return;let i=t=>{if(e?.Check(t)===!1)return n.send(new Y(`message`,e,t).message);if(typeof t==`object`)return n.send(JSON.stringify(t));n.send(t)};if(typeof r?.next!=`function`)return void i(r);let a=r.next();if(a instanceof Promise)return(async()=>{let t=await a;if(e?.Check(t)===!1)return n.send(new Y(`message`,e,t).message);if(i(t.value),!t.done)for await(let e of r)i(e)})();if(i(a.value),!a.done)for(let e of r)i(e)};return t},ty=/:.+?\?(?=\/|$)/,ny=e=>{let t=ty.exec(e);if(!t)return[e];let n=[],r=e.slice(0,t.index),i=t[0].slice(0,-1),a=e.slice(t.index+t[0].length);n.push(r.slice(0,-1)),n.push(r+i);for(let e of ny(a))e&&(e.startsWith(`/:`)||n.push(r.slice(0,-1)+e),n.push(r+i+e));return n},ry=e=>typeof e==`object`&&!!e&&(e.toString()===`[object HTMLBundle]`||typeof e.index==`string`),iy={GET:!0,HEAD:!0,OPTIONS:!0,DELETE:!0,PATCH:!0,POST:!0,PUT:!0},ay=e=>{if(!e.config.aot||!e.config.systemRouter)return;let t={},n=(e,n)=>{t[e.path]?t[e.path][e.method]||(t[e.path][e.method]=n):t[e.path]={[e.method]:n}},r=e.routeTree;for(let i of e.router.history){if(typeof i.handler!=`function`)continue;let a=i.method;if(a===`GET`&&`WS_${i.path}`in r||a===`WS`||i.path.charCodeAt(i.path.length-1)===42||!(a in iy))continue;if(a===`ALL`){`WS_${i.path}`in r||(t[i.path]=i.hooks?.config?.mount?i.hooks.trace||e.event.trace||e.extender.higherOrderFunctions?Yv(e,i):i.hooks.mount||i.handler:i.handler);continue}let o,s=e.config.precompile?Yv(e,i):t=>o?o(t):(o=Yv(e,i))(t);for(let e of ny(i.path))n({method:a,path:e},s)}return t},oy=(e,t)=>{if(!t)return e;for(let n of Object.keys(t))if(e[n]!==t[n]){if(!e[n]){e[n]=t[n];continue}if(e[n]&&t[n]){if(typeof e[n]==`function`||e[n]instanceof Response){e[n]=t[n];continue}e[n]={...e[n],...t[n]}}}return e},sy={...X_,name:`bun`,handler:{mapResponse:Z_,mapEarlyResponse:Q_,mapCompactResponse:$_,createStaticHandler:tv,createNativeStaticHandler:Xv},composeHandler:{...X_.composeHandler,headers:Qh?`c.headers=c.request.headers.toJSON()
`:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`},listen(e){return(t,n)=>{if(typeof Bun>`u`)throw Error(`.listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch`);if(e.compile(),typeof t==`string`){if(!Tg(t))throw Error(`Port must be a numeric value`);t=parseInt(t)}let r=(e,{withAsync:t=!1}={})=>{let n={},r=[];for(let[i,a]of Object.entries(e))if(Bg){if(!a)continue;for(let[e,o]of Object.entries(a))if(!(!o||!(e in iy))){if(o instanceof Promise){t&&(n[i]||(n[i]={}),r.push(o.then(t=>{t instanceof Response&&(n[i][e]=t),ry(t)&&(n[i][e]=t)})));continue}!(o instanceof Response)&&!ry(o)||(n[i]||(n[i]={}),n[i][e]=o)}}else{if(!a)continue;if(a instanceof Promise){t&&(n[i]||(n[i]={}),r.push(a.then(e=>{e instanceof Response&&(n[i]=e)})));continue}if(!(a instanceof Response))continue;n[i]=a}return t?Promise.all(r).then(()=>n):n},i=typeof t==`object`?{development:!Gg,reusePort:!0,idleTimeout:30,...e.config.serve||{},...t||{},routes:oy(oy(r(e.router.response),ay(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...Zv||{},...t.websocket||{}},fetch:e.fetch}:{development:!Gg,reusePort:!0,idleTimeout:30,...e.config.serve||{},routes:oy(oy(r(e.router.response),ay(e)),e.config.serve?.routes),websocket:{...e.config.websocket||{},...Zv||{}},port:t,fetch:e.fetch};if(e.server=Bun.serve(i),e.event.start)for(let t=0;t<e.event.start.length;t++)e.event.start[t].fn(e);n&&n(e.server),process.on(`beforeExit`,()=>{if(e.server&&(e.server.stop?.(),e.server=null,e.event.stop))for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)}),e.promisedModules.then(async()=>{e.server?.reload({...i,fetch:e.fetch,routes:oy(oy(await r(e.router.response,{withAsync:!0}),ay(e)),e.config.serve?.routes)}),Bun?.gc(!1)})}},async stop(e,t){if(e.server){if(e.server.stop(t),e.server=null,e.event.stop?.length)for(let t=0;t<e.event.stop.length;t++)e.event.stop[t].fn(e)}else console.log("Elysia isn't running. Call `app.listen` to start the server.",Error().stack)},ws(e,t,n){let{parse:r,body:i,response:a,...o}=n,s=bv(i,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize}),c=bv(a,{modules:e.definitions.typebox,models:e.definitions.type,normalize:e.config.normalize});e.route(`WS`,t,async t=>{let i=t.server??e.server,{set:a,path:o,qi:l,headers:u,query:d,params:f}=t;if(t.validator=c,n.upgrade)if(typeof n.upgrade==`function`){let e=n.upgrade(t);e instanceof Promise&&await e}else n.upgrade&&Object.assign(a.headers,n.upgrade);if(a.cookie&&J(a.cookie)){let e=F_(a.cookie);e&&(a.headers[`set-cookie`]=e)}a.headers[`set-cookie`]&&Array.isArray(a.headers[`set-cookie`])&&(a.headers=I_(new Headers(a.headers),a.headers[`set-cookie`]));let p=ey(c),m=$v(r),h;if(typeof n.beforeHandle==`function`){let e=n.beforeHandle(t);e instanceof Promise&&await e}let g=[...n.error?Array.isArray(n.error)?n.error:[n.error]:[],...(e.event.error??[]).map(e=>typeof e==`function`?e:e.fn)].filter(e=>e),_=g.length>0,ee=_?async(e,n)=>{for(let r of g){let i=r(Object.assign(t,{error:n}));if(i instanceof Promise&&(i=await i),await p(e,i),i)break}}:()=>{};if(!i?.upgrade(t.request,{headers:J(a.headers)?a.headers:void 0,data:{...t,get id(){return h||=Fg()},validator:c,ping(e){n.ping?.(e)},pong(e){n.pong?.(e)},open:async e=>{try{await p(e,n.open?.(new Qv(e,t)))}catch(t){ee(e,t)}},message:async(e,r)=>{let i=await m(e,r);if(s?.Check(i)===!1){let t=new Y(`message`,s,i);return _?ee(e,t):void e.send(t.message)}try{await p(e,n.message?.(new Qv(e,t,i),i))}catch(t){ee(e,t)}},drain:async e=>{try{await p(e,n.drain?.(new Qv(e,t)))}catch(t){ee(e,t)}},close:async(e,r,i)=>{try{await p(e,n.close?.(new Qv(e,t),r,i))}catch(t){ee(e,t)}}}}))return a.status=400,`Expected a websocket connection`},{...o,websocket:n})}},cy=Kh?Bun.env:{},ly=(e,t)=>{let n=e.schema;if(n&&(n.$defs?.[n.$ref]&&(n=n.$defs[n.$ref]),n?.properties))for(let[e,r]of Object.entries(n.properties))t[e]??=r.default},uy=e=>{let{mapResponse:t,mapEarlyResponse:n}=e[`~adapter`].handler,r=e.setHeaders;return async i=>{let a=i.url,o=a.indexOf(`/`,11),s=a.indexOf(`?`,o+1),c=s===-1?a.substring(o):a.substring(o,s),l={cookie:{},status:200,headers:r?{...r}:{}},u=Object.assign({},e.singleton.decorator,{set:l,store:e.singleton.store,request:i,path:c,qi:s,error:Jg,status:Jg,redirect:jg});try{if(e.event.request)for(let t=0;t<e.event.request.length;t++){let r=e.event.request[t].fn,i=r(u);if(i instanceof Promise&&(i=await i),i=n(i,l),i)return u.response=i}let r=i.method===`GET`&&i.headers.get(`upgrade`)?.toLowerCase()===`websocket`?`WS`:i.method,o=e.router.dynamic.find(i.method,c)??e.router.dynamic.find(r,c)??e.router.dynamic.find(`ALL`,c);if(!o)throw u.query=s===-1?{}:ov(a.substring(s+1)),new Yg;let{handle:d,hooks:f,validator:p,content:m,route:h}=o.store,g;if(i.method!==`GET`&&i.method!==`HEAD`)if(m)switch(m){case`application/json`:g=await i.json();break;case`text/plain`:g=await i.text();break;case`application/x-www-form-urlencoded`:g=ov(await i.text());break;case`application/octet-stream`:g=await i.arrayBuffer();break;case`multipart/form-data`:g={};let e=await i.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}else{let t;if(i.body&&(t=i.headers.get(`content-type`)),t){let n=t.indexOf(`;`);if(n!==-1&&(t=t.slice(0,n)),u.contentType=t,f.parse)for(let n=0;n<f.parse.length;n++){let r=f.parse[n].fn;if(typeof r==`string`)switch(r){case`json`:case`application/json`:g=await i.json();break;case`text`:case`text/plain`:g=await i.text();break;case`urlencoded`:case`application/x-www-form-urlencoded`:g=ov(await i.text());break;case`arrayBuffer`:case`application/octet-stream`:g=await i.arrayBuffer();break;case`formdata`:case`multipart/form-data`:g={};let n=await i.formData();for(let e of n.keys()){if(g[e])continue;let t=n.getAll(e);t.length===1?g[e]=t[0]:g[e]=t}break;default:let a=e[`~parser`][r];if(a){let e=a(u,t);if(e instanceof Promise&&(e=await e),e){g=e;break}}break}else{let e=r(u,t);if(e instanceof Promise&&(e=await e),e){g=e;break}}}if(delete u.contentType,g===void 0)switch(t){case`application/json`:g=await i.json();break;case`text/plain`:g=await i.text();break;case`application/x-www-form-urlencoded`:g=ov(await i.text());break;case`application/octet-stream`:g=await i.arrayBuffer();break;case`multipart/form-data`:g={};let e=await i.formData();for(let t of e.keys()){if(g[t])continue;let n=e.getAll(t);n.length===1?g[t]=n[0]:g[t]=n}break}}}u.route=h,u.body=g,u.params=o?.params||void 0,u.query=s===-1?{}:ov(a.substring(s+1)),u.headers={};for(let[e,t]of i.headers.entries())u.headers[e]=t;let _={domain:e.config.cookie?.domain??p?.cookie?.config.domain,expires:e.config.cookie?.expires??p?.cookie?.config.expires,httpOnly:e.config.cookie?.httpOnly??p?.cookie?.config.httpOnly,maxAge:e.config.cookie?.maxAge??p?.cookie?.config.maxAge,path:e.config.cookie?.path??p?.cookie?.config.path,priority:e.config.cookie?.priority??p?.cookie?.config.priority,partitioned:e.config.cookie?.partitioned??p?.cookie?.config.partitioned,sameSite:e.config.cookie?.sameSite??p?.cookie?.config.sameSite,secure:e.config.cookie?.secure??p?.cookie?.config.secure,secrets:e.config.cookie?.secrets??p?.cookie?.config.secrets,sign:e.config.cookie?.sign??p?.cookie?.config.sign},ee=i.headers.get(`cookie`);u.cookie=await P_(u.set,ee,_);let te=p?.createHeaders?.();te&&ly(te,u.headers);let ne=p?.createParams?.();ne&&ly(ne,u.params);let re=p?.createQuery?.();if(re&&ly(re,u.query),f.transform)for(let e=0;e<f.transform.length;e++){let t=f.transform[e],r=t.fn(u);if(r instanceof Promise&&(r=await r),r instanceof qg){let e=n(r,u.set);if(e)return u.response=e}t.subType===`derive`&&Object.assign(u,r)}if(p){if(te){let e=structuredClone(u.headers);for(let[t,n]of i.headers)e[t]=n;if(p.headers.Check(e)===!1)throw new Y(`header`,p.headers,e)}else p.headers?.Decode&&(u.headers=p.headers.Decode(u.headers));if(ne?.Check(u.params)===!1)throw new Y(`params`,p.params,u.params);if(p.params?.Decode&&(u.params=p.params.Decode(u.params)),p.query?.schema){let e=p.query.schema;e.$defs?.[e.$ref]&&(e=e.$defs[e.$ref]);let t=e.properties;for(let e of Object.keys(t)){let n=t[e];(n.type===`array`||n.items?.type===`string`)&&typeof u.query[e]==`string`&&u.query[e]&&(u.query[e]=u.query[e].split(`,`))}}if(re?.Check(u.query)===!1)throw new Y(`query`,p.query,u.query);if(p.query?.Decode&&(u.query=p.query.Decode(u.query)),p.createCookie?.()){let e={};for(let[t,n]of Object.entries(u.cookie))e[t]=n.value;if(p.cookie.Check(e)===!1)throw new Y(`cookie`,p.cookie,e);p.cookie?.Decode&&(e=p.cookie.Decode(e))}if(p.createBody?.()?.Check(g)===!1)throw new Y(`body`,p.body,g);p.body?.Decode&&(u.body=p.body.Decode(g))}if(f.beforeHandle)for(let e=0;e<f.beforeHandle.length;e++){let t=f.beforeHandle[e],r=t.fn(u);if(r instanceof Promise&&(r=await r),r instanceof qg){let e=n(r,u.set);if(e)return u.response=e}if(t.subType===`resolve`){Object.assign(u,r);continue}if(r!==void 0){if(u.response=r,f.afterHandle)for(let e=0;e<f.afterHandle.length;e++){let t=f.afterHandle[e].fn(u);t instanceof Promise&&(t=await t),t&&(r=t)}let e=n(r,u.set);if(e)return u.response=e}}let v=typeof d==`function`?d(u):d;if(v instanceof Promise&&(v=await v),f.afterHandle?.length){u.response=v;for(let e=0;e<f.afterHandle.length;e++){let t=f.afterHandle[e].fn(u);t instanceof Promise&&(t=await t);let r=t instanceof qg,i=r?t.code:l.status?typeof l.status==`string`?_g[l.status]:l.status:200;r&&(l.status=i,t=t.response);let a=p?.createResponse?.()?.[i];if(a?.Check(t)===!1)if(a?.Clean){let e=a.Clean(t);if(a?.Check(e)===!1)throw new Y(`response`,a,t);t=e}else throw new Y(`response`,a,t);a?.Encode&&(u.response=t=a.Encode(t)),a?.Clean&&(u.response=t=a.Clean(t));let o=n(t,u.set);if(o!==void 0)return u.response=o}}else{let e=v instanceof qg,t=e?v.code:l.status?typeof l.status==`string`?_g[l.status]:l.status:200;e&&(l.status=t,v=v.response);let n=p?.createResponse?.()?.[t];if(n?.Check(v)===!1)if(n?.Clean){let e=n.Clean(v);if(n?.Check(e)===!1)throw new Y(`response`,n,v);v=e}else throw new Y(`response`,n,v);n?.Encode&&(v=n.Encode(v)),n?.Clean&&(v=n.Clean(v))}if(u.set.cookie&&_?.sign){let e=_.secrets?typeof _.secrets==`string`?_.secrets:_.secrets[0]:void 0;if(_.sign===!0){if(e)for(let[t,n]of Object.entries(u.set.cookie))u.set.cookie[t].value=await xg(n.value,e)}else{let t=p?.cookie?.schema?.properties;if(e)for(let n of _.sign)n in t&&u.set.cookie[n]?.value&&(u.set.cookie[n].value=await xg(u.set.cookie[n].value,e))}}return t(u.response=v,u.set)}catch(t){let n=t instanceof Mp&&t.error?t.error:t;return e.handleError(u,n)}finally{e.event.afterResponse&&setImmediate(async()=>{for(let t of e.event.afterResponse)await t.fn(u)})}}},dy=e=>{let{mapResponse:t}=e[`~adapter`].handler;return async(n,r)=>{let i=Object.assign(n,{error:r,code:r.code});if(i.set=n.set,e.event.error)for(let r=0;r<e.event.error.length;r++){let a=e.event.error[r].fn(i);if(a instanceof Promise&&(a=await a),a!=null)return n.response=t(a,n.set)}return new Response(typeof r.cause==`string`?r.cause:r.message,{headers:n.set.headers,status:r.status??500})}},fy=Symbol.dispose,py=class e{constructor(e={}){this.server=null,this.dependencies={},this[`~Prefix`]=``,this[`~Singleton`]=null,this[`~Definitions`]=null,this[`~Metadata`]=null,this[`~Ephemeral`]=null,this[`~Volatile`]=null,this[`~Routes`]=null,this.singleton={decorator:{},store:{},derive:{},resolve:{}},this.definitions={typebox:X.Module({}),type:{},error:{}},this.extender={macro:{},higherOrderFunctions:[]},this.validator={global:null,scoped:null,local:null,getCandidate(){return!this.global&&!this.scoped&&!this.local?{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0}:og(og(this.global,this.scoped),this.local)}},this.standaloneValidator={global:null,scoped:null,local:null},this.event={},this.router={"~http":void 0,get http(){return this[`~http`]||=new _h({lazy:!0,onParam:lh.default}),this[`~http`]},"~dynamic":void 0,get dynamic(){return this[`~dynamic`]||=new _h({onParam:lh.default}),this[`~dynamic`]},static:{},response:{},history:[]},this.routeTree={},this.inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1,path:!1,route:!1,url:!1},this[`~parser`]={},this.handle=async e=>this.fetch(e),this.fetch=e=>(this.fetch=this.config.aot?Gv(this):uy(this))(e),this.handleError=async(e,t)=>(this.handleError=this.config.aot?Kv(this):dy(this))(e,t),this.listen=(e,t)=>(this[`~adapter`].listen(this)(e,t),this.promisedModules.size&&k_(5e3),this.promisedModules.then(()=>{k_(1e3)}),this),this.stop=async e=>(await this[`~adapter`].stop?.(this,e),this),this[fy]=()=>{this.server&&this.stop()},e.tags&&(e.detail?e.detail.tags=e.tags:e.detail={tags:e.tags}),this.config={aot:cy.ELYSIA_AOT!==`false`,nativeStaticResponse:!0,systemRouter:!0,encodeSchema:!0,normalize:!0,...e,prefix:e.prefix?e.prefix.charCodeAt(0)===47?e.prefix:`/${e.prefix}`:void 0,cookie:{path:`/`,...e?.cookie},experimental:e?.experimental??{},seed:e?.seed===void 0?``:e?.seed},this[`~adapter`]=e.adapter??(typeof Bun<`u`?sy:X_),e?.analytic&&(e?.name||e?.seed!==void 0)&&(this.telemetry={stack:Error().stack})}get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}getGlobalDefinitions(){return this.definitions}getServer(){return this.server}getParent(){return null}get promisedModules(){return this._promisedModules||=new Eg(console.error,()=>{}),this._promisedModules}env(e,t=cy){if(bv(e,{modules:this.definitions.typebox,dynamic:!0,additionalProperties:!0,coerce:!0,sanitize:()=>this.config.sanitize}).Check(t)===!1){let n=new Y(`env`,e,t);throw Error(n.all.map(e=>e.summary).join(`
`))}return this}wrap(e){return this.extender.higherOrderFunctions.push({checksum:dg(JSON.stringify({name:this.config.name,seed:this.config.seed,content:e.toString()})),fn:e}),this}get models(){let e={};for(let t of Object.keys(this.definitions.type))e[t]=bv(this.definitions.typebox.Import(t));return e.modules=this.definitions.typebox,e}add(e,t,n,r,i){let a=i?.skipPrefix??!1,o=i?.allowMeta??!1;r??={},this.applyMacro(r);let s=[];if(r.standaloneValidator&&(s=s.concat(r.standaloneValidator)),this.standaloneValidator.local&&(s=s.concat(this.standaloneValidator.local)),this.standaloneValidator.scoped&&(s=s.concat(this.standaloneValidator.scoped)),this.standaloneValidator.global&&(s=s.concat(this.standaloneValidator.global)),t!==``&&t.charCodeAt(0)!==47&&(t=`/`+t),this.config.prefix&&!a&&(t=this.config.prefix+t),r?.type)switch(r.type){case`text`:r.type=`text/plain`;break;case`json`:r.type=`application/json`;break;case`formdata`:r.type=`multipart/form-data`;break;case`urlencoded`:r.type=`application/x-www-form-urlencoded`;break;case`arrayBuffer`:r.type=`application/octet-stream`;break;default:break}let c=this.validator.getCandidate(),l={body:r?.body??c?.body,headers:r?.headers??c?.headers,params:r?.params??c?.params,query:r?.query??c?.query,cookie:r?.cookie??c?.cookie,response:r?.response??c?.response},u=this.config.precompile===!0||typeof this.config.precompile==`object`&&this.config.precompile.compose===!0,d=()=>{let e=this.definitions.type,t=!this.config.aot,n=this.config.normalize,r=this.definitions.typebox,i=()=>this.config.sanitize,a=()=>{if(l.cookie||s.find(e=>e.cookie))return Av({modules:r,validator:l.cookie,defaultConfig:this.config.cookie,normalize:n,config:l.cookie?.config??{},dynamic:t,models:e,validators:s.map(e=>e.cookie),sanitize:i})};return u?{body:bv(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:kv(),validators:s.map(e=>e.body),sanitize:i}),headers:bv(l.headers,{modules:r,dynamic:t,models:e,additionalProperties:!0,coerce:!0,additionalCoerce:Tv(),validators:s.map(e=>e.headers),sanitize:i}),params:bv(l.params,{modules:r,dynamic:t,models:e,coerce:!0,additionalCoerce:Tv(),validators:s.map(e=>e.params),sanitize:i}),query:bv(l.query,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:Dv(),validators:s.map(e=>e.query),sanitize:i}),cookie:a(),response:Cv(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:s.map(e=>e.response),sanitize:i})}:{createBody(){return this.body?this.body:this.body=bv(l.body,{modules:r,dynamic:t,models:e,normalize:n,additionalCoerce:kv(),validators:s.map(e=>e.body),sanitize:i})},createHeaders(){return this.headers?this.headers:this.headers=bv(l.headers,{modules:r,dynamic:t,models:e,normalize:n,additionalProperties:!n,coerce:!0,additionalCoerce:Tv(),validators:s.map(e=>e.headers),sanitize:i})},createParams(){return this.params?this.params:this.params=bv(l.params,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:Tv(),validators:s.map(e=>e.params),sanitize:i})},createQuery(){return this.query?this.query:this.query=bv(l.query,{modules:r,dynamic:t,models:e,normalize:n,coerce:!0,additionalCoerce:Dv(),validators:s.map(e=>e.query),sanitize:i})},createCookie(){return this.cookie?this.cookie:this.cookie=a()},createResponse(){return this.response?this.response:this.response=Cv(l.response,{modules:r,dynamic:t,models:e,normalize:n,validators:s.map(e=>e.response),sanitize:i})}}};(c.body||c.cookie||c.headers||c.params||c.query||c.response)&&(r=sg(r,c)),r.tags&&(r.detail?r.detail.tags=r.tags:r.detail={tags:r.tags}),J(this.config.detail)&&(r.detail=ng(Object.assign({},this.config.detail),r.detail));let f=J(this.event)?sg(this.event,Og(r)):{...cg(Og(r))};if(s.length&&Object.assign(f,{standaloneValidator:s}),this.config.aot===!1){let i=d();this.router.dynamic.add(e,t,{validator:i,hooks:f,content:r?.type,handle:n,route:t});let a=zg(t,{dynamic:!0});if(t!==a&&this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t}),this.config.strictPath===!1){let a=Rg(t);this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t});let o=zg(a);a!==o&&this.router.dynamic.add(e,a,{validator:i,hooks:f,content:r?.type,handle:n,route:t})}this.router.history.push({method:e,path:t,composed:null,handler:n,compile:void 0,hooks:f});return}let p=this[`~adapter`].handler,m=typeof n==`function`?void 0:()=>{let r={redirect:jg,request:this[`~adapter`].isWebStandard?new Request(`http://e.ly${t}`,{method:e}):void 0,server:null,set:{headers:Object.assign({},this.setHeaders)},status:Jg,store:this.store};try{this.event.request?.map(e=>{if(typeof e.fn==`function`)return e.fn(r);if(typeof e==`function`)return e(r)})}catch(e){let t;r.error=e,this.event.error?.some(e=>{if(typeof e.fn==`function`)return t=e.fn(r);if(typeof e==`function`)return t=e(r)}),t!==void 0&&(n=t)}let i=p.createNativeStaticHandler?.(n,f,r.set);return i instanceof Promise?i.then(e=>{if(e)return e}):i?.()},h=this.config.nativeStaticResponse===!0,g=t=>{!h||!m||(Bg?this.router.response[t]?this.router.response[t][e]=m():this.router.response[t]={[e]:m()}:this.router.response[t]=m())};g(t);let _,ee=()=>_||=Hv({app:this,path:t,method:e,hooks:f,validator:d(),handler:typeof n!=`function`&&typeof p.createStaticHandler!=`function`?()=>n:n,allowMeta:o,inference:this.inference}),te;if(`${e}_${t}`in this.routeTree)for(let n=0;n<this.router.history.length;n++){let r=this.router.history[n];if(r.path===t&&r.method===e){te=n;break}}else this.routeTree[`${e}_${t}`]=this.router.history.length;let ne=te??this.router.history.length,re=u?ee():e=>(this.router.history[ne].composed=ee())(e);te===void 0?this.router.history.push(Object.assign({method:e,path:t,composed:re,compile:ee,handler:n,hooks:f},r.webSocket?{websocket:r.websocket}:void 0)):this.router.history[te]=Object.assign({method:e,path:t,composed:re,compile:ee,handler:n,hooks:f},s.length?{standaloneValidators:s}:void 0,r.webSocket?{websocket:r.websocket}:void 0);let v={handler:u?re:void 0,compile(){return this.handler=ee()}},ie=this.router.static,ae=t.indexOf(`:`)===-1&&t.indexOf(`*`)===-1;if(e===`WS`){if(ae){t in ie?ie[t][e]=ne:ie[t]={[e]:ne};return}this.router.http.add(`WS`,t,v),this.config.strictPath||this.router.http.add(`WS`,Rg(t),v);let n=zg(t,{dynamic:!0});t!==n&&this.router.http.add(`WS`,n,v);return}if(ae)t in ie?ie[t][e]=ne:ie[t]={[e]:ne},this.config.strictPath||g(Rg(t));else{if(this.router.http.add(e,t,v),!this.config.strictPath){let n=Rg(t);g(n),this.router.http.add(e,n,v)}let n=zg(t,{dynamic:!0});t!==n&&(this.router.http.add(e,n,v),g(n))}}headers(e){return e?(this.setHeaders||={},this.setHeaders=ng(this.setHeaders,e),this):this}onStart(e){return this.on(`start`,e),this}onRequest(e){return this.on(`request`,e),this}onParse(e,t){return t?this.on(e,`parse`,t):typeof e==`string`?this.on(`parse`,this[`~parser`][e]):this.on(`parse`,e)}parser(e,t){return this[`~parser`][e]=t,this}onTransform(e,t){return t?this.on(e,`transform`,t):this.on(`transform`,e)}resolve(e,t){t||(t=e,e={as:`local`});let n={subType:`resolve`,fn:t};return this.onBeforeHandle(e,n)}mapResolve(e,t){t||(t=e,e={as:`local`});let n={subType:`mapResolve`,fn:t};return this.onBeforeHandle(e,n)}onBeforeHandle(e,t){return t?this.on(e,`beforeHandle`,t):this.on(`beforeHandle`,e)}onAfterHandle(e,t){return t?this.on(e,`afterHandle`,t):this.on(`afterHandle`,e)}mapResponse(e,t){return t?this.on(e,`mapResponse`,t):this.on(`mapResponse`,e)}onAfterResponse(e,t){return t?this.on(e,`afterResponse`,t):this.on(`afterResponse`,e)}trace(e,t){t||(t=e,e={as:`local`}),Array.isArray(t)||(t=[t]);for(let n of t)this.on(e,`trace`,lv(n));return this}error(e,t){switch(typeof e){case`string`:return t.prototype[Wg]=e,this.definitions.error[e]=t,this;case`function`:return this.definitions.error=e(this.definitions.error),this}for(let[t,n]of Object.entries(e))n.prototype[Wg]=t,this.definitions.error[t]=n;return this}onError(e,t){return t?this.on(e,`error`,t):this.on(`error`,e)}onStop(e){return this.on(`stop`,e),this}on(e,t,n){let r;switch(typeof e){case`string`:r=e,n=t;break;case`object`:r=t,!Array.isArray(t)&&typeof t==`object`&&(n=t);break}n=Array.isArray(n)?Dg(n):typeof n==`function`?[{fn:n}]:[n];let i=n;for(let t of i)t.scope=typeof e==`string`?`local`:e?.as??`local`,(r===`resolve`||r===`derive`)&&(t.subType=r);r!==`trace`&&(this.inference=j_({[r]:i.map(e=>e.fn)},this.inference));for(let e of i){let t=mg(e,`global`,{skipIfHasType:!0});switch(r){case`start`:this.event.start??=[],this.event.start.push(t);break;case`request`:this.event.request??=[],this.event.request.push(t);break;case`parse`:this.event.parse??=[],this.event.parse.push(t);break;case`transform`:this.event.transform??=[],this.event.transform.push(t);break;case`derive`:this.event.transform??=[],this.event.transform.push(Dg(t,`derive`));break;case`beforeHandle`:this.event.beforeHandle??=[],this.event.beforeHandle.push(t);break;case`resolve`:this.event.beforeHandle??=[],this.event.beforeHandle.push(Dg(t,`resolve`));break;case`afterHandle`:this.event.afterHandle??=[],this.event.afterHandle.push(t);break;case`mapResponse`:this.event.mapResponse??=[],this.event.mapResponse.push(t);break;case`afterResponse`:this.event.afterResponse??=[],this.event.afterResponse.push(t);break;case`trace`:this.event.trace??=[],this.event.trace.push(t);break;case`error`:this.event.error??=[],this.event.error.push(t);break;case`stop`:this.event.stop??=[],this.event.stop.push(t);break}}return this}as(e){return Lg(this.event.parse,e),Lg(this.event.transform,e),Lg(this.event.beforeHandle,e),Lg(this.event.afterHandle,e),Lg(this.event.mapResponse,e),Lg(this.event.afterResponse,e),Lg(this.event.trace,e),Lg(this.event.error,e),e===`scoped`?(this.validator.scoped=og(this.validator.scoped,this.validator.local),this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null)):e===`global`&&(this.validator.global=og(this.validator.global,og(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null,this.standaloneValidator.local!==null&&(this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null),this.standaloneValidator.scoped!==null&&(this.standaloneValidator.global||=[],this.standaloneValidator.global.push(...this.standaloneValidator.scoped),this.standaloneValidator.scoped=null)),this}group(t,n,r){let i=new e({...this.config,prefix:``});i.singleton={...this.singleton},i.definitions={...this.definitions},i.getServer=()=>this.getServer(),i.inference=Ag(this.inference),i.extender={...this.extender},i[`~parser`]=this[`~parser`],i.standaloneValidator={local:[...this.standaloneValidator.local??[]],scoped:[...this.standaloneValidator.scoped??[]],global:[...this.standaloneValidator.global??[]]};let a=typeof n==`object`,o=(a?r:n)(i);return this.singleton=ng(this.singleton,i.singleton),this.definitions=ng(this.definitions,i.definitions),o.event.request?.length&&(this.event.request=[...this.event.request||[],...o.event.request||[]]),o.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...o.event.mapResponse||[]]),this.model(o.definitions.type),Object.values(i.router.history).forEach(({method:e,path:r,handler:i,hooks:s})=>{if(r=(a?``:this.config.prefix??``)+t+r,a){let{body:t,headers:a,query:c,params:l,cookie:u,response:d,...f}=n,p=s,m=t||a||c||l||u||d;this.add(e,r,i,sg(f,{...p||{},error:p.error?Array.isArray(p.error)?[...p.error??[],...o.event.error??[]]:[p.error,...o.event.error??[]]:o.event.error,standaloneValidator:m?[...p.standaloneValidator??[],{body:t,headers:a,query:c,params:l,cookie:u,response:d}]:p.standaloneValidator}),void 0)}else this.add(e,r,i,sg(s,{error:o.event.error}),{skipPrefix:!0})}),this}guard(t,n){if(!n){if(typeof t==`object`){this.applyMacro(t),t.detail&&(this.config.detail?this.config.detail=ng(Object.assign({},this.config.detail),t.detail):this.config.detail=t.detail),t.tags&&(this.config.detail?this.config.detail.tags=t.tags:this.config.detail={tags:t.tags});let e=t.as??`local`;if(t.schema===`standalone`){this.standaloneValidator[e]||(this.standaloneValidator[e]=[]);let n=t?.response?typeof t.response==`string`||A in t.response||`~standard`in t.response?{200:t.response}:t?.response:void 0;this.standaloneValidator[e].push({body:t.body,headers:t.headers,params:t.params,query:t.query,response:n,cookie:t.cookie})}else this.validator[e]={body:t.body??this.validator[e]?.body,headers:t.headers??this.validator[e]?.headers,params:t.params??this.validator[e]?.params,query:t.query??this.validator[e]?.query,response:t.response??this.validator[e]?.response,cookie:t.cookie??this.validator[e]?.cookie};return t.parse&&this.on({as:e},`parse`,t.parse),t.transform&&this.on({as:e},`transform`,t.transform),t.derive&&this.on({as:e},`derive`,t.derive),t.beforeHandle&&this.on({as:e},`beforeHandle`,t.beforeHandle),t.resolve&&this.on({as:e},`resolve`,t.resolve),t.afterHandle&&this.on({as:e},`afterHandle`,t.afterHandle),t.mapResponse&&this.on({as:e},`mapResponse`,t.mapResponse),t.afterResponse&&this.on({as:e},`afterResponse`,t.afterResponse),t.error&&this.on({as:e},`error`,t.error),this}return this.guard({},t)}let r=new e({...this.config,prefix:``});r.singleton={...this.singleton},r.definitions={...this.definitions},r.inference=Ag(this.inference),r.extender={...this.extender},r.getServer=()=>this.getServer();let i=n(r);return this.singleton=ng(this.singleton,r.singleton),this.definitions=ng(this.definitions,r.definitions),i.getServer=()=>this.server,i.event.request?.length&&(this.event.request=[...this.event.request||[],...i.event.request||[]]),i.event.mapResponse?.length&&(this.event.mapResponse=[...this.event.mapResponse||[],...i.event.mapResponse||[]]),this.model(i.definitions.type),Object.values(r.router.history).forEach(({method:e,path:n,handler:r,hooks:a})=>{let{body:o,headers:s,query:c,params:l,cookie:u,response:d,...f}=t,p=o||s||c||l||u||d;this.add(e,n,r,sg(f,{...a||{},error:a.error?Array.isArray(a.error)?[...a.error??[],...i.event.error??[]]:[a.error,...i.event.error??[]]:i.event.error,standaloneValidator:p?[...a.standaloneValidator??[],{body:o,headers:s,query:c,params:l,cookie:u,response:d}]:a.standaloneValidator}))}),this}use(t){if(!t)return this;if(Array.isArray(t)){let e=this;for(let n of t)e=e.use(n);return e}return t instanceof Promise?(this.promisedModules.add(t.then(t=>{if(typeof t==`function`)return t(this);if(t instanceof e||t.constructor?.name===`Elysia`)return this._use(t).compile();if(typeof t.default==`function`)return t.default(this);if(t.default instanceof e||t.constructor?.name===`Elysia`||t.constructor?.name===`_Elysia`)return this._use(t.default);try{return this._use(t.default)}catch(e){throw console.error(`Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.`),e}}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):this._use(t)}propagatePromiseModules(e){if(e.promisedModules.size<=0)return this;for(let t of e.promisedModules.promises)this.promisedModules.add(t.then(e=>{if(!e)return;let t=this._use(e);return t instanceof Promise?t.then(t=>{t?t.compile():e.compile()}):e.compile()}));return this}_use(t){if(typeof t==`function`){let n=t(this);return n instanceof Promise?(this.promisedModules.add(n.then(t=>{if(t instanceof e){t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.model(this.definitions.type),t.error(this.definitions.error);for(let{method:e,path:n,handler:r,hooks:i}of Object.values(t.router.history))this.add(e,n,r,i,void 0);return t===this?void 0:(this.propagatePromiseModules(t),t)}return typeof t==`function`?t(this):typeof t.default==`function`?t.default(this):this._use(t)}).then(e=>(e&&typeof e.compile==`function`&&e.compile(),e))),this):n}this.propagatePromiseModules(t);let n=t.config.name,r=t.config.seed;if(t.getParent=()=>this,t.getServer=()=>this.getServer(),t.getGlobalRoutes=()=>this.getGlobalRoutes(),t.getGlobalDefinitions=()=>this.getGlobalDefinitions(),t.standaloneValidator?.scoped&&(this.standaloneValidator.local?this.standaloneValidator.local=this.standaloneValidator.local.concat(t.standaloneValidator.scoped):this.standaloneValidator.local=t.standaloneValidator.scoped),t.standaloneValidator?.global&&(this.standaloneValidator.global?this.standaloneValidator.global=this.standaloneValidator.global.concat(t.standaloneValidator.global):this.standaloneValidator.global=t.standaloneValidator.global),J(t[`~parser`])&&(this[`~parser`]={...t[`~parser`],...this[`~parser`]}),t.setHeaders&&this.headers(t.setHeaders),n){n in this.dependencies||(this.dependencies[n]=[]);let e=r===void 0?0:dg(n+JSON.stringify(r));this.dependencies[n].some(({checksum:t})=>e===t)||(this.extender.macro={...this.extender.macro,...t.extender.macro},this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions))}else J(t.extender.macro)&&(this.extender.macro={...this.extender.macro,...t.extender.macro}),t.extender.higherOrderFunctions.length&&(this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(t.extender.higherOrderFunctions));if(t.extender.higherOrderFunctions.length){Ig(this.extender.higherOrderFunctions);let e=[];for(let t=0;t<this.extender.higherOrderFunctions.length;t++){let n=this.extender.higherOrderFunctions[t];n.checksum&&(e.includes(n.checksum)&&(this.extender.higherOrderFunctions.splice(t,1),t--),e.push(n.checksum))}e.length=0}this.inference=A_(this.inference,t.inference),J(t.singleton.decorator)&&this.decorate(t.singleton.decorator),J(t.singleton.store)&&this.state(t.singleton.store),J(t.definitions.type)&&this.model(t.definitions.type),J(t.definitions.error)&&this.error(t.definitions.error),J(t.extender.macro)&&(this.extender.macro={...this.extender.macro,...t.extender.macro});for(let{method:e,path:n,handler:r,hooks:i}of Object.values(t.router.history))this.add(e,n,r,i);if(n){n in this.dependencies||(this.dependencies[n]=[]);let e=r===void 0?0:dg(n+JSON.stringify(r));if(this.dependencies[n].some(({checksum:t})=>e===t))return this;this.dependencies[n].push(this.config?.analytic?{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies,stack:t.telemetry?.stack,routes:t.router.history,decorators:t.singleton,store:t.singleton.store,error:t.definitions.error,derive:t.event.transform?.filter(e=>e?.subType===`derive`).map(e=>({fn:e.toString(),stack:Error().stack??``})),resolve:t.event.transform?.filter(e=>e?.subType===`resolve`).map(e=>({fn:e.toString(),stack:Error().stack??``}))}:{name:t.config.name,seed:t.config.seed,checksum:e,dependencies:t.dependencies}),J(t.event)&&(this.event=pg(this.event,gg(t.event),e))}else J(t.event)&&(this.event=pg(this.event,gg(t.event)));return t.validator.global&&(this.validator.global=sg(this.validator.global,{...t.validator.global})),t.validator.scoped&&(this.validator.local=sg(this.validator.local,{...t.validator.scoped})),this}macro(e,t){if(typeof e==`string`&&!t)throw Error(`Macro function is required`);return typeof e==`string`?this.extender.macro[e]=t:this.extender.macro={...this.extender.macro,...e},this}applyMacro(e,t=e,{iteration:n=0,applied:r={}}={}){if(n>=16)return;let i=this.extender.macro;for(let[a,o]of Object.entries(t)){if(!(a in i))continue;let t=typeof i[a]==`function`?i[a](o):i[a];if(!t||typeof i[a]==`object`&&o===!1)return;let s=dg(a+JSON.stringify(t.seed??o));if(!(s in r)){r[s]=!0;for(let[o,s]of Object.entries(t))if(o!==`seed`){if(o in Hg){Cg(e,o,s),delete e[a];continue}if(o===`detail`){e.detail||={},e.detail=ng(e.detail,s),delete e[a];continue}if(o in i){this.applyMacro(e,{[o]:s},{applied:r,iteration:n+1}),delete e[a];continue}switch((o===`derive`||o===`resolve`)&&typeof s==`function`&&(s={fn:s,subType:o}),typeof e[o]){case`function`:e[o]=[e[o],s];break;case`object`:Array.isArray(e[o])?e[o].push(s):e[o]=[e[o],s];break;case`undefined`:e[o]=s;break}delete e[a]}}}}mount(t,n,r){if(t instanceof e||typeof t==`function`||t.length===0||t===`/`){let i=typeof t==`function`?t:t instanceof e?t.compile().fetch:n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw Error(`Invalid handler`)})();return this.route(`ALL`,`/*`,({request:e,path:t})=>i(new Request($h(e.url,t),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body})),{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}let i=n instanceof e?n.compile().fetch:typeof n==`function`?n:(()=>{throw Error(`Invalid handler`)})(),a=t.length-(t.endsWith(`*`)?1:0),o=({request:e,path:t})=>i(new Request($h(e.url,t.slice(a)||`/`),{method:e.method,headers:e.headers,signal:e.signal,credentials:e.credentials,referrerPolicy:e.referrerPolicy,duplex:e.duplex,redirect:e.redirect,mode:e.mode,keepalive:e.keepalive,integrity:e.integrity,body:e.body}));return this.route(`ALL`,t,o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this.route(`ALL`,t+(t.endsWith(`/`)?`*`:`/*`),o,{parse:`none`,...r,detail:{...r?.detail,hide:!0},config:{mount:i}}),this}get(e,t,n){return this.add(`GET`,e,t,n),this}post(e,t,n){return this.add(`POST`,e,t,n),this}put(e,t,n){return this.add(`PUT`,e,t,n),this}patch(e,t,n){return this.add(`PATCH`,e,t,n),this}delete(e,t,n){return this.add(`DELETE`,e,t,n),this}options(e,t,n){return this.add(`OPTIONS`,e,t,n),this}all(e,t,n){return this.add(`ALL`,e,t,n),this}head(e,t,n){return this.add(`HEAD`,e,t,n),this}connect(e,t,n){return this.add(`CONNECT`,e,t,n),this}route(e,t,n,r){return this.add(e.toUpperCase(),t,n,r,r?.config),this}ws(e,t){return this[`~adapter`].ws?this[`~adapter`].ws(this,e,t):console.warn(`Current adapter doesn't support WebSocket`),this}state(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return!n||!J(n)?this:t?(t in this.singleton.store?this.singleton.store[t]=ng(this.singleton.store[t],n,{override:r===`override`}):this.singleton.store[t]=n,this):(n===null||(this.singleton.store=ng(this.singleton.store,n,{override:r===`override`})),this);case`function`:return t?(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n):this.singleton.store=n(this.singleton.store),this;default:return(r===`override`||!(t in this.singleton.store))&&(this.singleton.store[t]=n),this}}decorate(e,t,n){t===void 0?(n=e,e={as:`append`},t=``):n===void 0&&(typeof e==`string`?(n=t,t=e,e={as:`append`}):typeof e==`object`&&(n=t,t=``));let{as:r}=e;if(typeof t!=`string`)return this;switch(typeof n){case`object`:return t?(t in this.singleton.decorator?this.singleton.decorator[t]=ng(this.singleton.decorator[t],n,{override:r===`override`}):this.singleton.decorator[t]=n,this):(n===null||(this.singleton.decorator=ng(this.singleton.decorator,n,{override:r===`override`})),this);case`function`:return t?(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n):this.singleton.decorator=n(this.singleton.decorator),this;default:return(r===`override`||!(t in this.singleton.decorator))&&(this.singleton.decorator[t]=n),this}}derive(e,t){t||(t=e,e={as:`local`});let n={subType:`derive`,fn:t};return this.onTransform(e,n)}model(e,t){let n=e=>{let t={};for(let n in e)`~standard`in e[n]||(t[n]=e[n]);return t};switch(typeof e){case`object`:let r={},i=Object.entries(e);if(!i.length)return this;for(let[e,t]of i)e in this.definitions.type||(`~standard`in t?this.definitions.type[e]=t:(r[e]=this.definitions.type[e]=t,r[e].$id??=`#/components/schemas/${e}`));return this.definitions.typebox=X.Module({...this.definitions.typebox.$defs,...r}),this;case`function`:let a=e(this.definitions.type);return this.definitions.type=a,this.definitions.typebox=X.Module(n(a)),this;case`string`:if(!t)break;if(this.definitions.type[e]=t,`~standard`in t)return this;let o={...t,id:t.$id??`#/components/schemas/${e}`};return this.definitions.typebox=X.Module({...this.definitions.typebox.$defs,...o}),this}return t?(this.definitions.type[e]=t,`~standard`in t||(this.definitions.typebox=X.Module({...this.definitions.typebox.$defs,[e]:t})),this):this}Ref(e){return X.Ref(e)}mapDerive(e,t){t||(t=e,e={as:`local`});let n={subType:`mapDerive`,fn:t};return this.onTransform(e,n)}affix(e,t,n){if(n===``)return this;let r=[`_`,`-`,` `],i=e=>e[0].toUpperCase()+e.slice(1),a=e===`prefix`?(e,t)=>r.includes(e.at(-1)??``)?e+t:e+i(t):r.includes(n.at(-1)??``)?(e,t)=>t+e:(e,t)=>t+i(e),o=e=>{let t={};switch(e){case`decorator`:for(let e in this.singleton.decorator)t[a(n,e)]=this.singleton.decorator[e];this.singleton.decorator=t;break;case`state`:for(let e in this.singleton.store)t[a(n,e)]=this.singleton.store[e];this.singleton.store=t;break;case`model`:for(let e in this.definitions.type)t[a(n,e)]=this.definitions.type[e];this.definitions.type=t;break;case`error`:for(let e in this.definitions.error)t[a(n,e)]=this.definitions.error[e];this.definitions.error=t;break}},s=Array.isArray(t)?t:[t];for(let e of s.some(e=>e===`all`)?[`decorator`,`state`,`model`,`error`]:s)o(e);return this}prefix(e,t){return this.affix(`prefix`,e,t)}suffix(e,t){return this.affix(`suffix`,e,t)}compile(){return this[`~adapter`].isWebStandard?(this.fetch=this.config.aot?Gv(this):uy(this),typeof this.server?.reload==`function`&&this.server.reload({...this.server||{},fetch:this.fetch}),this):(typeof this.server?.reload==`function`&&this.server.reload(this.server||{}),this._handle=Gv(this),this)}get modules(){return this.promisedModules}},my=py;
/**
* @license
*
* MIT License
*
* Copyright (c) 2020 Evgeny Poberezkin
*
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
*
* The above copyright notice and this permission notice shall be included in all
* copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
* SOFTWARE.
*/
export{ie as a,f_ as i,Y as n,X as r,my as t};