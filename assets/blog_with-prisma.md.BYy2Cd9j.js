import{F as e,_ as t,p as n,te as r,u as i,v as a}from"./chunks/runtime-core.esm-bundler.D02XvB7A.js";import{t as o}from"./chunks/Layout.CgtC_9GJ.js";const s=JSON.parse(`{"title":"用 Elysia 加速你的下一个 Prisma 服务器","description":"在 Bun 和 Elysia 的支持下，我们进入了一个全新的开发者体验时代。通过 Prisma，我们可以加速与数据库的交互，而 Elysia 加速了我们在开发者体验和性能方面创建后台 Web 服务器的过程。","frontmatter":{"title":"用 Elysia 加速你的下一个 Prisma 服务器","sidebar":false,"editLink":false,"search":false,"head":[["meta",{"property":"og:title","content":"用 Elysia 加速你的下一个 Prisma 服务器"}],["meta",{"name":"description","content":"在 Bun 和 Elysia 的支持下，我们进入了一个全新的开发者体验时代。通过 Prisma，我们可以加速与数据库的交互，而 Elysia 加速了我们在开发者体验和性能方面创建后台 Web 服务器的过程。"}],["meta",{"property":"og:description","content":"在 Bun 和 Elysia 的支持下，我们进入了一个全新的开发者体验时代。通过 Prisma，我们可以加速与数据库的交互，而 Elysia 加速了我们在开发者体验和性能方面创建后台 Web 服务器的过程。"}],["meta",{"property":"og:image","content":"https://elysiajs.com/blog/with-prisma/prism.webp"}],["meta",{"property":"twitter:image","content":"https://elysiajs.com/blog/with-prisma/prism.webp"}]]},"headers":[],"relativePath":"blog/with-prisma.md","filePath":"blog/with-prisma.md","lastUpdated":1758208104000}`);var c=Object.assign({name:`blog/with-prisma.md`},{setup(s){return(s,c)=>(e(),n(`div`,null,[a(o,{title:`用 Elysia 加速你的下一个 Prisma 服务器`,src:`/blog/with-prisma/prism.webp`,alt:`中心放置的三角棱镜`,author:`saltyaom`,date:`2023 年 6 月 4 日`},{default:r(()=>c[0]||=[t(` Prisma 是一个著名的 TypeScript ORM，以其优秀的开发者体验而闻名。 `,-1),i(`p`,null,`它提供了类型安全和直观的 API，使我们能够使用流畅自然的语法与数据库进行交互。`,-1),i(`p`,null,`编写数据库查询就像使用 TypeScript 的自动补全编写数据结构一样简单，随后 Prisma 会生成高效的 SQL 查询并在后台处理数据库连接。`,-1),i(`p`,null,`Prisma 的一个突出特点是它与流行数据库的无缝集成，例如：`,-1),i(`ul`,null,[i(`li`,null,`PostgreSQL`),i(`li`,null,`MySQL`),i(`li`,null,`SQLite`),i(`li`,null,`SQL Server`),i(`li`,null,`MongoDB`),i(`li`,null,`CockroachDB`)],-1),i(`p`,null,`因此，我们可以灵活地选择最适合我们项目需求的数据库，而不必妥协于 Prisma 带来的强大性能。`,-1),i(`p`,null,`这意味着你可以专注于真正重要的事情：构建应用程序逻辑。`,-1),i(`p`,null,`Prisma 是 Elysia 的灵感之一，其声明性 API 和流畅的开发体验让人愉悦。`,-1),i(`p`,null,[t(`现在，我们可以通过 `),i(`a`,{href:`https://bun.sh/blog/bun-v0.6.7`,target:`_blank`,rel:`noreferrer`},`Bun 0.6.7 的发布`),t(` 让期待已久的想法成真，Bun 现在原生支持 Prisma。`)],-1),i(`h2`,{id:`elysia`,tabindex:`-1`},[t(`Elysia `),i(`a`,{class:`header-anchor`,href:`#elysia`,"aria-label":`Permalink to “Elysia”`},`​`)],-1),i(`p`,null,`当你问应该使用什么框架和 Bun 搭配时，Elysia 是显而易见的选择。`,-1),i(`p`,null,`虽然你可以使用 Express 与 Bun，但 Elysia 是专为 Bun 构建的。`,-1),i(`p`,null,`Elysia 的性能几乎比 Express 快了 19 倍，结合了声明性 API，能够创建统一的类型系统和端到端的类型安全。`,-1),i(`p`,null,`Elysia 以其流畅的开发者体验而闻名，尤其是自早期以来 Elysia 就被设计用于与 Prisma 一起使用。`,-1),i(`p`,null,`凭借 Elysia 的严格类型验证，我们可以轻松地使用声明性 API 集成 Elysia 和 Prisma。`,-1),i(`p`,null,`换句话说，Elysia 确保运行时类型与 TypeScript 的类型始终同步，使其表现得像一种类型严格的语言，你可以完全信任类型系统，提前发现任何类型错误，减少与类型相关的调试错误。`,-1),i(`h2`,{id:`设置`,tabindex:`-1`},[t(`设置 `),i(`a`,{class:`header-anchor`,href:`#设置`,"aria-label":`Permalink to “设置”`},`​`)],-1),i(`p`,null,[t(`我们开始的第一步是运行 `),i(`code`,null,`bun create`),t(` 来设置一个 Elysia 服务器。`)],-1),i(`div`,{class:`language-bash`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`bash`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`bun`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` create`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` elysia`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` elysia-prisma`)])])])],-1),i(`p`,null,[t(`其中 `),i(`code`,null,`elysia-prisma`),t(` 是我们的项目名称（文件夹目的地），可以自由更改为你喜欢的名称。`)],-1),i(`p`,null,`现在进入我们的文件夹，安装 Prisma CLI 作为开发依赖。`,-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`bun add `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`-`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`d prisma`)])])])],-1),i(`p`,null,[t(`然后我们可以使用 `),i(`code`,null,`prisma init`),t(` 设置 Prisma 项目。`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`bunx prisma init`)])])])],-1),i(`p`,null,[i(`code`,null,`bunx`),t(` 是 Bun 的命令，相当于 `),i(`code`,null,`npx`),t(`，允许我们执行包的执行文件。`)],-1),i(`p`,null,[t(`设置完成后，我们可以看到 Prisma 会更新 `),i(`code`,null,`.env`),t(` 文件，并生成一个名为 `),i(`strong`,null,`prisma`),t(` 的文件夹，文件夹内有 `),i(`strong`,null,`schema.prisma`),t(` 文件。`)],-1),i(`p`,null,[i(`strong`,null,`schema.prisma`),t(` 是使用 Prisma 的 schema 语言定义的数据库模型。`)],-1),i(`p`,null,[t(`让我们将 `),i(`strong`,null,`schema.prisma`),t(` 文件更新如下作为演示：`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`generator client {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  provider `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` "prisma-client-js"`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`}`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`datasource db {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  provider `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` "postgresql"`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  url      `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` env`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`"DATABASE_URL"`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`}`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`model User {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  id        Int     @id @`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`default`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`autoincrement`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`())`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  username  String  @unique`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`  password  String`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`}`)])])])],-1),i(`p`,null,[t(`这段代码告诉 Prisma 我们想创建一个名为 `),i(`strong`,null,`User`),t(` 的表，包含以下列：`)],-1),i(`table`,{tabindex:`0`},[i(`thead`,null,[i(`tr`,null,[i(`th`,null,`列名`),i(`th`,null,`类型`),i(`th`,null,`约束`)])]),i(`tbody`,null,[i(`tr`,null,[i(`td`,null,`id`),i(`td`,null,`数字`),i(`td`,null,`主键并自动增值`)]),i(`tr`,null,[i(`td`,null,`username`),i(`td`,null,`字符串`),i(`td`,null,`唯一`)]),i(`tr`,null,[i(`td`,null,`password`),i(`td`,null,`字符串`),i(`td`,null,`-`)])])],-1),i(`p`,null,[t(`然后 Prisma 会读取模式，并根据 `),i(`code`,null,`.env`),t(` 文件中的 DATABASE_URL，因此在同步我们的数据库之前，我们需要先定义 `),i(`code`,null,`DATABASE_URL`),t(`。`)],-1),i(`p`,null,`由于我们没有正在运行的数据库，可以使用 Docker 设置一个：`,-1),i(`div`,{class:`language-bash`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`bash`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`docker`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` run`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` -p`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 5432:5432`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` -e`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` POSTGRES_PASSWORD=`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`12345678`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` -d`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` postgres`)])])])],-1),i(`p`,null,[t(`现在进入项目根目录下的 `),i(`code`,null,`.env`),t(` 文件并编辑：`)],-1),i(`div`,{class:`language-`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`}),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,null,`DATABASE_URL="postgresql://postgres:12345678@localhost:5432/db?schema=public"`)])])])],-1),i(`p`,null,[t(`然后我们可以运行 `),i(`code`,null,`prisma migrate`),t(` 来同步数据库与 Prisma 模式：`)],-1),i(`div`,{class:`language-bash`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`bash`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`bunx`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` prisma`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` migrate`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` dev`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` --name`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` init`)])])])],-1),i(`p`,null,`之后 Prisma 将根据我们的模式生成强类型的 Prisma Client 代码。`,-1),i(`p`,null,`这意味着我们可以在代码编辑器中获得自动补全和类型检查，在编译时捕获潜在错误，而不是在运行时。`,-1),i(`h2`,{id:`进入代码`,tabindex:`-1`},[t(`进入代码 `),i(`a`,{class:`header-anchor`,href:`#进入代码`,"aria-label":`Permalink to “进入代码”`},`​`)],-1),i(`p`,null,[t(`在我们的 `),i(`strong`,null,`src/index.ts`),t(` 中，更新 Elysia 服务器以创建一个简单的用户注册接口。`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark has-diff`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { Elysia } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'elysia'`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { PrismaClient } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@prisma/client'`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` db`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` PrismaClient`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`() `)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` app`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` Elysia`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`post`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`( `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        '/sign-up'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`, `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`        async`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` ({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`body`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=>`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` db.user.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`create`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            data: body `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }) `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    ) `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`listen`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`3000`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`console.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`log`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"    `🦊 Elysia 正在运行于 ${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`hostname`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}:${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`port`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}`")]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,`我们刚刚创建了一个简单的接口，用于使用 Elysia 和 Prisma 向数据库插入新用户。`,-1),i(`div`,{class:`tip custom-block`},[i(`p`,{class:`custom-block-title custom-block-title-default`},`TIP`),i(`p`,null,[i(`strong`,null,`重要`),t(`的是，在返回 Prisma 函数时，你应该始终将回调函数标记为 async。`)]),i(`p`,null,`因为 Prisma 函数不返回原生 Promise，Elysia 不能动态处理自定义 Promise 类型，但通过静态代码分析，通过将回调函数标记为 async，Elysia 会尝试等待函数的返回类型，从而允许我们映射 Prisma 结果。`)],-1),i(`p`,null,`现在问题是，body 可能是任何内容，而不仅限于我们预期定义的类型。`,-1),i(`p`,null,`我们可以通过使用 Elysia 的类型系统来改进这一点。`,-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark has-diff`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { Elysia, t } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'elysia'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { PrismaClient } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@prisma/client'`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` db`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` PrismaClient`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` app`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` Elysia`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`post`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        '/sign-up'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`, `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`        async`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` ({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`body`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=>`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` db.user.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`create`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            data: body`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }),`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        { `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            body: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(), `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                password: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    minLength: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`8`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                }) `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }) `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        } `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    )`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`listen`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`3000`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`console.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`log`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"    `🦊 Elysia 正在运行于 ${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`hostname`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}:${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`port`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}`")]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,[t(`这告诉 Elysia 验证传入请求的 body 是否匹配指定的形状，并将回调中 `),i(`code`,null,`body`),t(` 的 TypeScript 类型更新为匹配相同类型：`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6A737D`,"--shiki-dark":`#6A737D`}},`// 'body' 现在的类型如下：`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`{`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`    username`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`: string`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`    password`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`: string`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`}`)])])])],-1),i(`p`,null,`这意味着如果这个形状与数据库表不匹配，它会立即给你警告。`,-1),i(`p`,null,`这在你需要编辑表格或执行迁移时非常有效，Elysia 可以逐行记录错误，因为类型冲突在达到生产环境之前。`,-1),i(`h2`,{id:`错误处理`,tabindex:`-1`},[t(`错误处理 `),i(`a`,{class:`header-anchor`,href:`#错误处理`,"aria-label":`Permalink to “错误处理”`},`​`)],-1),i(`p`,null,[t(`由于我们的 `),i(`code`,null,`username`),t(` 字段是唯一的，有时 Prisma 可能会抛出错误，可能会在尝试注册时意外重复 `),i(`code`,null,`username`),t(`，如：`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`Invalid `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"`prisma.user.create()`"),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` invocation`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`:`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`Unique constraint failed on the `),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`fields`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`: (`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"`username`"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,[t(`默认的 Elysia 错误处理程序可以自动处理这种情况，但我们可以通过指定使用 Elysia 的局部 `),i(`code`,null,`onError`),t(` 钩子来改进：`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark has-diff`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { Elysia, t } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'elysia'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { PrismaClient } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@prisma/client'`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` db`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` PrismaClient`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` app`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` Elysia`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`post`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        '/'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`,`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`        async`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` ({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`body`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=>`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` db.user.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`create`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            data: body`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }),`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        {`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`            error`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`code`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) {  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                switch`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` (code) {  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#6A737D`,"--shiki-dark":`#6A737D`}},`                    // Prisma P2002: "Unique constraint failed on the {constraint}"`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                    case`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'P2002'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`:  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                        return`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` {  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                            error: `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`'用户名必须是唯一的'`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                        }  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                }  `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            },  `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            body: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(),`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                password: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    minLength: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`8`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                })`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            })`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    )`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`listen`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`3000`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`console.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`log`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"    `🦊 Elysia 正在运行于 ${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`hostname`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}:${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`port`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}`")]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,[t(`使用 `),i(`code`,null,`error`),t(` 钩子，回调内部抛出的任何错误都会传递到 `),i(`code`,null,`error`),t(` 钩子，允许我们定义自定义错误处理。`)],-1),i(`p`,null,[t(`根据 `),i(`a`,{href:`https://www.prisma.io/docs/reference/api-reference/error-reference#p2002`,target:`_blank`,rel:`noreferrer`},`Prisma 文档`),t(`，错误代码 'P2002' 意味着执行查询时违反了唯一约束。`)],-1),i(`p`,null,[t(`由于此表只有一个 `),i(`code`,null,`username`),t(` 字段是唯一的，我们可以推断该错误是由于用户名不唯一引起，因此我们返回自定义错误消息：`)],-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`{`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`    error`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`: `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`'用户名必须是唯一的'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`}`)])])])],-1),i(`p`,null,`当唯一约束失败时，这将返回我们自定义错误消息的 JSON 等效项。`,-1),i(`p`,null,`使我们能够流畅地从 Prisma 错误中定义任何自定义错误。`,-1),i(`h2`,{id:`奖励-参考模式`,tabindex:`-1`},[t(`奖励：参考模式 `),i(`a`,{class:`header-anchor`,href:`#奖励-参考模式`,"aria-label":`Permalink to “奖励：参考模式”`},`​`)],-1),i(`p`,null,[t(`当我们的服务器变得复杂，类型变得冗余并成为模板代码时，使用 `),i(`strong`,null,`参考模式`),t(` 可以改进内联的 Elysia 类型。`)],-1),i(`p`,null,`简单地说，我们可以为我们的模式命名，并通过名称引用类型。`,-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark has-diff`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { Elysia, t } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'elysia'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { PrismaClient } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@prisma/client'`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` db`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` PrismaClient`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` app`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` Elysia`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`model`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        'user.sign'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(), `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            password: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                minLength: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`8`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }) `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }) `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    }) `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`post`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        '/'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`,`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`        async`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` ({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`body`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=>`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` db.user.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`create`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            data: body`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }),`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`            error`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`code`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                switch`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` (code) {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6A737D`,"--shiki-dark":`#6A737D`}},`                    // Prisma P2002: "Unique constraint failed on the {constraint}"`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                    case`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'P2002'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`:`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                        return`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                            error: `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`'用户名必须是唯一的'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                        }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            },`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            body: `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`'user.sign'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`, `)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            body: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(), `)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                password: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    minLength: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`8`)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                }) `)]),t(`
`),i(`span`,{class:`line diff remove`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }) `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    )`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`listen`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`3000`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`console.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`log`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"    `🦊 Elysia 正在运行于 ${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`hostname`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}:${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`port`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}`")]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,`这与使用内联相同，但你只需定义一次，然后通过名称引用模式以消除冗余的验证代码。`,-1),i(`p`,null,`TypeScript 和验证代码会按预期工作。`,-1),i(`h2`,{id:`奖励-文档`,tabindex:`-1`},[t(`奖励：文档 `),i(`a`,{class:`header-anchor`,href:`#奖励-文档`,"aria-label":`Permalink to “奖励：文档”`},`​`)],-1),i(`p`,null,`作为奖励，Elysia 的类型系统也是 OpenAPI Schema 3.0 的兼容版，这意味着它能够与支持 OpenAPI Schema 的工具（如 Swagger）生成文档。`,-1),i(`p`,null,`我们可以使用 Elysia Swagger 插件以一行代码生成 API 文档。`,-1),i(`div`,{class:`language-bash`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`bash`),i(`pre`,{class:`shiki shiki-themes github-light github-dark`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`bun`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` add`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` @elysiajs/swagger`)])])])],-1),i(`p`,null,`然后只需添加插件：`,-1),i(`div`,{class:`language-ts`},[i(`button`,{title:`Copy Code`,class:`copy`}),i(`span`,{class:`lang`},`ts`),i(`pre`,{class:`shiki shiki-themes github-light github-dark has-diff`,style:{"--shiki-light":`#24292e`,"--shiki-dark":`#e1e4e8`,"--shiki-light-bg":`#fff`,"--shiki-dark-bg":`#24292e`},tabindex:`0`,dir:`ltr`},[i(`code`,null,[i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { Elysia, t } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'elysia'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { PrismaClient } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@prisma/client'`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`import`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` { swagger } `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`from`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` '@elysiajs/swagger'`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` db`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` PrismaClient`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`const`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},` app`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` =`),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},` new`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},` Elysia`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`use`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`swagger`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`()) `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`post`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`        '/'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`,`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`        async`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` ({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`body`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) `),i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`=>`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            db.user.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`create`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                data: body,`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                select: { `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    id: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`true`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`, `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    username: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`true`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                } `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }),`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`            error`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `),i(`span`,{style:{"--shiki-light":`#E36209`,"--shiki-dark":`#FFAB70`}},`code`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` }) {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                switch`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` (code) {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#6A737D`,"--shiki-dark":`#6A737D`}},`                    // Prisma P2002: "Unique constraint failed on the {constraint}"`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                    case`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},` 'P2002'`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`:`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#D73A49`,"--shiki-dark":`#F97583`}},`                        return`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},` {`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                            error: `),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`'用户名必须是唯一的'`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                        }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            },`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            body: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(),`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                password: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                    minLength: `),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`8`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                })`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }),`)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            response: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Object`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`({ `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                id: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`Number`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(), `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`                username: t.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`String`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`() `)]),t(`
`),i(`span`,{class:`line diff add`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`            }) `)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`        }`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    )`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`    .`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`listen`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`),i(`span`,{style:{"--shiki-light":`#005CC5`,"--shiki-dark":`#79B8FF`}},`3000`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)]),t(`
`),i(`span`,{class:`line`}),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`console.`),i(`span`,{style:{"--shiki-light":`#6F42C1`,"--shiki-dark":`#B392F0`}},`log`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`(`)]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"    `🦊 Elysia 正在运行于 ${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`hostname`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}:${"),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`app`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`server`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},`?.`),i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`port`),i(`span`,{style:{"--shiki-light":`#032F62`,"--shiki-dark":`#9ECBFF`}},"}`")]),t(`
`),i(`span`,{class:`line`},[i(`span`,{style:{"--shiki-light":`#24292E`,"--shiki-dark":`#E1E4E8`}},`)`)])])])],-1),i(`p`,null,`这就是创建一个良好定义的 API 文档所需的一切。`,-1),i(`img`,{class:`-png`,src:`/blog/with-prisma/swagger.webp`,alt:`通过 Elysia 生成的 Swagger 文档`},null,-1),i(`p`,null,[t(`由于严格定义类型的文档，我们发现由于不应返回私密信息而意外返回了 `),i(`code`,null,`password`),t(` 字段。`)],-1),i(`p`,null,[t(`得益于 Elysia 的类型系统，我们定义响应不应包含 `),i(`code`,null,`password`),t(`，这会自动警告我们 Prisma 查询返回了密码，允许我们提前修复这个问题。`)],-1),i(`p`,null,`此外，我们无须担心可能会忘记 OpenAPI Schema 3.0 的规范，因为我们也有自动补全和类型安全。`,-1),i(`p`,null,[t(`我们可以用 `),i(`code`,null,`detail`),t(` 定义我们的路由细节，它也遵循 OpenAPI Schema 3.0，因此我们可以轻松创建文档。`)],-1),i(`h2`,{id:`接下来是什么`,tabindex:`-1`},[t(`接下来是什么 `),i(`a`,{class:`header-anchor`,href:`#接下来是什么`,"aria-label":`Permalink to “接下来是什么”`},`​`)],-1),i(`p`,null,`在 Bun 和 Elysia 的支持下，我们进入了一个全新的开发者体验时代。`,-1),i(`p`,null,`通过 Prisma，我们可以加速与数据库的交互，Elysia 则加速了我们在开发者体验和性能方面创建后台 Web 服务器的过程。`,-1),i(`blockquote`,null,[i(`p`,null,`与之工作是一种绝对的乐趣。`)],-1),i(`p`,null,`Elysia 正在努力创建一个更好的开发者体验的新标准，以 Bun 构建高性能的 TypeScript 服务器，能够与 Go 和 Rust 的性能相匹配。`,-1),i(`p`,null,[t(`如果你在寻找学习 Bun 的起点，可以考虑看看 Elysia ，特别是在 `),i(`a`,{href:`/eden/overview.html`},`端到端类型安全`),t(` 方面，类似于 tRPC，但基于 REST 标准，而无需任何代码生成。`)],-1),i(`p`,null,[t(`如果你对 Elysia 感兴趣，欢迎查看我们的 `),i(`a`,{href:`https://discord.gg/eaFJ2KDJck`,target:`_blank`,rel:`noreferrer`},`Discord 服务器`),t(` 或查看 `),i(`a`,{href:`https://github.com/elysiajs/elysia`,target:`_blank`,rel:`noreferrer`},`Elysia 的 GitHub`)],-1)]),_:1,__:[0]})]))}});export{s as __pageData,c as default};